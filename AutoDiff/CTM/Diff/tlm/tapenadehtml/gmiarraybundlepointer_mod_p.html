<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">! Module implements a derived type to support an "array of arrays" in F90.</code>
<code class="comment">! The derived type is not opaque - a compromise to minimize the impact on</code>
<code class="comment">! legacy code that uses the original data structure (a 4D array).</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="keyword">MODULE </code><code class="funcname">GMIARRAYBUNDLEPOINTER_MOD</code>
  <code class="keyword">IMPLICIT NONE</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!-------------------------------------------------------------------------</code>
  PRIVATE 
<code class="comment">! derived type</code>
  PUBLIC t_gmiarraybundle
<code class="comment">! constructor</code>
  PUBLIC constructarraybundle
<code class="comment">! destructor</code>
  PUBLIC cleanarraypointer
<code class="comment">! accessor</code>
  PUBLIC setarraypointer
<code class="comment">! accessor</code>
  PUBLIC getarraypointer
<code class="comment">! Derived type has public components for ease of use.</code>
<code class="comment">! Strong encapsulation would require intrusive changes</code>
<code class="comment">! in bothe GEOS and GMI.</code>
  <code class="keyword">TYPE </code><code class="typename">T_GMIARRAYBUNDLE</code>
      <code class="typename">REAL*8</code>, <code class="typename">POINTER </code>:: <code class="vardecl">parray3d</code>(:, :, :) =&gt; <code class="funcname">NULL</code>()
  <code class="keyword">END TYPE </code>T_GMIARRAYBUNDLE
  <code class="keyword">INTERFACE </code><code class="funcname">CLEANARRAYPOINTER</code>
      <code class="keyword">MODULE PROCEDURE </code><code class="funcname">CLEANSCALAR</code>
      <code class="keyword">MODULE PROCEDURE </code><code class="funcname">CLEANVECTOR</code>
  <code class="keyword">END INTERFACE</code>

<a name="constructarraybundle"></a>
<code class="keyword">CONTAINS</code>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">!-------------------------------------------------------------------------</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! Initialize a bundle from an already allocated 4D array.</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">FUNCTION </code><code class="funcname">CONSTRUCTARRAYBUNDLE</code>(<code class="vardecl">oldarray</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">ju1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="label">&</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="label">&   </code><code class="vardecl">numspecies</code>) RESULT (BUNDLE)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">ju1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">numspecies</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! I,J,K,species</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">TARGET </code>:: <code class="vardecl">oldarray</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">ju1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">bundle</code>(:)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">ALLOCATE(</code>bundle<code class="keyword">(</code>numspecies<code class="keyword">))</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,numspecies</a>
      <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETARRAYPOINTER</code>(bundle(i), oldarray(i1, ju1, k1, i), i1, i2, <code class="label">&</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="label">&                    </code>ju1, j2, k1, k2)</a>
<a name="setarraypointer"></a>    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END FUNCTION </code><code class="funcname">CONSTRUCTARRAYBUNDLE</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">!-------------------------------------------------------------------------</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! Establish a link to a specified 3D target</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! (pretend that encapsulation is enforced)</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">SETARRAYPOINTER</code>(<code class="vardecl">this</code>, <code class="vardecl">newtarget</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">ju1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">ju1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">TYPE(</code><code class="typename">T_GMIARRAYBUNDLE</code><code class="keyword">) </code>:: <code class="vardecl">this</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">TARGET </code>:: <code class="vardecl">newtarget</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">ju1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! The following could fail on some compilers if a temporary copy of</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! oldArray is generated.  Unlikely in this context, though.</code></a>
<a name="getarraypointer"></a>    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile">this%parray3d =&gt; newtarget</a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">SETARRAYPOINTER</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">!-------------------------------------------------------------------------</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! Retrieve pointer (pretend that encapsulation is enforced)</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">FUNCTION </code><code class="funcname">GETARRAYPOINTER</code>(<code class="vardecl">this</code>) RESULT (PTR)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">TYPE(</code><code class="typename">T_GMIARRAYBUNDLE</code><code class="keyword">) </code>:: <code class="vardecl">this</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ptr</code>(:, :, :)</a>
<a name="cleanscalar"></a>    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile">ptr =&gt; this%parray3d</a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END FUNCTION </code><code class="funcname">GETARRAYPOINTER</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">!-------------------------------------------------------------------------</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! Nullify the internal pointer (pretend encapsulation is enforced)</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CLEANSCALAR</code>(<code class="vardecl">this</code>)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">TYPE(</code><code class="typename">T_GMIARRAYBUNDLE</code><code class="keyword">) </code>:: <code class="vardecl">this</code></a>
<a name="cleanvector"></a>    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">NULLIFY(</code>this%parray3d<code class="keyword">)</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CLEANSCALAR</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">!-------------------------------------------------------------------------</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! Clean an array of derived types. First clean each element, and</code></a>
<a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="comment">! then deallocate the array.</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CLEANVECTOR</code>(<code class="vardecl">this</code>, <code class="vardecl">status</code>)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">status</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">this</code>(:)</a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIZE</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,<code class="funcname">SIZE</code>(this)</a>
      <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">DEALLOCATE(</code>this(i)%parray3d<code class="keyword">)</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">DEALLOCATE(</code>this, <code class="keyword">stat</code>=status<code class="keyword">)</code></a>
  <a href="null.html#gmiarraybundlepointer_mod_d" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CLEANVECTOR</code></a>
<code class="keyword">END MODULE </code><code class="funcname">GMIARRAYBUNDLEPOINTER_MOD</code>
</pre>
</body>
