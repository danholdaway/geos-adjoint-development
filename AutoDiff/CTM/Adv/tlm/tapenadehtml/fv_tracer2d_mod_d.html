<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="keyword">MODULE </code><code class="funcname">FV_TRACER2D_MOD_D</code>
  <code class="keyword">USE </code><code class="funcname">FV_ARRAYS_MOD</code>, <code class="keyword">ONLY </code>: fvprc, real4, real8
  <code class="keyword">USE </code><code class="funcname">TP_CORE_MOD_D</code>, <code class="keyword">ONLY </code>: fv_tp_2d, fv_tp_2d_tlm
  <code class="keyword">USE </code><code class="funcname">FV_GRID_TOOLS_MOD_D</code>, <code class="keyword">ONLY </code>: area, rarea, dxa, dya, dx, dy
  <code class="keyword">USE </code><code class="funcname">FV_GRID_UTILS_MOD_D</code>, <code class="keyword">ONLY </code>: sina_u, sina_v, sin_sg
  <code class="keyword">USE </code><code class="funcname">FV_MP_MOD_D</code>, <code class="keyword">ONLY </code>: gid, domain, mp_reduce_max, ng, isd, ied, jsd,<code class="label">&</code>
<code class="label">& </code>jed, is, js, ie, je
  <code class="keyword">USE </code><code class="funcname">MPP_DOMAINS_MOD_D</code>, <code class="keyword">ONLY </code>: mpp_update_domains, <code class="label">&</code>
<code class="label">& </code>mpp_update_domains_tlm, cgrid_ne, mpp_get_boundary
  <code class="keyword">USE </code><code class="funcname">FV_TIMING_MOD</code>, <code class="keyword">ONLY </code>: timing_on, timing_off
  <code class="keyword">IMPLICIT NONE</code>
  PRIVATE 
  PUBLIC tracer_2d, tracer_2d_1l, offline_tracer_advection
  PUBLIC tracer_2d_tlm, tracer_2d_1l_tlm, offline_tracer_advection_tlm
<a name="offline_tracer_advection_tlm"></a>
<code class="keyword">CONTAINS</code>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!  Differentiation of offline_tracer_advection in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   variations   of useful results: q</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   with respect to varying inputs: q</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   RW status of diff variables: q:in-out</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">OFFLINE_TRACER_ADVECTION_TLM</code>(<code class="vardecl">q</code>, <code class="vardecl">q_tl</code>, <code class="vardecl">ple0</code>, <code class="vardecl">ple1</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code><code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi905"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="vardecl">ak</code>, <code class="vardecl">bk</code>, <code class="vardecl">ptop</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>, <code class="vardecl">hord</code>, <code class="vardecl">kord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">dt</code>, <code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi906"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">z_tracer</code>, <code class="vardecl">fill</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi905" target="origFile"><code class="keyword">USE </code><code class="funcname">FV_MAPZ_MOD_D</code>, <code class="keyword">ONLY </code>: map1_q2, map1_q2_tlm</a>
    <a href="null_p.html#fv_tracer2d_modi906" target="origFile"><code class="keyword">USE </code><code class="funcname">FV_FILL_MOD_D</code>, <code class="keyword">ONLY </code>: fillz, fillz_tlm</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!do k = 1,npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   do j = js,je</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      do i = is,ie</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!         q(i,j,k,iq) = q1(i,j,k) * scalingFactors(k)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   enddo</code></a>
<a name="offline_tracer_advection_tlmi907"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!enddo</code></a>
<a name="offline_tracer_advection_tlmi908"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! nq loop</code></a>
<a name="offline_tracer_advection_tlmi909"></a>    <a href="null_p.html#fv_tracer2d_modi907" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code></a>
<a name="offline_tracer_advection_tlmi910"></a>    <a href="null_p.html#fv_tracer2d_modi908" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_modi909" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
<a name="offline_tracer_advection_tlmi911"></a><a href="null_p.html#fv_tracer2d_modi910" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
<a name="offline_tracer_advection_tlmi912"></a>    <a href="null_p.html#fv_tracer2d_modi910" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
<a name="offline_tracer_advection_tlmi913"></a>    <a href="null_p.html#fv_tracer2d_modi911" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
<a name="offline_tracer_advection_tlmi914"></a>    <a href="null_p.html#fv_tracer2d_modi912" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
<a name="offline_tracer_advection_tlmi915"></a>    <a href="null_p.html#fv_tracer2d_modi913" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
<a name="offline_tracer_advection_tlmi916"></a>    <a href="null_p.html#fv_tracer2d_modi914" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">z_tracer</code></a>
<a name="offline_tracer_advection_tlmi917"></a>    <a href="null_p.html#fv_tracer2d_modi915" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">fill</code></a>
    <a href="null_p.html#fv_tracer2d_modi916" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a name="offline_tracer_advection_tlmi918"></a><a href="null_p.html#fv_tracer2d_modi917" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_modi917" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple0</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a name="offline_tracer_advection_tlmi919"></a><a href="null_p.html#fv_tracer2d_modi918" target="origFile"><code class="comment">! DELP after dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_modi918" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">ple1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a name="offline_tracer_advection_tlmi920"></a><a href="null_p.html#fv_tracer2d_modi919" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi919" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi921"></a><a href="null_p.html#fv_tracer2d_modi920" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi920" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi922"></a><a href="null_p.html#fv_tracer2d_modi921" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi921" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi923"></a><a href="null_p.html#fv_tracer2d_modi922" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi922" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_modi923" target="origFile"><code class="comment">! Tracers</code></a>
<a name="offline_tracer_advection_tlmi924"></a>    <a href="null_p.html#fv_tracer2d_modi923" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a name="offline_tracer_advection_tlmi925"></a><a href="null_p.html#fv_tracer2d_modi924" target="origFile"><code class="comment">! AK for remapping</code></a>
    <a href="null_p.html#fv_tracer2d_modi924" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ak</code>(<code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a name="offline_tracer_advection_tlmi926"></a><a href="null_p.html#fv_tracer2d_modi925" target="origFile"><code class="comment">! BK for remapping</code></a>
<a name="offline_tracer_advection_tlmi927"></a>    <a href="null_p.html#fv_tracer2d_modi925" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">bk</code>(<code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi926" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ptop</code></a>
<a href="null_p.html#fv_tracer2d_modi927" target="origFile"><code class="comment">! Local Arrays</code></a>
<a name="offline_tracer_advection_tlmi928"></a><a href="null_p.html#fv_tracer2d_modi927" target="origFile"><code class="comment">! X-Dir for MPP Updates</code></a>
    <a href="null_p.html#fv_tracer2d_modi927" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">xl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi929"></a><a href="null_p.html#fv_tracer2d_modi928" target="origFile"><code class="comment">! Y-Dir for MPP Updates</code></a>
    <a href="null_p.html#fv_tracer2d_modi928" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">yl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi930"></a><a href="null_p.html#fv_tracer2d_modi929" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi929" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cxl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi931"></a><a href="null_p.html#fv_tracer2d_modi930" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi930" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cyl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi932"></a><a href="null_p.html#fv_tracer2d_modi931" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi931" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfxl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi933"></a><a href="null_p.html#fv_tracer2d_modi932" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi932" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfyl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi934"></a><a href="null_p.html#fv_tracer2d_modi933" target="origFile"><code class="comment">! Pressure Thickness</code></a>
    <a href="null_p.html#fv_tracer2d_modi933" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dpl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi935"></a><a href="null_p.html#fv_tracer2d_modi934" target="origFile"><code class="comment">! Pressure Thickness</code></a>
    <a href="null_p.html#fv_tracer2d_modi934" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_modi935" target="origFile"><code class="comment">! Local Tracer Arrays</code></a>
<a href="null_p.html#fv_tracer2d_modi935" target="origFile"><code class="comment">! 2D Tracers</code></a>
<a name="offline_tracer_advection_tlmi936"></a>    <a href="null_p.html#fv_tracer2d_modi935" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q1_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_modi936" target="origFile"><code class="comment">! 2D Tracers</code></a>
<a name="offline_tracer_advection_tlmi937"></a>    <a href="null_p.html#fv_tracer2d_modi936" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q2_tl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_modi937" target="origFile"><code class="comment">! 3D Tracers</code></a>
<a name="offline_tracer_advection_tlmi938"></a>    <a href="null_p.html#fv_tracer2d_modi937" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q3</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q3_tl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a name="offline_tracer_advection_tlmi939"></a><a href="null_p.html#fv_tracer2d_modi938" target="origFile"><code class="comment">! Local Buffer Arrarys</code></a>
<a name="offline_tracer_advection_tlmi940"></a>    <a href="null_p.html#fv_tracer2d_modi938" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">wbuffer</code>(<code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi941"></a>    <a href="null_p.html#fv_tracer2d_modi939" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">sbuffer</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi942"></a>    <a href="null_p.html#fv_tracer2d_modi940" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">ebuffer</code>(<code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi941" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">nbuffer</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi943"></a><a href="null_p.html#fv_tracer2d_modi942" target="origFile"><code class="comment">! Local Remap Arrays</code></a>
<a name="offline_tracer_advection_tlmi944"></a>    <a href="null_p.html#fv_tracer2d_modi942" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a name="offline_tracer_advection_tlmi945"></a>    <a href="null_p.html#fv_tracer2d_modi943" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pe2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi944" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="offline_tracer_advection_tlmi946"></a><a href="null_p.html#fv_tracer2d_modi945" target="origFile"><code class="comment">! Local indices</code></a>
<a name="offline_tracer_advection_tlmi947"></a>    <a href="null_p.html#fv_tracer2d_modi945" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">n</code>, <code class="vardecl">iq</code></a>
    <a href="null_p.html#fv_tracer2d_modi946" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dtr8</code></a>
<a name="offline_tracer_advection_tlmi948"></a>    <a href="null_p.html#fv_tracer2d_modi947" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scalingfactor</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scalingfactor_tl</code></a>
<a href="null_p.html#fv_tracer2d_modi948" target="origFile"><code class="comment">!real(REAL8) :: scalingFactors(npz)</code></a>
<a name="offline_tracer_advection_tlmi949"></a><a href="null_p.html#fv_tracer2d_modi948" target="origFile"><code class="comment">! Time-step</code></a>
<a name="offline_tracer_advection_tlmi950"></a>    <a href="null_p.html#fv_tracer2d_modi948" target="origFile">dtr8 = dt</a>
<a name="offline_tracer_advection_tlmi951"></a>    <a href="null_p.html#fv_tracer2d_modi949" target="origFile">wbuffer = <code class="constant">0.0</code></a>
<a name="offline_tracer_advection_tlmi952"></a>    <a href="null_p.html#fv_tracer2d_modi950" target="origFile">sbuffer = <code class="constant">0.0</code></a>
<a name="offline_tracer_advection_tlmi953"></a>    <a href="null_p.html#fv_tracer2d_modi951" target="origFile">ebuffer = <code class="constant">0.0</code></a>
    <a href="null_p.html#fv_tracer2d_modi952" target="origFile">nbuffer = <code class="constant">0.0</code></a>
<a name="offline_tracer_advection_tlmi954"></a><a href="null_p.html#fv_tracer2d_modi953" target="origFile"><code class="comment">! Fill CX/CY C-Grid boundaries and update ghost regions</code></a>
<a name="offline_tracer_advection_tlmi955"></a>    <a href="null_p.html#fv_tracer2d_modi953" target="origFile">xl(is:ie, js:je, :) = cx(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_modi954" target="origFile">yl(is:ie, js:je, :) = cy(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_modi955" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_GET_BOUNDARY</code>(xl, yl, domain, <code class="keyword">wbufferx</code>=wbuffer, <code class="keyword">ebufferx</code>=<code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi956"></a><a href="null_p.html#fv_tracer2d_modi955" target="origFile"><code class="label">&                   </code>ebuffer, <code class="keyword">sbuffery</code>=sbuffer, <code class="keyword">nbuffery</code>=nbuffer, <code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi957"></a><a href="null_p.html#fv_tracer2d_modi955" target="origFile"><code class="label">&                   </code><code class="keyword">gridtype</code>=cgrid_ne)</a>
<a name="offline_tracer_advection_tlmi958"></a>    <a href="null_p.html#fv_tracer2d_modi956" target="origFile">xl(ie+<code class="constant">1</code>, js:je, :) = ebuffer</a>
    <a href="null_p.html#fv_tracer2d_modi957" target="origFile">yl(is:ie, je+<code class="constant">1</code>, :) = nbuffer</a>
<a name="offline_tracer_advection_tlmi959"></a>    <a href="null_p.html#fv_tracer2d_modi958" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS</code>(xl, yl, domain, <code class="keyword">gridtype</code>=cgrid_ne, <code class="keyword">complete</code>=<code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi960"></a><a href="null_p.html#fv_tracer2d_modi958" target="origFile"><code class="label">&                     </code><code class="constant">.true.</code>)</a>
<a name="offline_tracer_advection_tlmi961"></a>    <a href="null_p.html#fv_tracer2d_modi959" target="origFile">cxl(is:ie+<code class="constant">1</code>, jsd:jed, :) = xl(is:ie+<code class="constant">1</code>, jsd:jed, :)</a>
    <a href="null_p.html#fv_tracer2d_modi960" target="origFile">cyl(isd:ied, js:je+<code class="constant">1</code>, :) = yl(isd:ied, js:je+<code class="constant">1</code>, :)</a>
<a name="offline_tracer_advection_tlmi962"></a><a href="null_p.html#fv_tracer2d_modi961" target="origFile"><code class="comment">! Fill MFX/MFY C-Grid boundaries</code></a>
<a name="offline_tracer_advection_tlmi963"></a>    <a href="null_p.html#fv_tracer2d_modi961" target="origFile">xl(is:ie, js:je, :) = mfx(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_modi962" target="origFile">yl(is:ie, js:je, :) = mfy(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_modi963" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_GET_BOUNDARY</code>(xl, yl, domain, <code class="keyword">wbufferx</code>=wbuffer, <code class="keyword">ebufferx</code>=<code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi964"></a><a href="null_p.html#fv_tracer2d_modi963" target="origFile"><code class="label">&                   </code>ebuffer, <code class="keyword">sbuffery</code>=sbuffer, <code class="keyword">nbuffery</code>=nbuffer, <code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi965"></a><a href="null_p.html#fv_tracer2d_modi963" target="origFile"><code class="label">&                   </code><code class="keyword">gridtype</code>=cgrid_ne)</a>
<a name="offline_tracer_advection_tlmi966"></a>    <a href="null_p.html#fv_tracer2d_modi964" target="origFile">xl(ie+<code class="constant">1</code>, js:je, :) = ebuffer</a>
<a name="offline_tracer_advection_tlmi967"></a>    <a href="null_p.html#fv_tracer2d_modi965" target="origFile">yl(is:ie, je+<code class="constant">1</code>, :) = nbuffer</a>
<a name="offline_tracer_advection_tlmi968"></a>    <a href="null_p.html#fv_tracer2d_modi966" target="origFile">mfxl(is:ie+<code class="constant">1</code>, js:je, :) = xl(is:ie+<code class="constant">1</code>, js:je, :)</a>
    <a href="null_p.html#fv_tracer2d_modi967" target="origFile">mfyl(is:ie, js:je+<code class="constant">1</code>, :) = yl(is:ie, js:je+<code class="constant">1</code>, :)</a>
<a href="null_p.html#fv_tracer2d_modi968" target="origFile"><code class="comment">! Fill local tracers and pressure thickness</code></a>
<a name="offline_tracer_advection_tlmi969"></a>    <a href="null_p.html#fv_tracer2d_modi968" target="origFile">dpl(:, :, :) = ple0(:, :, <code class="constant">2</code>:npz+<code class="constant">1</code>) - ple0(:, :, <code class="constant">1</code>:npz)</a>
<a name="offline_tracer_advection_tlmi969"></a>    <a href="null_p.html#fv_tracer2d_modi969" target="origFile">q3_tl = <code class="constant">0.0_8</code></a>
<a name="offline_tracer_advection_tlmi970"></a>    <a href="null_p.html#fv_tracer2d_modi969" target="origFile">q3_tl(is:ie, js:je, :, :) = q_tl(is:ie, js:je, :, :)</a>
    <a href="null_p.html#fv_tracer2d_modi969" target="origFile">q3(is:ie, js:je, :, :) = q(is:ie, js:je, :, :)</a>
<a name="offline_tracer_advection_tlmi976"></a>    <a href="null_p.html#fv_tracer2d_modi970" target="origFile"><code class="keyword">IF</code> (z_tracer) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_tracer2d_modi970" target="origFile">q2_tl = <code class="constant">0.0_8</code></a>
<a name="offline_tracer_advection_tlmi974"></a><a href="null_p.html#fv_tracer2d_modi976" target="origFile"><code class="comment">!$omp parallel do default(shared) private(q2)</code></a>
<a name="offline_tracer_advection_tlmi973"></a>      <a href="null_p.html#fv_tracer2d_modi976" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="offline_tracer_advection_tlmi972"></a>        <a href="null_p.html#fv_tracer2d_modi974" target="origFile"><code class="keyword">DO </code>iq=<code class="constant">1</code>,nq</a>
          <a href="null_p.html#fv_tracer2d_modi973" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a name="offline_tracer_advection_tlmi971"></a><a href="null_p.html#fv_tracer2d_modi972" target="origFile"><code class="comment">! To_do list:</code></a>
            <a href="null_p.html#fv_tracer2d_modi972" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
<a name="offline_tracer_advection_tlmi971"></a><a href="null_p.html#fv_tracer2d_modi971" target="origFile"><code class="comment">! The data copying can be avoided if q is</code></a>
              <a href="null_p.html#fv_tracer2d_modi971" target="origFile">q2_tl(i, j, iq) = q3_tl(i, j, k, iq)</a>
              <a href="null_p.html#fv_tracer2d_modi971" target="origFile">q2(i, j, iq) = q3(i, j, k, iq)</a>
            <a href="null_p.html#fv_tracer2d_modi972" target="origFile"><code class="keyword">END DO</code></a>
<a name="offline_tracer_advection_tlmi975"></a>          <a href="null_p.html#fv_tracer2d_modi973" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi974" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_modi975" target="origFile"><code class="comment">! re-dimensioned as q(i,j,nq,k)</code></a>
        <a href="null_p.html#fv_tracer2d_modi975" target="origFile"><code class="keyword">CALL </code><code class="funcname">TRACER_2D_1L_TLM</code>(q2, q2_tl, dpl(is, js, k), mfxl(is, js, k)<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi975" target="origFile"><code class="label">&                       </code>, mfyl(is, js, k), cxl(is, jsd, k), cyl(isd, js<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi975" target="origFile"><code class="label">&                       </code>, k), npx, npy, npz, <code class="constant">1</code>, nq, hord, q_split, k, q3<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi975" target="origFile"><code class="label">&                       </code>, q3_tl, dtr8, <code class="constant">0</code>, <code class="keyword">dpa</code>=dpa)</a>
      <a href="null_p.html#fv_tracer2d_modi976" target="origFile"><code class="keyword">END DO</code></a>
<a name="offline_tracer_advection_tlmi977"></a>      <a href="null_p.html#fv_tracer2d_modi970" target="origFile">q1_tl = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#fv_tracer2d_modi970" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_modi977" target="origFile"><code class="keyword">CALL </code><code class="funcname">TRACER_2D_TLM</code>(q3, q3_tl, dpl, mfxl, mfyl, cxl, cyl, npx, npy<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi977" target="origFile"><code class="label">&                  </code>, npz, <code class="constant">1</code>, nq, hord, q_split, dtr8, <code class="constant">0</code>, <code class="keyword">dpa</code>=dpa)</a>
<a name="offline_tracer_advection_tlmi993"></a>      <a href="null_p.html#fv_tracer2d_modi970" target="origFile">q1_tl = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#fv_tracer2d_modi970" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="comment">!------------------------------------------------------------------</code></a>
<a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="comment">! Re-Map constituents</code></a>
<a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="comment">! Do remapping one tracer at a time; seems to be faster</code></a>
<a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="comment">! It requires less memory than mapn_ppm</code></a>
<a name="offline_tracer_advection_tlmi990"></a><a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="comment">!------------------------------------------------------------------</code></a>
<a name="offline_tracer_advection_tlmi978"></a>    <a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="keyword">DO </code>iq=<code class="constant">1</code>,nq</a>
      <a href="null_p.html#fv_tracer2d_modi990" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a name="offline_tracer_advection_tlmi980"></a><a href="null_p.html#fv_tracer2d_modi978" target="origFile"><code class="comment">! pressures mapping from (dpA is new delp after tracer_2d)</code></a>
<a name="offline_tracer_advection_tlmi979"></a>        <a href="null_p.html#fv_tracer2d_modi978" target="origFile">pe1(:, <code class="constant">1</code>) = ptop</a>
        <a href="null_p.html#fv_tracer2d_modi980" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz+<code class="constant">1</code></a>
<a name="offline_tracer_advection_tlmi981"></a>          <a href="null_p.html#fv_tracer2d_modi979" target="origFile">pe1(:, k) = pe1(:, k-<code class="constant">1</code>) + dpa(:, j, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi980" target="origFile"><code class="keyword">END DO</code></a>
<a name="offline_tracer_advection_tlmi982"></a><a href="null_p.html#fv_tracer2d_modi981" target="origFile"><code class="comment">! pressures mapping to</code></a>
<a name="offline_tracer_advection_tlmi984"></a>        <a href="null_p.html#fv_tracer2d_modi981" target="origFile">pe2(:, <code class="constant">1</code>) = ptop</a>
<a name="offline_tracer_advection_tlmi983"></a>        <a href="null_p.html#fv_tracer2d_modi982" target="origFile">pe2(:, npz+<code class="constant">1</code>) = pe1(:, npz+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi984" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz</a>
<a name="offline_tracer_advection_tlmi986"></a>          <a href="null_p.html#fv_tracer2d_modi983" target="origFile">pe2(:, k) = ak(k) + bk(k)*pe1(:, npz+<code class="constant">1</code>)</a>
<a name="offline_tracer_advection_tlmi985"></a>        <a href="null_p.html#fv_tracer2d_modi984" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi986" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="offline_tracer_advection_tlmi987"></a>          <a href="null_p.html#fv_tracer2d_modi985" target="origFile">dp2(:, j, k) = pe2(:, k+<code class="constant">1</code>) - pe2(:, k)</a>
        <a href="null_p.html#fv_tracer2d_modi986" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi987" target="origFile"><code class="keyword">CALL </code><code class="funcname">MAP1_Q2_TLM</code>(npz, pe1, q3(isd, jsd, <code class="constant">1</code>, iq), q3_tl(isd, jsd, <code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi988"></a><a href="null_p.html#fv_tracer2d_modi987" target="origFile"><code class="label">&                  </code><code class="constant">1</code>, iq), npz, pe2, q1(:, j, :), q1_tl(:, j, :), dp2(:<code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi989"></a><a href="null_p.html#fv_tracer2d_modi987" target="origFile"><code class="label">&                  </code>, j, :), is, ie, <code class="constant">0</code>, kord, j, isd, ied, jsd, jed)</a>
<a href="null_p.html#fv_tracer2d_modi988" target="origFile"><code class="comment">!, .true.)</code></a>
        <a href="null_p.html#fv_tracer2d_modi988" target="origFile"><code class="keyword">IF</code> (fill) </a><a href="null_p.html#fv_tracer2d_modi989" target="origFile"><code class="keyword">CALL </code><code class="funcname">FILLZ_TLM</code>(ie - is + <code class="constant">1</code>, npz, <code class="constant">1</code>, q1(:, j, :), q1_tl<code class="label">&</code></a>
<a name="offline_tracer_advection_tlmi991"></a><a href="null_p.html#fv_tracer2d_modi989" target="origFile"><code class="label">&                          </code>(:, j, :), dp2(:, j, :))</a>
      <a href="null_p.html#fv_tracer2d_modi990" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_modi991" target="origFile"><code class="comment">! Rescale tracers based on ple1 at destination timestep</code></a>
<a href="null_p.html#fv_tracer2d_modi991" target="origFile"><code class="comment">!------------------------------------------------------</code></a>
<a name="offline_tracer_advection_tlmi992"></a>      <a href="null_p.html#fv_tracer2d_modi991" target="origFile">scalingfactor_tl = <code class="funcname">CALCSCALINGFACTOR_TLM</code>(q1, q1_tl, dp2, ple1, npx<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi991" target="origFile"><code class="label">&       </code>, npy, npz, is, ie, js, je, scalingfactor)</a>
<a href="null_p.html#fv_tracer2d_modi992" target="origFile"><code class="comment">!scalingFactors = computeScalingFactors(q1, dp2, ple1, npx, npy, npz, is, ie, js, je)</code></a>
<a href="null_p.html#fv_tracer2d_modi992" target="origFile"><code class="comment">! Return tracers</code></a>
<a href="null_p.html#fv_tracer2d_modi992" target="origFile"><code class="comment">!---------------</code></a>
<a name="offline_tracer_advection_tlmi992"></a>      <a href="null_p.html#fv_tracer2d_modi992" target="origFile">q_tl(is:ie, js:je, <code class="constant">1</code>:npz, iq) = q1_tl(is:ie, js:je, <code class="constant">1</code>:npz)*<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi992" target="origFile"><code class="label">&       </code>scalingfactor + q1(is:ie, js:je, <code class="constant">1</code>:npz)*scalingfactor_tl</a>
      <a href="null_p.html#fv_tracer2d_modi992" target="origFile">q(is:ie, js:je, <code class="constant">1</code>:npz, iq) = q1(is:ie, js:je, <code class="constant">1</code>:npz)*scalingfactor</a>
<a name="tracer_2d_1l_tlm"></a>    <a href="null_p.html#fv_tracer2d_modi993" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">OFFLINE_TRACER_ADVECTION_TLM</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!  Differentiation of tracer_2d_1l in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   variations   of useful results: q q3</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   with respect to varying inputs: q q3</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! !ROUTINE: Perform 2D horizontal-to-lagrangian transport</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">TRACER_2D_1L_TLM</code>(<code class="vardecl">q</code>, <code class="vardecl">q_tl</code>, <code class="vardecl">dp0</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi777"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">npz</code>, <code class="vardecl">qs</code>, <code class="vardecl">nq</code>, <code class="vardecl">hord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">k</code>, <code class="vardecl">q3</code>, <code class="vardecl">q3_tl</code>, <code class="vardecl">dt</code>, <code class="vardecl">id_divg</code>, <code class="vardecl">dpa</code>)</a>
<a name="tracer_2d_1l_tlmi778"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="tracer_2d_1l_tlmi779"></a>    <a href="null_p.html#fv_tracer2d_modi777" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code></a>
    <a href="null_p.html#fv_tracer2d_modi778" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">k</code></a>
<a name="tracer_2d_1l_tlmi780"></a><a href="null_p.html#fv_tracer2d_modi779" target="origFile"><code class="comment">! first tracer to advect</code></a>
    <a href="null_p.html#fv_tracer2d_modi779" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">qs</code></a>
<a name="tracer_2d_1l_tlmi781"></a><a href="null_p.html#fv_tracer2d_modi780" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
<a name="tracer_2d_1l_tlmi782"></a>    <a href="null_p.html#fv_tracer2d_modi780" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
<a name="tracer_2d_1l_tlmi783"></a>    <a href="null_p.html#fv_tracer2d_modi781" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
<a name="tracer_2d_1l_tlmi784"></a>    <a href="null_p.html#fv_tracer2d_modi782" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
<a name="tracer_2d_1l_tlmi785"></a>    <a href="null_p.html#fv_tracer2d_modi783" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">id_divg</code></a>
    <a href="null_p.html#fv_tracer2d_modi784" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a href="null_p.html#fv_tracer2d_modi785" target="origFile"><code class="comment">! 2D Tracers</code></a>
<a name="tracer_2d_1l_tlmi786"></a>    <a href="null_p.html#fv_tracer2d_modi785" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q_tl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_modi786" target="origFile"><code class="comment">! Tracers</code></a>
<a name="tracer_2d_1l_tlmi787"></a>    <a href="null_p.html#fv_tracer2d_modi786" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q3</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q3_tl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a name="tracer_2d_1l_tlmi788"></a><a href="null_p.html#fv_tracer2d_modi787" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_modi787" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">dp0</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi789"></a><a href="null_p.html#fv_tracer2d_modi788" target="origFile"><code class="comment">! DELP after advection</code></a>
    <a href="null_p.html#fv_tracer2d_modi788" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">OPTIONAL</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi790"></a><a href="null_p.html#fv_tracer2d_modi789" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi789" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a name="tracer_2d_1l_tlmi791"></a><a href="null_p.html#fv_tracer2d_modi790" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi790" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi792"></a><a href="null_p.html#fv_tracer2d_modi791" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi791" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi793"></a><a href="null_p.html#fv_tracer2d_modi792" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi792" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_modi793" target="origFile"><code class="comment">! Local Arrays</code></a>
<a name="tracer_2d_1l_tlmi794"></a>    <a href="null_p.html#fv_tracer2d_modi793" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi795"></a>    <a href="null_p.html#fv_tracer2d_modi794" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi796"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi797"></a>    <a href="null_p.html#fv_tracer2d_modi795" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfx2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi798"></a>    <a href="null_p.html#fv_tracer2d_modi796" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfy2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi799"></a>    <a href="null_p.html#fv_tracer2d_modi797" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cx2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a name="tracer_2d_1l_tlmi800"></a>    <a href="null_p.html#fv_tracer2d_modi798" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cy2</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi801"></a>    <a href="null_p.html#fv_tracer2d_modi799" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi802"></a>    <a href="null_p.html#fv_tracer2d_modi800" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi803"></a>    <a href="null_p.html#fv_tracer2d_modi801" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_x</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a name="tracer_2d_1l_tlmi804"></a>    <a href="null_p.html#fv_tracer2d_modi802" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_y</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_1l_tlmi805"></a>    <a href="null_p.html#fv_tracer2d_modi803" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">xfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a name="tracer_2d_1l_tlmi806"></a>    <a href="null_p.html#fv_tracer2d_modi804" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">yfx</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi807"></a>    <a href="null_p.html#fv_tracer2d_modi805" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cmax</code></a>
<a name="tracer_2d_1l_tlmi808"></a>    <a href="null_p.html#fv_tracer2d_modi806" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">frac</code>, <code class="vardecl">rdt</code></a>
<a name="tracer_2d_1l_tlmi809"></a>    <a href="null_p.html#fv_tracer2d_modi807" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">nsplt</code></a>
<a name="tracer_2d_1l_tlmi810"></a>    <a href="null_p.html#fv_tracer2d_modi808" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">it</code>, <code class="vardecl">iq</code></a>
<a name="tracer_2d_1l_tlmi811"></a>    <a href="null_p.html#fv_tracer2d_modi809" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
<a name="tracer_2d_1l_tlmi812"></a>    <a href="null_p.html#fv_tracer2d_modi810" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="tracer_2d_1l_tlmi813"></a>    <a href="null_p.html#fv_tracer2d_modi811" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
<a name="tracer_2d_1l_tlmi814"></a>    <a href="null_p.html#fv_tracer2d_modi812" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
<a name="tracer_2d_1l_tlmi815"></a>    <a href="null_p.html#fv_tracer2d_modi813" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">PRESENT</code></a>
    <a href="null_p.html#fv_tracer2d_modi814" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_tracer2d_modi815" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs1</code></a>
<a name="tracer_2d_1l_tlmi820"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
<a name="tracer_2d_1l_tlmi819"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a name="tracer_2d_1l_tlmi816"></a>    <a href="null_p.html#fv_tracer2d_modi820" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
<a name="tracer_2d_1l_tlmi817"></a>      <a href="null_p.html#fv_tracer2d_modi819" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_modi816" target="origFile"><code class="keyword">IF</code> (cx(i, j) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi818"></a>          <a href="null_p.html#fv_tracer2d_modi817" target="origFile">xfx(i, j) = cx(i, j)*dxa(i-<code class="constant">1</code>, j)*dy(i, j)*sin_sg(i-<code class="constant">1</code>, j, <code class="constant">3</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi816" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_tracer2d_modi818" target="origFile">xfx(i, j) = cx(i, j)*dxa(i, j)*dy(i, j)*sin_sg(i, j, <code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi816" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi825"></a>      <a href="null_p.html#fv_tracer2d_modi819" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi824"></a>    <a href="null_p.html#fv_tracer2d_modi820" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi821"></a>    <a href="null_p.html#fv_tracer2d_modi825" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
<a name="tracer_2d_1l_tlmi822"></a>      <a href="null_p.html#fv_tracer2d_modi824" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_modi821" target="origFile"><code class="keyword">IF</code> (cy(i, j) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi823"></a>          <a href="null_p.html#fv_tracer2d_modi822" target="origFile">yfx(i, j) = cy(i, j)*dya(i, j-<code class="constant">1</code>)*dx(i, j)*sin_sg(i, j-<code class="constant">1</code>, <code class="constant">4</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi821" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_tracer2d_modi823" target="origFile">yfx(i, j) = cy(i, j)*dya(i, j)*dx(i, j)*sin_sg(i, j, <code class="constant">2</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi821" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi826"></a>      <a href="null_p.html#fv_tracer2d_modi824" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi827"></a>    <a href="null_p.html#fv_tracer2d_modi825" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_modi826" target="origFile"><code class="keyword">IF</code> (q_split .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi844"></a><a href="null_p.html#fv_tracer2d_modi827" target="origFile"><code class="comment">! Determine nsplt for tracer advection</code></a>
<a name="tracer_2d_1l_tlmi843"></a>      <a href="null_p.html#fv_tracer2d_modi827" target="origFile">cmax = <code class="constant">0.</code></a>
<a name="tracer_2d_1l_tlmi828"></a>      <a href="null_p.html#fv_tracer2d_modi844" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a name="tracer_2d_1l_tlmi829"></a>        <a href="null_p.html#fv_tracer2d_modi843" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_modi828" target="origFile"><code class="keyword">IF</code> (cx(i, j) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi830"></a>            <a href="null_p.html#fv_tracer2d_modi829" target="origFile">abs0 = cx(i, j)</a>
          <a href="null_p.html#fv_tracer2d_modi828" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_1l_tlmi831"></a>            <a href="null_p.html#fv_tracer2d_modi830" target="origFile">abs0 = -cx(i, j)</a>
<a name="tracer_2d_1l_tlmi832"></a>          <a href="null_p.html#fv_tracer2d_modi828" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi833"></a>          <a href="null_p.html#fv_tracer2d_modi831" target="origFile">x1 = abs0 + (<code class="constant">1.</code>-sina_u(i, j))</a>
          <a href="null_p.html#fv_tracer2d_modi832" target="origFile"><code class="keyword">IF</code> (cy(i, j) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi834"></a>            <a href="null_p.html#fv_tracer2d_modi833" target="origFile">abs1 = cy(i, j)</a>
          <a href="null_p.html#fv_tracer2d_modi832" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_1l_tlmi835"></a>            <a href="null_p.html#fv_tracer2d_modi834" target="origFile">abs1 = -cy(i, j)</a>
<a name="tracer_2d_1l_tlmi836"></a>          <a href="null_p.html#fv_tracer2d_modi832" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi837"></a>          <a href="null_p.html#fv_tracer2d_modi835" target="origFile">y1 = abs1 + (<code class="constant">1.</code>-sina_v(i, j))</a>
<a name="tracer_2d_1l_tlmi838"></a>          <a href="null_p.html#fv_tracer2d_modi836" target="origFile"><code class="keyword">IF</code> (x1 .LT. y1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_modi837" target="origFile"><code class="keyword">IF</code> (y1 .LT. cmax) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi839"></a>              <a href="null_p.html#fv_tracer2d_modi838" target="origFile">cmax = cmax</a>
            <a href="null_p.html#fv_tracer2d_modi837" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_1l_tlmi840"></a>              <a href="null_p.html#fv_tracer2d_modi839" target="origFile">cmax = y1</a>
<a name="tracer_2d_1l_tlmi841"></a>            <a href="null_p.html#fv_tracer2d_modi837" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_modi836" target="origFile"><code class="keyword">ELSE </code></a><a href="null_p.html#fv_tracer2d_modi840" target="origFile"><code class="keyword">IF</code> (x1 .LT. cmax) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi842"></a>            <a href="null_p.html#fv_tracer2d_modi841" target="origFile">cmax = cmax</a>
          <a href="null_p.html#fv_tracer2d_modi840" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_modi842" target="origFile">cmax = x1</a>
          <a href="null_p.html#fv_tracer2d_modi836" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi845"></a>        <a href="null_p.html#fv_tracer2d_modi843" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi846"></a>      <a href="null_p.html#fv_tracer2d_modi844" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi848"></a><a name="tracer_2d_1l_tlmi847"></a>      <a href="null_p.html#fv_tracer2d_modi845" target="origFile"><code class="keyword">CALL </code><code class="funcname">MP_REDUCE_MAX</code>(cmax)</a>
      <a href="null_p.html#fv_tracer2d_modi846" target="origFile">nsplt = <code class="funcname">INT</code>(<code class="constant">1.01 </code>+ cmax)</a>
      <a href="null_p.html#fv_tracer2d_modi847" target="origFile"><code class="keyword">IF</code> (gid .EQ. <code class="constant">0 </code>.AND. nsplt .GT. <code class="constant">5</code>) </a><a href="null_p.html#fv_tracer2d_modi848" target="origFile"><code class="keyword">WRITE</code>(<code class="constant">6</code>, <code class="keyword">*</code>) k, <code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi849"></a><a href="null_p.html#fv_tracer2d_modi848" target="origFile"><code class="label">&                                        </code><code class="string">'Tracer_2d_split='</code>, nsplt, cmax</a>
    <a href="null_p.html#fv_tracer2d_modi826" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_1l_tlmi850"></a>      <a href="null_p.html#fv_tracer2d_modi849" target="origFile">nsplt = q_split</a>
<a name="tracer_2d_1l_tlmi854"></a>    <a href="null_p.html#fv_tracer2d_modi826" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi853"></a>    <a href="null_p.html#fv_tracer2d_modi850" target="origFile">frac = <code class="constant">1.</code>/<code class="funcname">REAL</code>(nsplt)</a>
<a name="tracer_2d_1l_tlmi851"></a>    <a href="null_p.html#fv_tracer2d_modi854" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
<a name="tracer_2d_1l_tlmi852"></a>      <a href="null_p.html#fv_tracer2d_modi853" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_modi851" target="origFile">cx2(i, j) = cx(i, j)*frac</a>
        <a href="null_p.html#fv_tracer2d_modi852" target="origFile">xfx(i, j) = xfx(i, j)*frac</a>
<a name="tracer_2d_1l_tlmi857"></a>      <a href="null_p.html#fv_tracer2d_modi853" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi856"></a>    <a href="null_p.html#fv_tracer2d_modi854" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi855"></a>    <a href="null_p.html#fv_tracer2d_modi857" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_modi856" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_modi855" target="origFile">mfx2(i, j) = mfx(i, j)*frac</a>
<a name="tracer_2d_1l_tlmi861"></a>      <a href="null_p.html#fv_tracer2d_modi856" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi860"></a>    <a href="null_p.html#fv_tracer2d_modi857" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi858"></a>    <a href="null_p.html#fv_tracer2d_modi861" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
<a name="tracer_2d_1l_tlmi859"></a>      <a href="null_p.html#fv_tracer2d_modi860" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_modi858" target="origFile">cy2(i, j) = cy(i, j)*frac</a>
        <a href="null_p.html#fv_tracer2d_modi859" target="origFile">yfx(i, j) = yfx(i, j)*frac</a>
<a name="tracer_2d_1l_tlmi864"></a>      <a href="null_p.html#fv_tracer2d_modi860" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi863"></a>    <a href="null_p.html#fv_tracer2d_modi861" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi862"></a>    <a href="null_p.html#fv_tracer2d_modi864" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
      <a href="null_p.html#fv_tracer2d_modi863" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_modi862" target="origFile">mfy2(i, j) = mfy(i, j)*frac</a>
<a name="tracer_2d_1l_tlmi867"></a>      <a href="null_p.html#fv_tracer2d_modi863" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi866"></a>    <a href="null_p.html#fv_tracer2d_modi864" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi865"></a>    <a href="null_p.html#fv_tracer2d_modi867" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
      <a href="null_p.html#fv_tracer2d_modi866" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_modi865" target="origFile">ra_x(i, j) = area(i, j) + xfx(i, j) - xfx(i+<code class="constant">1</code>, j)</a>
<a name="tracer_2d_1l_tlmi870"></a>      <a href="null_p.html#fv_tracer2d_modi866" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi869"></a>    <a href="null_p.html#fv_tracer2d_modi867" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi868"></a>    <a href="null_p.html#fv_tracer2d_modi870" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_modi869" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_modi868" target="origFile">ra_y(i, j) = area(i, j) + yfx(i, j) - yfx(i, j+<code class="constant">1</code>)</a>
<a name="tracer_2d_1l_tlmi873"></a>      <a href="null_p.html#fv_tracer2d_modi869" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi872"></a>    <a href="null_p.html#fv_tracer2d_modi870" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi871"></a>    <a href="null_p.html#fv_tracer2d_modi873" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_modi872" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_modi871" target="origFile">dp1(i, j) = dp0(i, j)</a>
      <a href="null_p.html#fv_tracer2d_modi872" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_modi873" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi897"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile">fx_tl = <code class="constant">0.0_8</code></a>
<a name="tracer_2d_1l_tlmi876"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile">fy_tl = <code class="constant">0.0_8</code></a>
<a name="tracer_2d_1l_tlmi875"></a>    <a href="null_p.html#fv_tracer2d_modi897" target="origFile"><code class="keyword">DO </code>it=<code class="constant">1</code>,nsplt</a>
<a name="tracer_2d_1l_tlmi874"></a>      <a href="null_p.html#fv_tracer2d_modi876" target="origFile"><code class="keyword">DO </code>j=js,je</a>
        <a href="null_p.html#fv_tracer2d_modi875" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_modi874" target="origFile">dp2(i, j) = dp1(i, j) + (mfx2(i, j)-mfx2(i+<code class="constant">1</code>, j)+mfy2(i, j)-<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi874" target="origFile"><code class="label">&           </code>mfy2(i, j+<code class="constant">1</code>))*rarea(i, j)</a>
<a name="tracer_2d_1l_tlmi877"></a>        <a href="null_p.html#fv_tracer2d_modi875" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi878"></a>      <a href="null_p.html#fv_tracer2d_modi876" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi879"></a>      <a href="null_p.html#fv_tracer2d_modi877" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TOTAL'</code>)</a>
<a name="tracer_2d_1l_tlmi880"></a>      <a href="null_p.html#fv_tracer2d_modi878" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TRAC'</code>)</a>
<a name="tracer_2d_1l_tlmi881"></a>      <a href="null_p.html#fv_tracer2d_modi879" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS_TLM</code>(q, q_tl, domain, <code class="keyword">complete</code>=<code class="constant">.true.</code>)</a>
<a name="tracer_2d_1l_tlmi882"></a>      <a href="null_p.html#fv_tracer2d_modi880" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TRAC'</code>)</a>
<a name="tracer_2d_1l_tlmi891"></a>      <a href="null_p.html#fv_tracer2d_modi881" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TOTAL'</code>)</a>
<a name="tracer_2d_1l_tlmi883"></a>      <a href="null_p.html#fv_tracer2d_modi882" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'fv_tp_2d'</code>)</a>
      <a href="null_p.html#fv_tracer2d_modi891" target="origFile"><code class="keyword">DO </code>iq=qs,nq</a>
        <a href="null_p.html#fv_tracer2d_modi883" target="origFile"><code class="keyword">CALL </code><code class="funcname">FV_TP_2D_TLM</code>(q(isd:, jsd:, iq), q_tl(isd:, jsd:, iq), cx2, <code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi884"></a><a href="null_p.html#fv_tracer2d_modi883" target="origFile"><code class="label">&                   </code>cy2, npx, npy, hord, fx, fx_tl, fy, fy_tl, xfx, yfx<code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi887"></a><a href="null_p.html#fv_tracer2d_modi883" target="origFile"><code class="label">&                   </code>, ra_x, ra_y, <code class="keyword">mfx</code>=mfx2, <code class="keyword">mfy</code>=mfy2)</a>
<a name="tracer_2d_1l_tlmi886"></a>        <a href="null_p.html#fv_tracer2d_modi884" target="origFile"><code class="keyword">IF</code> (it .EQ. nsplt) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi885"></a>          <a href="null_p.html#fv_tracer2d_modi887" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_modi886" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_modi885" target="origFile">q3_tl(i, j, k, iq) = (dp1(i, j)*q_tl(i, j, iq)+rarea(i, j)<code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi885"></a><a href="null_p.html#fv_tracer2d_modi885" target="origFile"><code class="label">&               </code>*(fx_tl(i, j)-fx_tl(i+<code class="constant">1</code>, j)+fy_tl(i, j)-fy_tl(i, j+<code class="constant">1</code>)))/<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi885" target="origFile"><code class="label">&               </code>dp2(i, j)</a>
              <a href="null_p.html#fv_tracer2d_modi885" target="origFile">q3(i, j, k, iq) = (q(i, j, iq)*dp1(i, j)+(fx(i, j)-fx(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi885" target="origFile"><code class="label">&               </code>, j)+fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_modi886" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi890"></a>          <a href="null_p.html#fv_tracer2d_modi887" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi889"></a>        <a href="null_p.html#fv_tracer2d_modi884" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_1l_tlmi888"></a>          <a href="null_p.html#fv_tracer2d_modi890" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_modi889" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_modi888" target="origFile">q_tl(i, j, iq) = (dp1(i, j)*q_tl(i, j, iq)+rarea(i, j)*(<code class="label">&</code></a>
<a name="tracer_2d_1l_tlmi888"></a><a href="null_p.html#fv_tracer2d_modi888" target="origFile"><code class="label">&               </code>fx_tl(i, j)-fx_tl(i+<code class="constant">1</code>, j)+fy_tl(i, j)-fy_tl(i, j+<code class="constant">1</code>)))/<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi888" target="origFile"><code class="label">&               </code>dp2(i, j)</a>
              <a href="null_p.html#fv_tracer2d_modi888" target="origFile">q(i, j, iq) = (q(i, j, iq)*dp1(i, j)+(fx(i, j)-fx(i+<code class="constant">1</code>, j)+<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi888" target="origFile"><code class="label">&               </code>fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_modi889" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_tracer2d_modi890" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi892"></a>        <a href="null_p.html#fv_tracer2d_modi884" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_1l_tlmi893"></a>      <a href="null_p.html#fv_tracer2d_modi891" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi896"></a>      <a href="null_p.html#fv_tracer2d_modi892" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'fv_tp_2d'</code>)</a>
<a name="tracer_2d_1l_tlmi895"></a>      <a href="null_p.html#fv_tracer2d_modi893" target="origFile"><code class="keyword">IF</code> (it .NE. nsplt) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi894"></a>        <a href="null_p.html#fv_tracer2d_modi896" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi895" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi894" target="origFile">dp1(i, j) = dp2(i, j)</a>
          <a href="null_p.html#fv_tracer2d_modi895" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi896" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi898"></a>      <a href="null_p.html#fv_tracer2d_modi893" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_tracer2d_modi897" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi899"></a><a href="null_p.html#fv_tracer2d_modi898" target="origFile"><code class="comment">! nsplt</code></a>
<a name="tracer_2d_1l_tlmi902"></a>    <a href="null_p.html#fv_tracer2d_modi898" target="origFile"><code class="keyword">IF</code> (id_divg .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_1l_tlmi901"></a>      <a href="null_p.html#fv_tracer2d_modi899" target="origFile">rdt = <code class="constant">1.</code>/(frac*dt)</a>
<a name="tracer_2d_1l_tlmi900"></a>      <a href="null_p.html#fv_tracer2d_modi902" target="origFile"><code class="keyword">DO </code>j=js,je</a>
        <a href="null_p.html#fv_tracer2d_modi901" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_modi900" target="origFile">dp0(i, j) = (xfx(i+<code class="constant">1</code>, j)-xfx(i, j)+yfx(i, j+<code class="constant">1</code>)-yfx(i, j))*<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi900" target="origFile"><code class="label">&           </code>rarea(i, j)*rdt</a>
        <a href="null_p.html#fv_tracer2d_modi901" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_1l_tlmi904"></a><a name="tracer_2d_1l_tlmi903"></a>      <a href="null_p.html#fv_tracer2d_modi902" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_modi898" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlm"></a>    <a href="null_p.html#fv_tracer2d_modi903" target="origFile"><code class="keyword">IF</code> (<code class="funcname">PRESENT</code>(dpa)) </a><a href="null_p.html#fv_tracer2d_modi904" target="origFile">dpa = dp2</a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">TRACER_2D_1L_TLM</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!  Differentiation of tracer_2d in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   variations   of useful results: q</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   with respect to varying inputs: q</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">TRACER_2D_TLM</code>(<code class="vardecl">q</code>, <code class="vardecl">q_tl</code>, <code class="vardecl">dp1</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code><code class="label">&</code></a>
<a name="tracer_2d_tlmi645"></a><a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">qs</code>, <code class="vardecl">nq</code>, <code class="vardecl">hord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">dt</code>, <code class="vardecl">id_divg</code>, <code class="vardecl">dpa</code>)</a>
<a name="tracer_2d_tlmi646"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="tracer_2d_tlmi647"></a>    <a href="null_p.html#fv_tracer2d_modi645" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code></a>
<a name="tracer_2d_tlmi648"></a>    <a href="null_p.html#fv_tracer2d_modi646" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_modi647" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
<a name="tracer_2d_tlmi649"></a><a href="null_p.html#fv_tracer2d_modi648" target="origFile"><code class="comment">! first tracer to advect</code></a>
    <a href="null_p.html#fv_tracer2d_modi648" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">qs</code></a>
<a name="tracer_2d_tlmi650"></a><a href="null_p.html#fv_tracer2d_modi649" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
<a name="tracer_2d_tlmi651"></a>    <a href="null_p.html#fv_tracer2d_modi649" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
<a name="tracer_2d_tlmi652"></a>    <a href="null_p.html#fv_tracer2d_modi650" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
<a name="tracer_2d_tlmi653"></a>    <a href="null_p.html#fv_tracer2d_modi651" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
<a name="tracer_2d_tlmi654"></a>    <a href="null_p.html#fv_tracer2d_modi652" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">id_divg</code></a>
    <a href="null_p.html#fv_tracer2d_modi653" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a href="null_p.html#fv_tracer2d_modi654" target="origFile"><code class="comment">! Tracers</code></a>
<a name="tracer_2d_tlmi655"></a>    <a href="null_p.html#fv_tracer2d_modi654" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q_tl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a name="tracer_2d_tlmi656"></a><a href="null_p.html#fv_tracer2d_modi655" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_modi655" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi657"></a><a href="null_p.html#fv_tracer2d_modi656" target="origFile"><code class="comment">! DELP after advection</code></a>
    <a href="null_p.html#fv_tracer2d_modi656" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">OPTIONAL</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi658"></a><a href="null_p.html#fv_tracer2d_modi657" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi657" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi659"></a><a href="null_p.html#fv_tracer2d_modi658" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi658" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi660"></a><a href="null_p.html#fv_tracer2d_modi659" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi659" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi661"></a><a href="null_p.html#fv_tracer2d_modi660" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_modi660" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_modi661" target="origFile"><code class="comment">! Local Arrays</code></a>
<a name="tracer_2d_tlmi662"></a>    <a href="null_p.html#fv_tracer2d_modi661" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_tlmi663"></a>    <a href="null_p.html#fv_tracer2d_modi662" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_tlmi664"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a name="tracer_2d_tlmi665"></a>    <a href="null_p.html#fv_tracer2d_modi663" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_tlmi666"></a>    <a href="null_p.html#fv_tracer2d_modi664" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_x</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a name="tracer_2d_tlmi667"></a>    <a href="null_p.html#fv_tracer2d_modi665" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_y</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a name="tracer_2d_tlmi668"></a>    <a href="null_p.html#fv_tracer2d_modi666" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">xfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a name="tracer_2d_tlmi669"></a>    <a href="null_p.html#fv_tracer2d_modi667" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">yfx</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi668" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cmax</code>(<code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_modi669" target="origFile"><code class="comment">!#ifdef IBM_FIX</code></a>
<a href="null_p.html#fv_tracer2d_modi669" target="origFile"><code class="comment">!      real(FVPRC) :: cmax_x, cmax_y</code></a>
<a name="tracer_2d_tlmi670"></a><a href="null_p.html#fv_tracer2d_modi669" target="origFile"><code class="comment">!#endif</code></a>
<a name="tracer_2d_tlmi671"></a>    <a href="null_p.html#fv_tracer2d_modi669" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">c_global</code></a>
<a name="tracer_2d_tlmi672"></a>    <a href="null_p.html#fv_tracer2d_modi670" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">frac</code>, <code class="vardecl">rdt</code></a>
<a name="tracer_2d_tlmi673"></a>    <a href="null_p.html#fv_tracer2d_modi671" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">nsplt</code></a>
<a name="tracer_2d_tlmi674"></a>    <a href="null_p.html#fv_tracer2d_modi672" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">it</code>, <code class="vardecl">iq</code></a>
<a name="tracer_2d_tlmi675"></a>    <a href="null_p.html#fv_tracer2d_modi673" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
<a name="tracer_2d_tlmi676"></a>    <a href="null_p.html#fv_tracer2d_modi674" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="tracer_2d_tlmi677"></a>    <a href="null_p.html#fv_tracer2d_modi675" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
<a name="tracer_2d_tlmi678"></a>    <a href="null_p.html#fv_tracer2d_modi676" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
<a name="tracer_2d_tlmi679"></a>    <a href="null_p.html#fv_tracer2d_modi677" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">PRESENT</code></a>
    <a href="null_p.html#fv_tracer2d_modi678" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_tracer2d_modi679" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs1</code></a>
<a name="tracer_2d_tlmi690"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a name="tracer_2d_tlmi684"></a><a href="null_p.html#fv_tracer2d_modi690" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
<a name="tracer_2d_tlmi683"></a>    <a href="null_p.html#fv_tracer2d_modi690" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="tracer_2d_tlmi680"></a>      <a href="null_p.html#fv_tracer2d_modi684" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
<a name="tracer_2d_tlmi681"></a>        <a href="null_p.html#fv_tracer2d_modi683" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_modi680" target="origFile"><code class="keyword">IF</code> (cx(i, j, k) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_modi681" target="origFile">xfx(i, j, k) = cx(i, j, k)*dxa(i-<code class="constant">1</code>, j)*dy(i, j)*sin_sg(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a name="tracer_2d_tlmi682"></a><a href="null_p.html#fv_tracer2d_modi681" target="origFile"><code class="label">&             </code>j, <code class="constant">3</code>)</a>
          <a href="null_p.html#fv_tracer2d_modi680" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_modi682" target="origFile">xfx(i, j, k) = cx(i, j, k)*dxa(i, j)*dy(i, j)*sin_sg(i, j, <code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi682" target="origFile"><code class="label">&             </code>)</a>
          <a href="null_p.html#fv_tracer2d_modi680" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi689"></a>        <a href="null_p.html#fv_tracer2d_modi683" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi688"></a>      <a href="null_p.html#fv_tracer2d_modi684" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi685"></a>      <a href="null_p.html#fv_tracer2d_modi689" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
<a name="tracer_2d_tlmi686"></a>        <a href="null_p.html#fv_tracer2d_modi688" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
          <a href="null_p.html#fv_tracer2d_modi685" target="origFile"><code class="keyword">IF</code> (cy(i, j, k) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_modi686" target="origFile">yfx(i, j, k) = cy(i, j, k)*dya(i, j-<code class="constant">1</code>)*dx(i, j)*sin_sg(i, j-<code class="label">&</code></a>
<a name="tracer_2d_tlmi687"></a><a href="null_p.html#fv_tracer2d_modi686" target="origFile"><code class="label">&             </code><code class="constant">1</code>, <code class="constant">4</code>)</a>
          <a href="null_p.html#fv_tracer2d_modi685" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_modi687" target="origFile">yfx(i, j, k) = cy(i, j, k)*dya(i, j)*dx(i, j)*sin_sg(i, j, <code class="constant">2</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi687" target="origFile"><code class="label">&             </code>)</a>
          <a href="null_p.html#fv_tracer2d_modi685" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_tracer2d_modi688" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi691"></a>      <a href="null_p.html#fv_tracer2d_modi689" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_modi690" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi710"></a><a href="null_p.html#fv_tracer2d_modi691" target="origFile"><code class="comment">!--------------------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_tracer2d_modi691" target="origFile"><code class="keyword">IF</code> (q_split .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">! Determine nsplt</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!#ifdef IBM_FIX</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!!$omp parallel do default(shared) private(cmax_x, cmax_y)</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!      do k=1,npz</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!        cmax(k) = 0.</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!        do j=js,je</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!          do i=is,ie</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!            cmax_x  = max(abs(cx(i,j,k))+1.-sina_u(i,j), cmax(k))</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!            cmax_y  = max(abs(cy(i,j,k))+1.-sina_v(i,j), cmax(k))</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!            cmax(k) = max(cmax_x, cmax_y)</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!          enddo</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!        enddo</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!      enddo</code></a>
<a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!#else </code></a>
<a name="tracer_2d_tlmi692"></a><a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="comment">!$omp parallel do default(shared) </code></a>
<a name="tracer_2d_tlmi709"></a>      <a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="tracer_2d_tlmi708"></a>        <a href="null_p.html#fv_tracer2d_modi692" target="origFile">cmax(k) = <code class="constant">0.</code></a>
<a name="tracer_2d_tlmi693"></a>        <a href="null_p.html#fv_tracer2d_modi709" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a name="tracer_2d_tlmi694"></a>          <a href="null_p.html#fv_tracer2d_modi708" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi693" target="origFile"><code class="keyword">IF</code> (cx(i, j, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi695"></a>              <a href="null_p.html#fv_tracer2d_modi694" target="origFile">abs0 = cx(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_modi693" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_tlmi696"></a>              <a href="null_p.html#fv_tracer2d_modi695" target="origFile">abs0 = -cx(i, j, k)</a>
<a name="tracer_2d_tlmi697"></a>            <a href="null_p.html#fv_tracer2d_modi693" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi698"></a>            <a href="null_p.html#fv_tracer2d_modi696" target="origFile">x1 = abs0 + <code class="constant">1. </code>- sina_u(i, j)</a>
            <a href="null_p.html#fv_tracer2d_modi697" target="origFile"><code class="keyword">IF</code> (cy(i, j, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi699"></a>              <a href="null_p.html#fv_tracer2d_modi698" target="origFile">abs1 = cy(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_modi697" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_tlmi700"></a>              <a href="null_p.html#fv_tracer2d_modi699" target="origFile">abs1 = -cy(i, j, k)</a>
<a name="tracer_2d_tlmi701"></a>            <a href="null_p.html#fv_tracer2d_modi697" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi702"></a>            <a href="null_p.html#fv_tracer2d_modi700" target="origFile">y1 = abs1 + <code class="constant">1. </code>- sina_v(i, j)</a>
<a name="tracer_2d_tlmi703"></a>            <a href="null_p.html#fv_tracer2d_modi701" target="origFile"><code class="keyword">IF</code> (x1 .LT. y1) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_modi702" target="origFile"><code class="keyword">IF</code> (y1 .LT. cmax(k)) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi704"></a>                <a href="null_p.html#fv_tracer2d_modi703" target="origFile">cmax(k) = cmax(k)</a>
              <a href="null_p.html#fv_tracer2d_modi702" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_tlmi705"></a>                <a href="null_p.html#fv_tracer2d_modi704" target="origFile">cmax(k) = y1</a>
<a name="tracer_2d_tlmi706"></a>              <a href="null_p.html#fv_tracer2d_modi702" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_tracer2d_modi701" target="origFile"><code class="keyword">ELSE </code></a><a href="null_p.html#fv_tracer2d_modi705" target="origFile"><code class="keyword">IF</code> (x1 .LT. cmax(k)) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi707"></a>              <a href="null_p.html#fv_tracer2d_modi706" target="origFile">cmax(k) = cmax(k)</a>
            <a href="null_p.html#fv_tracer2d_modi705" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_tracer2d_modi707" target="origFile">cmax(k) = x1</a>
            <a href="null_p.html#fv_tracer2d_modi701" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_modi708" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi711"></a>        <a href="null_p.html#fv_tracer2d_modi709" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi712"></a>      <a href="null_p.html#fv_tracer2d_modi710" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_modi711" target="origFile"><code class="keyword">CALL </code><code class="funcname">MP_REDUCE_MAX</code>(cmax, npz)</a>
<a href="null_p.html#fv_tracer2d_modi712" target="origFile"><code class="comment">!#endif</code></a>
<a name="tracer_2d_tlmi713"></a><a href="null_p.html#fv_tracer2d_modi712" target="origFile"><code class="comment">! find global max courant number and define nsplt to scale cx,cy,mfx,mfy</code></a>
<a name="tracer_2d_tlmi717"></a>      <a href="null_p.html#fv_tracer2d_modi712" target="origFile">c_global = cmax(<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_tracer2d_modi713" target="origFile"><code class="keyword">IF</code> (npz .NE. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi714"></a><a href="null_p.html#fv_tracer2d_modi717" target="origFile"><code class="comment">! if NOT shallow water test case</code></a>
<a name="tracer_2d_tlmi715"></a>        <a href="null_p.html#fv_tracer2d_modi717" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz</a>
          <a href="null_p.html#fv_tracer2d_modi714" target="origFile"><code class="keyword">IF</code> (cmax(k) .LT. c_global) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi716"></a>            <a href="null_p.html#fv_tracer2d_modi715" target="origFile">c_global = c_global</a>
          <a href="null_p.html#fv_tracer2d_modi714" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_modi716" target="origFile">c_global = cmax(k)</a>
          <a href="null_p.html#fv_tracer2d_modi714" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi718"></a>        <a href="null_p.html#fv_tracer2d_modi717" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi720"></a><a name="tracer_2d_tlmi719"></a>      <a href="null_p.html#fv_tracer2d_modi713" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_tracer2d_modi718" target="origFile">nsplt = <code class="funcname">INT</code>(<code class="constant">1. </code>+ c_global)</a>
      <a href="null_p.html#fv_tracer2d_modi719" target="origFile"><code class="keyword">IF</code> (gid .EQ. <code class="constant">0 </code>.AND. nsplt .GT. <code class="constant">5</code>) </a><a href="null_p.html#fv_tracer2d_modi720" target="origFile"><code class="keyword">WRITE</code>(<code class="constant">6</code>, <code class="keyword">*</code>) <code class="string">'Tracer_2d_split='</code><code class="label">&</code></a>
<a name="tracer_2d_tlmi721"></a><a href="null_p.html#fv_tracer2d_modi720" target="origFile"><code class="label">&                                        </code>, nsplt, c_global</a>
    <a href="null_p.html#fv_tracer2d_modi691" target="origFile"><code class="keyword">ELSE</code></a>
<a name="tracer_2d_tlmi722"></a>      <a href="null_p.html#fv_tracer2d_modi721" target="origFile">nsplt = q_split</a>
    <a href="null_p.html#fv_tracer2d_modi691" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi723"></a><a href="null_p.html#fv_tracer2d_modi722" target="origFile"><code class="comment">!--------------------------------------------------------------------------------</code></a>
<a name="tracer_2d_tlmi738"></a>    <a href="null_p.html#fv_tracer2d_modi722" target="origFile">frac = <code class="constant">1.</code>/<code class="funcname">REAL</code>(nsplt)</a>
    <a href="null_p.html#fv_tracer2d_modi723" target="origFile"><code class="keyword">IF</code> (nsplt .NE. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="tracer_2d_tlmi727"></a><a href="null_p.html#fv_tracer2d_modi738" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
<a name="tracer_2d_tlmi726"></a>      <a href="null_p.html#fv_tracer2d_modi738" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="tracer_2d_tlmi724"></a>        <a href="null_p.html#fv_tracer2d_modi727" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
<a name="tracer_2d_tlmi725"></a>          <a href="null_p.html#fv_tracer2d_modi726" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
            <a href="null_p.html#fv_tracer2d_modi724" target="origFile">cx(i, j, k) = cx(i, j, k)*frac</a>
            <a href="null_p.html#fv_tracer2d_modi725" target="origFile">xfx(i, j, k) = xfx(i, j, k)*frac</a>
<a name="tracer_2d_tlmi730"></a>          <a href="null_p.html#fv_tracer2d_modi726" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi729"></a>        <a href="null_p.html#fv_tracer2d_modi727" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi728"></a>        <a href="null_p.html#fv_tracer2d_modi730" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi729" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
            <a href="null_p.html#fv_tracer2d_modi728" target="origFile">mfx(i, j, k) = mfx(i, j, k)*frac</a>
<a name="tracer_2d_tlmi734"></a>          <a href="null_p.html#fv_tracer2d_modi729" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi733"></a>        <a href="null_p.html#fv_tracer2d_modi730" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi731"></a>        <a href="null_p.html#fv_tracer2d_modi734" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
<a name="tracer_2d_tlmi732"></a>          <a href="null_p.html#fv_tracer2d_modi733" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
            <a href="null_p.html#fv_tracer2d_modi731" target="origFile">cy(i, j, k) = cy(i, j, k)*frac</a>
            <a href="null_p.html#fv_tracer2d_modi732" target="origFile">yfx(i, j, k) = yfx(i, j, k)*frac</a>
<a name="tracer_2d_tlmi737"></a>          <a href="null_p.html#fv_tracer2d_modi733" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi736"></a>        <a href="null_p.html#fv_tracer2d_modi734" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi735"></a>        <a href="null_p.html#fv_tracer2d_modi737" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_modi736" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi735" target="origFile">mfy(i, j, k) = mfy(i, j, k)*frac</a>
          <a href="null_p.html#fv_tracer2d_modi736" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi737" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_modi738" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_modi723" target="origFile">fx_tl = <code class="constant">0.0_8</code></a>
      <a href="null_p.html#fv_tracer2d_modi723" target="origFile">fy_tl = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#fv_tracer2d_modi723" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_modi723" target="origFile">fx_tl = <code class="constant">0.0_8</code></a>
<a name="tracer_2d_tlmi764"></a>      <a href="null_p.html#fv_tracer2d_modi723" target="origFile">fy_tl = <code class="constant">0.0_8</code></a>
<a name="tracer_2d_tlmi739"></a>    <a href="null_p.html#fv_tracer2d_modi723" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d_tlmi740"></a>    <a href="null_p.html#fv_tracer2d_modi764" target="origFile"><code class="keyword">DO </code>it=<code class="constant">1</code>,nsplt</a>
<a name="tracer_2d_tlmi741"></a>      <a href="null_p.html#fv_tracer2d_modi739" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TOTAL'</code>)</a>
<a name="tracer_2d_tlmi742"></a>      <a href="null_p.html#fv_tracer2d_modi740" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TRAC'</code>)</a>
<a name="tracer_2d_tlmi743"></a>      <a href="null_p.html#fv_tracer2d_modi741" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS_TLM</code>(q, q_tl, domain, <code class="keyword">complete</code>=<code class="constant">.true.</code>)</a>
<a name="tracer_2d_tlmi763"></a>      <a href="null_p.html#fv_tracer2d_modi742" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TRAC'</code>)</a>
      <a href="null_p.html#fv_tracer2d_modi743" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TOTAL'</code>)</a>
<a name="tracer_2d_tlmi746"></a><a href="null_p.html#fv_tracer2d_modi763" target="origFile"><code class="comment">!$omp parallel do default(shared) private(ra_x, ra_y, dp2, fx, fy)</code></a>
<a name="tracer_2d_tlmi745"></a>      <a href="null_p.html#fv_tracer2d_modi763" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="tracer_2d_tlmi744"></a>        <a href="null_p.html#fv_tracer2d_modi746" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
          <a href="null_p.html#fv_tracer2d_modi745" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi744" target="origFile">ra_x(i, j) = area(i, j) + xfx(i, j, k) - xfx(i+<code class="constant">1</code>, j, k)</a>
<a name="tracer_2d_tlmi749"></a>          <a href="null_p.html#fv_tracer2d_modi745" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi748"></a>        <a href="null_p.html#fv_tracer2d_modi746" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi747"></a>        <a href="null_p.html#fv_tracer2d_modi749" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi748" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
            <a href="null_p.html#fv_tracer2d_modi747" target="origFile">ra_y(i, j) = area(i, j) + yfx(i, j, k) - yfx(i, j+<code class="constant">1</code>, k)</a>
<a name="tracer_2d_tlmi752"></a>          <a href="null_p.html#fv_tracer2d_modi748" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi751"></a>        <a href="null_p.html#fv_tracer2d_modi749" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi750"></a>        <a href="null_p.html#fv_tracer2d_modi752" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi751" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi750" target="origFile">dp2(i, j) = dp1(i, j, k) + (mfx(i, j, k)-mfx(i+<code class="constant">1</code>, j, k)+mfy(<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi750" target="origFile"><code class="label">&             </code>i, j, k)-mfy(i, j+<code class="constant">1</code>, k))*rarea(i, j)</a>
<a name="tracer_2d_tlmi753"></a>          <a href="null_p.html#fv_tracer2d_modi751" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi758"></a>        <a href="null_p.html#fv_tracer2d_modi752" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi754"></a>        <a href="null_p.html#fv_tracer2d_modi753" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'fv_tp_2d'</code>)</a>
        <a href="null_p.html#fv_tracer2d_modi758" target="origFile"><code class="keyword">DO </code>iq=qs,nq</a>
          <a href="null_p.html#fv_tracer2d_modi754" target="origFile"><code class="keyword">CALL </code><code class="funcname">FV_TP_2D_TLM</code>(q(isd:, jsd:, k, iq), q_tl(isd:, jsd:, k, iq<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi754" target="origFile"><code class="label">&                     </code>), cx(is:, jsd:, k), cy(isd:, js:, k), npx, npy, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi754" target="origFile"><code class="label">&                     </code>hord, fx, fx_tl, fy, fy_tl, xfx(is:, jsd:, k), yfx<code class="label">&</code></a>
<a name="tracer_2d_tlmi757"></a><a href="null_p.html#fv_tracer2d_modi754" target="origFile"><code class="label">&                     </code>(isd:, js:, k), ra_x, ra_y, <code class="keyword">mfx</code>=mfx(is:, js:, k), <code class="label">&</code></a>
<a name="tracer_2d_tlmi756"></a><a href="null_p.html#fv_tracer2d_modi754" target="origFile"><code class="label">&                     </code><code class="keyword">mfy</code>=mfy(is:, js:, k))</a>
<a name="tracer_2d_tlmi755"></a>          <a href="null_p.html#fv_tracer2d_modi757" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_modi756" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_modi755" target="origFile">q_tl(i, j, k, iq) = (dp1(i, j, k)*q_tl(i, j, k, iq)+rarea(<code class="label">&</code></a>
<a name="tracer_2d_tlmi755"></a><a href="null_p.html#fv_tracer2d_modi755" target="origFile"><code class="label">&               </code>i, j)*(fx_tl(i, j)-fx_tl(i+<code class="constant">1</code>, j)+fy_tl(i, j)-fy_tl(i, j+<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi755" target="origFile"><code class="label">&               </code><code class="constant">1</code>)))/dp2(i, j)</a>
              <a href="null_p.html#fv_tracer2d_modi755" target="origFile">q(i, j, k, iq) = (q(i, j, k, iq)*dp1(i, j, k)+(fx(i, j)-fx<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi755" target="origFile"><code class="label">&               </code>(i+<code class="constant">1</code>, j)+fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_modi756" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi759"></a>          <a href="null_p.html#fv_tracer2d_modi757" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi762"></a>        <a href="null_p.html#fv_tracer2d_modi758" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi761"></a>        <a href="null_p.html#fv_tracer2d_modi759" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'fv_tp_2d'</code>)</a>
<a name="tracer_2d_tlmi760"></a>        <a href="null_p.html#fv_tracer2d_modi762" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi761" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi760" target="origFile">dp1(i, j, k) = dp2(i, j)</a>
          <a href="null_p.html#fv_tracer2d_modi761" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi762" target="origFile"><code class="keyword">END DO</code></a>
<a name="tracer_2d_tlmi765"></a>      <a href="null_p.html#fv_tracer2d_modi763" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_modi764" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_modi765" target="origFile"><code class="comment">! npz</code></a>
<a href="null_p.html#fv_tracer2d_modi765" target="origFile"><code class="comment">! nsplt</code></a>
<a name="tracer_2d_tlmi766"></a><a href="null_p.html#fv_tracer2d_modi765" target="origFile"><code class="comment">! rescale mass fluxes back to original</code></a>
<a name="tracer_2d_tlmi767"></a>    <a href="null_p.html#fv_tracer2d_modi765" target="origFile">mfx = mfx/frac</a>
<a name="tracer_2d_tlmi768"></a>    <a href="null_p.html#fv_tracer2d_modi766" target="origFile">mfy = mfy/frac</a>
<a name="tracer_2d_tlmi770"></a><a name="tracer_2d_tlmi769"></a>    <a href="null_p.html#fv_tracer2d_modi767" target="origFile">cx = cx/frac</a>
<a name="tracer_2d_tlmi771"></a>    <a href="null_p.html#fv_tracer2d_modi768" target="origFile">cy = cy/frac</a>
<a name="tracer_2d_tlmi772"></a>    <a href="null_p.html#fv_tracer2d_modi769" target="origFile"><code class="keyword">IF</code> (<code class="funcname">PRESENT</code>(dpa)) </a><a href="null_p.html#fv_tracer2d_modi770" target="origFile">dpa = dp1</a>
<a name="tracer_2d_tlmi776"></a>    <a href="null_p.html#fv_tracer2d_modi771" target="origFile"><code class="keyword">IF</code> (id_divg .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_tracer2d_modi772" target="origFile">rdt = <code class="constant">1.</code>/(frac*dt)</a>
<a name="tracer_2d_tlmi775"></a><a href="null_p.html#fv_tracer2d_modi776" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
<a name="tracer_2d_tlmi774"></a>      <a href="null_p.html#fv_tracer2d_modi776" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="tracer_2d_tlmi773"></a>        <a href="null_p.html#fv_tracer2d_modi775" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_modi774" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_modi773" target="origFile">dp1(i, j, k) = (xfx(i+<code class="constant">1</code>, j, k)-xfx(i, j, k)+yfx(i, j+<code class="constant">1</code>, k)-<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi773" target="origFile"><code class="label">&             </code>yfx(i, j, k))*rarea(i, j)*rdt</a>
          <a href="null_p.html#fv_tracer2d_modi774" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_modi775" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_modi776" target="origFile"><code class="keyword">END DO</code></a>
<a name="offline_tracer_advection"></a>    <a href="null_p.html#fv_tracer2d_modi771" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">TRACER_2D_TLM</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">OFFLINE_TRACER_ADVECTION</code>(<code class="vardecl">q</code>, <code class="vardecl">ple0</code>, <code class="vardecl">ple1</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">ak</code>, <code class="vardecl">bk</code>, <code class="vardecl">ptop</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>, <code class="vardecl">hord</code>, <code class="vardecl">kord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">dt</code>, <code class="vardecl">z_tracer</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">fill</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">USE </code><code class="funcname">FV_MAPZ_MOD_D</code>, <code class="keyword">ONLY </code>: map1_q2</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">USE </code><code class="funcname">FV_FILL_MOD_D</code>, <code class="keyword">ONLY </code>: fillz</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!do k = 1,npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   do j = js,je</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      do i = is,ie</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!         q(i,j,k,iq) = q1(i,j,k) * scalingFactors(k)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! nq loop</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">z_tracer</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">fill</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple0</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP after dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">ple1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! AK for remapping</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ak</code>(<code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! BK for remapping</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">bk</code>(<code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ptop</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Arrays</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! X-Dir for MPP Updates</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">xl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Y-Dir for MPP Updates</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">yl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cxl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cyl</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfxl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfyl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Pressure Thickness</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dpl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Pressure Thickness</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Tracer Arrays</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! 2D Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! 2D Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! 3D Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q3</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Buffer Arrarys</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">wbuffer</code>(<code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">sbuffer</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">ebuffer</code>(<code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">nbuffer</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Remap Arrays</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pe2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local indices</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">n</code>, <code class="vardecl">iq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dtr8</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scalingfactor</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!real(REAL8) :: scalingFactors(npz)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Time-step</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">dtr8 = dt</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">wbuffer = <code class="constant">0.0</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">sbuffer = <code class="constant">0.0</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">ebuffer = <code class="constant">0.0</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">nbuffer = <code class="constant">0.0</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Fill CX/CY C-Grid boundaries and update ghost regions</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">xl(is:ie, js:je, :) = cx(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">yl(is:ie, js:je, :) = cy(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_GET_BOUNDARY</code>(xl, yl, domain, <code class="keyword">wbufferx</code>=wbuffer, <code class="keyword">ebufferx</code>=<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code>ebuffer, <code class="keyword">sbuffery</code>=sbuffer, <code class="keyword">nbuffery</code>=nbuffer, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code><code class="keyword">gridtype</code>=cgrid_ne)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">xl(ie+<code class="constant">1</code>, js:je, :) = ebuffer</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">yl(is:ie, je+<code class="constant">1</code>, :) = nbuffer</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS</code>(xl, yl, domain, <code class="keyword">gridtype</code>=cgrid_ne, <code class="keyword">complete</code>=<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                     </code><code class="constant">.true.</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">cxl(is:ie+<code class="constant">1</code>, jsd:jed, :) = xl(is:ie+<code class="constant">1</code>, jsd:jed, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">cyl(isd:ied, js:je+<code class="constant">1</code>, :) = yl(isd:ied, js:je+<code class="constant">1</code>, :)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Fill MFX/MFY C-Grid boundaries</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">xl(is:ie, js:je, :) = mfx(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">yl(is:ie, js:je, :) = mfy(:, :, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_GET_BOUNDARY</code>(xl, yl, domain, <code class="keyword">wbufferx</code>=wbuffer, <code class="keyword">ebufferx</code>=<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code>ebuffer, <code class="keyword">sbuffery</code>=sbuffer, <code class="keyword">nbuffery</code>=nbuffer, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code><code class="keyword">gridtype</code>=cgrid_ne)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">xl(ie+<code class="constant">1</code>, js:je, :) = ebuffer</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">yl(is:ie, je+<code class="constant">1</code>, :) = nbuffer</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfxl(is:ie+<code class="constant">1</code>, js:je, :) = xl(is:ie+<code class="constant">1</code>, js:je, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfyl(is:ie, js:je+<code class="constant">1</code>, :) = yl(is:ie, js:je+<code class="constant">1</code>, :)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Fill local tracers and pressure thickness</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">dpl(:, :, :) = ple0(:, :, <code class="constant">2</code>:npz+<code class="constant">1</code>) - ple0(:, :, <code class="constant">1</code>:npz)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">q3(is:ie, js:je, :, :) = q(is:ie, js:je, :, :)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (z_tracer) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared) private(q2)</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>iq=<code class="constant">1</code>,nq</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! To_do list:</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! The data copying can be avoided if q is</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">q2(i, j, iq) = q3(i, j, k, iq)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! re-dimensioned as q(i,j,nq,k)</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TRACER_2D_1L</code>(q2, dpl(is, js, k), mfxl(is, js, k), mfyl(is, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code>js, k), cxl(is, jsd, k), cyl(isd, js, k), npx, npy, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                   </code>npz, <code class="constant">1</code>, nq, hord, q_split, k, q3, dtr8, <code class="constant">0</code>, dpa)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TRACER_2D</code>(q3, dpl, mfxl, mfyl, cxl, cyl, npx, npy, npz, <code class="constant">1</code>, nq<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&              </code>, hord, q_split, dtr8, <code class="constant">0</code>, dpa)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------------------</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Re-Map constituents</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Do remapping one tracer at a time; seems to be faster</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! It requires less memory than mapn_ppm</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>iq=<code class="constant">1</code>,nq</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! pressures mapping from (dpA is new delp after tracer_2d)</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">pe1(:, <code class="constant">1</code>) = ptop</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">pe1(:, k) = pe1(:, k-<code class="constant">1</code>) + dpa(:, j, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! pressures mapping to</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">pe2(:, <code class="constant">1</code>) = ptop</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">pe2(:, npz+<code class="constant">1</code>) = pe1(:, npz+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">pe2(:, k) = ak(k) + bk(k)*pe1(:, npz+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp2(:, j, k) = pe2(:, k+<code class="constant">1</code>) - pe2(:, k)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MAP1_Q2</code>(npz, pe1, q3(isd, jsd, <code class="constant">1</code>, iq), npz, pe2, q1(:, j, :<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&              </code>), dp2(:, j, :), is, ie, <code class="constant">0</code>, kord, j, isd, ied, jsd, jed)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!, .true.)</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (fill) <code class="keyword">CALL </code><code class="funcname">FILLZ</code>(ie - is + <code class="constant">1</code>, npz, <code class="constant">1</code>, q1(:, j, :), dp2(:, j<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                      </code>, :))</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Rescale tracers based on ple1 at destination timestep</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">scalingfactor = <code class="funcname">CALCSCALINGFACTOR</code>(q1, dp2, ple1, npx, npy, npz, is<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&       </code>, ie, js, je)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!scalingFactors = computeScalingFactors(q1, dp2, ple1, npx, npy, npz, is, ie, js, je)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Return tracers</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!---------------</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">q(is:ie, js:je, <code class="constant">1</code>:npz, iq) = q1(is:ie, js:je, <code class="constant">1</code>:npz)*scalingfactor</a>
<a name="tracer_2d_1l"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">OFFLINE_TRACER_ADVECTION</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! !ROUTINE: Perform 2D horizontal-to-lagrangian transport</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">TRACER_2D_1L</code>(<code class="vardecl">q</code>, <code class="vardecl">dp0</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">qs</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">nq</code>, <code class="vardecl">hord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">k</code>, <code class="vardecl">q3</code>, <code class="vardecl">dt</code>, <code class="vardecl">id_divg</code>, <code class="vardecl">dpa</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">k</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! first tracer to advect</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">qs</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">id_divg</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! 2D Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q3</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">dp0</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP after advection</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">OPTIONAL</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Arrays</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfx2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">mfy2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cx2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cy2</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_x</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_y</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">xfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">yfx</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cmax</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">frac</code>, <code class="vardecl">rdt</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">nsplt</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">it</code>, <code class="vardecl">iq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">PRESENT</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cx(i, j) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j) = cx(i, j)*dxa(i-<code class="constant">1</code>, j)*dy(i, j)*sin_sg(i-<code class="constant">1</code>, j, <code class="constant">3</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j) = cx(i, j)*dxa(i, j)*dy(i, j)*sin_sg(i, j, <code class="constant">1</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cy(i, j) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j) = cy(i, j)*dya(i, j-<code class="constant">1</code>)*dx(i, j)*sin_sg(i, j-<code class="constant">1</code>, <code class="constant">4</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j) = cy(i, j)*dya(i, j)*dx(i, j)*sin_sg(i, j, <code class="constant">2</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (q_split .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Determine nsplt for tracer advection</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax = <code class="constant">0.</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cx(i, j) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs0 = cx(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs0 = -cx(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">x1 = abs0 + (<code class="constant">1.</code>-sina_u(i, j))</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cy(i, j) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs1 = cy(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs1 = -cy(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">y1 = abs1 + (<code class="constant">1.</code>-sina_v(i, j))</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (x1 .LT. y1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (y1 .LT. cmax) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax = cmax</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax = y1</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE IF</code> (x1 .LT. cmax) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax = cmax</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax = x1</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MP_REDUCE_MAX</code>(cmax)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">nsplt = <code class="funcname">INT</code>(<code class="constant">1.01 </code>+ cmax)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (gid .EQ. <code class="constant">0 </code>.AND. nsplt .GT. <code class="constant">5</code>) <code class="keyword">WRITE</code>(<code class="constant">6</code>, <code class="keyword">*</code>) k, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                                        </code><code class="string">'Tracer_2d_split='</code>, nsplt, cmax</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">nsplt = q_split</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">frac = <code class="constant">1.</code>/<code class="funcname">REAL</code>(nsplt)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">cx2(i, j) = cx(i, j)*frac</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j) = xfx(i, j)*frac</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfx2(i, j) = mfx(i, j)*frac</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">cy2(i, j) = cy(i, j)*frac</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j) = yfx(i, j)*frac</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfy2(i, j) = mfy(i, j)*frac</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">ra_x(i, j) = area(i, j) + xfx(i, j) - xfx(i+<code class="constant">1</code>, j)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">ra_y(i, j) = area(i, j) + yfx(i, j) - yfx(i, j+<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp1(i, j) = dp0(i, j)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>it=<code class="constant">1</code>,nsplt</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp2(i, j) = dp1(i, j) + (mfx2(i, j)-mfx2(i+<code class="constant">1</code>, j)+mfy2(i, j)-<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&           </code>mfy2(i, j+<code class="constant">1</code>))*rarea(i, j)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TOTAL'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TRAC'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS</code>(q, domain, <code class="keyword">complete</code>=<code class="constant">.true.</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TRAC'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TOTAL'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'fv_tp_2d'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>iq=qs,nq</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">FV_TP_2D</code>(q(isd:, jsd:, iq), cx2, cy2, npx, npy, hord, fx, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&               </code>fy, xfx, yfx, ra_x, ra_y, <code class="keyword">mfx</code>=mfx2, <code class="keyword">mfy</code>=mfy2)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (it .EQ. nsplt) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">q3(i, j, k, iq) = (q(i, j, iq)*dp1(i, j)+(fx(i, j)-fx(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&               </code>, j)+fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">q(i, j, iq) = (q(i, j, iq)*dp1(i, j)+(fx(i, j)-fx(i+<code class="constant">1</code>, j)+<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&               </code>fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'fv_tp_2d'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (it .NE. nsplt) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp1(i, j) = dp2(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! nsplt</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (id_divg .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">rdt = <code class="constant">1.</code>/(frac*dt)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp0(i, j) = (xfx(i+<code class="constant">1</code>, j)-xfx(i, j)+yfx(i, j+<code class="constant">1</code>)-yfx(i, j))*<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&           </code>rarea(i, j)*rdt</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
<a name="tracer_2d"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (<code class="funcname">PRESENT</code>(dpa)) dpa = dp2</a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">TRACER_2D_1L</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">TRACER_2D</code>(<code class="vardecl">q</code>, <code class="vardecl">dp1</code>, <code class="vardecl">mfx</code>, <code class="vardecl">mfy</code>, <code class="vardecl">cx</code>, <code class="vardecl">cy</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">qs</code>, <code class="vardecl">nq</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">hord</code>, <code class="vardecl">q_split</code>, <code class="vardecl">dt</code>, <code class="vardecl">id_divg</code>, <code class="vardecl">dpa</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! first tracer to advect</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">qs</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! number of tracers to be advected</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">hord</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q_split</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">id_divg</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Tracers</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>, <code class="vardecl">nq</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP before dyn_core</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! DELP after advection</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">OPTIONAL</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">dpa</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">cx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Courant Number Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">cy</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux X-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">mfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Mass Flux Y-Dir</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">mfy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Local Arrays</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">fy</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_x</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">ra_y</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">xfx</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>+<code class="constant">1</code>, <code class="vardecl">jsd</code>:<code class="vardecl">jed</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">yfx</code>(<code class="vardecl">isd</code>:<code class="vardecl">ied</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>+<code class="constant">1</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">cmax</code>(<code class="vardecl">npz</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#ifdef IBM_FIX</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      real(FVPRC) :: cmax_x, cmax_y</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#endif</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">c_global</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">fvprc</code><code class="typename">) </code>:: <code class="vardecl">frac</code>, <code class="vardecl">rdt</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">nsplt</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">it</code>, <code class="vardecl">iq</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">PRESENT</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cx(i, j, k) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j, k) = cx(i, j, k)*dxa(i-<code class="constant">1</code>, j)*dy(i, j)*sin_sg(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code>j, <code class="constant">3</code>)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j, k) = cx(i, j, k)*dxa(i, j)*dy(i, j)*sin_sg(i, j, <code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code>)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cy(i, j, k) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j, k) = cy(i, j, k)*dya(i, j-<code class="constant">1</code>)*dx(i, j)*sin_sg(i, j-<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code><code class="constant">1</code>, <code class="constant">4</code>)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j, k) = cy(i, j, k)*dya(i, j)*dx(i, j)*sin_sg(i, j, <code class="constant">2</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code>)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!--------------------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (q_split .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Determine nsplt</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#ifdef IBM_FIX</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!!$omp parallel do default(shared) private(cmax_x, cmax_y)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      do k=1,npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!        cmax(k) = 0.</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!        do j=js,je</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!          do i=is,ie</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!            cmax_x  = max(abs(cx(i,j,k))+1.-sina_u(i,j), cmax(k))</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!            cmax_y  = max(abs(cy(i,j,k))+1.-sina_v(i,j), cmax(k))</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!            cmax(k) = max(cmax_x, cmax_y)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!          enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!        enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!      enddo</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#else </code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared) </code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax(k) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cx(i, j, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs0 = cx(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs0 = -cx(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">x1 = abs0 + <code class="constant">1. </code>- sina_u(i, j)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cy(i, j, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs1 = cy(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">abs1 = -cy(i, j, k)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">y1 = abs1 + <code class="constant">1. </code>- sina_v(i, j)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (x1 .LT. y1) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (y1 .LT. cmax(k)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax(k) = cmax(k)</a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax(k) = y1</a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE IF</code> (x1 .LT. cmax(k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax(k) = cmax(k)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">cmax(k) = x1</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MP_REDUCE_MAX</code>(cmax, npz)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#endif</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! find global max courant number and define nsplt to scale cx,cy,mfx,mfy</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">c_global = cmax(<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (npz .NE. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! if NOT shallow water test case</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,npz</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (cmax(k) .LT. c_global) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">c_global = c_global</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">c_global = cmax(k)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">nsplt = <code class="funcname">INT</code>(<code class="constant">1. </code>+ c_global)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (gid .EQ. <code class="constant">0 </code>.AND. nsplt .GT. <code class="constant">5</code>) <code class="keyword">WRITE</code>(<code class="constant">6</code>, <code class="keyword">*</code>) <code class="string">'Tracer_2d_split='</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                                        </code>, nsplt, c_global</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">nsplt = q_split</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!--------------------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">frac = <code class="constant">1.</code>/<code class="funcname">REAL</code>(nsplt)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (nsplt .NE. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">cx(i, j, k) = cx(i, j, k)*frac</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">xfx(i, j, k) = xfx(i, j, k)*frac</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie+<code class="constant">1</code></a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfx(i, j, k) = mfx(i, j, k)*frac</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">cy(i, j, k) = cy(i, j, k)*frac</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">yfx(i, j, k) = yfx(i, j, k)*frac</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je+<code class="constant">1</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfy(i, j, k) = mfy(i, j, k)*frac</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>it=<code class="constant">1</code>,nsplt</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TOTAL'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'COMM_TRAC'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_UPDATE_DOMAINS</code>(q, domain, <code class="keyword">complete</code>=<code class="constant">.true.</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TRAC'</code>)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'COMM_TOTAL'</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared) private(ra_x, ra_y, dp2, fx, fy)</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=jsd,jed</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">ra_x(i, j) = area(i, j) + xfx(i, j, k) - xfx(i+<code class="constant">1</code>, j, k)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=isd,ied</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">ra_y(i, j) = area(i, j) + yfx(i, j, k) - yfx(i, j+<code class="constant">1</code>, k)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp2(i, j) = dp1(i, j, k) + (mfx(i, j, k)-mfx(i+<code class="constant">1</code>, j, k)+mfy(<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code>i, j, k)-mfy(i, j+<code class="constant">1</code>, k))*rarea(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_ON</code>(<code class="string">'fv_tp_2d'</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>iq=qs,nq</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">FV_TP_2D</code>(q(isd:, jsd:, k, iq), cx(is:, jsd:, k), cy(isd:<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                 </code>, js:, k), npx, npy, hord, fx, fy, xfx(is:, jsd:, k), <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                 </code>yfx(isd:, js:, k), ra_x, ra_y, <code class="keyword">mfx</code>=mfx(is:, js:, k), <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&                 </code><code class="keyword">mfy</code>=mfy(is:, js:, k))</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
              <a href="null_p.html#fv_tracer2d_mod" target="origFile">q(i, j, k, iq) = (q(i, j, k, iq)*dp1(i, j, k)+(fx(i, j)-fx<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&               </code>(i+<code class="constant">1</code>, j)+fy(i, j)-fy(i, j+<code class="constant">1</code>))*rarea(i, j))/dp2(i, j)</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMING_OFF</code>(<code class="string">'fv_tp_2d'</code>)</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp1(i, j, k) = dp2(i, j)</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! npz</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! nsplt</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! rescale mass fluxes back to original</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfx = mfx/frac</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">mfy = mfy/frac</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">cx = cx/frac</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">cy = cy/frac</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (<code class="funcname">PRESENT</code>(dpa)) dpa = dp1</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (id_divg .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">rdt = <code class="constant">1.</code>/(frac*dt)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!$omp parallel do default(shared)</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>j=js,je</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>i=is,ie</a>
            <a href="null_p.html#fv_tracer2d_mod" target="origFile">dp1(i, j, k) = (xfx(i+<code class="constant">1</code>, j, k)-xfx(i, j, k)+yfx(i, j+<code class="constant">1</code>, k)-<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&             </code>yfx(i, j, k))*rarea(i, j)*rdt</a>
          <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="calcscalingfactor_tlm"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">TRACER_2D</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!  Differentiation of calcscalingfactor in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   variations   of useful results: scaling</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!   with respect to varying inputs: q1</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------------------------------------</code></a>
<a name="calcscalingfactor_tlmi619"></a>  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">FUNCTION </code><code class="funcname">CALCSCALINGFACTOR_TLM</code>(<code class="vardecl">q1</code>, <code class="vardecl">q1_tl</code>, <code class="vardecl">dp2</code>, <code class="vardecl">ple1</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">is</code><code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">ie</code>, <code class="vardecl">js</code>, <code class="vardecl">je</code>, <code class="vardecl">scaling</code>) RESULT (SCALING_TL)</a>
<a name="calcscalingfactor_tlmi620"></a>    <a href="null_p.html#fv_tracer2d_modi619" target="origFile"><code class="keyword">USE </code><code class="funcname">MPP_MOD_D</code>, <code class="keyword">ONLY </code>: mpp_sum, mpp_sum_tlm</a>
<a name="calcscalingfactor_tlmi621"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="calcscalingfactor_tlmi622"></a>    <a href="null_p.html#fv_tracer2d_modi620" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code>, <code class="vardecl">is</code>, <code class="vardecl">ie</code>, <code class="vardecl">js</code>, <code class="vardecl">je</code></a>
<a name="calcscalingfactor_tlmi623"></a>    <a href="null_p.html#fv_tracer2d_modi621" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_modi622" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
<a name="calcscalingfactor_tlmi624"></a>    <a href="null_p.html#fv_tracer2d_modi623" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="calcscalingfactor_tlmi625"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1_tl</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
<a name="calcscalingfactor_tlmi626"></a>    <a href="null_p.html#fv_tracer2d_modi624" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi625" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
<a name="calcscalingfactor_tlmi627"></a>    <a href="null_p.html#fv_tracer2d_modi626" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scaling</code></a>
<a name="calcscalingfactor_tlmi628"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scaling_tl</code></a>
    <a href="null_p.html#fv_tracer2d_modi627" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k</code></a>
<a name="calcscalingfactor_tlmi629"></a>    <a href="null_p.html#fv_tracer2d_modi628" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">partialsums</code>(<code class="constant">2</code>, <code class="vardecl">npz</code>), <code class="vardecl">globalsums</code>(<code class="constant">2</code>)</a>
<a name="calcscalingfactor_tlmi630"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">partialsums_tl</code>(<code class="constant">2</code>, <code class="vardecl">npz</code>), <code class="vardecl">globalsums_tl</code>(<code class="constant">2</code>)</a>
<a name="calcscalingfactor_tlmi631"></a>    <a href="null_p.html#fv_tracer2d_modi629" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tiny_denominator</code>=<code class="constant">1.0e-30</code></a>
<a name="calcscalingfactor_tlmi632"></a>    <a href="null_p.html#fv_tracer2d_modi630" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#fv_tracer2d_modi631" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null_p.html#fv_tracer2d_modi632" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, DIMENSION(ie-is+<code class="constant">1</code>, je-js+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
<a name="calcscalingfactor_tlmi637"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, DIMENSION(ie-is+<code class="constant">1</code>, je-js+<code class="constant">1</code>) :: <code class="vardecl">arg1_tl</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">partialsums_tl = <code class="constant">0.0_8</code></a>
<a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">!-------</code></a>
<a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">! Compute partial sum on local array first to minimize communication.</code></a>
<a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">! This algorithm will not be strongly repdroducible under changes do domain</code></a>
<a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">! decomposition, but uses far less communication bandwidth (and memory BW)</code></a>
<a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">! then the preceding implementation.</code></a>
<a name="calcscalingfactor_tlmi633"></a><a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="comment">!-------</code></a>
    <a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a name="calcscalingfactor_tlmi633"></a><a href="null_p.html#fv_tracer2d_modi633" target="origFile"><code class="comment">! numerator</code></a>
<a name="calcscalingfactor_tlmi634"></a>      <a href="null_p.html#fv_tracer2d_modi633" target="origFile">arg1_tl(:, :) = dp2(:, :, k)*area(is:ie, js:je)*q1_tl(:, :, k)</a>
<a name="calcscalingfactor_tlmi634"></a>      <a href="null_p.html#fv_tracer2d_modi633" target="origFile">arg1(:, :) = q1(:, :, k)*dp2(:, :, k)*area(is:ie, js:je)</a>
<a name="calcscalingfactor_tlmi635"></a>      <a href="null_p.html#fv_tracer2d_modi634" target="origFile">partialsums_tl(<code class="constant">1</code>, k) = <code class="funcname">SUM</code>(arg1_tl(:, :))</a>
      <a href="null_p.html#fv_tracer2d_modi634" target="origFile">partialsums(<code class="constant">1</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
<a href="null_p.html#fv_tracer2d_modi635" target="origFile"><code class="comment">! denominator</code></a>
<a name="calcscalingfactor_tlmi635"></a>      <a href="null_p.html#fv_tracer2d_modi635" target="origFile">arg1_tl(:, :) = (ple1(:, :, k+<code class="constant">1</code>)-ple1(:, :, k))*area(is:ie, js:je)<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_modi635" target="origFile"><code class="label">&       </code>*q1_tl(:, :, k)</a>
<a name="calcscalingfactor_tlmi636"></a>      <a href="null_p.html#fv_tracer2d_modi635" target="origFile">arg1(:, :) = q1(:, :, k)*(ple1(:, :, k+<code class="constant">1</code>)-ple1(:, :, k))*area(is:<code class="label">&</code></a>
<a name="calcscalingfactor_tlmi636"></a><a href="null_p.html#fv_tracer2d_modi635" target="origFile"><code class="label">&       </code>ie, js:je)</a>
      <a href="null_p.html#fv_tracer2d_modi636" target="origFile">partialsums_tl(<code class="constant">2</code>, k) = <code class="funcname">SUM</code>(arg1_tl(:, :))</a>
      <a href="null_p.html#fv_tracer2d_modi636" target="origFile">partialsums(<code class="constant">2</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
<a name="calcscalingfactor_tlmi638"></a>    <a href="null_p.html#fv_tracer2d_modi637" target="origFile"><code class="keyword">END DO</code></a>
<a name="calcscalingfactor_tlmi638"></a>    <a href="null_p.html#fv_tracer2d_modi638" target="origFile">globalsums_tl = <code class="constant">0.0_8</code></a>
<a name="calcscalingfactor_tlmi639"></a>    <a href="null_p.html#fv_tracer2d_modi638" target="origFile">globalsums_tl(<code class="constant">1</code>) = <code class="funcname">SUM</code>(partialsums_tl(<code class="constant">1</code>, :))</a>
<a name="calcscalingfactor_tlmi639"></a>    <a href="null_p.html#fv_tracer2d_modi638" target="origFile">globalsums(<code class="constant">1</code>) = <code class="funcname">SUM</code>(partialsums(<code class="constant">1</code>, :))</a>
<a name="calcscalingfactor_tlmi640"></a>    <a href="null_p.html#fv_tracer2d_modi639" target="origFile">globalsums_tl(<code class="constant">2</code>) = <code class="funcname">SUM</code>(partialsums_tl(<code class="constant">2</code>, :))</a>
<a name="calcscalingfactor_tlmi641"></a>    <a href="null_p.html#fv_tracer2d_modi639" target="origFile">globalsums(<code class="constant">2</code>) = <code class="funcname">SUM</code>(partialsums(<code class="constant">2</code>, :))</a>
<a name="calcscalingfactor_tlmi642"></a>    <a href="null_p.html#fv_tracer2d_modi640" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_SUM_TLM</code>(globalsums, globalsums_tl, <code class="constant">2</code>)</a>
    <a href="null_p.html#fv_tracer2d_modi641" target="origFile"><code class="keyword">IF</code> (globalsums(<code class="constant">2</code>) .GT. tiny_denominator) <code class="keyword">THEN</code></a>
<a name="calcscalingfactor_tlmi642"></a>      <a href="null_p.html#fv_tracer2d_modi642" target="origFile">scaling_tl = (globalsums_tl(<code class="constant">1</code>)*globalsums(<code class="constant">2</code>)-globalsums(<code class="constant">1</code>)*<code class="label">&</code></a>
<a name="calcscalingfactor_tlmi643"></a><a href="null_p.html#fv_tracer2d_modi642" target="origFile"><code class="label">&       </code>globalsums_tl(<code class="constant">2</code>))/globalsums(<code class="constant">2</code>)**<code class="constant">2</code></a>
      <a href="null_p.html#fv_tracer2d_modi642" target="origFile">scaling = globalsums(<code class="constant">1</code>)/globalsums(<code class="constant">2</code>)</a>
<a href="null_p.html#fv_tracer2d_modi643" target="origFile"><code class="comment">!#################################################################</code></a>
<a href="null_p.html#fv_tracer2d_modi643" target="origFile"><code class="comment">! This line was added to ensure strong reproducibility of the code</code></a>
<a href="null_p.html#fv_tracer2d_modi643" target="origFile"><code class="comment">!#################################################################</code></a>
<a name="calcscalingfactor_tlmi644"></a>      <a href="null_p.html#fv_tracer2d_modi643" target="origFile">scaling = <code class="funcname">REAL</code>(scaling, <code class="keyword">kind</code>=real4)</a>
    <a href="null_p.html#fv_tracer2d_modi641" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_modi644" target="origFile">scaling = <code class="constant">1.d0</code></a>
      <a href="null_p.html#fv_tracer2d_modi641" target="origFile">scaling_tl = <code class="constant">0.0_8</code></a>
<a name="calcscalingfactor"></a>    <a href="null_p.html#fv_tracer2d_modi641" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END FUNCTION </code><code class="funcname">CALCSCALINGFACTOR_TLM</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------------------------------------</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">FUNCTION </code><code class="funcname">CALCSCALINGFACTOR</code>(<code class="vardecl">q1</code>, <code class="vardecl">dp2</code>, <code class="vardecl">ple1</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">is</code>, <code class="vardecl">ie</code>, <code class="vardecl">js</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">je</code>) RESULT (SCALING)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">USE </code><code class="funcname">MPP_MOD_D</code>, <code class="keyword">ONLY </code>: mpp_sum</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code>, <code class="vardecl">is</code>, <code class="vardecl">ie</code>, <code class="vardecl">js</code>, <code class="vardecl">je</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scaling</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">partialsums</code>(<code class="constant">2</code>, <code class="vardecl">npz</code>), <code class="vardecl">globalsums</code>(<code class="constant">2</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tiny_denominator</code>=<code class="constant">1.0e-30</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, DIMENSION(ie-is+<code class="constant">1</code>, je-js+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-------</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Compute partial sum on local array first to minimize communication.</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! This algorithm will not be strongly repdroducible under changes do domain</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! decomposition, but uses far less communication bandwidth (and memory BW)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! then the preceding implementation.</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-------</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! numerator</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">arg1(:, :) = q1(:, :, k)*dp2(:, :, k)*area(is:ie, js:je)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">partialsums(<code class="constant">1</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! denominator</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">arg1(:, :) = q1(:, :, k)*(ple1(:, :, k+<code class="constant">1</code>)-ple1(:, :, k))*area(is:<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&       </code>ie, js:je)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">partialsums(<code class="constant">2</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">globalsums(<code class="constant">1</code>) = <code class="funcname">SUM</code>(partialsums(<code class="constant">1</code>, :))</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">globalsums(<code class="constant">2</code>) = <code class="funcname">SUM</code>(partialsums(<code class="constant">2</code>, :))</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_SUM</code>(globalsums, <code class="constant">2</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (globalsums(<code class="constant">2</code>) .GT. tiny_denominator) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">scaling = globalsums(<code class="constant">1</code>)/globalsums(<code class="constant">2</code>)</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#################################################################</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! This line was added to ensure strong reproducibility of the code</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!#################################################################</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">scaling = <code class="funcname">REAL</code>(scaling, <code class="keyword">kind</code>=real4)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">scaling = <code class="constant">1.d0</code></a>
<a name="computescalingfactors"></a>    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END FUNCTION </code><code class="funcname">CALCSCALINGFACTOR</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!------------------------------------------------------------------------------------</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">FUNCTION </code><code class="funcname">COMPUTESCALINGFACTORS</code>(<code class="vardecl">q1</code>, <code class="vardecl">dp2</code>, <code class="vardecl">ple1</code>, <code class="vardecl">npx</code>, <code class="vardecl">npy</code>, <code class="vardecl">npz</code>, <code class="vardecl">is</code>, <code class="vardecl">ie</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&   </code><code class="vardecl">js</code>, <code class="vardecl">je</code>) RESULT (SCALING)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">USE </code><code class="funcname">MPP_MOD_D</code>, <code class="keyword">ONLY </code>: mpp_sum</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npx</code>, <code class="vardecl">is</code>, <code class="vardecl">ie</code>, <code class="vardecl">js</code>, <code class="vardecl">je</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npy</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">npz</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple1</code>(<code class="vardecl">is</code>:<code class="vardecl">ie</code>, <code class="vardecl">js</code>:<code class="vardecl">je</code>, <code class="vardecl">npz</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">scaling</code>(<code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">partialsums</code>(<code class="constant">2</code>, <code class="vardecl">npz</code>), <code class="vardecl">globalsums</code>(<code class="constant">2</code>, <code class="vardecl">npz</code>)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tiny_denominator</code>=<code class="constant">1.0e-30</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, DIMENSION(ie-is+<code class="constant">1</code>, je-js+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-------</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! Compute partial sum on local array first to minimize communication.</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! This algorithm will not be strongly repdroducible under changes do domain</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! decomposition, but uses far less communication bandwidth (and memory BW)</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! then the preceding implementation.</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">!-------</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! numerator</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">arg1(:, :) = q1(:, :, k)*dp2(:, :, k)*area(is:ie, js:je)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">partialsums(<code class="constant">1</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="comment">! denominator</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">arg1(:, :) = q1(:, :, k)*(ple1(:, :, k+<code class="constant">1</code>)-ple1(:, :, k))*area(is:<code class="label">&</code></a>
<a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="label">&       </code>ie, js:je)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile">partialsums(<code class="constant">2</code>, k) = <code class="funcname">SUM</code>(arg1(:, :))</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">MPP_SUM</code>(partialsums, <code class="constant">2</code>*npz)</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile">globalsums = partialsums</a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,npz</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">IF</code> (partialsums(<code class="constant">2</code>, k) .GT. tiny_denominator) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">scaling(k) = globalsums(<code class="constant">1</code>, k)/globalsums(<code class="constant">2</code>, k)</a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_tracer2d_mod" target="origFile">scaling(k) = <code class="constant">1.d0</code></a>
      <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_tracer2d_mod" target="origFile"><code class="keyword">END FUNCTION </code><code class="funcname">COMPUTESCALINGFACTORS</code></a>
<code class="keyword">END MODULE </code><code class="funcname">FV_TRACER2D_MOD_D</code>
</pre>
</body>
