<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="keyword">MODULE </code><code class="funcname">FV_MAPZ_MOD_D</code>
  <code class="keyword">USE </code><code class="funcname">FV_ARRAYS_MOD</code>, <code class="keyword">ONLY </code>: real8
  <code class="keyword">IMPLICIT NONE</code>
  <code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">r0</code>=<code class="constant">0.0</code>, <code class="vardecl">r2</code>=<code class="constant">1.</code>/<code class="constant">2.</code>, <code class="vardecl">r3</code>=<code class="constant">1.</code>/<code class="constant">3.</code>, <code class="vardecl">r23</code>=<code class="constant">2.</code>/<code class="constant">3.</code>, <code class="vardecl">r12</code>=<code class="label">&</code>
<code class="label">&   </code><code class="constant">1.</code>/<code class="constant">12.</code>
  PRIVATE 
  PUBLIC map1_q2
  PUBLIC map1_q2_tlm
<a name="map1_q2_tlm"></a>
<code class="keyword">CONTAINS</code>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!  Differentiation of map1_q2 in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!   variations   of useful results: q2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!   with respect to varying inputs: q1 q2</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">MAP1_Q2_TLM</code>(<code class="vardecl">km</code>, <code class="vardecl">pe1</code>, <code class="vardecl">q1</code>, <code class="vardecl">q1_tl</code>, <code class="vardecl">kn</code>, <code class="vardecl">pe2</code>, <code class="vardecl">q2</code>, <code class="vardecl">q2_tl</code>, <code class="vardecl">dp2</code>, <code class="vardecl">i1</code><code class="label">&</code></a>
<a name="map1_q2_tlmi510"></a><a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>, <code class="vardecl">kord</code>, <code class="vardecl">j</code>, <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="map1_q2_tlmi511"></a><a href="null_p.html#fv_mapz_modi510" target="origFile"><code class="comment">! !INPUT PARAMETERS:</code></a>
<a name="map1_q2_tlmi512"></a>    <a href="null_p.html#fv_mapz_modi510" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">j</code></a>
<a name="map1_q2_tlmi513"></a>    <a href="null_p.html#fv_mapz_modi511" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
    <a href="null_p.html#fv_mapz_modi512" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code></a>
<a name="map1_q2_tlmi514"></a><a href="null_p.html#fv_mapz_modi513" target="origFile"><code class="comment">! Mode: 0 ==  constituents 1 == ???</code></a>
<a name="map1_q2_tlmi515"></a>    <a href="null_p.html#fv_mapz_modi513" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
    <a href="null_p.html#fv_mapz_modi514" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
<a name="map1_q2_tlmi516"></a><a href="null_p.html#fv_mapz_modi515" target="origFile"><code class="comment">! Original vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_modi515" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a name="map1_q2_tlmi517"></a><a href="null_p.html#fv_mapz_modi516" target="origFile"><code class="comment">! Target vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_modi516" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kn</code></a>
<a name="map1_q2_tlmi518"></a><a href="null_p.html#fv_mapz_modi517" target="origFile"><code class="comment">! pressure at layer edges </code></a>
    <a href="null_p.html#fv_mapz_modi517" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_mapz_modi518" target="origFile"><code class="comment">! (from model top to bottom surface)</code></a>
<a href="null_p.html#fv_mapz_modi518" target="origFile"><code class="comment">! in the original vertical coordinate</code></a>
<a name="map1_q2_tlmi519"></a><a href="null_p.html#fv_mapz_modi518" target="origFile"><code class="comment">! pressure at layer edges </code></a>
    <a href="null_p.html#fv_mapz_modi518" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_mapz_modi519" target="origFile"><code class="comment">! (from model top to bottom surface)</code></a>
<a href="null_p.html#fv_mapz_modi519" target="origFile"><code class="comment">! in the new vertical coordinate</code></a>
<a href="null_p.html#fv_mapz_modi519" target="origFile"><code class="comment">! Field input</code></a>
<a name="map1_q2_tlmi520"></a>    <a href="null_p.html#fv_mapz_modi519" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">ibeg</code>:<code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>:<code class="vardecl">jend</code>, <code class="vardecl">km</code>)</a>
<a name="map1_q2_tlmi521"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1_tl</code>(<code class="vardecl">ibeg</code>:<code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>:<code class="vardecl">jend</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_modi520" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a href="null_p.html#fv_mapz_modi521" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_modi521" target="origFile"><code class="comment">! Field output</code></a>
<a name="map1_q2_tlmi522"></a>    <a href="null_p.html#fv_mapz_modi521" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2_tl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a name="map1_q2_tlmi523"></a><a href="null_p.html#fv_mapz_modi522" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#fv_mapz_modi522" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a name="map1_q2_tlmi524"></a>    <a href="null_p.html#fv_mapz_modi523" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q4_tl</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a name="map1_q2_tlmi525"></a>    <a href="null_p.html#fv_mapz_modi524" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pl</code>, <code class="vardecl">pr</code>, <code class="vardecl">qsum</code>, <code class="vardecl">dp</code>, <code class="vardecl">esl</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">qsum_tl</code></a>
<a name="map1_q2_tlmi529"></a>    <a href="null_p.html#fv_mapz_modi525" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">l</code>, <code class="vardecl">m</code>, <code class="vardecl">k0</code></a>
<a name="map1_q2_tlmi528"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile">q4_tl = <code class="constant">0.0_8</code></a>
<a name="map1_q2_tlmi526"></a>    <a href="null_p.html#fv_mapz_modi529" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km</a>
<a name="map1_q2_tlmi527"></a>      <a href="null_p.html#fv_mapz_modi528" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="map1_q2_tlmi527"></a>        <a href="null_p.html#fv_mapz_modi526" target="origFile">dp1(i, k) = pe1(i, k+<code class="constant">1</code>) - pe1(i, k)</a>
        <a href="null_p.html#fv_mapz_modi527" target="origFile">q4_tl(<code class="constant">1</code>, i, k) = q1_tl(i, j, k)</a>
        <a href="null_p.html#fv_mapz_modi527" target="origFile">q4(<code class="constant">1</code>, i, k) = q1(i, j, k)</a>
<a name="map1_q2_tlmi530"></a>      <a href="null_p.html#fv_mapz_modi528" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_modi529" target="origFile"><code class="keyword">END DO</code></a>
<a name="map1_q2_tlmi531"></a><a href="null_p.html#fv_mapz_modi530" target="origFile"><code class="comment">! Compute vertical subgrid distribution</code></a>
<a name="map1_q2_tlmi532"></a>    <a href="null_p.html#fv_mapz_modi530" target="origFile"><code class="keyword">IF</code> (kord .GT. <code class="constant">7</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_modi531" target="origFile"><code class="keyword">IF</code> (kord .EQ. <code class="constant">111</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_modi532" target="origFile"><code class="keyword">CALL </code><code class="funcname">CS_PROFILE_LINEAR_TLM</code>(q4, q4_tl, dp1, km, i1, i2, iv)</a>
<a href="null_p.html#fv_mapz_modi531" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#fv_mapz_modi531" target="origFile"><code class="comment">!  call  cs_profile( q4, dp1, km, i1, i2, iv, kord )</code></a>
        <a href="null_p.html#fv_mapz_modi531" target="origFile">qsum_tl = <code class="constant">0.0_8</code></a>
      <a href="null_p.html#fv_mapz_modi531" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_modi531" target="origFile">qsum_tl = <code class="constant">0.0_8</code></a>
      <a href="null_p.html#fv_mapz_modi531" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_modi530" target="origFile"><code class="keyword">ELSE</code></a>
<a name="map1_q2_tlmi551"></a>      <a href="null_p.html#fv_mapz_modi530" target="origFile">qsum_tl = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#fv_mapz_modi530" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_modi551" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#fv_mapz_modi551" target="origFile"><code class="comment">!    call ppm_profile( q4, dp1, km, i1, i2, iv, kord )</code></a>
<a name="map1_q2_tlmi533"></a><a href="null_p.html#fv_mapz_modi551" target="origFile"><code class="comment">! Mapping</code></a>
<a name="map1_q2_tlmi550"></a>    <a href="null_p.html#fv_mapz_modi551" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="map1_q2_tlmi534"></a>      <a href="null_p.html#fv_mapz_modi533" target="origFile">k0 = <code class="constant">1</code></a>
<a name="map1_q2_tlmi535"></a>      <a href="null_p.html#fv_mapz_modi550" target="origFile"><code class="keyword">DO </code><code class="label">555 </code>k=<code class="constant">1</code>,kn</a>
        <a href="null_p.html#fv_mapz_modi534" target="origFile"><code class="keyword">DO </code>l=k0,km</a>
<a href="null_p.html#fv_mapz_modi535" target="origFile"><code class="comment">! locate the top edge: pe2(i,k)</code></a>
          <a href="null_p.html#fv_mapz_modi535" target="origFile"><code class="keyword">IF</code> (pe2(i, k) .GE. pe1(i, l) .AND. pe2(i, k) .LE. pe1(i, l+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi535" target="origFile"><code class="label">&         </code>) <code class="keyword">GOTO </code><code class="label">110</code></a>
<a name="map1_q2_tlmi536"></a>        <a href="null_p.html#fv_mapz_modi534" target="origFile"><code class="keyword">END DO</code></a>
<a name="map1_q2_tlmi537"></a>        <a href="null_p.html#fv_mapz_modi550" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
<a name="map1_q2_tlmi538"></a> <a href="null_p.html#fv_mapz_modi550" target="origFile"><code class="label">110 </code></a>   <a href="null_p.html#fv_mapz_modi536" target="origFile">pl = (pe2(i, k)-pe1(i, l))/dp1(i, l)</a>
        <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a name="map1_q2_tlmi539"></a><a href="null_p.html#fv_mapz_modi538" target="origFile"><code class="comment">! entire new grid is within the original grid</code></a>
          <a href="null_p.html#fv_mapz_modi538" target="origFile">pr = (pe2(i, k+<code class="constant">1</code>)-pe1(i, l))/dp1(i, l)</a>
          <a href="null_p.html#fv_mapz_modi539" target="origFile">q2_tl(i, k) = q4_tl(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*(pr+pl)*(q4_tl(<code class="constant">4</code>, i, l)+<code class="label">&</code></a>
<a name="map1_q2_tlmi539"></a><a href="null_p.html#fv_mapz_modi539" target="origFile"><code class="label">&           </code>q4_tl(<code class="constant">3</code>, i, l)-q4_tl(<code class="constant">2</code>, i, l)) - r3*(pr*(pr+pl)+pl**<code class="constant">2</code>)*q4_tl<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi539" target="origFile"><code class="label">&           </code>(<code class="constant">4</code>, i, l)</a>
<a name="map1_q2_tlmi540"></a>          <a href="null_p.html#fv_mapz_modi539" target="origFile">q2(i, k) = q4(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi539" target="origFile"><code class="label">&           </code>, l))*(pr+pl) - q4(<code class="constant">4</code>, i, l)*r3*(pr*(pr+pl)+pl**<code class="constant">2</code>)</a>
          <a href="null_p.html#fv_mapz_modi540" target="origFile">k0 = l</a>
<a name="map1_q2_tlmi541"></a>          <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="keyword">GOTO </code><code class="label">555</code></a>
        <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_modi541" target="origFile"><code class="comment">! Fractional area...</code></a>
          <a href="null_p.html#fv_mapz_modi541" target="origFile">qsum_tl = (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4_tl(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(<code class="constant">1.</code>+pl)*<code class="label">&</code></a>
<a name="map1_q2_tlmi541"></a><a href="null_p.html#fv_mapz_modi541" target="origFile"><code class="label">&           </code>(q4_tl(<code class="constant">4</code>, i, l)+q4_tl(<code class="constant">3</code>, i, l)-q4_tl(<code class="constant">2</code>, i, l))-r3*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi541" target="origFile"><code class="label">&           </code>+pl))*q4_tl(<code class="constant">4</code>, i, l))</a>
          <a href="null_p.html#fv_mapz_modi541" target="origFile">qsum = (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+<code class="label">&</code></a>
<a name="map1_q2_tlmi542"></a><a href="null_p.html#fv_mapz_modi541" target="origFile"><code class="label">&           </code>q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)-q4(<code class="constant">4</code>, i, l)*(r3*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code>+<code class="label">&</code></a>
<a name="map1_q2_tlmi543"></a><a href="null_p.html#fv_mapz_modi541" target="origFile"><code class="label">&           </code>pl))))</a>
          <a href="null_p.html#fv_mapz_modi542" target="origFile"><code class="keyword">DO </code>m=l+<code class="constant">1</code>,km</a>
<a name="map1_q2_tlmi544"></a><a href="null_p.html#fv_mapz_modi543" target="origFile"><code class="comment">! locate the bottom edge: pe2(i,k+1)</code></a>
            <a href="null_p.html#fv_mapz_modi543" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .GT. pe1(i, m+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a name="map1_q2_tlmi544"></a><a href="null_p.html#fv_mapz_modi544" target="origFile"><code class="comment">! Whole layer..</code></a>
              <a href="null_p.html#fv_mapz_modi544" target="origFile">qsum_tl = qsum_tl + dp1(i, m)*q4_tl(<code class="constant">1</code>, i, m)</a>
              <a href="null_p.html#fv_mapz_modi544" target="origFile">qsum = qsum + dp1(i, m)*q4(<code class="constant">1</code>, i, m)</a>
            <a href="null_p.html#fv_mapz_modi543" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_modi543" target="origFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
            <a href="null_p.html#fv_mapz_modi543" target="origFile"><code class="keyword">END IF</code></a>
<a name="map1_q2_tlmi545"></a>          <a href="null_p.html#fv_mapz_modi542" target="origFile"><code class="keyword">END DO</code></a>
<a name="map1_q2_tlmi546"></a>          <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
<a name="map1_q2_tlmi547"></a> <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="label">120 </code></a>     <a href="null_p.html#fv_mapz_modi545" target="origFile">dp = pe2(i, k+<code class="constant">1</code>) - pe1(i, m)</a>
          <a href="null_p.html#fv_mapz_modi546" target="origFile">esl = dp/dp1(i, m)</a>
<a name="map1_q2_tlmi547"></a>          <a href="null_p.html#fv_mapz_modi547" target="origFile">qsum_tl = qsum_tl + dp*(q4_tl(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4_tl(<code class="constant">3</code>, i, m)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi547" target="origFile"><code class="label">&           </code>-q4_tl(<code class="constant">2</code>, i, m)+(<code class="constant">1.</code>-r23*esl)*q4_tl(<code class="constant">4</code>, i, m)))</a>
<a name="map1_q2_tlmi548"></a>          <a href="null_p.html#fv_mapz_modi547" target="origFile">qsum = qsum + dp*(q4(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4(<code class="constant">3</code>, i, m)-q4(<code class="constant">2</code>, i, m)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi547" target="origFile"><code class="label">&           </code>+q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl)))</a>
<a name="map1_q2_tlmi549"></a>          <a href="null_p.html#fv_mapz_modi548" target="origFile">k0 = m</a>
<a name="map1_q2_tlmi549"></a>        <a href="null_p.html#fv_mapz_modi537" target="origFile"><code class="keyword">END IF</code></a>
 <a href="null_p.html#fv_mapz_modi550" target="origFile"><code class="label">123 </code></a>   <a href="null_p.html#fv_mapz_modi549" target="origFile">q2_tl(i, k) = qsum_tl/dp2(i, k)</a>
        <a href="null_p.html#fv_mapz_modi549" target="origFile">q2(i, k) = qsum/dp2(i, k)</a>
 <a href="null_p.html#fv_mapz_modi550" target="origFile"><code class="label">555  </code><code class="keyword">CONTINUE</code></a>
<a name="map1_q2"></a>    <a href="null_p.html#fv_mapz_modi551" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">MAP1_Q2_TLM</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">MAP1_Q2</code>(<code class="vardecl">km</code>, <code class="vardecl">pe1</code>, <code class="vardecl">q1</code>, <code class="vardecl">kn</code>, <code class="vardecl">pe2</code>, <code class="vardecl">q2</code>, <code class="vardecl">dp2</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>, <code class="vardecl">kord</code>, <code class="vardecl">j</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT PARAMETERS:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">j</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Mode: 0 ==  constituents 1 == ???</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Original vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Target vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kn</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! pressure at layer edges </code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! (from model top to bottom surface)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! in the original vertical coordinate</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! pressure at layer edges </code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>+<code class="constant">1</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! (from model top to bottom surface)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! in the new vertical coordinate</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Field input</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q1</code>(<code class="vardecl">ibeg</code>:<code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>:<code class="vardecl">jend</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Field output</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pl</code>, <code class="vardecl">pr</code>, <code class="vardecl">qsum</code>, <code class="vardecl">dp</code>, <code class="vardecl">esl</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">l</code>, <code class="vardecl">m</code>, <code class="vardecl">k0</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">dp1(i, k) = pe1(i, k+<code class="constant">1</code>) - pe1(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q4(<code class="constant">1</code>, i, k) = q1(i, j, k)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Compute vertical subgrid distribution</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GT. <code class="constant">7</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .EQ. <code class="constant">111</code>) <code class="keyword">CALL </code><code class="funcname">CS_PROFILE_LINEAR</code>(q4, dp1, km, i1, i2, iv)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!  call  cs_profile( q4, dp1, km, i1, i2, iv, kord )</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!    call ppm_profile( q4, dp1, km, i1, i2, iv, kord )</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Mapping</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">k0 = <code class="constant">1</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kn</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>l=k0,km</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! locate the top edge: pe2(i,k)</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pe2(i, k) .GE. pe1(i, l) .AND. pe2(i, k) .LE. pe1(i, l+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">pl = (pe2(i, k)-pe1(i, l))/dp1(i, l)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! entire new grid is within the original grid</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">pr = (pe2(i, k+<code class="constant">1</code>)-pe1(i, l))/dp1(i, l)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q2(i, k) = q4(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&               </code>, i, l))*(pr+pl) - q4(<code class="constant">4</code>, i, l)*r3*(pr*(pr+pl)+pl**<code class="constant">2</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">k0 = l</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">555</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Fractional area...</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">qsum = (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&               </code>l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)-q4(<code class="constant">4</code>, i, l)*(r3*(<code class="constant">1.</code>+<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&               </code>pl*(<code class="constant">1.</code>+pl))))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>m=l+<code class="constant">1</code>,km</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! locate the bottom edge: pe2(i,k+1)</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .GT. pe1(i, m+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Whole layer..</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">qsum = qsum + dp1(i, m)*q4(<code class="constant">1</code>, i, m)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">dp = pe2(i, k+<code class="constant">1</code>) - pe1(i, m)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">esl = dp/dp1(i, m)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">qsum = qsum + dp*(q4(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4(<code class="constant">3</code>, i, m)-q4(<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                   </code><code class="constant">2</code>, i, m)+q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl)))</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">k0 = m</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
 <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">123    </code>q2(i, k) = qsum/dp2(i, k)</a>
 <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">555    </code><code class="keyword">CONTINUE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlm"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">MAP1_Q2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!  Differentiation of cs_profile_linear in forward (tangent) mode:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!   variations   of useful results: a4</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!   with respect to varying inputs: a4</code></a>
<a name="cs_profile_linear_tlmi476"></a>  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CS_PROFILE_LINEAR_TLM</code>(<code class="vardecl">a4</code>, <code class="vardecl">a4_tl</code>, <code class="vardecl">delp</code>, <code class="vardecl">km</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_modi476" target="origFile"><code class="comment">! Optimized vertical profile reconstruction:</code></a>
<a name="cs_profile_linear_tlmi477"></a><a href="null_p.html#fv_mapz_modi476" target="origFile"><code class="comment">! Latest: Apr 2008 S.-J. Lin, NOAA/GFDL</code></a>
    <a href="null_p.html#fv_mapz_modi476" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
<a name="cs_profile_linear_tlmi478"></a><a href="null_p.html#fv_mapz_modi477" target="origFile"><code class="comment">! vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_modi477" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a name="cs_profile_linear_tlmi479"></a><a href="null_p.html#fv_mapz_modi478" target="origFile"><code class="comment">! iv =-1: winds</code></a>
    <a href="null_p.html#fv_mapz_modi478" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
<a href="null_p.html#fv_mapz_modi479" target="origFile"><code class="comment">! iv = 0: positive definite scalars</code></a>
<a href="null_p.html#fv_mapz_modi479" target="origFile"><code class="comment">! iv = 1: others</code></a>
<a name="cs_profile_linear_tlmi480"></a><a href="null_p.html#fv_mapz_modi479" target="origFile"><code class="comment">! layer pressure thickness</code></a>
    <a href="null_p.html#fv_mapz_modi479" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delp</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_modi480" target="origFile"><code class="comment">! Interpolated values</code></a>
<a name="cs_profile_linear_tlmi481"></a>    <a href="null_p.html#fv_mapz_modi480" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4_tl</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a name="cs_profile_linear_tlmi482"></a><a href="null_p.html#fv_mapz_modi481" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
<a name="cs_profile_linear_tlmi483"></a>    <a href="null_p.html#fv_mapz_modi481" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">extm</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_modi482" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">gam</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a name="cs_profile_linear_tlmi484"></a>    <a href="null_p.html#fv_mapz_modi483" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
<a name="cs_profile_linear_tlmi485"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q_tl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
<a name="cs_profile_linear_tlmi486"></a>    <a href="null_p.html#fv_mapz_modi484" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">d4</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
<a name="cs_profile_linear_tlmi487"></a>    <a href="null_p.html#fv_mapz_modi485" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">bet</code>, <code class="vardecl">a_bot</code>, <code class="vardecl">grat</code></a>
    <a href="null_p.html#fv_mapz_modi486" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pmp_1</code>, <code class="vardecl">lac_1</code>, <code class="vardecl">pmp_2</code>, <code class="vardecl">lac_2</code></a>
<a name="cs_profile_linear_tlmi492"></a>    <a href="null_p.html#fv_mapz_modi487" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">im</code></a>
<a name="cs_profile_linear_tlmi488"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile">q_tl = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#fv_mapz_modi492" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="cs_profile_linear_tlmi489"></a><a href="null_p.html#fv_mapz_modi488" target="origFile"><code class="comment">! grid ratio</code></a>
<a name="cs_profile_linear_tlmi490"></a>      <a href="null_p.html#fv_mapz_modi488" target="origFile">grat = delp(i, <code class="constant">2</code>)/delp(i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_modi489" target="origFile">bet = grat*(grat+<code class="constant">0.5</code>)</a>
<a name="cs_profile_linear_tlmi490"></a>      <a href="null_p.html#fv_mapz_modi490" target="origFile">q_tl(i, <code class="constant">1</code>) = ((grat+grat)*(grat+<code class="constant">1.</code>)*a4_tl(<code class="constant">1</code>, i, <code class="constant">1</code>)+a4_tl(<code class="constant">1</code>, i, <code class="constant">2</code>))<code class="label">&</code></a>
<a name="cs_profile_linear_tlmi491"></a><a href="null_p.html#fv_mapz_modi490" target="origFile"><code class="label">&       </code>/bet</a>
      <a href="null_p.html#fv_mapz_modi490" target="origFile">q(i, <code class="constant">1</code>) = ((grat+grat)*(grat+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, <code class="constant">1</code>)+a4(<code class="constant">1</code>, i, <code class="constant">2</code>))/bet</a>
<a name="cs_profile_linear_tlmi498"></a>      <a href="null_p.html#fv_mapz_modi491" target="origFile">gam(i, <code class="constant">1</code>) = (<code class="constant">1.</code>+grat*(grat+<code class="constant">1.5</code>))/bet</a>
<a name="cs_profile_linear_tlmi497"></a>    <a href="null_p.html#fv_mapz_modi492" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi493"></a>    <a href="null_p.html#fv_mapz_modi498" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
<a name="cs_profile_linear_tlmi494"></a>      <a href="null_p.html#fv_mapz_modi497" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="cs_profile_linear_tlmi495"></a>        <a href="null_p.html#fv_mapz_modi493" target="origFile">d4(i) = delp(i, k-<code class="constant">1</code>)/delp(i, k)</a>
        <a href="null_p.html#fv_mapz_modi494" target="origFile">bet = <code class="constant">2. </code>+ d4(i) + d4(i) - gam(i, k-<code class="constant">1</code>)</a>
<a name="cs_profile_linear_tlmi495"></a>        <a href="null_p.html#fv_mapz_modi495" target="origFile">q_tl(i, k) = (<code class="constant">3.</code>*(a4_tl(<code class="constant">1</code>, i, k-<code class="constant">1</code>)+d4(i)*a4_tl(<code class="constant">1</code>, i, k))-q_tl(i<code class="label">&</code></a>
<a name="cs_profile_linear_tlmi496"></a><a href="null_p.html#fv_mapz_modi495" target="origFile"><code class="label">&         </code>, k-<code class="constant">1</code>))/bet</a>
        <a href="null_p.html#fv_mapz_modi495" target="origFile">q(i, k) = (<code class="constant">3.</code>*(a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)+d4(i)*a4(<code class="constant">1</code>, i, k))-q(i, k-<code class="constant">1</code>))/bet</a>
        <a href="null_p.html#fv_mapz_modi496" target="origFile">gam(i, k) = d4(i)/bet</a>
<a name="cs_profile_linear_tlmi501"></a>      <a href="null_p.html#fv_mapz_modi497" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi499"></a>    <a href="null_p.html#fv_mapz_modi498" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi500"></a>    <a href="null_p.html#fv_mapz_modi501" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_modi499" target="origFile">a_bot = <code class="constant">1. </code>+ d4(i)*(d4(i)+<code class="constant">1.5</code>)</a>
<a name="cs_profile_linear_tlmi500"></a>      <a href="null_p.html#fv_mapz_modi500" target="origFile">q_tl(i, km+<code class="constant">1</code>) = (<code class="constant">2.</code>*d4(i)*(d4(i)+<code class="constant">1.</code>)*a4_tl(<code class="constant">1</code>, i, km)+a4_tl(<code class="constant">1</code>, i, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi500" target="origFile"><code class="label">&       </code>km-<code class="constant">1</code>)-a_bot*q_tl(i, km))/(d4(i)*(d4(i)+<code class="constant">0.5</code>)-a_bot*gam(i, km))</a>
      <a href="null_p.html#fv_mapz_modi500" target="origFile">q(i, km+<code class="constant">1</code>) = (<code class="constant">2.</code>*d4(i)*(d4(i)+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, km)+a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>)-<code class="label">&</code></a>
<a name="cs_profile_linear_tlmi504"></a><a href="null_p.html#fv_mapz_modi500" target="origFile"><code class="label">&       </code>a_bot*q(i, km))/(d4(i)*(d4(i)+<code class="constant">0.5</code>)-a_bot*gam(i, km))</a>
<a name="cs_profile_linear_tlmi503"></a>    <a href="null_p.html#fv_mapz_modi501" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi502"></a>    <a href="null_p.html#fv_mapz_modi504" target="origFile"><code class="keyword">DO </code>k=km,<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="cs_profile_linear_tlmi502"></a>      <a href="null_p.html#fv_mapz_modi503" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_modi502" target="origFile">q_tl(i, k) = q_tl(i, k) - gam(i, k)*q_tl(i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_modi502" target="origFile">q(i, k) = q(i, k) - gam(i, k)*q(i, k+<code class="constant">1</code>)</a>
<a name="cs_profile_linear_tlmi509"></a>      <a href="null_p.html#fv_mapz_modi503" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi508"></a>    <a href="null_p.html#fv_mapz_modi504" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear_tlmi505"></a>    <a href="null_p.html#fv_mapz_modi509" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km</a>
<a name="cs_profile_linear_tlmi505"></a>      <a href="null_p.html#fv_mapz_modi508" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="cs_profile_linear_tlmi506"></a>        <a href="null_p.html#fv_mapz_modi505" target="origFile">a4_tl(<code class="constant">2</code>, i, k) = q_tl(i, k)</a>
<a name="cs_profile_linear_tlmi506"></a>        <a href="null_p.html#fv_mapz_modi505" target="origFile">a4(<code class="constant">2</code>, i, k) = q(i, k)</a>
<a name="cs_profile_linear_tlmi507"></a>        <a href="null_p.html#fv_mapz_modi506" target="origFile">a4_tl(<code class="constant">3</code>, i, k) = q_tl(i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_modi506" target="origFile">a4(<code class="constant">3</code>, i, k) = q(i, k+<code class="constant">1</code>)</a>
<a name="cs_profile_linear_tlmi507"></a>        <a href="null_p.html#fv_mapz_modi507" target="origFile">a4_tl(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4_tl(<code class="constant">1</code>, i, k)-a4_tl(<code class="constant">2</code>, i, k)-a4_tl(<code class="constant">3</code>, i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_modi507" target="origFile"><code class="label">&         </code>, k))</a>
        <a href="null_p.html#fv_mapz_modi507" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
      <a href="null_p.html#fv_mapz_modi508" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile_linear"></a>    <a href="null_p.html#fv_mapz_modi509" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CS_PROFILE_LINEAR_TLM</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CS_PROFILE_LINEAR</code>(<code class="vardecl">a4</code>, <code class="vardecl">delp</code>, <code class="vardecl">km</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Optimized vertical profile reconstruction:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Latest: Apr 2008 S.-J. Lin, NOAA/GFDL</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv =-1: winds</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 0: positive definite scalars</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 1: others</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! layer pressure thickness</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delp</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Interpolated values</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">extm</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">gam</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">d4</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">bet</code>, <code class="vardecl">a_bot</code>, <code class="vardecl">grat</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pmp_1</code>, <code class="vardecl">lac_1</code>, <code class="vardecl">pmp_2</code>, <code class="vardecl">lac_2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">im</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! grid ratio</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">grat = delp(i, <code class="constant">2</code>)/delp(i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">bet = grat*(grat+<code class="constant">0.5</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">1</code>) = ((grat+grat)*(grat+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, <code class="constant">1</code>)+a4(<code class="constant">1</code>, i, <code class="constant">2</code>))/bet</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">gam(i, <code class="constant">1</code>) = (<code class="constant">1.</code>+grat*(grat+<code class="constant">1.5</code>))/bet</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">d4(i) = delp(i, k-<code class="constant">1</code>)/delp(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">bet = <code class="constant">2. </code>+ d4(i) + d4(i) - gam(i, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = (<code class="constant">3.</code>*(a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)+d4(i)*a4(<code class="constant">1</code>, i, k))-q(i, k-<code class="constant">1</code>))/bet</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">gam(i, k) = d4(i)/bet</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a_bot = <code class="constant">1. </code>+ d4(i)*(d4(i)+<code class="constant">1.5</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km+<code class="constant">1</code>) = (<code class="constant">2.</code>*d4(i)*(d4(i)+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, km)+a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>)-<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&       </code>a_bot*q(i, km))/(d4(i)*(d4(i)+<code class="constant">0.5</code>)-a_bot*gam(i, km))</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=km,<code class="constant">1</code>,-<code class="constant">1</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k) - gam(i, k)*q(i, k+<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = q(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = q(i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="cs_profile"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CS_PROFILE_LINEAR</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CS_PROFILE</code>(<code class="vardecl">a4</code>, <code class="vardecl">delp</code>, <code class="vardecl">km</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>, <code class="vardecl">kord</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Optimized vertical profile reconstruction:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Latest: Apr 2008 S.-J. Lin, NOAA/GFDL</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv =-1: winds</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 0: positive definite scalars</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 1: others</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! layer pressure thickness</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delp</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Interpolated values</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">extm</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">gam</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">q</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">d4</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">bet</code>, <code class="vardecl">a_bot</code>, <code class="vardecl">grat</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">pmp_1</code>, <code class="vardecl">lac_1</code>, <code class="vardecl">pmp_2</code>, <code class="vardecl">lac_2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">im</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs3</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs4</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs5</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs6</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs7</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs8</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs9</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y27</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y26</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y25</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y24</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y23</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y22</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y21</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y20</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x6</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x5</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x4</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x3</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y19</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y18</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y17</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y16</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y15</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y14</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y13</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y12</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y11</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y10</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">z1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y9</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y8</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y7</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y6</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y5</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y4</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y3</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! grid ratio</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">grat = delp(i, <code class="constant">2</code>)/delp(i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">bet = grat*(grat+<code class="constant">0.5</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">1</code>) = ((grat+grat)*(grat+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, <code class="constant">1</code>)+a4(<code class="constant">1</code>, i, <code class="constant">2</code>))/bet</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">gam(i, <code class="constant">1</code>) = (<code class="constant">1.</code>+grat*(grat+<code class="constant">1.5</code>))/bet</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">d4(i) = delp(i, k-<code class="constant">1</code>)/delp(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">bet = <code class="constant">2. </code>+ d4(i) + d4(i) - gam(i, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = (<code class="constant">3.</code>*(a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)+d4(i)*a4(<code class="constant">1</code>, i, k))-q(i, k-<code class="constant">1</code>))/bet</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">gam(i, k) = d4(i)/bet</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a_bot = <code class="constant">1. </code>+ d4(i)*(d4(i)+<code class="constant">1.5</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km+<code class="constant">1</code>) = (<code class="constant">2.</code>*d4(i)*(d4(i)+<code class="constant">1.</code>)*a4(<code class="constant">1</code>, i, km)+a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>)-<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&       </code>a_bot*q(i, km))/(d4(i)*(d4(i)+<code class="constant">0.5</code>)-a_bot*gam(i, km))</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=km,<code class="constant">1</code>,-<code class="constant">1</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k) - gam(i, k)*q(i, k+<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Apply constraints</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile">im = i2 - i1 + <code class="constant">1</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Apply *large-scale* constraints </code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, <code class="constant">2</code>)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = a4(<code class="constant">1</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, <code class="constant">2</code>) .GT. y1) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">2</code>) = y1</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">2</code>) = q(i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, <code class="constant">2</code>)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = a4(<code class="constant">1</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, <code class="constant">2</code>) .LT. y2) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">2</code>) = y2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, <code class="constant">2</code>) = q(i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">gam(i, k) = a4(<code class="constant">1</code>, i, k) - a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = kord</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = -kord</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Interior:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs0 .LT. <code class="constant">11</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">1</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (gam(i, k-<code class="constant">1</code>)*gam(i, k+<code class="constant">1</code>) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y3 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y3 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. y3) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y3</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y4 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y4 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. y4) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y4</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (gam(i, k-<code class="constant">1</code>) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y5 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y5 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. y5) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y5</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. y6) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y6</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. q(i, k)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = <code class="constant">0.</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! abs(kord) &gt;=11</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">1</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (gam(i, k-<code class="constant">1</code>)*gam(i, k+<code class="constant">1</code>) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. y7) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y7</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. y8) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y8</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (gam(i, k-<code class="constant">1</code>) .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. y9) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y9</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                 </code>*gam(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (q(i, k) .GT. a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! There exists a local min</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y10 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y10 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. y10) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y10</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">z1 = a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">z1 = <code class="constant">0.</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>) .LT. z1) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = z1</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (q(i, k) .LT. z1) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = z1</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y11 = a4(<code class="constant">1</code>, i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y11 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .GT. y11) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = y11</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, k) .LT. a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                 </code>*gam(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + <code class="constant">0.5</code>*gam(i, k-<code class="constant">1</code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (q(i, k) .LT. a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = a4(<code class="constant">1</code>, i, k) - <code class="constant">0.5</code>*gam(i, k+<code class="constant">1</code>)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, k) = q(i, k)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Bottom:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, km)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y12 = a4(<code class="constant">1</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y12 = a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, km) .GT. y12) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km) = y12</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km) = q(i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, km)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y13 = a4(<code class="constant">1</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y13 = a4(<code class="constant">1</code>, i, km-<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (q(i, km) .LT. y13) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km) = y13</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">q(i, km) = q(i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = q(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = q(i, k+<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km-<code class="constant">1</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (gam(i, k)*gam(i, k+<code class="constant">1</code>) .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">extm(i, k) = <code class="constant">.false.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">extm(i, k) = <code class="constant">.true.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!---------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Apply subgrid constraints:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!---------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! f(s) = AL + s*[(AR-AL) + A6*(1-s)]         ( 0 &lt;= s  <= 1 )</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Top 2 and bottom 2 layers always use monotonic mapping</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">2</code>, i, <code class="constant">1</code>)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = a4(<code class="constant">2</code>, i, <code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .EQ. -<code class="constant">1</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, <code class="constant">1</code>)*a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .LE. <code class="constant">0.</code>) a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = <code class="constant">0.</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs1 = iv</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs1 = -iv</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs1 .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, <code class="constant">1</code>) = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, <code class="constant">1</code>) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">abs2 = iv</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">abs2 = -iv</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs2 .NE. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, <code class="constant">1</code>) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, <code class="constant">1</code>)-(a4(<code class="constant">2</code>, i, <code class="constant">1</code>)+a4(<code class="constant">3</code>, i, <code class="constant">1</code>)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">CS_LIMITERS</code>(im, extm(i1, <code class="constant">1</code>), a4(<code class="constant">1</code>, i1, <code class="constant">1</code>), <code class="constant">1</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! k=2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, <code class="constant">2</code>) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, <code class="constant">2</code>)-(a4(<code class="constant">2</code>, i, <code class="constant">2</code>)+a4(<code class="constant">3</code>, i, <code class="constant">2</code>)))</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">CS_LIMITERS</code>(im, extm(i1, <code class="constant">2</code>), a4(<code class="constant">1</code>, i1, <code class="constant">2</code>), <code class="constant">2</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-------------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Huynh's 2nd constraint for interior:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-------------------------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">2</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs3 = kord</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs3 = -kord</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs3 .LT. <code class="constant">9</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Left  edges</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_1 = a4(<code class="constant">1</code>, i, k) - <code class="constant">2.</code>*gam(i, k+<code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lac_1 = pmp_1 + <code class="constant">1.5</code>*gam(i, k+<code class="constant">2</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. pmp_1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .GT. lac_1) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y20 = lac_1</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y20 = pmp_1</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac_1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y20 = lac_1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y20 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) .LT. y20) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = y20</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = a4(<code class="constant">2</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .LT. lac_1) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y14 = lac_1</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y14 = pmp_1</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y14 = lac_1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y14 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x1 .GT. y14) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = y14</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = x1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Right edges</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_2 = a4(<code class="constant">1</code>, i, k) + <code class="constant">2.</code>*gam(i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lac_2 = pmp_2 - <code class="constant">1.5</code>*gam(i, k-<code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. pmp_2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .GT. lac_2) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y21 = lac_2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y21 = pmp_2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac_2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y21 = lac_2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y21 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i, k) .LT. y21) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = y21</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = a4(<code class="constant">3</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .LT. lac_2) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y15 = lac_2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y15 = pmp_2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y15 = lac_2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y15 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x2 .GT. y15) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = y15</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = x2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">abs4 = kord</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">abs4 = -kord</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs4 .EQ. <code class="constant">9</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (extm(i, k) .AND. (extm(i, k-<code class="constant">1</code>) .OR. extm(i, k+<code class="constant">1</code>))) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! c90_mp122</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! grid-scale 2-delta-z wave detected</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">0.</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">6.</code>*a4(<code class="constant">1</code>, i, k) - <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&               </code>)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">4</code>, i, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">abs5 = a4(<code class="constant">4</code>, i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">abs5 = -a4(<code class="constant">4</code>, i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) - a4(<code class="constant">3</code>, i, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">abs8 = a4(<code class="constant">2</code>, i, k) - a4(<code class="constant">3</code>, i, k)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">abs8 = -(a4(<code class="constant">2</code>, i, k)-a4(<code class="constant">3</code>, i, k))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Check within the smooth region if subgrid profile is non-monotonic</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs5 .GT. abs8) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_1 = a4(<code class="constant">1</code>, i, k) - <code class="constant">2.</code>*gam(i, k+<code class="constant">1</code>)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">lac_1 = pmp_1 + <code class="constant">1.5</code>*gam(i, k+<code class="constant">2</code>)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. pmp_1) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .GT. lac_1) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y22 = lac_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y22 = pmp_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac_1) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y22 = lac_1</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y22 = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) .LT. y22) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">x3 = y22</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">x3 = a4(<code class="constant">2</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_1) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .LT. lac_1) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y16 = lac_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y16 = pmp_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_1) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y16 = lac_1</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y16 = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x3 .GT. y16) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = y16</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = x3</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_2 = a4(<code class="constant">1</code>, i, k) + <code class="constant">2.</code>*gam(i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">lac_2 = pmp_2 - <code class="constant">1.5</code>*gam(i, k-<code class="constant">1</code>)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. pmp_2) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .GT. lac_2) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y23 = lac_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y23 = pmp_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac_2) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y23 = lac_2</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y23 = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i, k) .LT. y23) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">x4 = y23</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">x4 = a4(<code class="constant">3</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_2) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .LT. lac_2) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y17 = lac_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y17 = pmp_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_2) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y17 = lac_2</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">y17 = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x4 .GT. y17) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = y17</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = x4</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">6.</code>*a4(<code class="constant">1</code>, i, k) - <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                 </code>k))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">abs6 = kord</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">abs6 = -kord</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs6 .EQ. <code class="constant">10</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (extm(i, k)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (extm(i, k-<code class="constant">1</code>) .OR. extm(i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! grid-scale 2-delta-z wave detected</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">0.</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! True local extremum</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">6.</code>*a4(<code class="constant">1</code>, i, k) - <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                   </code>, k))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! not a local extremum</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">6.</code>*a4(<code class="constant">1</code>, i, k) - <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                 </code>k))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">4</code>, i, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">abs7 = a4(<code class="constant">4</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">abs7 = -a4(<code class="constant">4</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) - a4(<code class="constant">3</code>, i, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">abs9 = a4(<code class="constant">2</code>, i, k) - a4(<code class="constant">3</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">abs9 = -(a4(<code class="constant">2</code>, i, k)-a4(<code class="constant">3</code>, i, k))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Check within the smooth region if subgrid profile is non-monotonic</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs7 .GT. abs9) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_1 = a4(<code class="constant">1</code>, i, k) - <code class="constant">2.</code>*gam(i, k+<code class="constant">1</code>)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">lac_1 = pmp_1 + <code class="constant">1.5</code>*gam(i, k+<code class="constant">2</code>)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .LT. lac_1) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y26 = lac_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y26 = pmp_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. y26) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y24 = y26</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y24 = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) .LT. y24) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">x5 = y24</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">x5 = a4(<code class="constant">2</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_1) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_1 .LT. lac_1) <code class="keyword">THEN</code></a>
                      <a href="null_p.html#fv_mapz_mod" target="origFile">y18 = lac_1</a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                      <a href="null_p.html#fv_mapz_mod" target="origFile">y18 = pmp_1</a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_1) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y18 = lac_1</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y18 = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x5 .GT. y18) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = y18</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = x5</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">pmp_2 = a4(<code class="constant">1</code>, i, k) + <code class="constant">2.</code>*gam(i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">lac_2 = pmp_2 - <code class="constant">1.5</code>*gam(i, k-<code class="constant">1</code>)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .LT. lac_2) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y27 = lac_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y27 = pmp_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. y27) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y25 = y27</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y25 = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i, k) .LT. y25) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">x6 = y25</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">x6 = a4(<code class="constant">3</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. pmp_2) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (pmp_2 .LT. lac_2) <code class="keyword">THEN</code></a>
                      <a href="null_p.html#fv_mapz_mod" target="origFile">y19 = lac_2</a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                      <a href="null_p.html#fv_mapz_mod" target="origFile">y19 = pmp_2</a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac_2) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y19 = lac_2</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">y19 = a4(<code class="constant">1</code>, i, k)</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x6 .GT. y19) <code class="keyword">THEN</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = y19</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                    <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = x6</a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
                  <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">6.</code>*a4(<code class="constant">1</code>, i, k) - <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                   </code>, k))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! kord = 11, ...</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (extm(i, k) .AND. (extm(i, k-<code class="constant">1</code>) .OR. extm(i, k+<code class="constant">1</code>))) <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&             </code><code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Noisy region:</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = a4(<code class="constant">1</code>, i, k)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">0.</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                 </code>)))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Additional constraint to ensure positivity</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">CALL </code><code class="funcname">CS_LIMITERS</code>(im, extm(i1, k), a4(<code class="constant">1</code>, i1, k), <code class="constant">0</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! k-loop</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!----------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Bottom layer subgrid constraints:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!----------------------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">3</code>, i, km)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, km) = a4(<code class="constant">3</code>, i, km)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, km) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .LT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i, km)*a4(<code class="constant">1</code>, i, km) .LE. <code class="constant">0.</code>) a4(<code class="constant">3</code>, i, km) = <code class="constant">0.</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=km-<code class="constant">1</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (k .EQ. km - <code class="constant">1</code>) <code class="keyword">CALL </code><code class="funcname">CS_LIMITERS</code>(im, extm(i1, k), a4(<code class="constant">1</code>, i1, k)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                                   </code>, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (k .EQ. km) <code class="keyword">CALL </code><code class="funcname">CS_LIMITERS</code>(im, extm(i1, k), a4(<code class="constant">1</code>, i1, k), <code class="constant">1</code>)</a>
<a name="cs_limiters"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CS_PROFILE</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CS_LIMITERS</code>(<code class="vardecl">im</code>, <code class="vardecl">extm</code>, <code class="vardecl">a4</code>, <code class="vardecl">iv</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">im</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">extm</code>(<code class="vardecl">im</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! PPM array</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">im</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">da1</code>, <code class="vardecl">da2</code>, <code class="vardecl">a6da</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Positive definite constraint</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,im</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i) .LE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = -(a4(<code class="constant">3</code>, i)-a4(<code class="constant">2</code>, i))</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs0 .LT. -a4(<code class="constant">4</code>, i)) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i) + <code class="constant">0.25</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">2</code>, i))**<code class="constant">2</code>/a4(<code class="constant">4</code>, i) + a4(<code class="constant">4</code>, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&               </code>i)*r12 .LT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! local minimum is negative</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i) .LT. a4(<code class="constant">3</code>, i) .AND. a4(<code class="constant">1</code>, i) .LT. a4(<code class="constant">2</code>, i)) <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&             </code><code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">3</code>, i) .GT. a4(<code class="constant">2</code>, i)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">2</code>, i) - a4(<code class="constant">4</code>, i)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
                <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">3</code>, i) - a4(<code class="constant">4</code>, i)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .EQ. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,im</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> ((a4(<code class="constant">1</code>, i)-a4(<code class="constant">2</code>, i))*(a4(<code class="constant">1</code>, i)-a4(<code class="constant">3</code>, i)) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da1 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da2 = da1**<code class="constant">2</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a6da = a4(<code class="constant">4</code>, i)*da1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a6da .LT. -da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">2</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a6da .GT. da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">3</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Standard PPM constraint</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,im</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (extm(i)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da1 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da2 = da1**<code class="constant">2</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a6da = a4(<code class="constant">4</code>, i)*da1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a6da .LT. -da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">2</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a6da .GT. da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">3</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="ppm_profile"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CS_LIMITERS</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">PPM_PROFILE</code>(<code class="vardecl">a4</code>, <code class="vardecl">delp</code>, <code class="vardecl">km</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">iv</code>, <code class="vardecl">kord</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv =-1: winds</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">iv</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 0: positive definite scalars</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 1: others</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! iv = 2: temp (if remap_t) and w (iv=-2)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Starting longitude</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Finishing longitude</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! vertical dimension</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Order (or more accurately method no.):</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kord</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! </code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! layer pressure thickness</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delp</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Interpolated values</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! DESCRIPTION:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!   Perform the piecewise parabolic reconstruction</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! </code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !REVISION HISTORY: </code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! S.-J. Lin   revised at GFDL 2007</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! local arrays:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dc</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">h2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">delq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">df2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">d4</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! local scalars:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code>, <code class="vardecl">km1</code>, <code class="vardecl">lmt</code>, <code class="vardecl">it</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">fac</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">a1</code>, <code class="vardecl">a2</code>, <code class="vardecl">c1</code>, <code class="vardecl">c2</code>, <code class="vardecl">c3</code>, <code class="vardecl">d1</code>, <code class="vardecl">d2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">qm</code>, <code class="vardecl">dq</code>, <code class="vardecl">lac</code>, <code class="vardecl">qmp</code>, <code class="vardecl">pmp</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIGN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">max1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x3</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">z1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y9</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y8</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y7</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y6</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y5</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y4</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y3</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile">km1 = km - <code class="constant">1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile">it = i2 - i1 + <code class="constant">1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">delq(i, k-<code class="constant">1</code>) = a4(<code class="constant">1</code>, i, k) - a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">d4(i, k) = delp(i, k-<code class="constant">1</code>) + delp(i, k)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km1</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">c1 = (delp(i, k-<code class="constant">1</code>)+<code class="constant">0.5</code>*delp(i, k))/d4(i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">c2 = (delp(i, k+<code class="constant">1</code>)+<code class="constant">0.5</code>*delp(i, k))/d4(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">df2(i, k) = delp(i, k)*(c1*delq(i, k)+c2*delq(i, k-<code class="constant">1</code>))/(d4(i, k)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>+delp(i, k+<code class="constant">1</code>))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (df2(i, k) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = df2(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = -df2(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">max1 = a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">max1 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">max1 = a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">max1 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = max1 - a4(<code class="constant">1</code>, i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = a4(<code class="constant">1</code>, i, k+<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">z1 = a4(<code class="constant">1</code>, i, k) - min2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x1 .GT. y1) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (y1 .GT. z1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = z1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = y1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (x1 .GT. z1) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = z1</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = x1</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">dc(i, k) = <code class="funcname">SIGN</code>(min1, df2(i, k))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! 4th order interpolation of the provisional cell edge value</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km1</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">c1 = delq(i, k-<code class="constant">1</code>)*delp(i, k-<code class="constant">1</code>)/d4(i, k)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a1 = d4(i, k-<code class="constant">1</code>)/(d4(i, k)+delp(i, k-<code class="constant">1</code>))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a2 = d4(i, k+<code class="constant">1</code>)/(d4(i, k)+delp(i, k))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>) + c1 + <code class="constant">2.</code>/(d4(i, k-<code class="constant">1</code>)+d4(i, k+<code class="constant">1</code>))*(<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>delp(i, k)*(c1*(a1-a2)+a2*dc(i, k-<code class="constant">1</code>))-delp(i, k-<code class="constant">1</code>)*a1*dc(i, k)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (km .GT. <code class="constant">8 </code>.AND. kord .GT. <code class="constant">4</code>) <code class="keyword">CALL </code><code class="funcname">STEEPZ</code>(i1, i2, km, a4, df2, dc<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                                          </code>, delq, delp, d4)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Area preserving cubic with 2nd deriv. = 0 at the boundaries</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Top</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">d1 = delp(i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">d2 = delp(i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">qm = (d2*a4(<code class="constant">1</code>, i, <code class="constant">1</code>)+d1*a4(<code class="constant">1</code>, i, <code class="constant">2</code>))/(d1+d2)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">dq = <code class="constant">2.</code>*(a4(<code class="constant">1</code>, i, <code class="constant">2</code>)-a4(<code class="constant">1</code>, i, <code class="constant">1</code>))/(d1+d2)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">c1 = <code class="constant">4.</code>*(a4(<code class="constant">2</code>, i, <code class="constant">3</code>)-qm-d2*dq)/(d2*(<code class="constant">2.</code>*d2*d2+d1*(d2+<code class="constant">3.</code>*d1)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">c3 = dq - <code class="constant">0.5</code>*c1*(d2*(<code class="constant">5.</code>*d1+d2)-<code class="constant">3.</code>*d1*d1)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = qm - <code class="constant">0.25</code>*c1*d1*d2*(d2+<code class="constant">3.</code>*d1)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Top edge:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-------------------------------------------------------</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = d1*(<code class="constant">2.</code>*c1*d1**<code class="constant">2</code>-c3) + a4(<code class="constant">2</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .GT. a4(<code class="constant">1</code>, i, <code class="constant">2</code>)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = a4(<code class="constant">1</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, <code class="constant">2</code>) .LT. y2) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = y2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = a4(<code class="constant">2</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .LT. a4(<code class="constant">1</code>, i, <code class="constant">2</code>)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y3 = a4(<code class="constant">1</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y3 = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, <code class="constant">2</code>) .GT. y3) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = y3</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = a4(<code class="constant">2</code>, i, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">dc(i, <code class="constant">1</code>) = <code class="constant">0.5</code>*(a4(<code class="constant">2</code>, i, <code class="constant">2</code>)-a4(<code class="constant">1</code>, i, <code class="constant">1</code>))</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Enforce monotonicity  within the top layer</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">2</code>, i, <code class="constant">1</code>)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = a4(<code class="constant">2</code>, i, <code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">2</code>, i, <code class="constant">2</code>)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = a4(<code class="constant">2</code>, i, <code class="constant">2</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">2</code>) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .EQ. -<code class="constant">1</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, <code class="constant">1</code>)*a4(<code class="constant">1</code>, i, <code class="constant">1</code>) .LE. <code class="constant">0.</code>) a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = <code class="constant">0.</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = iv</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = -iv</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs0 .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, <code class="constant">1</code>) = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, <code class="constant">1</code>) = a4(<code class="constant">1</code>, i, <code class="constant">1</code>)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Bottom</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Area preserving cubic with 2nd deriv. = 0 at the surface</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">d1 = delp(i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">d2 = delp(i, km1)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">qm = (d2*a4(<code class="constant">1</code>, i, km)+d1*a4(<code class="constant">1</code>, i, km1))/(d1+d2)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">dq = <code class="constant">2.</code>*(a4(<code class="constant">1</code>, i, km1)-a4(<code class="constant">1</code>, i, km))/(d1+d2)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">c1 = (a4(<code class="constant">2</code>, i, km1)-qm-d2*dq)/(d2*(<code class="constant">2.</code>*d2*d2+d1*(d2+<code class="constant">3.</code>*d1)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">c3 = dq - <code class="constant">2.0</code>*c1*(d2*(<code class="constant">5.</code>*d1+d2)-<code class="constant">3.</code>*d1*d1)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = qm - c1*d1*d2*(d2+<code class="constant">3.</code>*d1)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Bottom edge:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, km) = d1*(<code class="constant">8.</code>*c1*d1**<code class="constant">2</code>-c3) + a4(<code class="constant">2</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, km) .GT. a4(<code class="constant">1</code>, i, km1)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y4 = a4(<code class="constant">1</code>, i, km1)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y4 = a4(<code class="constant">1</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, km) .LT. y4) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = y4</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = a4(<code class="constant">2</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, km) .LT. a4(<code class="constant">1</code>, i, km1)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y5 = a4(<code class="constant">1</code>, i, km1)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">y5 = a4(<code class="constant">1</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, km) .GT. y5) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = y5</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = a4(<code class="constant">2</code>, i, km)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">dc(i, km) = <code class="constant">0.5</code>*(a4(<code class="constant">1</code>, i, km)-a4(<code class="constant">2</code>, i, km))</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Enforce constraint on the "slope" at the surface</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!#ifdef BOT_MONO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!      do i=i1,i2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         a4(4,i,km) = 0</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         if( a4(3,i,km) * a4(1,i,km) &lt;= 0. ) a4(3,i,km) = 0.</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         d1 = a4(1,i,km) - a4(2,i,km)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         d2 = a4(3,i,km) - a4(1,i,km)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         if ( d1*d2 &lt; 0. ) then</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!              a4(2,i,km) = a4(1,i,km)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!              a4(3,i,km) = a4(1,i,km)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         else</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!              dq = sign(min(abs(d1),abs(d2),0.5*abs(delq(i,km-1))), d1)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!              a4(2,i,km) = a4(1,i,km) - dq</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!              a4(3,i,km) = a4(1,i,km) + dq</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!         endif</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!      enddo</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!#else</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">2</code>, i, km)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = a4(<code class="constant">2</code>, i, km)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, km) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. a4(<code class="constant">3</code>, i, km)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, km) = a4(<code class="constant">3</code>, i, km)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, km) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (iv .LT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, km)*a4(<code class="constant">3</code>, i, km) .LE. <code class="constant">0.</code>) a4(<code class="constant">3</code>, i, km) = <code class="constant">0.</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!#endif</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,km1</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = a4(<code class="constant">2</code>, i, k+<code class="constant">1</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! f(s) = AL + s*[(AR-AL) + A6*(1-s)]         ( 0 &lt;= s  <= 1 )</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------------------------------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Top 2 and bottom 2 layers always use monotonic mapping</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,<code class="constant">2</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">PPM_LIMITERS</code>(dc(i1, k), a4(<code class="constant">1</code>, i1, k), it, <code class="constant">0</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .GE. <code class="constant">7</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Huynh's 2nd constraint</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-----------------------</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km1</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Method#1</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!           h2(i,k) = delq(i,k) - delq(i,k-1)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Method#2 - better</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">h2(i, k) = <code class="constant">2.</code>*(dc(i, k+<code class="constant">1</code>)/delp(i, k+<code class="constant">1</code>)-dc(i, k-<code class="constant">1</code>)/delp(i, k-<code class="constant">1</code>)<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&           </code>)/(delp(i, k)+<code class="constant">0.5</code>*(delp(i, k-<code class="constant">1</code>)+delp(i, k+<code class="constant">1</code>)))*delp(i, k)**<code class="constant">2</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Method#3</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!!!            h2(i,k) = dc(i,k+1) - dc(i,k-1)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! original quasi-monotone</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">fac = <code class="constant">1.5</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">2</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Right edges</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!        qmp   = a4(1,i,k) + 2.0*delq(i,k-1)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!        lac   = a4(1,i,k) + fac*h2(i,k-1) + 0.5*delq(i,k-1)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">pmp = <code class="constant">2.</code>*dc(i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">qmp = a4(<code class="constant">1</code>, i, k) + pmp</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lac = a4(<code class="constant">1</code>, i, k) + fac*h2(i, k-<code class="constant">1</code>) + dc(i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. qmp) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .GT. lac) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = lac</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = qmp</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = lac</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y8 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i, k) .LT. y8) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = y8</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = a4(<code class="constant">3</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. qmp) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .LT. lac) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = lac</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = qmp</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = lac</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y6 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x2 .GT. y6) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = y6</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i, k) = x2</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Left  edges</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!        qmp   = a4(1,i,k) - 2.0*delq(i,k)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!        lac   = a4(1,i,k) + fac*h2(i,k+1) - 0.5*delq(i,k)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">qmp = a4(<code class="constant">1</code>, i, k) - pmp</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lac = a4(<code class="constant">1</code>, i, k) + fac*h2(i, k+<code class="constant">1</code>) - dc(i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .GT. qmp) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .GT. lac) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = lac</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = qmp</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .GT. lac) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = lac</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y9 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i, k) .LT. y9) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x3 = y9</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">x3 = a4(<code class="constant">2</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i, k) .LT. qmp) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .LT. lac) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = lac</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = qmp</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">1</code>, i, k) .LT. lac) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = lac</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y7 = a4(<code class="constant">1</code>, i, k)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x3 .GT. y7) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = y7</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = x3</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-------------</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Recompute A6</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">!-------------</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Additional constraint to ensure positivity when kord=7</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0 </code>.AND. kord .GE. <code class="constant">6</code>) <code class="keyword">CALL </code><code class="funcname">PPM_LIMITERS</code>(dc(i1, k), a4<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                                                    </code>(<code class="constant">1</code>, i1, k), it, <code class="constant">2</code>)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile">lmt = kord - <code class="constant">3</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0 </code>.LT. lmt) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">lmt = lmt</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">lmt = <code class="constant">0</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (iv .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">2 </code>.GT. lmt) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lmt = lmt</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">lmt = <code class="constant">2</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">2</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .NE. <code class="constant">4</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (kord .NE. <code class="constant">6</code>) <code class="keyword">CALL </code><code class="funcname">PPM_LIMITERS</code>(dc(i1, k), a4(<code class="constant">1</code>, i1, k), it, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&                                    </code>lmt)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=km1,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i, k) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i, k)-(a4(<code class="constant">2</code>, i, k)+a4(<code class="constant">3</code>, i, k)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">PPM_LIMITERS</code>(dc(i1, k), a4(<code class="constant">1</code>, i1, k), it, <code class="constant">0</code>)</a>
<a name="ppm_limiters"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">PPM_PROFILE</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">PPM_LIMITERS</code>(<code class="vardecl">dm</code>, <code class="vardecl">a4</code>, <code class="vardecl">itot</code>, <code class="vardecl">lmt</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! the linear slope</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dm</code>(<code class="keyword">*</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Total Longitudes</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">itot</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! 0: Standard PPM constraint</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">lmt</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! 1: Improved full monotonicity constraint (Lin)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! 2: Positive definite constraint</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! 3: do nothing (return immediately)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! PPM array</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="keyword">*</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! AA &lt;-- a4(1,i)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! AL &lt;-- a4(2,i)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! AR &lt;-- a4(3,i)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! A6 &lt;-- a4(4,i)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">qmp</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">da1</code>, <code class="vardecl">da2</code>, <code class="vardecl">a6da</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">fmin</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIGN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Developer: S.-J. Lin</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (lmt .EQ. <code class="constant">3</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">RETURN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (lmt .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="p0"></a><a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Standard PPM constraint</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,itot</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (</a><a href="msg.html#p0" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="null_p.html#fv_mapz_mod" target="origFile">dm(i) .EQ. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da1 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">da2 = da1**<code class="constant">2</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">a6da = a4(<code class="constant">4</code>, i)*da1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a6da .LT. -da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">2</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a6da .GT. da2) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">3</code>, i) - a4(<code class="constant">4</code>, i)</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (lmt .EQ. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Improved full monotonicity constraint (Lin 2004)</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Note: no need to provide first guess of A6 &lt;-- a4(4,i)</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,itot</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">qmp = <code class="constant">2.</code>*dm(i)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = qmp</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x1 = -qmp</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">2</code>, i) - a4(<code class="constant">1</code>, i) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = a4(<code class="constant">2</code>, i) - a4(<code class="constant">1</code>, i)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = -(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x1 .GT. y1) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = y1</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min1 = x1</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i) - <code class="funcname">SIGN</code>(min1, qmp)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (qmp .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = qmp</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">x2 = -qmp</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i) - a4(<code class="constant">1</code>, i) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">1</code>, i)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">y2 = -(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (x2 .GT. y2) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = y2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">min2 = x2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i) + <code class="funcname">SIGN</code>(min2, qmp)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(<code class="constant">2.</code>*a4(<code class="constant">1</code>, i)-(a4(<code class="constant">2</code>, i)+a4(<code class="constant">3</code>, i)))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (lmt .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Positive definite constraint</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,itot</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = a4(<code class="constant">3</code>, i) - a4(<code class="constant">2</code>, i)</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">abs0 = -(a4(<code class="constant">3</code>, i)-a4(<code class="constant">2</code>, i))</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (abs0 .LT. -a4(<code class="constant">4</code>, i)) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">fmin = a4(<code class="constant">1</code>, i) + <code class="constant">0.25</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">2</code>, i))**<code class="constant">2</code>/a4(<code class="constant">4</code>, i) + a4(<code class="constant">4</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&           </code>, i)*r12</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (fmin .LT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (a4(<code class="constant">1</code>, i) .LT. a4(<code class="constant">3</code>, i) .AND. a4(<code class="constant">1</code>, i) .LT. a4(<code class="constant">2</code>, i)) <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&           </code><code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">1</code>, i)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">1</code>, i)</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">0.</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE IF</code> (a4(<code class="constant">3</code>, i) .GT. a4(<code class="constant">2</code>, i)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">2</code>, i)-a4(<code class="constant">1</code>, i))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">3</code>, i) = a4(<code class="constant">2</code>, i) - a4(<code class="constant">4</code>, i)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">4</code>, i) = <code class="constant">3.</code>*(a4(<code class="constant">3</code>, i)-a4(<code class="constant">1</code>, i))</a>
              <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i) = a4(<code class="constant">3</code>, i) - a4(<code class="constant">4</code>, i)</a>
            <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="steepz"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">PPM_LIMITERS</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">STEEPZ</code>(<code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">km</code>, <code class="vardecl">a4</code>, <code class="vardecl">df2</code>, <code class="vardecl">dm</code>, <code class="vardecl">dq</code>, <code class="vardecl">dp</code>, <code class="vardecl">d4</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">km</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! grid size</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! backward diff of q</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! backward sum:  dp(k)+ dp(k-1) </code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">d4</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! first guess mismatch</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">df2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! monotonic mismatch</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dm</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! first guess/steepened</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">a4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">k</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">alfa</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">f</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">rat</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL(</code><code class="modifier">real8</code><code class="typename">) </code>:: <code class="vardecl">dg2</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Compute ratio of dq/dp</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">rat(i, k) = dq(i, k-<code class="constant">1</code>)/d4(i, k)</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="comment">! Compute F</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,km-<code class="constant">1</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">f(i, k) = (rat(i, k+<code class="constant">1</code>)-rat(i, k))/(dp(i, k-<code class="constant">1</code>)+dp(i, k)+dp(i, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="p1"></a>    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,km-<code class="constant">2</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (f(i, k+<code class="constant">1</code>)*f(i, k-<code class="constant">1</code>) .LT. <code class="constant">0. </code>.AND. </a><a href="msg.html#p1" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="null_p.html#fv_mapz_mod" target="origFile">df2(i, k) .NE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">dg2 = (f(i, k+<code class="constant">1</code>)-f(i, k-<code class="constant">1</code>))*((dp(i, k+<code class="constant">1</code>)-dp(i, k-<code class="constant">1</code>))**<code class="constant">2</code>+d4(i, <code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&           </code>k)*d4(i, k+<code class="constant">1</code>))</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0.5 </code>.GT. -(<code class="constant">0.1875</code>*dg2/df2(i, k))) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = -(<code class="constant">0.1875</code>*dg2/df2(i, k))</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">y1 = <code class="constant">0.5</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">IF</code> (<code class="constant">0. </code>.LT. y1) <code class="keyword">THEN</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">alfa(i, k) = y1</a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#fv_mapz_mod" target="origFile">alfa(i, k) = <code class="constant">0.</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="null_p.html#fv_mapz_mod" target="origFile">alfa(i, k) = <code class="constant">0.</code></a>
        <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>k=<code class="constant">4</code>,km-<code class="constant">2</code></a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
        <a href="null_p.html#fv_mapz_mod" target="origFile">a4(<code class="constant">2</code>, i, k) = (<code class="constant">1.</code>-alfa(i, k-<code class="constant">1</code>)-alfa(i, k))*a4(<code class="constant">2</code>, i, k) + alfa(i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>, k-<code class="constant">1</code>)*(a4(<code class="constant">1</code>, i, k)-dm(i, k)) + alfa(i, k)*(a4(<code class="constant">1</code>, i, k-<code class="constant">1</code>)+dm(i<code class="label">&</code></a>
<a href="null_p.html#fv_mapz_mod" target="origFile"><code class="label">&         </code>, k-<code class="constant">1</code>))</a>
      <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
    <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END DO</code></a>
  <a href="null_p.html#fv_mapz_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">STEEPZ</code></a>
<code class="keyword">END MODULE </code><code class="funcname">FV_MAPZ_MOD_D</code>
</pre>
</body>
