<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!         NASA/GSFC, Software Systems Support Office, Code 610.3         !</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!BOP</code>
<code class="comment">!</code>
<code class="comment">! !MODULE: convectiveTransport_mod </code>
<code class="comment">!</code>
<code class="comment">! !INTERFACE:</code>
<code class="comment">!</code>
<code class="keyword">MODULE </code><code class="funcname">CONVECTIVETRANSPORT_MOD_B</code>
  <code class="keyword">IMPLICIT NONE</code>
<code class="comment">!EOC</code>
<code class="comment">!------------------------------------------------------------------------------</code>
  PRIVATE 
  PUBLIC convectivetransport
  PUBLIC convectivetransport_adm
<a name="convectivetransport_adm"></a>
<code class="keyword">CONTAINS</code>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!  Differentiation of convectivetransport in reverse (adjoint) mode:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   gradient     of useful results: qq</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   with respect to varying inputs: qq</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Module for the convective transport.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!BOP</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !IROUTINE: convectiveTransport</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !INTERFACE:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
  <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CONVECTIVETRANSPORT_ADM</code>(<code class="vardecl">il2g</code>, <code class="vardecl">delt</code>, <code class="vardecl">xmbsth</code>, <code class="vardecl">ideep</code>, <code class="vardecl">pbli</code>, <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&   </code><code class="vardecl">dui</code>, <code class="vardecl">eui</code>, <code class="vardecl">mui</code>, <code class="vardecl">mdi</code>, <code class="vardecl">dpi</code>, <code class="vardecl">fracis</code>, <code class="vardecl">qq</code>, <code class="vardecl">qq_ad</code>, <code class="vardecl">isfixedconcentration</code>, <code class="vardecl">i1</code><code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">i2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">numspecies</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#convectivetransport_modi0" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi0" target="origFile"><code class="comment">! !INPUT PARAMETERS</code></a>
    <a href="null_p.html#convectivetransport_modi0" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">isfixedconcentration</code>(:)</a>
    <a href="null_p.html#convectivetransport_modi1" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">numspecies</code></a>
<a href="null_p.html#convectivetransport_modi2" target="origFile"><code class="comment">! gathered max lon indices over which to operate</code></a>
    <a href="null_p.html#convectivetransport_modi2" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">il2g</code></a>
<a href="null_p.html#convectivetransport_modi3" target="origFile"><code class="comment">! convection time step (s)</code></a>
    <a href="null_p.html#convectivetransport_modi3" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delt</code></a>
<a href="null_p.html#convectivetransport_modi4" target="origFile"><code class="comment">! threshold below which we treat mass fluxes as zero (mb/s)</code></a>
    <a href="null_p.html#convectivetransport_modi4" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">xmbsth</code></a>
<a href="null_p.html#convectivetransport_modi5" target="origFile"><code class="comment">! gathering array</code></a>
    <a href="null_p.html#convectivetransport_modi5" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ideep</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#convectivetransport_modi6" target="origFile"><code class="comment">! index of planetary boundary layer</code></a>
    <a href="null_p.html#convectivetransport_modi6" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pbli</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#convectivetransport_modi7" target="origFile"><code class="comment">! mass detraining from updraft</code></a>
    <a href="null_p.html#convectivetransport_modi7" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi8" target="origFile"><code class="comment">! mass entraining into updraft</code></a>
    <a href="null_p.html#convectivetransport_modi8" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">eui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi9" target="origFile"><code class="comment">! mass flux up</code></a>
    <a href="null_p.html#convectivetransport_modi9" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi10" target="origFile"><code class="comment">! mass flux down</code></a>
    <a href="null_p.html#convectivetransport_modi10" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mdi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi11" target="origFile"><code class="comment">! delta pressure between interfaces</code></a>
    <a href="null_p.html#convectivetransport_modi11" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dpi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi12" target="origFile"><code class="comment">! insoluble fraction of tracer</code></a>
    <a href="null_p.html#convectivetransport_modi12" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">fracis</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
<a href="null_p.html#convectivetransport_modi13" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi13" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#convectivetransport_modi13" target="origFile"><code class="comment">! tracer array including moisture (mixing ratio)</code></a>
    <a href="null_p.html#convectivetransport_modi13" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">qq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">qq_ad</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">! This routine performs convective transport of trace species.</code></a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">! Note that we assume that the tracers are in a moist mixing ratio.</code></a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="comment">! !DEFINED PARAMETERS:</code></a>
    <a href="null_p.html#convectivetransport_modi14" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">small</code>=<code class="constant">1.0d-36</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">!BOC</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#convectivetransport_modi15" target="origFile"><code class="typename">CHARACTER</code>(<code class="keyword">len</code>=<code class="constant">75</code>) :: <code class="vardecl">err_msg</code></a>
    <a href="null_p.html#convectivetransport_modi16" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il</code>, <code class="vardecl">ik</code>, <code class="vardecl">ic</code></a>
    <a href="null_p.html#convectivetransport_modi17" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">km1</code>, <code class="vardecl">kp1</code></a>
<a href="null_p.html#convectivetransport_modi18" target="origFile"><code class="comment">! average mixing ratio in pbl</code></a>
    <a href="null_p.html#convectivetransport_modi18" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">avg_pbl</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">avg_pbl_ad</code></a>
<a href="null_p.html#convectivetransport_modi19" target="origFile"><code class="comment">! mix ratio of constituent above</code></a>
    <a href="null_p.html#convectivetransport_modi19" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cabv</code></a>
<a href="null_p.html#convectivetransport_modi20" target="origFile"><code class="comment">! mix ratio of constituent below</code></a>
    <a href="null_p.html#convectivetransport_modi20" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cbel</code></a>
<a href="null_p.html#convectivetransport_modi21" target="origFile"><code class="comment">! normalized diff. between cabv and cbel</code></a>
    <a href="null_p.html#convectivetransport_modi21" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cdifr</code></a>
<a href="null_p.html#convectivetransport_modi22" target="origFile"><code class="comment">! flux coming into  each box at a k level</code></a>
    <a href="null_p.html#convectivetransport_modi22" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxin</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxin_ad</code></a>
<a href="null_p.html#convectivetransport_modi23" target="origFile"><code class="comment">! flux going out of each box at a k level</code></a>
    <a href="null_p.html#convectivetransport_modi23" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxout</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxout_ad</code></a>
    <a href="null_p.html#convectivetransport_modi24" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">maxc</code></a>
    <a href="null_p.html#convectivetransport_modi25" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">minc</code></a>
<a href="null_p.html#convectivetransport_modi26" target="origFile"><code class="comment">! mixing ratio of a scavenged tracer</code></a>
    <a href="null_p.html#convectivetransport_modi26" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">scav</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">scav_ad</code></a>
    <a href="null_p.html#convectivetransport_modi27" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">sqrt_fisg</code></a>
<a href="null_p.html#convectivetransport_modi28" target="origFile"><code class="comment">!.sds - new temp variable for updraft concen calc</code></a>
    <a href="null_p.html#convectivetransport_modi28" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_conu</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_conu_ad</code></a>
<a href="null_p.html#convectivetransport_modi29" target="origFile"><code class="comment">! mix ratio in env.      at interfaces</code></a>
    <a href="null_p.html#convectivetransport_modi29" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">chat</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">chat_ad</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi30" target="origFile"><code class="comment">! mix ratio in updraft   at interfaces</code></a>
    <a href="null_p.html#convectivetransport_modi30" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">conu</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">conu_ad</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi31" target="origFile"><code class="comment">! mix ratio in downdraft at interfaces</code></a>
    <a href="null_p.html#convectivetransport_modi31" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cond</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cond_ad</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi32" target="origFile"><code class="comment">! gathered tend.  array</code></a>
    <a href="null_p.html#convectivetransport_modi32" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dcondt</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dcondt_ad</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi33" target="origFile"><code class="comment">! gathered downdraft entrainment</code></a>
    <a href="null_p.html#convectivetransport_modi33" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">edi</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi34" target="origFile"><code class="comment">! gathered insoluble frac. of tracer</code></a>
    <a href="null_p.html#convectivetransport_modi34" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fisg</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_modi35" target="origFile"><code class="comment">! gathered tracer array</code></a>
    <a href="null_p.html#convectivetransport_modi35" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xconst</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xconst_ad</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_modi36" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#convectivetransport_modi37" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#convectivetransport_modi38" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#convectivetransport_modi39" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
    <a href="null_p.html#convectivetransport_modi40" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#convectivetransport_modi41" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min1_ad</code></a>
    <a href="null_p.html#convectivetransport_modi42" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#convectivetransport_modi43" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min2</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min2_ad</code></a>
    <a href="null_p.html#convectivetransport_modi44" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min3</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min3_ad</code></a>
    <a href="null_p.html#convectivetransport_modi45" target="origFile"><code class="typename">LOGICAL</code>, DIMENSION(il2g, k2-k1+<code class="constant">1</code>) :: <code class="vardecl">mask</code></a>
    <a href="null_p.html#convectivetransport_modi46" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1_ad</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad0</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad2</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tmp</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tmp_ad</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad3</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad4</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad5</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad6</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_ad7</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_from</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to0</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">branch</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_from0</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to2</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to3</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_from1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_to4</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_from2</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ad_count</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ic)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL2B</code>(<code class="constant">0</code>)</a>
<a href="null_p.html#convectivetransport_modi47" target="origFile"><code class="label">icloop:</code><code class="keyword">DO </code>ic=<code class="constant">1</code>,numspecies</a>
      <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">IF</code> (isfixedconcentration(ic)) <code class="keyword">THEN</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ic)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL2B</code>(<code class="constant">2</code>)</a>
      <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile">ad_from = k1</a>
<a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="comment">! ------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="comment">! Gather up the constituent and set tend. to zero.</code></a>
<a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="comment">! ------------------------------------------------</code></a>
        <a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="keyword">DO </code>ik=ad_from,k2</a>
          <a href="null_p.html#convectivetransport_modi51" target="origFile"><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
            <a href="null_p.html#convectivetransport_modi49" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(fisg(il, ik))</a>
            <a href="null_p.html#convectivetransport_modi49" target="origFile">fisg(il, ik) = fracis(ideep(il), ik, ic)</a>
            <a href="null_p.html#convectivetransport_modi50" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(xconst(il, ik))</a>
            <a href="null_p.html#convectivetransport_modi50" target="origFile">xconst(il, ik) = qq(ideep(il), ik, ic)</a>
          <a href="null_p.html#convectivetransport_modi51" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(il - <code class="constant">1</code>)</a>
        <a href="null_p.html#convectivetransport_modi52" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ik - <code class="constant">1</code>)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_from)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile">ad_from0 = k1</a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! -----------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! From now on work only with gathered data.</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! -----------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! Interpolate environment tracer values to interfaces.</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="label">ikloop1:</code><code class="keyword">DO </code>ik=ad_from0,k2</a>
          <a href="null_p.html#convectivetransport_modi53" target="origFile"><code class="keyword">IF</code> (k1 .LT. ik - <code class="constant">1</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_modi54" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(km1)</a>
            <a href="null_p.html#convectivetransport_modi54" target="origFile">km1 = ik - <code class="constant">1</code></a>
            <a href="null_p.html#convectivetransport_modi53" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
          <a href="null_p.html#convectivetransport_modi53" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_modi55" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(km1)</a>
            <a href="null_p.html#convectivetransport_modi55" target="origFile">km1 = k1</a>
            <a href="null_p.html#convectivetransport_modi53" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
          <a href="null_p.html#convectivetransport_modi53" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_modi56" target="origFile"><code class="keyword">IF</code> (k2 .GT. ik + <code class="constant">1</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_modi57" target="origFile">kp1 = ik + <code class="constant">1</code></a>
          <a href="null_p.html#convectivetransport_modi56" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_modi58" target="origFile">kp1 = k2</a>
          <a href="null_p.html#convectivetransport_modi56" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_modi59" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8ARRAY</code>(edi(:, ik), il2g)</a>
          <a href="null_p.html#convectivetransport_modi59" target="origFile">edi(:, ik) = mdi(:, ik) - mdi(:, kp1)</a>
  <a href="null_p.html#convectivetransport_modi64" target="origFile"><code class="label">illoop1:</code><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!minc = Min (xconst(il,km1), xconst(il,ik))</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!maxc = Max (xconst(il,km1), xconst(il,ik))</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!if (minc &lt; 0.0d0) then</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!cdifr = 0.0d0</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!cdifr = Abs (xconst(il,ik) - xconst(il,km1)) /  &</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!        Max (maxc, SMALL)</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!end if</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!if (cdifr &gt; 1.0d-6) then</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   ! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   ! The two layers differ significantly, so use a geometric</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   ! averaging procedure.</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   ! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   cabv = Max (xconst(il,km1), (maxc * 1.0d-12))</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   cbel = Max (xconst(il,ik),  (maxc * 1.0d-12))</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!   chat(il,ik) = Log (cabv/cbel) / (cabv - cbel) * cabv * cbel</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">! ---------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">! The two layers have only a small difference, so use</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">! arithmetic mean.</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="comment">! ---------------------------------------------------</code></a>
            <a href="null_p.html#convectivetransport_modi60" target="origFile">chat(il, ik) = <code class="constant">0.5d0</code>*(xconst(il, ik)+xconst(il, km1))</a>
<a href="null_p.html#convectivetransport_modi61" target="origFile"><code class="comment">!end if</code></a>
<a href="null_p.html#convectivetransport_modi61" target="origFile"><code class="comment">! -------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi61" target="origFile"><code class="comment">! Provisional up and down draft values.</code></a>
<a href="null_p.html#convectivetransport_modi61" target="origFile"><code class="comment">! -------------------------------------</code></a>
            <a href="null_p.html#convectivetransport_modi61" target="origFile">conu(il, ik) = chat(il, ik)</a>
            <a href="null_p.html#convectivetransport_modi62" target="origFile">cond(il, ik) = chat(il, km1)</a>
<a href="null_p.html#convectivetransport_modi63" target="origFile"><code class="comment">! ------------------</code></a>
<a href="null_p.html#convectivetransport_modi63" target="origFile"><code class="comment">! Provisional tends.</code></a>
<a href="null_p.html#convectivetransport_modi63" target="origFile"><code class="comment">! ------------------</code></a>
            <a href="null_p.html#convectivetransport_modi63" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(dcondt(il, ik))</a>
            <a href="null_p.html#convectivetransport_modi63" target="origFile">dcondt(il, ik) = <code class="constant">0.0d0</code></a>
          <a href="null_p.html#convectivetransport_modi64" target="origFile"><code class="keyword">END DO </code><code class="label">illoop1</code></a>
          <a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(il - <code class="constant">1</code>)</a>
        <a href="null_p.html#convectivetransport_modi65" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop1</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ik - <code class="constant">1</code>)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_from0)</a>
        <a href="null_p.html#convectivetransport_modi66" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHBOOLEANARRAY</code>(mask, il2g*(k2-k1+<code class="constant">1</code>))</a>
        <a href="null_p.html#convectivetransport_modi66" target="origFile">mask(:, :) = edi(:, :) .LT. <code class="constant">0.0d0</code></a>
        <a href="null_p.html#convectivetransport_modi67" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8ARRAY</code>(edi, il2g*(k2-k1+<code class="constant">1</code>))</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">WHERE </code>(mask(:, :)) </a><a href="null_p.html#convectivetransport_modi67" target="origFile">edi(:, :) = <code class="constant">0.0d0</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(il)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile">ad_count = <code class="constant">1</code></a>
<a href="null_p.html#convectivetransport_modi68" target="origFile"><code class="label">illoop2:</code><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
<a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="comment">! ----------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="comment">! Find the mixing ratio in the downdraft, top of atmosphere down.</code></a>
<a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="comment">! NOTE: mass flux   in downdraft (mdi) will be zero or negative.</code></a>
<a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="comment">!       entrainment in downdraft (edi) will be zero or positive.</code></a>
<a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="comment">! ----------------------------------------------------------------------</code></a>
 <a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="label">ikloopdd:</code><code class="keyword">DO </code>ik=<code class="constant">2</code>,k2</a>
            <a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="keyword">IF</code> (mdi(il, ik-<code class="constant">1</code>) .LT. -xmbsth .OR. edi(il, ik) .GT. xmbsth<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="label">&           </code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_modi70" target="origFile">cond(il, ik) = (cond(il, ik-<code class="constant">1</code>)*mdi(il, ik-<code class="constant">1</code>)-xconst(il, ik<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi70" target="origFile"><code class="label">&               </code>)*edi(il, ik))/(mdi(il, ik-<code class="constant">1</code>)-edi(il, ik))</a>
              <a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
            <a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
            <a href="null_p.html#convectivetransport_modi69" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_modi71" target="origFile"><code class="keyword">END DO </code><code class="label">ikloopdd</code></a>
          <a href="null_p.html#convectivetransport_modi68" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ik - <code class="constant">1</code>)</a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! ------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! Calculate updrafts with scavenging from bottom to top.</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! Include the downdrafts.</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! ------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! -------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! Do the bottom most levels in the pbl.</code></a>
<a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="comment">! -------------------------------------</code></a>
          <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">IF</code> (<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>)) .EQ. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
          <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_modi73" target="origFile">result1 = <code class="funcname">SUM</code>(xconst(il, k2:pbli(il):-<code class="constant">1</code>)*dpi(il, k2:pbli(il)<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi73" target="origFile"><code class="label">&             </code>:-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_modi74" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(avg_pbl)</a>
            <a href="null_p.html#convectivetransport_modi74" target="origFile">avg_pbl = result1/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_modi75" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(sqrt_fisg)</a>
            <a href="null_p.html#convectivetransport_modi75" target="origFile">sqrt_fisg = <code class="funcname">SQRT</code>(fisg(il, pbli(il)))</a>
            <a href="null_p.html#convectivetransport_modi76" target="origFile">scav = avg_pbl*(<code class="constant">1.0d0</code>-sqrt_fisg)</a>
            <a href="null_p.html#convectivetransport_modi77" target="origFile">conu(il, pbli(il)) = avg_pbl*sqrt_fisg</a>
            <a href="null_p.html#convectivetransport_modi78" target="origFile"><code class="keyword">IF</code> (chat(il, pbli(il)) .GT. xconst(il, pbli(il)-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_modi79" target="origFile">min1 = xconst(il, pbli(il)-<code class="constant">1</code>)</a>
              <a href="null_p.html#convectivetransport_modi78" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
            <a href="null_p.html#convectivetransport_modi78" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_modi80" target="origFile">min1 = chat(il, pbli(il))</a>
              <a href="null_p.html#convectivetransport_modi78" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
            <a href="null_p.html#convectivetransport_modi78" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#convectivetransport_modi81" target="origFile">fluxin = (mui(il, pbli(il))+mdi(il, pbli(il)))*min1 - mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi81" target="origFile"><code class="label">&             </code>, pbli(il))*cond(il, pbli(il))</a>
            <a href="null_p.html#convectivetransport_modi82" target="origFile">fluxout = mui(il, pbli(il))*conu(il, pbli(il)) + mui(il, <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi82" target="origFile"><code class="label">&             </code>pbli(il))*scav</a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(dcondt(il, k2))</a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile">dcondt(il, k2) = (fluxin-fluxout)/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi83" target="origFile"><code class="label">&             </code>))</a>
            <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">IF</code> (avg_pbl .GT. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_modi84" target="origFile">ad_from1 = k2</a>
              <a href="null_p.html#convectivetransport_modi86" target="origFile"><code class="keyword">DO </code>ik=ad_from1,pbli(il),-<code class="constant">1</code></a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">qq(ideep(il), ik, ic) = (avg_pbl+dcondt(il, k2)*delt)/<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi85" target="origFile"><code class="label">&                 </code>avg_pbl*xconst(il, ik)</a>
              <a href="null_p.html#convectivetransport_modi86" target="origFile"><code class="keyword">END DO</code></a>
              <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ik + <code class="constant">1</code>)</a>
              <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_from1)</a>
              <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
            <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
            <a href="null_p.html#convectivetransport_modi84" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#convectivetransport_modi72" target="origFile">ad_from2 = pbli(il) - <code class="constant">1</code></a>
<a href="null_p.html#convectivetransport_modi111" target="origFile"><code class="comment">! ---------------------------</code></a>
<a href="null_p.html#convectivetransport_modi111" target="origFile"><code class="comment">! Loop over all other levels.</code></a>
<a href="null_p.html#convectivetransport_modi111" target="origFile"><code class="comment">! ---------------------------</code></a>
    <a href="null_p.html#convectivetransport_modi111" target="origFile"><code class="label">ikloop2:</code><code class="keyword">DO </code>ik=ad_from2,<code class="constant">2</code>,-<code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_modi87" target="origFile">kp1 = ik + <code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_modi88" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(km1)</a>
              <a href="null_p.html#convectivetransport_modi88" target="origFile">km1 = ik - <code class="constant">1</code></a>
<a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="comment">! -----------------------------</code></a>
<a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="comment">! Find mixing ratio in updraft.</code></a>
<a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="comment">! -----------------------------</code></a>
              <a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="keyword">IF</code> (mui(il, kp1) - dui(il, ik) + eui(il, ik) .GT. xmbsth) <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="label">&             </code><code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_modi90" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(sqrt_fisg)</a>
                <a href="null_p.html#convectivetransport_modi90" target="origFile">sqrt_fisg = <code class="funcname">SQRT</code>(fisg(il, ik))</a>
                <a href="null_p.html#convectivetransport_modi91" target="origFile"><code class="keyword">IF</code> (mui(il, kp1) + eui(il, ik) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#convectivetransport_modi92" target="origFile">abs0 = mui(il, kp1) + eui(il, ik)</a>
                <a href="null_p.html#convectivetransport_modi91" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#convectivetransport_modi93" target="origFile">abs0 = -(mui(il, kp1)+eui(il, ik))</a>
                <a href="null_p.html#convectivetransport_modi91" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="keyword">IF</code> (abs0 .GE. xmbsth) <code class="keyword">THEN</code></a>
<a href="null_p.html#convectivetransport_modi95" target="origFile"><code class="comment">!... mix updraft and entrainment, then detrain this concentration</code></a>
                  <a href="null_p.html#convectivetransport_modi95" target="origFile">temp_conu = (mui(il, kp1)*conu(il, kp1)+eui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi95" target="origFile"><code class="label">&                   </code>xconst(il, ik))/(mui(il, kp1)+eui(il, ik))</a>
<a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="comment">!... if updraft and entrainment flux sum to 0.0, then take average concen</code></a>
                  <a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
                <a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#convectivetransport_modi96" target="origFile">temp_conu = (xconst(il, ik)+conu(il, kp1))/<code class="constant">2.0d0</code></a>
                  <a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
                <a href="null_p.html#convectivetransport_modi94" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#convectivetransport_modi97" target="origFile"><code class="comment">!</code></a>
                <a href="null_p.html#convectivetransport_modi97" target="origFile">scav = ((mui(il, kp1)*conu(il, kp1)-dui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi97" target="origFile"><code class="label">&                 </code>temp_conu)*(<code class="constant">1.0d0</code>-fisg(il, ik))+eui(il, ik)*xconst(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi97" target="origFile"><code class="label">&                 </code>, ik)*(<code class="constant">1.0d0</code>-sqrt_fisg))/(mui(il, kp1)-dui(il, ik)+eui<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi97" target="origFile"><code class="label">&                 </code>(il, ik))</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">tmp = ((mui(il, kp1)*conu(il, kp1)-dui(il, ik)*temp_conu<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code>)*fisg(il, ik)+eui(il, ik)*xconst(il, ik)*sqrt_fisg)/(<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code>mui(il, kp1)-dui(il, ik)+eui(il, ik))</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">conu(il, ik) = tmp</a>
                <a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
              <a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_modi99" target="origFile">conu(il, ik) = xconst(il, ik)</a>
                <a href="null_p.html#convectivetransport_modi100" target="origFile">scav = <code class="constant">0.0d0</code></a>
                <a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
              <a href="null_p.html#convectivetransport_modi89" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_modi101" target="origFile"><code class="keyword">IF</code> (chat(il, ik) .GT. xconst(il, km1)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_modi102" target="origFile">min2 = xconst(il, km1)</a>
                <a href="null_p.html#convectivetransport_modi101" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
              <a href="null_p.html#convectivetransport_modi101" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_modi103" target="origFile">min2 = chat(il, ik)</a>
                <a href="null_p.html#convectivetransport_modi101" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
              <a href="null_p.html#convectivetransport_modi101" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! Calculate fluxes into and out of box.  With scavenging</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! included the net flux for the whole column is no longer</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! guaranteed to be zero.</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! Include the downdrafts.</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="comment">! -------------------------------------------------------</code></a>
              <a href="null_p.html#convectivetransport_modi104" target="origFile">fluxin = mui(il, kp1)*conu(il, kp1) + (mui(il, ik)+mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="label">&               </code>, ik))*min2 - mdi(il, ik)*cond(il, ik)</a>
              <a href="null_p.html#convectivetransport_modi105" target="origFile"><code class="keyword">IF</code> (chat(il, kp1) .GT. xconst(il, ik)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_modi106" target="origFile">min3 = xconst(il, ik)</a>
                <a href="null_p.html#convectivetransport_modi105" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
              <a href="null_p.html#convectivetransport_modi105" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_modi107" target="origFile">min3 = chat(il, kp1)</a>
                <a href="null_p.html#convectivetransport_modi105" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
              <a href="null_p.html#convectivetransport_modi105" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_modi108" target="origFile">fluxout = mui(il, ik)*conu(il, ik) + (mui(il, kp1)+mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi108" target="origFile"><code class="label">&               </code>, kp1))*min3 + (mui(il, ik)+mui(il, kp1))*<code class="constant">0.5d0</code>*scav - <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi108" target="origFile"><code class="label">&               </code>mdi(il, kp1)*cond(il, kp1)</a>
              <a href="null_p.html#convectivetransport_modi109" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHREAL8</code>(dcondt(il, ik))</a>
              <a href="null_p.html#convectivetransport_modi109" target="origFile">dcondt(il, ik) = (fluxin-fluxout)/dpi(il, ik)</a>
<a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="comment">! --------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="comment">! Update and scatter data back to full arrays.</code></a>
<a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="comment">! --------------------------------------------</code></a>
              <a href="null_p.html#convectivetransport_modi110" target="origFile">qq(ideep(il), ik, ic) = xconst(il, ik) + dcondt(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="label">&               </code>delt</a>
            <a href="null_p.html#convectivetransport_modi111" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop2</code></a>
            <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_from2)</a>
            <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(il)</a>
            <a href="null_p.html#convectivetransport_modi72" target="origFile">ad_count = ad_count + <code class="constant">1</code></a>
          <a href="null_p.html#convectivetransport_modi72" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#convectivetransport_modi68" target="origFile"><code class="keyword">END DO </code><code class="label">illoop2</code></a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">0</code>)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_count)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ic)</a>
        <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL2B</code>(<code class="constant">1</code>)</a>
      <a href="null_p.html#convectivetransport_modi48" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#convectivetransport_modi47" target="origFile"><code class="keyword">END DO </code><code class="label">icloop</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile">conu_ad = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile">dcondt_ad = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile">chat_ad = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile">cond_ad = <code class="constant">0.0_8</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile">xconst_ad = <code class="constant">0.0_8</code></a>
 <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">100 </code><code class="keyword">CALL </code><code class="funcname">POPCONTROL2B</code>(branch)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .NE. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ic)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_count)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ad_count</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (i .EQ. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">110</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">qq_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">conu_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">dcondt_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">chat_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">cond_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">xconst_ad = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a name="convectivetransport_admi34"></a>            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_from2)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=<code class="constant">2</code>,ad_from2,<code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_modi110" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + qq_ad(ideep(il), <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="label">&               </code>ik, ic)</a>
              <a href="null_p.html#convectivetransport_modi110" target="origFile">dcondt_ad(il, ik) = dcondt_ad(il, ik) + delt*qq_ad(ideep(<code class="label">&</code></a>
<a name="convectivetransport_admi35"></a><a href="null_p.html#convectivetransport_modi110" target="origFile"><code class="label">&               </code>il), ik, ic)</a>
              <a href="null_p.html#convectivetransport_modi110" target="origFile">qq_ad(ideep(il), ik, ic) = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_modi109" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(dcondt(il, ik))</a>
              <a href="null_p.html#convectivetransport_modi109" target="origFile">temp_ad7 = dcondt_ad(il, ik)/dpi(il, ik)</a>
              <a href="null_p.html#convectivetransport_modi109" target="origFile">fluxin_ad = temp_ad7</a>
<a name="convectivetransport_admi87"></a>              <a href="null_p.html#convectivetransport_modi109" target="origFile">fluxout_ad = -temp_ad7</a>
<a name="convectivetransport_admi36"></a>              <a href="null_p.html#convectivetransport_modi109" target="origFile">dcondt_ad(il, ik) = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_modi87" target="origFile">kp1 = ik + <code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_modi108" target="origFile">conu_ad(il, ik) = conu_ad(il, ik) + mui(il, ik)*fluxout_ad</a>
              <a href="null_p.html#convectivetransport_modi108" target="origFile">min3_ad = (mui(il, kp1)+mdi(il, kp1))*fluxout_ad</a>
              <a href="null_p.html#convectivetransport_modi108" target="origFile">scav_ad = (mui(il, ik)+mui(il, kp1))*<code class="constant">0.5d0</code>*fluxout_ad</a>
              <a href="null_p.html#convectivetransport_modi108" target="origFile">cond_ad(il, kp1) = cond_ad(il, kp1) - mdi(il, kp1)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi108" target="origFile"><code class="label">&               </code>fluxout_ad</a>
<a name="convectivetransport_admi32"></a>              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="convectivetransport_admi33"></a>                <a href="null_p.html#convectivetransport_modi106" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + min3_ad</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a name="convectivetransport_admi31"></a>                <a href="null_p.html#convectivetransport_modi107" target="origFile">chat_ad(il, kp1) = chat_ad(il, kp1) + min3_ad</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_modi104" target="origFile">conu_ad(il, kp1) = conu_ad(il, kp1) + mui(il, kp1)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi104" target="origFile"><code class="label">&               </code>fluxin_ad</a>
<a name="convectivetransport_admi88"></a>              <a href="null_p.html#convectivetransport_modi104" target="origFile">min2_ad = (mui(il, ik)+mdi(il, ik))*fluxin_ad</a>
              <a href="null_p.html#convectivetransport_modi104" target="origFile">cond_ad(il, ik) = cond_ad(il, ik) - mdi(il, ik)*fluxin_ad</a>
              <a href="null_p.html#convectivetransport_modi22" target="origFile">km1 = ik - <code class="constant">1</code></a>
<a name="convectivetransport_admi29"></a>              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="convectivetransport_admi30"></a>                <a href="null_p.html#convectivetransport_modi102" target="origFile">xconst_ad(il, km1) = xconst_ad(il, km1) + min2_ad</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_modi103" target="origFile">chat_ad(il, ik) = chat_ad(il, ik) + min2_ad</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
<a name="convectivetransport_admi28"></a>              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_modi99" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + conu_ad(il, ik)</a>
<a name="convectivetransport_admi27"></a>                <a href="null_p.html#convectivetransport_modi99" target="origFile">conu_ad(il, ik) = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_modi97" target="origFile">temp_ad6 = scav_ad/(mui(il, kp1)-dui(il, ik)+eui(il, ik)<code class="label">&</code></a>
<a name="convectivetransport_admi26"></a><a href="null_p.html#convectivetransport_modi97" target="origFile"><code class="label">&                 </code>)</a>
                <a href="null_p.html#convectivetransport_modi97" target="origFile">temp_ad5 = (<code class="constant">1.0d0</code>-fisg(il, ik))*temp_ad6</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">tmp_ad = conu_ad(il, ik)</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">conu_ad(il, ik) = <code class="constant">0.0_8</code></a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">temp_ad3 = tmp_ad/(mui(il, kp1)-dui(il, ik)+eui(il, ik))</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">temp_ad4 = fisg(il, ik)*temp_ad3</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">conu_ad(il, kp1) = conu_ad(il, kp1) + mui(il, kp1)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code>temp_ad5 + mui(il, kp1)*temp_ad4</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">temp_conu_ad = -(dui(il, ik)*temp_ad5) - dui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code>temp_ad4</a>
                <a href="null_p.html#convectivetransport_modi98" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + eui(il, ik)*(<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code><code class="constant">1.0d0</code>-sqrt_fisg)*temp_ad6 + eui(il, ik)*sqrt_fisg*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi98" target="origFile"><code class="label">&                 </code>temp_ad3</a>
<a name="convectivetransport_admi24"></a>                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#convectivetransport_modi95" target="origFile">temp_ad2 = temp_conu_ad/(mui(il, kp1)+eui(il, ik))</a>
                  <a href="null_p.html#convectivetransport_modi95" target="origFile">conu_ad(il, kp1) = conu_ad(il, kp1) + mui(il, kp1)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi95" target="origFile"><code class="label">&                   </code>temp_ad2</a>
                  <a href="null_p.html#convectivetransport_modi95" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + eui(il, ik)*<code class="label">&</code></a>
<a name="convectivetransport_admi25"></a><a href="null_p.html#convectivetransport_modi95" target="origFile"><code class="label">&                   </code>temp_ad2</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#convectivetransport_modi96" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + temp_conu_ad/<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi96" target="origFile"><code class="label">&                   </code><code class="constant">2.0d0</code></a>
                  <a href="null_p.html#convectivetransport_modi96" target="origFile">conu_ad(il, kp1) = conu_ad(il, kp1) + temp_conu_ad/<code class="label">&</code></a>
<a name="convectivetransport_admi23"></a><a href="null_p.html#convectivetransport_modi96" target="origFile"><code class="label">&                   </code><code class="constant">2.0d0</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
<a name="convectivetransport_admi22"></a>                <a href="null_p.html#convectivetransport_modi90" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(sqrt_fisg)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_modi88" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(km1)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">avg_pbl_ad = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">avg_pbl_ad = <code class="constant">0.0_8</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_from1)</a>
<a name="convectivetransport_admi21"></a>              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to4)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=ad_to4,ad_from1,<code class="constant">1</code></a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">temp = xconst(il, ik)/avg_pbl</a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">temp_ad1 = (avg_pbl+delt*dcondt(il, k2))*qq_ad(ideep(il)<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi85" target="origFile"><code class="label">&                 </code>, ik, ic)/avg_pbl</a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">avg_pbl_ad = avg_pbl_ad + temp*qq_ad(ideep(il), ik, ic) <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi85" target="origFile"><code class="label">&                 </code>- temp*temp_ad1</a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">dcondt_ad(il, k2) = dcondt_ad(il, k2) + temp*delt*qq_ad(<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi85" target="origFile"><code class="label">&                 </code>ideep(il), ik, ic)</a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + temp_ad1</a>
                <a href="null_p.html#convectivetransport_modi85" target="origFile">qq_ad(ideep(il), ik, ic) = <code class="constant">0.0_8</code></a>
<a name="convectivetransport_admi18"></a>              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(dcondt(il, k2))</a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile">temp_ad0 = dcondt_ad(il, k2)/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile">fluxin_ad = temp_ad0</a>
<a name="convectivetransport_admi19"></a>            <a href="null_p.html#convectivetransport_modi83" target="origFile">fluxout_ad = -temp_ad0</a>
            <a href="null_p.html#convectivetransport_modi83" target="origFile">dcondt_ad(il, k2) = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_modi82" target="origFile">conu_ad(il, pbli(il)) = conu_ad(il, pbli(il)) + mui(il, pbli<code class="label">&</code></a>
<a name="convectivetransport_admi20"></a><a href="null_p.html#convectivetransport_modi82" target="origFile"><code class="label">&             </code>(il))*fluxout_ad</a>
            <a href="null_p.html#convectivetransport_modi82" target="origFile">scav_ad = mui(il, pbli(il))*fluxout_ad</a>
            <a href="null_p.html#convectivetransport_modi81" target="origFile">min1_ad = (mui(il, pbli(il))+mdi(il, pbli(il)))*fluxin_ad</a>
            <a href="null_p.html#convectivetransport_modi81" target="origFile">cond_ad(il, pbli(il)) = cond_ad(il, pbli(il)) - mdi(il, pbli<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi81" target="origFile"><code class="label">&             </code>(il))*fluxin_ad</a>
<a name="convectivetransport_admi16"></a>            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_modi79" target="origFile">xconst_ad(il, pbli(il)-<code class="constant">1</code>) = xconst_ad(il, pbli(il)-<code class="constant">1</code>) + <code class="label">&</code></a>
<a name="convectivetransport_admi17"></a><a href="null_p.html#convectivetransport_modi79" target="origFile"><code class="label">&               </code>min1_ad</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
<a name="convectivetransport_admi12"></a>              <a href="null_p.html#convectivetransport_modi80" target="origFile">chat_ad(il, pbli(il)) = chat_ad(il, pbli(il)) + min1_ad</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#convectivetransport_modi77" target="origFile">avg_pbl_ad = avg_pbl_ad + (<code class="constant">1.0d0</code>-sqrt_fisg)*scav_ad + <code class="label">&</code></a>
<a name="convectivetransport_admi13"></a><a href="null_p.html#convectivetransport_modi77" target="origFile"><code class="label">&             </code>sqrt_fisg*conu_ad(il, pbli(il))</a>
<a name="convectivetransport_admi14"></a>            <a href="null_p.html#convectivetransport_modi77" target="origFile">conu_ad(il, pbli(il)) = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_modi75" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(sqrt_fisg)</a>
<a name="convectivetransport_admi15"></a>            <a href="null_p.html#convectivetransport_modi74" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(avg_pbl)</a>
            <a href="null_p.html#convectivetransport_modi74" target="origFile">result1_ad = avg_pbl_ad/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_modi73" target="origFile">xconst_ad(il, k2:pbli(il):-<code class="constant">1</code>) = xconst_ad(il, k2:pbli(il):-<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi73" target="origFile"><code class="label">&             </code>) + dpi(il, k2:pbli(il):-<code class="constant">1</code>)*result1_ad</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to3)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=ad_to3,<code class="constant">2</code>,<code class="constant">-1</code></a>
<a name="convectivetransport_admi11"></a>            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .NE. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_modi70" target="origFile">temp_ad = cond_ad(il, ik)/(mdi(il, ik-<code class="constant">1</code>)-edi(il, ik))</a>
              <a href="null_p.html#convectivetransport_modi70" target="origFile">cond_ad(il, ik-<code class="constant">1</code>) = cond_ad(il, ik-<code class="constant">1</code>) + mdi(il, ik-<code class="constant">1</code>)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi70" target="origFile"><code class="label">&               </code>temp_ad</a>
              <a href="null_p.html#convectivetransport_modi70" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) - edi(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi70" target="origFile"><code class="label">&               </code>temp_ad</a>
              <a href="null_p.html#convectivetransport_modi70" target="origFile">cond_ad(il, ik) = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
<a name="convectivetransport_admi9"></a> <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">110      </code><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(il)</a>
<a name="convectivetransport_admi10"></a>        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#convectivetransport_modi67" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8ARRAY</code>(edi, il2g*(k2-k1+<code class="constant">1</code>))</a>
        <a href="null_p.html#convectivetransport_modi66" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPBOOLEANARRAY</code>(mask, il2g*(k2-k1+<code class="constant">1</code>))</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_from0)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to2)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=ad_to2,ad_from0,<code class="constant">-1</code></a>
<a name="convectivetransport_admi5"></a>          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to1)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>il=ad_to1,<code class="constant">1</code>,<code class="constant">-1</code></a>
<a name="convectivetransport_admi6"></a>            <a href="null_p.html#convectivetransport_modi63" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(dcondt(il, ik))</a>
            <a href="null_p.html#convectivetransport_modi63" target="origFile">dcondt_ad(il, ik) = <code class="constant">0.0_8</code></a>
<a name="convectivetransport_admi7"></a>            <a href="null_p.html#convectivetransport_modi62" target="origFile">chat_ad(il, km1) = chat_ad(il, km1) + cond_ad(il, ik)</a>
            <a href="null_p.html#convectivetransport_modi62" target="origFile">cond_ad(il, ik) = <code class="constant">0.0_8</code></a>
<a name="convectivetransport_admi8"></a>            <a href="null_p.html#convectivetransport_modi61" target="origFile">chat_ad(il, ik) = chat_ad(il, ik) + conu_ad(il, ik)</a>
            <a href="null_p.html#convectivetransport_modi61" target="origFile">conu_ad(il, ik) = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_modi60" target="origFile">xconst_ad(il, ik) = xconst_ad(il, ik) + <code class="constant">0.5d0</code>*chat_ad(il, ik<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="label">&             </code>)</a>
            <a href="null_p.html#convectivetransport_modi60" target="origFile">xconst_ad(il, km1) = xconst_ad(il, km1) + <code class="constant">0.5d0</code>*chat_ad(il, <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_modi60" target="origFile"><code class="label">&             </code>ik)</a>
<a name="convectivetransport_admi4"></a>            <a href="null_p.html#convectivetransport_modi60" target="origFile">chat_ad(il, ik) = <code class="constant">0.0_8</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#convectivetransport_modi59" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8ARRAY</code>(edi(:, ik), il2g)</a>
<a name="convectivetransport_admi2"></a>          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPCONTROL1B</code>(branch)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (branch .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="convectivetransport_admi3"></a>            <a href="null_p.html#convectivetransport_modi54" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(km1)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_modi55" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(km1)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_from)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to0)</a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=ad_to0,ad_from,<code class="constant">-1</code></a>
<a name="convectivetransport_admi0"></a>          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ad_to)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>il=ad_to,<code class="constant">1</code>,<code class="constant">-1</code></a>
            <a href="null_p.html#convectivetransport_modi50" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(xconst(il, ik))</a>
            <a href="null_p.html#convectivetransport_modi50" target="origFile">qq_ad(ideep(il), ik, ic) = qq_ad(ideep(il), ik, ic) + <code class="label">&</code></a>
<a name="convectivetransport_admi1"></a><a href="null_p.html#convectivetransport_modi50" target="origFile"><code class="label">&             </code>xconst_ad(il, ik)</a>
            <a href="null_p.html#convectivetransport_modi50" target="origFile">xconst_ad(il, ik) = <code class="constant">0.0_8</code></a>
            <a href="null_p.html#convectivetransport_modi49" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPREAL8</code>(fisg(il, ik))</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ic)</a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">100</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">POPINTEGER4</code>(ic)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">130</code></a>
 <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">120 </code><code class="keyword">CALL </code><code class="funcname">PUSHCONTROL1B</code>(<code class="constant">1</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">PUSHINTEGER4</code>(ad_count)</a>
    <a href="null_p.html#convectivetransport_modi112" target="origFile"><code class="keyword">STOP</code></a>
<a name="convectivetransport"></a> <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">130 </code><code class="keyword">CONTINUE</code></a>
  <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CONVECTIVETRANSPORT_ADM</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Module for the convective transport.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!BOP</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !IROUTINE: convectiveTransport</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !INTERFACE:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
  <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CONVECTIVETRANSPORT</code>(<code class="vardecl">il2g</code>, <code class="vardecl">delt</code>, <code class="vardecl">xmbsth</code>, <code class="vardecl">ideep</code>, <code class="vardecl">pbli</code>, <code class="vardecl">dui</code>, <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&   </code><code class="vardecl">eui</code>, <code class="vardecl">mui</code>, <code class="vardecl">mdi</code>, <code class="vardecl">dpi</code>, <code class="vardecl">fracis</code>, <code class="vardecl">qq</code>, <code class="vardecl">isfixedconcentration</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code><code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">ilong</code>, <code class="vardecl">numspecies</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !INPUT PARAMETERS</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">isfixedconcentration</code>(:)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">numspecies</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathered max lon indices over which to operate</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">il2g</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! convection time step (s)</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">delt</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! threshold below which we treat mass fluxes as zero (mb/s)</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">xmbsth</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathering array</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ideep</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! index of planetary boundary layer</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pbli</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mass detraining from updraft</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mass entraining into updraft</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">eui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mass flux up</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mass flux down</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mdi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! delta pressure between interfaces</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dpi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! insoluble fraction of tracer</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">fracis</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! tracer array including moisture (mixing ratio)</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">qq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">numspecies</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! This routine performs convective transport of trace species.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Note that we assume that the tracers are in a moist mixing ratio.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !DEFINED PARAMETERS:</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">small</code>=<code class="constant">1.0d-36</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!-----------------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!BOC</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">CHARACTER</code>(<code class="keyword">len</code>=<code class="constant">75</code>) :: <code class="vardecl">err_msg</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il</code>, <code class="vardecl">ik</code>, <code class="vardecl">ic</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">km1</code>, <code class="vardecl">kp1</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! average mixing ratio in pbl</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">avg_pbl</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mix ratio of constituent above</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cabv</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mix ratio of constituent below</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cbel</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! normalized diff. between cabv and cbel</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cdifr</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! flux coming into  each box at a k level</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxin</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! flux going out of each box at a k level</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fluxout</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">maxc</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">minc</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mixing ratio of a scavenged tracer</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">scav</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">sqrt_fisg</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!.sds - new temp variable for updraft concen calc</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp_conu</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mix ratio in env.      at interfaces</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">chat</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mix ratio in updraft   at interfaces</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">conu</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! mix ratio in downdraft at interfaces</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cond</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathered tend.  array</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dcondt</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathered downdraft entrainment</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">edi</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathered insoluble frac. of tracer</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fisg</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! gathered tracer array</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xconst</code>(<code class="vardecl">il2g</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min1</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">abs0</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min2</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">min3</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">LOGICAL</code>, DIMENSION(il2g, k2-k1+<code class="constant">1</code>) :: <code class="vardecl">mask</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">icloop:</code><code class="keyword">DO </code>ic=<code class="constant">1</code>,numspecies</a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (.NOT.isfixedconcentration(ic)) <code class="keyword">THEN</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Gather up the constituent and set tend. to zero.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------------------------------------</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=k1,k2</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">fisg(il, ik) = fracis(ideep(il), ik, ic)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">xconst(il, ik) = qq(ideep(il), ik, ic)</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -----------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! From now on work only with gathered data.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -----------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Interpolate environment tracer values to interfaces.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">ikloop1:</code><code class="keyword">DO </code>ik=k1,k2</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (k1 .LT. ik - <code class="constant">1</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">km1 = ik - <code class="constant">1</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">km1 = k1</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (k2 .GT. ik + <code class="constant">1</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">kp1 = ik + <code class="constant">1</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">kp1 = k2</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile">edi(:, ik) = mdi(:, ik) - mdi(:, kp1)</a>
  <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">illoop1:</code><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!minc = Min (xconst(il,km1), xconst(il,ik))</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!maxc = Max (xconst(il,km1), xconst(il,ik))</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!if (minc &lt; 0.0d0) then</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!cdifr = 0.0d0</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!cdifr = Abs (xconst(il,ik) - xconst(il,km1)) /  &</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!        Max (maxc, SMALL)</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!end if</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!if (cdifr &gt; 1.0d-6) then</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   ! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   ! The two layers differ significantly, so use a geometric</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   ! averaging procedure.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   ! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   cabv = Max (xconst(il,km1), (maxc * 1.0d-12))</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   cbel = Max (xconst(il,ik),  (maxc * 1.0d-12))</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!   chat(il,ik) = Log (cabv/cbel) / (cabv - cbel) * cabv * cbel</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!else</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ---------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! The two layers have only a small difference, so use</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! arithmetic mean.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ---------------------------------------------------</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">chat(il, ik) = <code class="constant">0.5d0</code>*(xconst(il, ik)+xconst(il, km1))</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!end if</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Provisional up and down draft values.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">conu(il, ik) = chat(il, ik)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">cond(il, ik) = chat(il, km1)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Provisional tends.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">dcondt(il, ik) = <code class="constant">0.0d0</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">illoop1</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop1</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile">mask(:, :) = edi(:, :) .LT. <code class="constant">0.0d0</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">WHERE </code>(mask(:, :)) edi(:, :) = <code class="constant">0.0d0</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">illoop2:</code><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ----------------------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Find the mixing ratio in the downdraft, top of atmosphere down.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! NOTE: mass flux   in downdraft (mdi) will be zero or negative.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!       entrainment in downdraft (edi) will be zero or positive.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ----------------------------------------------------------------------</code></a>
 <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">ikloopdd:</code><code class="keyword">DO </code>ik=<code class="constant">2</code>,k2</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (mdi(il, ik-<code class="constant">1</code>) .LT. -xmbsth .OR. edi(il, ik) .GT. xmbsth<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&           </code>) cond(il, ik) = (cond(il, ik-<code class="constant">1</code>)*mdi(il, ik-<code class="constant">1</code>)-xconst(il, ik<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&               </code>)*edi(il, ik))/(mdi(il, ik-<code class="constant">1</code>)-edi(il, ik))</a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">ikloopdd</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Calculate updrafts with scavenging from bottom to top.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Include the downdrafts.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------</code></a>
<a name="p0"></a><a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Do the bottom most levels in the pbl.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (</a><a href="msg.html#p0" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="null_p.html#convectivetransport_mod" target="origFile"><code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>)) .EQ. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">err_msg = <code class="string">'Problem in convectiveTransport.'</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">PRINT*</code>, err_msg</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">STOP</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">result1 = <code class="funcname">SUM</code>(xconst(il, k2:pbli(il):-<code class="constant">1</code>)*dpi(il, k2:pbli(il)<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&             </code>:-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">avg_pbl = result1/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code>))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">sqrt_fisg = <code class="funcname">SQRT</code>(fisg(il, pbli(il)))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">scav = avg_pbl*(<code class="constant">1.0d0</code>-sqrt_fisg)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">conu(il, pbli(il)) = avg_pbl*sqrt_fisg</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (chat(il, pbli(il)) .GT. xconst(il, pbli(il)-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">min1 = xconst(il, pbli(il)-<code class="constant">1</code>)</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">min1 = chat(il, pbli(il))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">fluxin = (mui(il, pbli(il))+mdi(il, pbli(il)))*min1 - mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&             </code>, pbli(il))*cond(il, pbli(il))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">fluxout = mui(il, pbli(il))*conu(il, pbli(il)) + mui(il, <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&             </code>pbli(il))*scav</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile">dcondt(il, k2) = (fluxin-fluxout)/<code class="funcname">SUM</code>(dpi(il, k2:pbli(il):-<code class="constant">1</code><code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&             </code>))</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (avg_pbl .GT. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">DO </code>ik=k2,pbli(il),-<code class="constant">1</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">qq(ideep(il), ik, ic) = (avg_pbl+dcondt(il, k2)*delt)/<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>avg_pbl*xconst(il, ik)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO</code></a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ---------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Loop over all other levels.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! ---------------------------</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">ikloop2:</code><code class="keyword">DO </code>ik=pbli(il)-<code class="constant">1</code>,<code class="constant">2</code>,-<code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">kp1 = ik + <code class="constant">1</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">km1 = ik - <code class="constant">1</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -----------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Find mixing ratio in updraft.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -----------------------------</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (mui(il, kp1) - dui(il, ik) + eui(il, ik) .GT. xmbsth) <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&             </code><code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">sqrt_fisg = <code class="funcname">SQRT</code>(fisg(il, ik))</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (mui(il, kp1) + eui(il, ik) .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                  <a href="null_p.html#convectivetransport_mod" target="origFile">abs0 = mui(il, kp1) + eui(il, ik)</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#convectivetransport_mod" target="origFile">abs0 = -(mui(il, kp1)+eui(il, ik))</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (abs0 .GE. xmbsth) <code class="keyword">THEN</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!... mix updraft and entrainment, then detrain this concentration</code></a>
                  <a href="null_p.html#convectivetransport_mod" target="origFile">temp_conu = (mui(il, kp1)*conu(il, kp1)+eui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                   </code>xconst(il, ik))/(mui(il, kp1)+eui(il, ik))</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!... if updraft and entrainment flux sum to 0.0, then take average concen</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                  <a href="null_p.html#convectivetransport_mod" target="origFile">temp_conu = (xconst(il, ik)+conu(il, kp1))/<code class="constant">2.0d0</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">!</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">scav = ((mui(il, kp1)*conu(il, kp1)-dui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>temp_conu)*(<code class="constant">1.0d0</code>-fisg(il, ik))+eui(il, ik)*xconst(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>, ik)*(<code class="constant">1.0d0</code>-sqrt_fisg))/(mui(il, kp1)-dui(il, ik)+eui<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>(il, ik))</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">conu(il, ik) = ((mui(il, kp1)*conu(il, kp1)-dui(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>temp_conu)*fisg(il, ik)+eui(il, ik)*xconst(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&                 </code>sqrt_fisg)/(mui(il, kp1)-dui(il, ik)+eui(il, ik))</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">conu(il, ik) = xconst(il, ik)</a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">scav = <code class="constant">0.0d0</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (chat(il, ik) .GT. xconst(il, km1)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">min2 = xconst(il, km1)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">min2 = chat(il, ik)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Calculate fluxes into and out of box.  With scavenging</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! included the net flux for the whole column is no longer</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! guaranteed to be zero.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Include the downdrafts.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! -------------------------------------------------------</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">fluxin = mui(il, kp1)*conu(il, kp1) + (mui(il, ik)+mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&               </code>, ik))*min2 - mdi(il, ik)*cond(il, ik)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">IF</code> (chat(il, kp1) .GT. xconst(il, ik)) <code class="keyword">THEN</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">min3 = xconst(il, ik)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">ELSE</code></a>
                <a href="null_p.html#convectivetransport_mod" target="origFile">min3 = chat(il, kp1)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">fluxout = mui(il, ik)*conu(il, ik) + (mui(il, kp1)+mdi(il<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&               </code>, kp1))*min3 + (mui(il, ik)+mui(il, kp1))*<code class="constant">0.5d0</code>*scav - <code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&               </code>mdi(il, kp1)*cond(il, kp1)</a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">dcondt(il, ik) = (fluxin-fluxout)/dpi(il, ik)</a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! --------------------------------------------</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! Update and scatter data back to full arrays.</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="comment">! --------------------------------------------</code></a>
              <a href="null_p.html#convectivetransport_mod" target="origFile">qq(ideep(il), ik, ic) = xconst(il, ik) + dcondt(il, ik)*<code class="label">&</code></a>
<a href="null_p.html#convectivetransport_mod" target="origFile"><code class="label">&               </code>delt</a>
            <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop2</code></a>
          <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">illoop2</code></a>
      <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END DO </code><code class="label">icloop</code></a>
    <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="null_p.html#convectivetransport_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CONVECTIVETRANSPORT</code></a>
<code class="keyword">END MODULE </code><code class="funcname">CONVECTIVETRANSPORT_MOD_B</code>
</pre>
</body>
