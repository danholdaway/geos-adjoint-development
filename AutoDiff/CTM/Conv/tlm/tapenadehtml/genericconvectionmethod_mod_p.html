<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!         NASA/GSFC, Software Systems Support Office, Code 610.3         !</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!BOP</code>
<code class="comment">!</code>
<code class="comment">! !MODULE: GenericConvectionMethod_mod </code>
<code class="keyword">MODULE </code><code class="funcname">GENERICCONVECTIONMETHOD_MOD</code>
  <code class="keyword">USE </code><code class="funcname">ESMF</code>
  <code class="keyword">USE </code><code class="funcname">CONVECTIVETRANSPORT_MOD</code>
  <code class="keyword">USE </code><code class="funcname">GMIARRAYBUNDLEPOINTER_MOD</code>
  <code class="keyword">IMPLICIT NONE</code>
  PRIVATE 
  PUBLIC dogenericconvectivetransport
<a name="dogenericconvectivetransport"></a>
<code class="keyword">CONTAINS</code>
  <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT</code>(<code class="vardecl">det_ent</code>, <code class="vardecl">do_downdraft</code>, <code class="vardecl">pbl</code>, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&   </code><code class="vardecl">cldmas</code>, <code class="vardecl">dtrn</code>, <code class="vardecl">eu</code>, <code class="vardecl">ed</code>, <code class="vardecl">md</code>, <code class="vardecl">grid_height</code>, <code class="vardecl">mass</code>, <code class="vardecl">kel</code>, <code class="vardecl">press3e</code>, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&   </code><code class="vardecl">concentration</code>, <code class="vardecl">isfixedconcentration</code>, <code class="vardecl">mcor</code>, <code class="vardecl">tdt</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&   </code><code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code>)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! !INPUT PARAMETER:</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">isfixedconcentration</code>(:)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! flag for doing detrainment then entrainment</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">det_ent</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! flag for doing downdrafts</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">do_downdraft</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! model time step  (s)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">tdt</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! area of each grid box (m^2)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mcor</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! planetary boundary layer thickness (m)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pbl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! convective mass flux in     updraft (kg/m^2/s)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cldmas</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! detrainment rate (DAO:kg/m^2*s, NCAR:s^-1)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dtrn</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! ntrainment into convective updraft (s^-1)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">eu</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! entrainment into convective downdraft (s^-1)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ed</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! convective mass flux in downdraft (kg/m^2/s)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">md</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! grid box height  (m)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">grid_height</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass of air in each grid box (kg)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mass</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! temperature      (degK)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kel</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! atmospheric pressure at the edge of each grid box (mb)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press3e</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>-<code class="constant">1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! species concentration, known at zone centers (mixing ratio)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">concentration</code>(<code class="vardecl">num_species</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! !DEFINED PARAMETERS:</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! threshold below which we treat </code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">mbsth</code>=<code class="constant">1.0d-15</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass fluxes as zero (mb/s)</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mean surface gravity accel. (m/s^2)</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">gmi_g</code>=<code class="constant">9.81d0</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! pascals  per millibar</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">paspmb</code>=<code class="constant">100.00d0</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! This is the interface routine to Convective Transport.  </code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! It formats the gem variables to satisfy the Convective Transport routine.</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!EOP</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!------------------------------------------------------------------------</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!BOC</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">!</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">CHARACTER</code>(<code class="keyword">len</code>=<code class="constant">75</code>) :: <code class="vardecl">err_msg</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">iku</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il</code>, <code class="vardecl">ij</code>, <code class="vardecl">ik</code>, <code class="vardecl">ic</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! gathered index to operate over</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il2g</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">itdt_conv</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">num_conv_steps</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">rnum_conv_steps</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tdt_conv</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xmbsth</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! gathering array</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ideep</code>(<code class="vardecl">ilong</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! index of pbl height</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">pbli</code>(<code class="vardecl">ilong</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! velocity in convective updraft</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">updraft_velocity</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! (m/s)</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! delta pressure between interfaces</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dpi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass detraining from updraft</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass entraining into updraft</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">eui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass flux up</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass flux down</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mdi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! insoluble fraction of tracer</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fracis</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! tracer array including moisture</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">qq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAXVAL</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8</code>, DIMENSION(i2-i1+<code class="constant">1</code>, j2-j1+<code class="constant">1</code>, k2-k1+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result2</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">ideep(:) = <code class="constant">0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">pbli(:) = <code class="constant">0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">dpi(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">dui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">eui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">mui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">mdi(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">fracis(:, :, :) = <code class="constant">0.0d0</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">xmbsth = mbsth</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">updraft_velocity(:) = <code class="constant">0.0d0</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! -----------------------------------------------------------</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! Calculate any needed sub-cycling of the convection operator</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! by comparing the mass flux over the full time step to the</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! mass within the grid box.</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! -----------------------------------------------------------</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">result1 = <code class="funcname">SPREAD</code>(mcor(:, :), <code class="constant">3</code>, k2 - k1 + <code class="constant">1</code>)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">arg1(:, :, :) = tdt*cldmas(:, :, :)*result1/mass(:, :, :)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">result2 = <code class="funcname">MAXVAL</code>(arg1(:, :, :))</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">num_conv_steps = <code class="funcname">INT</code>(result2 + <code class="constant">1.0d0</code>)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">rnum_conv_steps = <code class="funcname">REAL</code>(num_conv_steps, <code class="constant">8</code>)</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">tdt_conv = tdt/rnum_conv_steps</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">ijloop:</code><code class="keyword">DO </code>ij=j1,j2</a>
      <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">il2g = <code class="constant">0</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">illoop:</code><code class="keyword">DO </code>il=i1,i2</a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! Verify that there is convection in the current cell.</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! ----------------------------------------------------</code></a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">result1 = <code class="funcname">MAXVAL</code>(cldmas(il, ij, :))</a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">IF</code> (result1 .GE. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">il2g = il2g + <code class="constant">1</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">ideep(il2g) = il</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">dpi(il2g, :) = (press3e(il, ij, k2-<code class="constant">1</code>:k1-<code class="constant">1</code>:-<code class="constant">1</code>)-press3e(il, ij, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&           </code>k2:k1:-<code class="constant">1</code>))*paspmb</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">mui(il2g, :) = cldmas(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">WHERE </code>(<code class="constant">0.0d0 </code>.LT. cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas(il, ij<code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&             </code>, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)) </a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas<code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&             </code>(il, ij, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">ELSEWHERE</code></a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = <code class="constant">0.0d0</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END WHERE</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">eui(il2g, :) = eui(il2g, :)*gmi_g</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">IF</code> (det_ent) dui(il2g, :) = dtrn(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO </code><code class="label">illoop</code></a>
      <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">IF</code> (il2g .NE. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">fracis(:, :, :) = <code class="constant">1.0d0</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! ----------------------------------------------------------------</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! Find the index of the top of the planetary boundary layer (pbl).</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! Convection will assume well mixed tracers below that level.</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="comment">! ----------------------------------------------------------------</code></a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">pbli(il) = <code class="constant">0</code></a>
   <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">ikloop:</code><code class="keyword">DO </code>ik=k1,k2</a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">IF</code> (pbl(ideep(il), ij) .LT. <code class="funcname">SUM</code>(grid_height(ideep(il), ij, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&               </code>k1:ik))) <code class="keyword">GOTO </code><code class="label">100</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO </code><code class="label">ikloop</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">110</code></a>
 <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">100      </code>pbli(il) = ik</a>
 <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">110      </code><code class="keyword">IF</code> (pbli(il) .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">pbli(il) = k2 - pbli(il)</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">itdtcloop:</code><code class="keyword">DO </code>itdt_conv=<code class="constant">1</code>,num_conv_steps</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">qq(:, k2:k1:-<code class="constant">1</code>, ic) = concentration(ic)%parray3d(:, ij, k1:<code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&             </code>k2)</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO</code></a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">CALL </code><code class="funcname">CONVECTIVETRANSPORT</code>(il2g, tdt_conv, xmbsth, ideep, pbli, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&                            </code>dui, eui, mui, mdi, dpi, fracis, qq, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&                            </code>isfixedconcentration, i1, i2, k1, k2, ilong<code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&                            </code>, num_species)</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
            <a href="null.html#genericconvectionmethod_mod_d" target="diffFile">concentration(ic)%parray3d(:, ij, k1:k2) = qq(:, k2:k1:-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">&             </code>ic)</a>
          <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO </code><code class="label">itdtcloop</code></a>
      <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END DO </code><code class="label">ijloop</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">RETURN</code></a>
 <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="label">120 </code>err_msg = <code class="string">'Could not find pbl in doGenericConvectiveTransport.'</code></a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">PRINT*</code>, err_msg</a>
    <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">STOP</code></a>
  <a href="null.html#genericconvectionmethod_mod_d" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT</code></a>
<code class="keyword">END MODULE </code><code class="funcname">GENERICCONVECTIONMETHOD_MOD</code>
</pre>
</body>
