<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code>
<code class="comment">!  Tapenade 3.12 (r6213) - 13 Oct 2016 10:30</code>
<code class="comment">!</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!         NASA/GSFC, Software Systems Support Office, Code 610.3         !</code>
<code class="comment">!-------------------------------------------------------------------------</code>
<code class="comment">!BOP</code>
<code class="comment">!</code>
<code class="comment">! !MODULE: GenericConvectionMethod_mod </code>
<code class="keyword">MODULE </code><code class="funcname">GENERICCONVECTIONMETHOD_MOD_D</code>
  <code class="keyword">USE </code><code class="funcname">ESMF</code>
  <code class="keyword">USE </code><code class="funcname">CONVECTIVETRANSPORT_MOD_D</code>
  <code class="keyword">USE </code><code class="funcname">GMIARRAYBUNDLEPOINTER_MOD_D</code>
  <code class="keyword">IMPLICIT NONE</code>
  PRIVATE 
  PUBLIC dogenericconvectivetransport
  PUBLIC dogenericconvectivetransport_tlm
<a name="dogenericconvectivetransport_tlm"></a>
<code class="keyword">CONTAINS</code>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!  Differentiation of dogenericconvectivetransport in forward (tangent) mode:</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!   variations   of useful results: *(concentration.parray3d)</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!   with respect to varying inputs: *(concentration.parray3d)</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!   RW status of diff variables: *(concentration.parray3d):in-out</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!   Plus diff mem management of: concentration.parray3d:in</code></a>
  <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT_TLM</code>(<code class="vardecl">det_ent</code>, <code class="vardecl">do_downdraft</code>, <code class="vardecl">pbl</code><code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">cldmas</code>, <code class="vardecl">dtrn</code>, <code class="vardecl">eu</code>, <code class="vardecl">ed</code>, <code class="vardecl">md</code>, <code class="vardecl">grid_height</code>, <code class="vardecl">mass</code>, <code class="vardecl">kel</code>, <code class="vardecl">press3e</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code><code class="vardecl">concentration</code>, <code class="vardecl">concentration_tl</code>, <code class="vardecl">isfixedconcentration</code>, <code class="vardecl">mcor</code>, <code class="vardecl">tdt</code>, <code class="vardecl">i1</code><code class="label">&</code></a>
<a name="dogenericconvectivetransport_tlmi115"></a><a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#genericconvectionmethod_modi115" target="origFile"><code class="comment">!</code></a>
<a name="dogenericconvectivetransport_tlmi116"></a><a href="null_p.html#genericconvectionmethod_modi115" target="origFile"><code class="comment">! !INPUT PARAMETER:</code></a>
<a name="dogenericconvectivetransport_tlmi117"></a>    <a href="null_p.html#genericconvectionmethod_modi115" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code></a>
<a name="dogenericconvectivetransport_tlmi118"></a>    <a href="null_p.html#genericconvectionmethod_modi116" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code></a>
    <a href="null_p.html#genericconvectionmethod_modi117" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">isfixedconcentration</code>(:)</a>
<a name="dogenericconvectivetransport_tlmi119"></a><a href="null_p.html#genericconvectionmethod_modi118" target="origFile"><code class="comment">! flag for doing detrainment then entrainment</code></a>
    <a href="null_p.html#genericconvectionmethod_modi118" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">det_ent</code></a>
<a name="dogenericconvectivetransport_tlmi120"></a><a href="null_p.html#genericconvectionmethod_modi119" target="origFile"><code class="comment">! flag for doing downdrafts</code></a>
    <a href="null_p.html#genericconvectionmethod_modi119" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">do_downdraft</code></a>
<a name="dogenericconvectivetransport_tlmi121"></a><a href="null_p.html#genericconvectionmethod_modi120" target="origFile"><code class="comment">! model time step  (s)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi120" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">tdt</code></a>
<a name="dogenericconvectivetransport_tlmi122"></a><a href="null_p.html#genericconvectionmethod_modi121" target="origFile"><code class="comment">! area of each grid box (m^2)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi121" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mcor</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a name="dogenericconvectivetransport_tlmi123"></a><a href="null_p.html#genericconvectionmethod_modi122" target="origFile"><code class="comment">! planetary boundary layer thickness (m)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi122" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pbl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a name="dogenericconvectivetransport_tlmi124"></a><a href="null_p.html#genericconvectionmethod_modi123" target="origFile"><code class="comment">! convective mass flux in     updraft (kg/m^2/s)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi123" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cldmas</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi125"></a><a href="null_p.html#genericconvectionmethod_modi124" target="origFile"><code class="comment">! detrainment rate (DAO:kg/m^2*s, NCAR:s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi124" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dtrn</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi126"></a><a href="null_p.html#genericconvectionmethod_modi125" target="origFile"><code class="comment">! ntrainment into convective updraft (s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi125" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">eu</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi127"></a><a href="null_p.html#genericconvectionmethod_modi126" target="origFile"><code class="comment">! entrainment into convective downdraft (s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi126" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ed</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi128"></a><a href="null_p.html#genericconvectionmethod_modi127" target="origFile"><code class="comment">! convective mass flux in downdraft (kg/m^2/s)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi127" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">md</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi129"></a><a href="null_p.html#genericconvectionmethod_modi128" target="origFile"><code class="comment">! grid box height  (m)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi128" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">grid_height</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi130"></a><a href="null_p.html#genericconvectionmethod_modi129" target="origFile"><code class="comment">! mass of air in each grid box (kg)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi129" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mass</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi131"></a><a href="null_p.html#genericconvectionmethod_modi130" target="origFile"><code class="comment">! temperature      (degK)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi130" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kel</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi132"></a><a href="null_p.html#genericconvectionmethod_modi131" target="origFile"><code class="comment">! atmospheric pressure at the edge of each grid box (mb)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi131" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press3e</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>-<code class="constant">1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_modi132" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_modi132" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#genericconvectionmethod_modi132" target="origFile"><code class="comment">! species concentration, known at zone centers (mixing ratio)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi132" target="origFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">concentration</code>(<code class="vardecl">num_species</code>)</a>
<a name="dogenericconvectivetransport_tlmi133"></a>    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">concentration_tl</code>(<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code><code class="vardecl">num_species</code>)</a>
<a href="null_p.html#genericconvectionmethod_modi133" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_modi133" target="origFile"><code class="comment">! !DEFINED PARAMETERS:</code></a>
<a name="dogenericconvectivetransport_tlmi134"></a><a href="null_p.html#genericconvectionmethod_modi133" target="origFile"><code class="comment">! threshold below which we treat </code></a>
    <a href="null_p.html#genericconvectionmethod_modi133" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">mbsth</code>=<code class="constant">1.0d-15</code></a>
<a href="null_p.html#genericconvectionmethod_modi134" target="origFile"><code class="comment">! mass fluxes as zero (mb/s)</code></a>
<a name="dogenericconvectivetransport_tlmi135"></a><a href="null_p.html#genericconvectionmethod_modi134" target="origFile"><code class="comment">! mean surface gravity accel. (m/s^2)</code></a>
    <a href="null_p.html#genericconvectionmethod_modi134" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">gmi_g</code>=<code class="constant">9.81d0</code></a>
<a name="dogenericconvectivetransport_tlmi136"></a><a href="null_p.html#genericconvectionmethod_modi135" target="origFile"><code class="comment">! pascals  per millibar</code></a>
    <a href="null_p.html#genericconvectionmethod_modi135" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">paspmb</code>=<code class="constant">100.00d0</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">! This is the interface routine to Convective Transport.  </code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">! It formats the gem variables to satisfy the Convective Transport routine.</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!------------------------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!BOC</code></a>
<a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">!</code></a>
<a name="dogenericconvectivetransport_tlmi137"></a><a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
<a name="dogenericconvectivetransport_tlmi138"></a>    <a href="null_p.html#genericconvectionmethod_modi136" target="origFile"><code class="typename">CHARACTER</code>(<code class="keyword">len</code>=<code class="constant">75</code>) :: <code class="vardecl">err_msg</code></a>
<a name="dogenericconvectivetransport_tlmi139"></a>    <a href="null_p.html#genericconvectionmethod_modi137" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">iku</code></a>
    <a href="null_p.html#genericconvectionmethod_modi138" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il</code>, <code class="vardecl">ij</code>, <code class="vardecl">ik</code>, <code class="vardecl">ic</code></a>
<a name="dogenericconvectivetransport_tlmi140"></a><a href="null_p.html#genericconvectionmethod_modi139" target="origFile"><code class="comment">! gathered index to operate over</code></a>
<a name="dogenericconvectivetransport_tlmi141"></a>    <a href="null_p.html#genericconvectionmethod_modi139" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il2g</code></a>
<a name="dogenericconvectivetransport_tlmi142"></a>    <a href="null_p.html#genericconvectionmethod_modi140" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">itdt_conv</code></a>
<a name="dogenericconvectivetransport_tlmi143"></a>    <a href="null_p.html#genericconvectionmethod_modi141" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">num_conv_steps</code></a>
<a name="dogenericconvectivetransport_tlmi144"></a>    <a href="null_p.html#genericconvectionmethod_modi142" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">rnum_conv_steps</code></a>
<a name="dogenericconvectivetransport_tlmi145"></a>    <a href="null_p.html#genericconvectionmethod_modi143" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tdt_conv</code></a>
    <a href="null_p.html#genericconvectionmethod_modi144" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xmbsth</code></a>
<a name="dogenericconvectivetransport_tlmi146"></a><a href="null_p.html#genericconvectionmethod_modi145" target="origFile"><code class="comment">! gathering array</code></a>
    <a href="null_p.html#genericconvectionmethod_modi145" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ideep</code>(<code class="vardecl">ilong</code>)</a>
<a name="dogenericconvectivetransport_tlmi147"></a><a href="null_p.html#genericconvectionmethod_modi146" target="origFile"><code class="comment">! index of pbl height</code></a>
    <a href="null_p.html#genericconvectionmethod_modi146" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">pbli</code>(<code class="vardecl">ilong</code>)</a>
<a name="dogenericconvectivetransport_tlmi148"></a><a href="null_p.html#genericconvectionmethod_modi147" target="origFile"><code class="comment">! velocity in convective updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_modi147" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">updraft_velocity</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
<a href="null_p.html#genericconvectionmethod_modi148" target="origFile"><code class="comment">! (m/s)</code></a>
<a name="dogenericconvectivetransport_tlmi149"></a><a href="null_p.html#genericconvectionmethod_modi148" target="origFile"><code class="comment">! delta pressure between interfaces</code></a>
    <a href="null_p.html#genericconvectionmethod_modi148" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dpi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi150"></a><a href="null_p.html#genericconvectionmethod_modi149" target="origFile"><code class="comment">! mass detraining from updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_modi149" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi151"></a><a href="null_p.html#genericconvectionmethod_modi150" target="origFile"><code class="comment">! mass entraining into updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_modi150" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">eui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi152"></a><a href="null_p.html#genericconvectionmethod_modi151" target="origFile"><code class="comment">! mass flux up</code></a>
    <a href="null_p.html#genericconvectionmethod_modi151" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi153"></a><a href="null_p.html#genericconvectionmethod_modi152" target="origFile"><code class="comment">! mass flux down</code></a>
    <a href="null_p.html#genericconvectionmethod_modi152" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mdi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a name="dogenericconvectivetransport_tlmi154"></a><a href="null_p.html#genericconvectionmethod_modi153" target="origFile"><code class="comment">! insoluble fraction of tracer</code></a>
    <a href="null_p.html#genericconvectionmethod_modi153" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fracis</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
<a href="null_p.html#genericconvectionmethod_modi154" target="origFile"><code class="comment">! tracer array including moisture</code></a>
<a name="dogenericconvectivetransport_tlmi155"></a>    <a href="null_p.html#genericconvectionmethod_modi154" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">qq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
<a name="dogenericconvectivetransport_tlmi156"></a>    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">qq_tl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
<a name="dogenericconvectivetransport_tlmi157"></a>    <a href="null_p.html#genericconvectionmethod_modi155" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAXVAL</code></a>
<a name="dogenericconvectivetransport_tlmi158"></a>    <a href="null_p.html#genericconvectionmethod_modi156" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
<a name="dogenericconvectivetransport_tlmi159"></a>    <a href="null_p.html#genericconvectionmethod_modi157" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
<a name="dogenericconvectivetransport_tlmi160"></a>    <a href="null_p.html#genericconvectionmethod_modi158" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="dogenericconvectivetransport_tlmi161"></a>    <a href="null_p.html#genericconvectionmethod_modi159" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
<a name="dogenericconvectivetransport_tlmi162"></a>    <a href="null_p.html#genericconvectionmethod_modi160" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1</code></a>
<a name="dogenericconvectivetransport_tlmi163"></a>    <a href="null_p.html#genericconvectionmethod_modi161" target="origFile"><code class="typename">REAL*8</code>, DIMENSION(i2-i1+<code class="constant">1</code>, j2-j1+<code class="constant">1</code>, k2-k1+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
<a name="dogenericconvectivetransport_tlmi164"></a>    <a href="null_p.html#genericconvectionmethod_modi162" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result2</code></a>
<a name="dogenericconvectivetransport_tlmi165"></a>    <a href="null_p.html#genericconvectionmethod_modi163" target="origFile">ideep(:) = <code class="constant">0</code></a>
<a name="dogenericconvectivetransport_tlmi166"></a>    <a href="null_p.html#genericconvectionmethod_modi164" target="origFile">pbli(:) = <code class="constant">0</code></a>
<a name="dogenericconvectivetransport_tlmi167"></a>    <a href="null_p.html#genericconvectionmethod_modi165" target="origFile">dpi(:, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi168"></a>    <a href="null_p.html#genericconvectionmethod_modi166" target="origFile">dui(:, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi169"></a>    <a href="null_p.html#genericconvectionmethod_modi167" target="origFile">eui(:, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi170"></a>    <a href="null_p.html#genericconvectionmethod_modi168" target="origFile">mui(:, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi171"></a>    <a href="null_p.html#genericconvectionmethod_modi169" target="origFile">mdi(:, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi172"></a>    <a href="null_p.html#genericconvectionmethod_modi170" target="origFile">fracis(:, :, :) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi173"></a>    <a href="null_p.html#genericconvectionmethod_modi171" target="origFile">xmbsth = mbsth</a>
    <a href="null_p.html#genericconvectionmethod_modi172" target="origFile">updraft_velocity(:) = <code class="constant">0.0d0</code></a>
<a href="null_p.html#genericconvectionmethod_modi173" target="origFile"><code class="comment">! -----------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_modi173" target="origFile"><code class="comment">! Calculate any needed sub-cycling of the convection operator</code></a>
<a href="null_p.html#genericconvectionmethod_modi173" target="origFile"><code class="comment">! by comparing the mass flux over the full time step to the</code></a>
<a href="null_p.html#genericconvectionmethod_modi173" target="origFile"><code class="comment">! mass within the grid box.</code></a>
<a name="dogenericconvectivetransport_tlmi174"></a><a href="null_p.html#genericconvectionmethod_modi173" target="origFile"><code class="comment">! -----------------------------------------------------------</code></a>
<a name="dogenericconvectivetransport_tlmi175"></a>    <a href="null_p.html#genericconvectionmethod_modi173" target="origFile">result1 = <code class="funcname">SPREAD</code>(mcor(:, :), <code class="constant">3</code>, k2 - k1 + <code class="constant">1</code>)</a>
<a name="dogenericconvectivetransport_tlmi176"></a>    <a href="null_p.html#genericconvectionmethod_modi174" target="origFile">arg1(:, :, :) = tdt*cldmas(:, :, :)*result1/mass(:, :, :)</a>
<a name="dogenericconvectivetransport_tlmi177"></a>    <a href="null_p.html#genericconvectionmethod_modi175" target="origFile">result2 = <code class="funcname">MAXVAL</code>(arg1(:, :, :))</a>
<a name="dogenericconvectivetransport_tlmi178"></a>    <a href="null_p.html#genericconvectionmethod_modi176" target="origFile">num_conv_steps = <code class="funcname">INT</code>(result2 + <code class="constant">1.0d0</code>)</a>
    <a href="null_p.html#genericconvectionmethod_modi177" target="origFile">rnum_conv_steps = <code class="funcname">REAL</code>(num_conv_steps, <code class="constant">8</code>)</a>
<a name="dogenericconvectivetransport_tlmi179"></a>    <a href="null_p.html#genericconvectionmethod_modi178" target="origFile">tdt_conv = tdt/rnum_conv_steps</a>
<a name="dogenericconvectivetransport_tlmi180"></a>    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">qq_tl = <code class="constant">0.0_8</code></a>
<a name="dogenericconvectivetransport_tlmi193"></a><a href="null_p.html#genericconvectionmethod_modi179" target="origFile"><code class="label">ijloop:</code><code class="keyword">DO </code>ij=j1,j2</a>
<a name="dogenericconvectivetransport_tlmi181"></a>      <a href="null_p.html#genericconvectionmethod_modi180" target="origFile">il2g = <code class="constant">0</code></a>
<a href="null_p.html#genericconvectionmethod_modi193" target="origFile"><code class="label">illoop:</code><code class="keyword">DO </code>il=i1,i2</a>
<a href="null_p.html#genericconvectionmethod_modi181" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_modi181" target="origFile"><code class="comment">! Verify that there is convection in the current cell.</code></a>
<a name="dogenericconvectivetransport_tlmi182"></a><a href="null_p.html#genericconvectionmethod_modi181" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a name="dogenericconvectivetransport_tlmi183"></a>        <a href="null_p.html#genericconvectionmethod_modi181" target="origFile">result1 = <code class="funcname">MAXVAL</code>(cldmas(il, ij, :))</a>
<a name="dogenericconvectivetransport_tlmi184"></a>        <a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="keyword">IF</code> (result1 .GE. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
<a name="dogenericconvectivetransport_tlmi185"></a>          <a href="null_p.html#genericconvectionmethod_modi183" target="origFile">il2g = il2g + <code class="constant">1</code></a>
          <a href="null_p.html#genericconvectionmethod_modi184" target="origFile">ideep(il2g) = il</a>
<a name="dogenericconvectivetransport_tlmi186"></a>          <a href="null_p.html#genericconvectionmethod_modi185" target="origFile">dpi(il2g, :) = (press3e(il, ij, k2-<code class="constant">1</code>:k1-<code class="constant">1</code>:-<code class="constant">1</code>)-press3e(il, ij, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi185" target="origFile"><code class="label">&           </code>k2:k1:-<code class="constant">1</code>))*paspmb</a>
          <a href="null_p.html#genericconvectionmethod_modi186" target="origFile">mui(il2g, :) = cldmas(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
<a name="dogenericconvectivetransport_tlmi188"></a>          <a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="keyword">WHERE </code>(<code class="constant">0.0d0 </code>.LT. cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas(il, ij<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="label">&             </code>, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)) </a>
            <a href="null_p.html#genericconvectionmethod_modi188" target="origFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas<code class="label">&</code></a>
<a name="dogenericconvectivetransport_tlmi189"></a><a href="null_p.html#genericconvectionmethod_modi188" target="origFile"><code class="label">&             </code>(il, ij, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)</a>
          <a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="keyword">ELSEWHERE</code></a>
<a name="dogenericconvectivetransport_tlmi190"></a>            <a href="null_p.html#genericconvectionmethod_modi189" target="origFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = <code class="constant">0.0d0</code></a>
<a name="dogenericconvectivetransport_tlmi192"></a><a name="dogenericconvectivetransport_tlmi191"></a>          <a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="keyword">END WHERE</code></a>
          <a href="null_p.html#genericconvectionmethod_modi190" target="origFile">eui(il2g, :) = eui(il2g, :)*gmi_g</a>
          <a href="null_p.html#genericconvectionmethod_modi191" target="origFile"><code class="keyword">IF</code> (det_ent) </a><a href="null_p.html#genericconvectionmethod_modi192" target="origFile">dui(il2g, :) = dtrn(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
<a name="dogenericconvectivetransport_tlmi194"></a>        <a href="null_p.html#genericconvectionmethod_modi182" target="origFile"><code class="keyword">END IF</code></a>
<a name="dogenericconvectivetransport_tlmi195"></a>      <a href="null_p.html#genericconvectionmethod_modi193" target="origFile"><code class="keyword">END DO </code><code class="label">illoop</code></a>
<a name="dogenericconvectivetransport_tlmi196"></a>      <a href="null_p.html#genericconvectionmethod_modi194" target="origFile"><code class="keyword">IF</code> (il2g .NE. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#genericconvectionmethod_modi195" target="origFile">fracis(:, :, :) = <code class="constant">1.0d0</code></a>
<a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="comment">! ----------------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="comment">! Find the index of the top of the planetary boundary layer (pbl).</code></a>
<a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="comment">! Convection will assume well mixed tracers below that level.</code></a>
<a name="dogenericconvectivetransport_tlmi197"></a><a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="comment">! ----------------------------------------------------------------</code></a>
<a name="dogenericconvectivetransport_tlmi198"></a>        <a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
<a name="dogenericconvectivetransport_tlmi199"></a>          <a href="null_p.html#genericconvectionmethod_modi197" target="origFile">pbli(il) = <code class="constant">0</code></a>
   <a href="null_p.html#genericconvectionmethod_modi198" target="origFile"><code class="label">ikloop:</code><code class="keyword">DO </code>ik=k1,k2</a>
            <a href="null_p.html#genericconvectionmethod_modi199" target="origFile"><code class="keyword">IF</code> (pbl(ideep(il), ij) .LT. <code class="funcname">SUM</code>(grid_height(ideep(il), ij, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi199" target="origFile"><code class="label">&               </code>k1:ik))) <code class="keyword">GOTO </code><code class="label">100</code></a>
<a name="dogenericconvectivetransport_tlmi200"></a>          <a href="null_p.html#genericconvectionmethod_modi198" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop</code></a>
<a name="dogenericconvectivetransport_tlmi201"></a>          <a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="keyword">GOTO </code><code class="label">110</code></a>
 <a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="label">100 </code></a>     <a href="null_p.html#genericconvectionmethod_modi200" target="origFile">pbli(il) = ik</a>
 <a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="label">110 </code></a>     <a href="null_p.html#genericconvectionmethod_modi201" target="origFile"><code class="keyword">IF</code> (pbli(il) .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="dogenericconvectivetransport_tlmi202"></a>            <a href="null_p.html#genericconvectionmethod_modi201" target="origFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
          <a href="null_p.html#genericconvectionmethod_modi201" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#genericconvectionmethod_modi202" target="origFile">pbli(il) = k2 - pbli(il)</a>
<a name="dogenericconvectivetransport_tlmi208"></a>          <a href="null_p.html#genericconvectionmethod_modi201" target="origFile"><code class="keyword">END IF</code></a>
<a name="dogenericconvectivetransport_tlmi204"></a>        <a href="null_p.html#genericconvectionmethod_modi196" target="origFile"><code class="keyword">END DO</code></a>
<a name="dogenericconvectivetransport_tlmi203"></a><a href="null_p.html#genericconvectionmethod_modi208" target="origFile"><code class="label">itdtcloop:</code><code class="keyword">DO </code>itdt_conv=<code class="constant">1</code>,num_conv_steps</a>
          <a href="null_p.html#genericconvectionmethod_modi204" target="origFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
<a name="dogenericconvectivetransport_tlmi203"></a>            <a href="null_p.html#genericconvectionmethod_modi203" target="origFile">qq_tl(:, k2:k1:-<code class="constant">1</code>, ic) = concentration_tl(ic)%parray3d(:, ij<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi203" target="origFile"><code class="label">&             </code>, k1:k2)</a>
            <a href="null_p.html#genericconvectionmethod_modi203" target="origFile">qq(:, k2:k1:-<code class="constant">1</code>, ic) = concentration(ic)%parray3d(:, ij, k1:<code class="label">&</code></a>
<a name="dogenericconvectivetransport_tlmi205"></a><a href="null_p.html#genericconvectionmethod_modi203" target="origFile"><code class="label">&             </code>k2)</a>
          <a href="null_p.html#genericconvectionmethod_modi204" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#genericconvectionmethod_modi205" target="origFile"><code class="keyword">CALL </code><code class="funcname">CONVECTIVETRANSPORT_TLM</code>(il2g, tdt_conv, xmbsth, ideep, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi205" target="origFile"><code class="label">&                                </code>pbli, dui, eui, mui, mdi, dpi, fracis, <code class="label">&</code></a>
<a name="dogenericconvectivetransport_tlmi207"></a><a href="null_p.html#genericconvectionmethod_modi205" target="origFile"><code class="label">&                                </code>qq, qq_tl, isfixedconcentration, i1, i2<code class="label">&</code></a>
<a name="dogenericconvectivetransport_tlmi206"></a><a href="null_p.html#genericconvectionmethod_modi205" target="origFile"><code class="label">&                                </code>, k1, k2, ilong, num_species)</a>
          <a href="null_p.html#genericconvectionmethod_modi207" target="origFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
<a name="dogenericconvectivetransport_tlmi206"></a>            <a href="null_p.html#genericconvectionmethod_modi206" target="origFile">concentration_tl(ic)%parray3d(:, ij, k1:k2) = qq_tl(:, k2:k1<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi206" target="origFile"><code class="label">&             </code>:-<code class="constant">1</code>, ic)</a>
            <a href="null_p.html#genericconvectionmethod_modi206" target="origFile">concentration(ic)%parray3d(:, ij, k1:k2) = qq(:, k2:k1:-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_modi206" target="origFile"><code class="label">&             </code>ic)</a>
          <a href="null_p.html#genericconvectionmethod_modi207" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#genericconvectionmethod_modi208" target="origFile"><code class="keyword">END DO </code><code class="label">itdtcloop</code></a>
<a name="dogenericconvectivetransport_tlmi209"></a>      <a href="null_p.html#genericconvectionmethod_modi194" target="origFile"><code class="keyword">END IF</code></a>
<a name="dogenericconvectivetransport_tlmi210"></a>    <a href="null_p.html#genericconvectionmethod_modi179" target="origFile"><code class="keyword">END DO </code><code class="label">ijloop</code></a>
<a name="dogenericconvectivetransport_tlmi211"></a>    <a href="null_p.html#genericconvectionmethod_modi209" target="origFile"><code class="keyword">RETURN</code></a>
<a name="dogenericconvectivetransport_tlmi212"></a> <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">120 </code></a><a href="null_p.html#genericconvectionmethod_modi210" target="origFile">err_msg = <code class="string">'Could not find pbl in doGenericConvectiveTransport.'</code></a>
    <a href="null_p.html#genericconvectionmethod_modi211" target="origFile"><code class="keyword">PRINT*</code>, err_msg</a>
<a name="dogenericconvectivetransport"></a>    <a href="null_p.html#genericconvectionmethod_modi212" target="origFile"><code class="keyword">STOP</code></a>
  <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT_TLM</code></a>
  <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT</code>(<code class="vardecl">det_ent</code>, <code class="vardecl">do_downdraft</code>, <code class="vardecl">pbl</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code><code class="vardecl">cldmas</code>, <code class="vardecl">dtrn</code>, <code class="vardecl">eu</code>, <code class="vardecl">ed</code>, <code class="vardecl">md</code>, <code class="vardecl">grid_height</code>, <code class="vardecl">mass</code>, <code class="vardecl">kel</code>, <code class="vardecl">press3e</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code><code class="vardecl">concentration</code>, <code class="vardecl">isfixedconcentration</code>, <code class="vardecl">mcor</code>, <code class="vardecl">tdt</code>, <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&   </code><code class="vardecl">k2</code>, <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! !INPUT PARAMETER:</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">j1</code>, <code class="vardecl">j2</code>, <code class="vardecl">k1</code>, <code class="vardecl">k2</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ilong</code>, <code class="vardecl">ivert</code>, <code class="vardecl">num_species</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">isfixedconcentration</code>(:)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! flag for doing detrainment then entrainment</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">det_ent</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! flag for doing downdrafts</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">do_downdraft</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! model time step  (s)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">tdt</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! area of each grid box (m^2)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mcor</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! planetary boundary layer thickness (m)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pbl</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! convective mass flux in     updraft (kg/m^2/s)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cldmas</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! detrainment rate (DAO:kg/m^2*s, NCAR:s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dtrn</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! ntrainment into convective updraft (s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">eu</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! entrainment into convective downdraft (s^-1)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ed</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! convective mass flux in downdraft (kg/m^2/s)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">md</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! grid box height  (m)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">grid_height</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass of air in each grid box (kg)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">mass</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! temperature      (degK)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kel</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! atmospheric pressure at the edge of each grid box (mb)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press3e</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">j1</code>:<code class="vardecl">j2</code>, <code class="vardecl">k1</code>-<code class="constant">1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! !INPUT/OUTPUT PARAMETERS:</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! species concentration, known at zone centers (mixing ratio)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">TYPE(T_GMIARRAYBUNDLE)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">concentration</code>(<code class="vardecl">num_species</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! !DEFINED PARAMETERS:</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! threshold below which we treat </code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">mbsth</code>=<code class="constant">1.0d-15</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass fluxes as zero (mb/s)</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mean surface gravity accel. (m/s^2)</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">gmi_g</code>=<code class="constant">9.81d0</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! pascals  per millibar</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">paspmb</code>=<code class="constant">100.00d0</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! !DESCRIPTION:</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! This is the interface routine to Convective Transport.  </code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! It formats the gem variables to satisfy the Convective Transport routine.</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!EOP</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!------------------------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!BOC</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">!</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! !LOCAL VARIABLES:</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">CHARACTER</code>(<code class="keyword">len</code>=<code class="constant">75</code>) :: <code class="vardecl">err_msg</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">iku</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il</code>, <code class="vardecl">ij</code>, <code class="vardecl">ik</code>, <code class="vardecl">ic</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! gathered index to operate over</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">il2g</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">itdt_conv</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">num_conv_steps</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">rnum_conv_steps</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tdt_conv</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xmbsth</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! gathering array</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ideep</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! index of pbl height</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">pbli</code>(<code class="vardecl">ilong</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! velocity in convective updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">updraft_velocity</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! (m/s)</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! delta pressure between interfaces</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dpi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass detraining from updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass entraining into updraft</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">eui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass flux up</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mui</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass flux down</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mdi</code>(<code class="vardecl">ilong</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! insoluble fraction of tracer</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fracis</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! tracer array including moisture</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">qq</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">k1</code>:<code class="vardecl">k2</code>, <code class="vardecl">num_species</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAXVAL</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result1</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8</code>, DIMENSION(i2-i1+<code class="constant">1</code>, j2-j1+<code class="constant">1</code>, k2-k1+<code class="constant">1</code>) :: <code class="vardecl">arg1</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">result2</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">ideep(:) = <code class="constant">0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">pbli(:) = <code class="constant">0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">dpi(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">dui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">eui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">mui(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">mdi(:, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">fracis(:, :, :) = <code class="constant">0.0d0</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">xmbsth = mbsth</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">updraft_velocity(:) = <code class="constant">0.0d0</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! -----------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! Calculate any needed sub-cycling of the convection operator</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! by comparing the mass flux over the full time step to the</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! mass within the grid box.</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! -----------------------------------------------------------</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">result1 = <code class="funcname">SPREAD</code>(mcor(:, :), <code class="constant">3</code>, k2 - k1 + <code class="constant">1</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">arg1(:, :, :) = tdt*cldmas(:, :, :)*result1/mass(:, :, :)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">result2 = <code class="funcname">MAXVAL</code>(arg1(:, :, :))</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">num_conv_steps = <code class="funcname">INT</code>(result2 + <code class="constant">1.0d0</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">rnum_conv_steps = <code class="funcname">REAL</code>(num_conv_steps, <code class="constant">8</code>)</a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile">tdt_conv = tdt/rnum_conv_steps</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">ijloop:</code><code class="keyword">DO </code>ij=j1,j2</a>
      <a href="null_p.html#genericconvectionmethod_mod" target="origFile">il2g = <code class="constant">0</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">illoop:</code><code class="keyword">DO </code>il=i1,i2</a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! Verify that there is convection in the current cell.</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! ----------------------------------------------------</code></a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile">result1 = <code class="funcname">MAXVAL</code>(cldmas(il, ij, :))</a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IF</code> (result1 .GE. <code class="constant">0.0d0</code>) <code class="keyword">THEN</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">il2g = il2g + <code class="constant">1</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">ideep(il2g) = il</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">dpi(il2g, :) = (press3e(il, ij, k2-<code class="constant">1</code>:k1-<code class="constant">1</code>:-<code class="constant">1</code>)-press3e(il, ij, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&           </code>k2:k1:-<code class="constant">1</code>))*paspmb</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">mui(il2g, :) = cldmas(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">WHERE </code>(<code class="constant">0.0d0 </code>.LT. cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas(il, ij<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&             </code>, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)) </a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = cldmas(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>) - cldmas<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&             </code>(il, ij, k2-<code class="constant">2</code>:k1:-<code class="constant">1</code>) + dtrn(il, ij, k2-<code class="constant">1</code>:k1+<code class="constant">1</code>:-<code class="constant">1</code>)</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">ELSEWHERE</code></a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">eui(il2g, k1+<code class="constant">1</code>:k2-<code class="constant">1</code>) = <code class="constant">0.0d0</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END WHERE</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">eui(il2g, :) = eui(il2g, :)*gmi_g</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IF</code> (det_ent) dui(il2g, :) = dtrn(il, ij, k2:k1:-<code class="constant">1</code>)*gmi_g</a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END IF</code></a>
      <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO </code><code class="label">illoop</code></a>
      <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IF</code> (il2g .NE. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile">fracis(:, :, :) = <code class="constant">1.0d0</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! ----------------------------------------------------------------</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! Find the index of the top of the planetary boundary layer (pbl).</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! Convection will assume well mixed tracers below that level.</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="comment">! ----------------------------------------------------------------</code></a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">DO </code>il=<code class="constant">1</code>,il2g</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile">pbli(il) = <code class="constant">0</code></a>
   <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">ikloop:</code><code class="keyword">DO </code>ik=k1,k2</a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">IF</code> (pbl(ideep(il), ij) .LT. <code class="funcname">SUM</code>(grid_height(ideep(il), ij, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&               </code>k1:ik))) <code class="keyword">THEN</code></a>
              <a href="null_p.html#genericconvectionmethod_mod" target="origFile">pbli(il) = ik</a>
              <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">GOTO </code><code class="label">100</code></a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END IF</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO </code><code class="label">ikloop</code></a>
 <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">100      </code><code class="keyword">IF</code> (pbli(il) .EQ. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">err_msg = <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&             </code><code class="string">'Could not find pbl in doGenericConvectiveTransport.'</code></a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">PRINT*</code>, err_msg</a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">STOP</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">pbli(il) = k2 - pbli(il)</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END IF</code></a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">itdtcloop:</code><code class="keyword">DO </code>itdt_conv=<code class="constant">1</code>,num_conv_steps</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">qq(:, k2:k1:-<code class="constant">1</code>, ic) = concentration(ic)%parray3d(:, ij, k1:<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&             </code>k2)</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO</code></a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">CALL </code><code class="funcname">CONVECTIVETRANSPORT</code>(il2g, tdt_conv, xmbsth, ideep, pbli, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&                            </code>dui, eui, mui, mdi, dpi, fracis, qq, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&                            </code>isfixedconcentration, i1, i2, k1, k2, ilong<code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&                            </code>, num_species)</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">DO </code>ic=<code class="constant">1</code>,num_species</a>
            <a href="null_p.html#genericconvectionmethod_mod" target="origFile">concentration(ic)%parray3d(:, ij, k1:k2) = qq(:, k2:k1:-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="label">&             </code>ic)</a>
          <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO</code></a>
        <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO </code><code class="label">itdtcloop</code></a>
      <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END IF</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END DO </code><code class="label">ijloop</code></a>
    <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="null_p.html#genericconvectionmethod_mod" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">DOGENERICCONVECTIVETRANSPORT</code></a>
<code class="keyword">END MODULE </code><code class="funcname">GENERICCONVECTIONMETHOD_MOD_D</code>
</pre>
</body>
