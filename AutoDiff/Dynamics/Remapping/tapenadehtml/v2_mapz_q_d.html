<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code>
<a name="v2_mapz_q_d"></a><code class="comment">!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53</code>
<code class="comment">!</code>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="comment">!  Differentiation of v2_mapz_q in forward (tangent) mode:</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="comment">!   variations   of useful results: q2</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="comment">!   with respect to varying inputs: pe1 pe2 dp1 q2 q4</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="comment">!   RW status of diff variables: pe1:in pe2:in dp1:in q2:in-out</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="comment">!                q4:in</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">V2_MAPZ_Q_D</code>(<code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">km</code>, <code class="vardecl">kn</code>, <code class="vardecl">pe1</code>, <code class="vardecl">pe1d</code>, <code class="vardecl">pe2</code>, <code class="vardecl">pe2d</code>, <code class="vardecl">dp1</code>, <code class="vardecl">dp1d</code>, <code class="label">&</code></a>
<a name="v2_mapz_q_di0"></a><a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="label">& </code><code class="vardecl">dp2</code>, <code class="vardecl">q4</code>, <code class="vardecl">q4d</code>, <code class="vardecl">q2</code>, <code class="vardecl">q2d</code>)</a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="v2_mapz_q_di1"></a><a href="v2_mapz_q.html#v2_mapz_qi0" target="origFile"><code class="comment">!Inputs</code></a>
  <a href="v2_mapz_q.html#v2_mapz_qi0" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">km</code>, <code class="vardecl">kn</code></a>
<a name="v2_mapz_q_di2"></a>  <a href="v2_mapz_q.html#v2_mapz_qi1" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>), <code class="vardecl">pe2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>+<code class="constant">1</code>)</a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe1d</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>), <code class="vardecl">pe2d</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>+<code class="constant">1</code>)</a>
<a name="v2_mapz_q_di3"></a>  <a href="v2_mapz_q.html#v2_mapz_qi2" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>), <code class="vardecl">dp2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp1d</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a name="v2_mapz_q_di4"></a>  <a href="v2_mapz_q.html#v2_mapz_qi3" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q4d</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="v2_mapz_q.html#v2_mapz_qi4" target="origFile"><code class="comment">!Outputs</code></a>
<a name="v2_mapz_q_di5"></a>  <a href="v2_mapz_q.html#v2_mapz_qi4" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2d</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a name="v2_mapz_q_di6"></a><a href="v2_mapz_q.html#v2_mapz_qi5" target="origFile"><code class="comment">!Locals</code></a>
  <a href="v2_mapz_q.html#v2_mapz_qi5" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k0</code>, <code class="vardecl">k</code>, <code class="vardecl">i</code>, <code class="vardecl">l</code>, <code class="vardecl">m</code></a>
<a name="v2_mapz_q_di7"></a>  <a href="v2_mapz_q.html#v2_mapz_qi6" target="origFile"><code class="typename">REAL </code>:: <code class="vardecl">pl</code>, <code class="vardecl">pr</code>, <code class="vardecl">qsum</code>, <code class="vardecl">dp</code>, <code class="vardecl">esl</code></a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="typename">REAL </code>:: <code class="vardecl">pld</code>, <code class="vardecl">prd</code>, <code class="vardecl">qsumd</code>, <code class="vardecl">dpd</code>, <code class="vardecl">esld</code></a>
<a name="v2_mapz_q_di26"></a>  <a href="v2_mapz_q.html#v2_mapz_qi7" target="origFile"><code class="typename">REAL</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">r3</code>=<code class="constant">1.</code>/<code class="constant">3.</code>, <code class="vardecl">r23</code>=<code class="constant">2.</code>/<code class="constant">3.</code></a>
  <a href="v2_mapz_q.html#v2_mapz_q" target="origFile">qsumd = <code class="constant">0.0</code></a>
<a name="v2_mapz_q_di8"></a><a href="v2_mapz_q.html#v2_mapz_qi26" target="origFile"><code class="comment">! Mapping</code></a>
<a name="v2_mapz_q_di25"></a>  <a href="v2_mapz_q.html#v2_mapz_qi26" target="origFile"><code class="keyword">DO </code>i=i1,i2</a>
<a name="v2_mapz_q_di9"></a>    <a href="v2_mapz_q.html#v2_mapz_qi8" target="origFile">k0 = <code class="constant">1</code></a>
<a name="v2_mapz_q_di10"></a>    <a href="v2_mapz_q.html#v2_mapz_qi25" target="origFile"><code class="keyword">DO </code><code class="label">555 </code>k=<code class="constant">1</code>,kn</a>
      <a href="v2_mapz_q.html#v2_mapz_qi9" target="origFile"><code class="keyword">DO </code>l=k0,km</a>
<a href="v2_mapz_q.html#v2_mapz_qi10" target="origFile"><code class="comment">! locate the top edge: pe2(i,k)</code></a>
        <a href="v2_mapz_q.html#v2_mapz_qi10" target="origFile"><code class="keyword">IF</code> (pe2(i, k) .GE. pe1(i, l) .AND. pe2(i, k) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi10" target="origFile"><code class="label">&         </code><code class="keyword">GOTO </code><code class="label">110</code></a>
<a name="v2_mapz_q_di11"></a>      <a href="v2_mapz_q.html#v2_mapz_qi9" target="origFile"><code class="keyword">END DO</code></a>
      <a href="v2_mapz_q.html#v2_mapz_qi25" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
<a name="v2_mapz_q_di11"></a> <a href="v2_mapz_q.html#v2_mapz_qi25" target="origFile"><code class="label">110 </code></a> <a href="v2_mapz_q.html#v2_mapz_qi11" target="origFile">pld = ((pe2d(i, k)-pe1d(i, l))*dp1(i, l)-(pe2(i, k)-pe1(i, l))*<code class="label">&</code></a>
<a name="v2_mapz_q_di12"></a><a href="v2_mapz_q.html#v2_mapz_qi11" target="origFile"><code class="label">&       </code>dp1d(i, l))/dp1(i, l)**<code class="constant">2</code></a>
<a name="v2_mapz_q_di13"></a>      <a href="v2_mapz_q.html#v2_mapz_qi11" target="origFile">pl = (pe2(i, k)-pe1(i, l))/dp1(i, l)</a>
      <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi13" target="origFile"><code class="comment">! entire new grid is within the original grid</code></a>
<a name="v2_mapz_q_di13"></a>        <a href="v2_mapz_q.html#v2_mapz_qi13" target="origFile">prd = ((pe2d(i, k+<code class="constant">1</code>)-pe1d(i, l))*dp1(i, l)-(pe2(i, k+<code class="constant">1</code>)-pe1(i, l<code class="label">&</code></a>
<a name="v2_mapz_q_di14"></a><a href="v2_mapz_q.html#v2_mapz_qi13" target="origFile"><code class="label">&         </code>))*dp1d(i, l))/dp1(i, l)**<code class="constant">2</code></a>
        <a href="v2_mapz_q.html#v2_mapz_qi13" target="origFile">pr = (pe2(i, k+<code class="constant">1</code>)-pe1(i, l))/dp1(i, l)</a>
        <a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile">q2d(i, k) = q4d(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*((q4d(<code class="constant">4</code>, i, l)+q4d(<code class="constant">3</code>, i, l)-q4d(<code class="constant">2</code><code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile"><code class="label">&         </code>, i, l))*(pr+pl)+(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(prd+<code class="label">&</code></a>
<a name="v2_mapz_q_di14"></a><a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile"><code class="label">&         </code>pld)) - r3*(q4d(<code class="constant">4</code>, i, l)*(pr*(pr+pl)+pl**<code class="constant">2</code>)+q4(<code class="constant">4</code>, i, l)*(prd*(<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile"><code class="label">&         </code>pr+pl)+pr*(prd+pld)+<code class="constant">2</code>*pl*pld))</a>
<a name="v2_mapz_q_di15"></a>        <a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile">q2(i, k) = q4(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi14" target="origFile"><code class="label">&         </code>))*(pr+pl) - q4(<code class="constant">4</code>, i, l)*r3*(pr*(pr+pl)+pl**<code class="constant">2</code>)</a>
        <a href="v2_mapz_q.html#v2_mapz_qi15" target="origFile">k0 = l</a>
<a name="v2_mapz_q_di16"></a>        <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="keyword">GOTO </code><code class="label">555</code></a>
      <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="keyword">ELSE</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="comment">! Fractional area...</code></a>
        <a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile">qsumd = (pe1d(i, l+<code class="constant">1</code>)-pe2d(i, k))*(q4(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)-q4(<code class="constant">4</code>, i, l)*(r3*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code>+pl<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>)))) + (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4d(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*((q4d(<code class="constant">4</code>, i, l<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>)+q4d(<code class="constant">3</code>, i, l)-q4d(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)+(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-<code class="label">&</code></a>
<a name="v2_mapz_q_di16"></a><a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>q4(<code class="constant">2</code>, i, l))*pld)-r3*(q4d(<code class="constant">4</code>, i, l)*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code>+pl))+q4(<code class="constant">4</code>, i, l)<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>*(pld*(<code class="constant">1.</code>+pl)+pl*pld)))</a>
        <a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile">qsum = (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="label">&</code></a>
<a name="v2_mapz_q_di17"></a><a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code><code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)-q4(<code class="constant">4</code>, i, l)*(r3*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code>+pl)))<code class="label">&</code></a>
<a name="v2_mapz_q_di18"></a><a href="v2_mapz_q.html#v2_mapz_qi16" target="origFile"><code class="label">&         </code>)</a>
        <a href="v2_mapz_q.html#v2_mapz_qi17" target="origFile"><code class="keyword">DO </code>m=l+<code class="constant">1</code>,km</a>
<a name="v2_mapz_q_di19"></a><a href="v2_mapz_q.html#v2_mapz_qi18" target="origFile"><code class="comment">! locate the bottom edge: pe2(i,k+1)</code></a>
          <a href="v2_mapz_q.html#v2_mapz_qi18" target="origFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .GT. pe1(i, m+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi19" target="origFile"><code class="comment">! Whole layer..</code></a>
<a name="v2_mapz_q_di19"></a>            <a href="v2_mapz_q.html#v2_mapz_qi19" target="origFile">qsumd = qsumd + dp1d(i, m)*q4(<code class="constant">1</code>, i, m) + dp1(i, m)*q4d(<code class="constant">1</code>, i<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi19" target="origFile"><code class="label">&             </code>, m)</a>
            <a href="v2_mapz_q.html#v2_mapz_qi19" target="origFile">qsum = qsum + dp1(i, m)*q4(<code class="constant">1</code>, i, m)</a>
          <a href="v2_mapz_q.html#v2_mapz_qi18" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="v2_mapz_q.html#v2_mapz_qi18" target="origFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
          <a href="v2_mapz_q.html#v2_mapz_qi18" target="origFile"><code class="keyword">END IF</code></a>
<a name="v2_mapz_q_di20"></a>        <a href="v2_mapz_q.html#v2_mapz_qi17" target="origFile"><code class="keyword">END DO</code></a>
<a name="v2_mapz_q_di20"></a>        <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
<a name="v2_mapz_q_di21"></a> <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="label">120 </code></a>   <a href="v2_mapz_q.html#v2_mapz_qi20" target="origFile">dpd = pe2d(i, k+<code class="constant">1</code>) - pe1d(i, m)</a>
<a name="v2_mapz_q_di21"></a>        <a href="v2_mapz_q.html#v2_mapz_qi20" target="origFile">dp = pe2(i, k+<code class="constant">1</code>) - pe1(i, m)</a>
<a name="v2_mapz_q_di22"></a>        <a href="v2_mapz_q.html#v2_mapz_qi21" target="origFile">esld = (dpd*dp1(i, m)-dp*dp1d(i, m))/dp1(i, m)**<code class="constant">2</code></a>
        <a href="v2_mapz_q.html#v2_mapz_qi21" target="origFile">esl = dp/dp1(i, m)</a>
        <a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile">qsumd = qsumd + dpd*(q4(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4(<code class="constant">3</code>, i, m)-q4(<code class="constant">2</code>, i, m<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile"><code class="label">&         </code>)+q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl))) + dp*(q4d(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*(esld*(q4(<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile"><code class="label">&         </code><code class="constant">3</code>, i, m)-q4(<code class="constant">2</code>, i, m)+q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl))+esl*(q4d(<code class="constant">3</code>, i, <code class="label">&</code></a>
<a name="v2_mapz_q_di22"></a><a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile"><code class="label">&         </code>m)-q4d(<code class="constant">2</code>, i, m)+q4d(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl)-q4(<code class="constant">4</code>, i, m)*r23*esld<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile"><code class="label">&         </code>)))</a>
<a name="v2_mapz_q_di23"></a>        <a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile">qsum = qsum + dp*(q4(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4(<code class="constant">3</code>, i, m)-q4(<code class="constant">2</code>, i, m)+<code class="label">&</code></a>
<a href="v2_mapz_q.html#v2_mapz_qi22" target="origFile"><code class="label">&         </code>q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl)))</a>
<a name="v2_mapz_q_di24"></a>        <a href="v2_mapz_q.html#v2_mapz_qi23" target="origFile">k0 = m</a>
<a name="v2_mapz_q_di24"></a>      <a href="v2_mapz_q.html#v2_mapz_qi12" target="origFile"><code class="keyword">END IF</code></a>
 <a href="v2_mapz_q.html#v2_mapz_qi25" target="origFile"><code class="label">123 </code></a> <a href="v2_mapz_q.html#v2_mapz_qi24" target="origFile">q2d(i, k) = qsumd/dp2(i, k)</a>
      <a href="v2_mapz_q.html#v2_mapz_qi24" target="origFile">q2(i, k) = qsum/dp2(i, k)</a>
 <a href="v2_mapz_q.html#v2_mapz_qi25" target="origFile"><code class="label">555 </code><code class="keyword">CONTINUE</code></a>
  <a href="v2_mapz_q.html#v2_mapz_qi26" target="origFile"><code class="keyword">END DO</code></a>
<a href="v2_mapz_q.html#v2_mapz_q" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">V2_MAPZ_Q_D</code></a>

</pre>
</body>
