<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code>
<a name="v2_mapz_q"></a><code class="comment">!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53</code>
<code class="comment">!</code>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">V2_MAPZ_Q</code>(<code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">km</code>, <code class="vardecl">kn</code>, <code class="vardecl">pe1</code>, <code class="vardecl">pe2</code>, <code class="vardecl">dp1</code>, <code class="vardecl">q4</code>, <code class="vardecl">q2</code>)</a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">!Inputs</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">i1</code>, <code class="vardecl">i2</code>, <code class="vardecl">km</code>, <code class="vardecl">kn</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pe1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>+<code class="constant">1</code>), <code class="vardecl">pe2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>+<code class="constant">1</code>)</a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dp1</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">q4</code>(<code class="constant">4</code>, <code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">km</code>)</a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">!Outputs</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">q2</code>(<code class="vardecl">i1</code>:<code class="vardecl">i2</code>, <code class="vardecl">kn</code>)</a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">!Locals</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k0</code>, <code class="vardecl">k</code>, <code class="vardecl">i</code>, <code class="vardecl">l</code>, <code class="vardecl">m</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL </code>:: <code class="vardecl">pl</code>, <code class="vardecl">pr</code>, <code class="vardecl">qsum</code>, <code class="vardecl">dp</code>, <code class="vardecl">esl</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">r3</code>=<code class="constant">1.</code>/<code class="constant">3.</code>, <code class="vardecl">r23</code>=<code class="constant">2.</code>/<code class="constant">3.</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">DP2</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL </code>:: <code class="funcname">DP2</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="typename">REAL </code>:: <code class="vardecl">result1</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! Mapping</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">DO </code>i=i1,i2</a>
    <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">k0 = <code class="constant">1</code></a>
    <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kn</a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">DO </code>l=k0,km</a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! locate the top edge: pe2(i,k)</code></a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">IF</code> (pe2(i, k) .GE. pe1(i, l) .AND. pe2(i, k) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="label">&</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">&         </code><code class="keyword">GOTO </code><code class="label">110</code></a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
 <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">110  </code>pl = (pe2(i, k)-pe1(i, l))/dp1(i, l)</a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .LE. pe1(i, l+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! entire new grid is within the original grid</code></a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">pr = (pe2(i, k+<code class="constant">1</code>)-pe1(i, l))/dp1(i, l)</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">q2(i, k) = q4(<code class="constant">2</code>, i, l) + <code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l<code class="label">&</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">&         </code>))*(pr+pl) - q4(<code class="constant">4</code>, i, l)*r3*(pr*(pr+pl)+pl**<code class="constant">2</code>)</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">k0 = l</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">555</code></a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">ELSE</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! Fractional area...</code></a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">qsum = (pe1(i, l+<code class="constant">1</code>)-pe2(i, k))*(q4(<code class="constant">2</code>, i, l)+<code class="constant">0.5</code>*(q4(<code class="constant">4</code>, i, l)+q4(<code class="label">&</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">&         </code><code class="constant">3</code>, i, l)-q4(<code class="constant">2</code>, i, l))*(<code class="constant">1.</code>+pl)-q4(<code class="constant">4</code>, i, l)*(r3*(<code class="constant">1.</code>+pl*(<code class="constant">1.</code>+pl)))<code class="label">&</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">&         </code>)</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">DO </code>m=l+<code class="constant">1</code>,km</a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! locate the bottom edge: pe2(i,k+1)</code></a>
          <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">IF</code> (pe2(i, k+<code class="constant">1</code>) .GT. pe1(i, m+<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="comment">! Whole layer..</code></a>
            <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">qsum = qsum + dp1(i, m)*q4(<code class="constant">1</code>, i, m)</a>
          <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">120</code></a>
          <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">GOTO </code><code class="label">123</code></a>
 <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">120    </code>dp = pe2(i, k+<code class="constant">1</code>) - pe1(i, m)</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">esl = dp/dp1(i, m)</a>
        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">qsum = qsum + dp*(q4(<code class="constant">2</code>, i, m)+<code class="constant">0.5</code>*esl*(q4(<code class="constant">3</code>, i, m)-q4(<code class="constant">2</code>, i, m)+<code class="label">&</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">&         </code>q4(<code class="constant">4</code>, i, m)*(<code class="constant">1.</code>-r23*esl)))</a>
<a name="p0"></a>        <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">k0 = m</a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END IF</code></a>
 <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">123  </code>result1 = </a><a href="msg.html#p0" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="funcname">DP2</code>(i, k)</a>
      <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile">q2(i, k) = qsum/result1</a>
 <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="label">555  </code><code class="keyword">CONTINUE</code></a>
    <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END DO</code></a>
<a href="v2_mapz_q_d.html#v2_mapz_q_d" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">V2_MAPZ_Q</code></a>

</pre>
</body>
