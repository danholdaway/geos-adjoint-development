!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53
!
!  Differentiation of aeroopt in forward (tangent) mode:
!   variations   of useful results: ssaa_irt taua_sot ssaa_sot
!                asya_irt asya_sot taua_irt
!   with respect to varying inputs: aerot
!   RW status of diff variables: ssaa_irt:out taua_sot:out ssaa_sot:out
!                aerot:in asya_irt:out asya_sot:out taua_irt:out
SUBROUTINE AEROOPT_D(im, jm, lm, na, nbchou_ir, nbchou_so, aerot, aerop&
& , ple, taua_ir_c, ssaa_ir_c, asya_ir_c, taua_irt, taua_irp, ssaa_irt&
& , ssaa_irp, asya_irt, asya_irp, taua_so_c, ssaa_so_c, asya_so_c, &
& taua_sot, taua_sop, ssaa_sot, ssaa_sop, asya_sot, asya_sop)
  IMPLICIT NONE
  INTEGER, INTENT(IN) :: im, jm, lm
  INTEGER, INTENT(IN) :: na, nbchou_ir, nbchou_so
  REAL, PARAMETER :: mapl_grav=9.81
!Inputs
  REAL, DIMENSION(im, jm, lm, na), INTENT(IN) :: aerot
  REAL, DIMENSION(im, jm, lm, na), INTENT(IN) :: aerop
  REAL, DIMENSION(im, jm, 0:lm), INTENT(IN) :: ple
  REAL, DIMENSION(im, jm, lm, nbchou_ir, na), INTENT(IN) :: taua_ir_c, &
& ssaa_ir_c, asya_ir_c
  REAL, DIMENSION(im, jm, lm, nbchou_so, na), INTENT(IN) :: taua_so_c, &
& ssaa_so_c, asya_so_c
!Outputs
  REAL, DIMENSION(im, jm, lm, nbchou_ir), INTENT(OUT) :: taua_irt, &
& ssaa_irt, asya_irt
  REAL, DIMENSION(im, jm, lm, nbchou_ir), INTENT(OUT) :: taua_irp, &
& ssaa_irp, asya_irp
  REAL, DIMENSION(im, jm, lm, nbchou_so), INTENT(OUT) :: taua_sot, &
& ssaa_sot, asya_sot
  REAL, DIMENSION(im, jm, lm, nbchou_so), INTENT(OUT) :: taua_sop, &
& ssaa_sop, asya_sop
!Locals
  INTEGER :: i, j, l, ai
  REAL :: x
  REAL, DIMENSION(im, jm, lm, na) :: saerot
  REAL, DIMENSION(im, jm, lm, na) :: saerop
  saerop = 0.0
  DO l=1,lm
    DO j=1,jm
      DO i=1,im
        x = (ple(i, j, l)-ple(i, j, l-1))*0.01*(100./mapl_grav)
        DO ai=1,na
          saerop(i, j, l, ai) = x*aerop(i, j, l, ai)
          saerot(i, j, l, ai) = x*aerot(i, j, l, ai)
        END DO
      END DO
    END DO
  END DO
!Compute aerosol optical properties for IR
  taua_irt = 0.0
  ssaa_irt = 0.0
  asya_irt = 0.0
  ssaa_irp = 0.0
  asya_irp = 0.0
  taua_irp = 0.0
  DO j=1,nbchou_ir
    DO l=1,na
      taua_irp(:, :, :, j) = taua_irp(:, :, :, j) + taua_ir_c(:, :, :&
&       , j, l)*saerop(:, :, :, l)
      taua_irt(:, :, :, j) = taua_irt(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_ir_c(:, :, :, j, l)
      ssaa_irp(:, :, :, j) = ssaa_irp(:, :, :, j) + taua_ir_c(:, :, :&
&       , j, l)*ssaa_ir_c(:, :, :, j, l)*saerop(:, :, :, l)
      ssaa_irt(:, :, :, j) = ssaa_irt(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_ir_c(:, :, :, j, l)*ssaa_ir_c(:, :, :, j, l)
      asya_irp(:, :, :, j) = asya_irp(:, :, :, j) + taua_ir_c(:, :, :&
&       , j, l)*ssaa_ir_c(:, :, :, j, l)*asya_ir_c(:, :, :, j, l)*&
&       saerop(:, :, :, l)
      asya_irt(:, :, :, j) = asya_irt(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_ir_c(:, :, :, j, l)*ssaa_ir_c(:, :, :, j, l)*asya_ir_c(:, :&
&       , :, j, l)
    END DO
  END DO
!Compute aerosol optical properties for SO
  taua_sot = 0.0
  ssaa_sot = 0.0
  asya_sot = 0.0
  taua_sop = 0.0
  ssaa_sop = 0.0
  asya_sop = 0.0
  DO j=1,nbchou_so
    DO l=1,na
      taua_sop(:, :, :, j) = taua_sop(:, :, :, j) + taua_so_c(:, :, :&
&       , j, l)*saerop(:, :, :, l)
      taua_sot(:, :, :, j) = taua_sot(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_so_c(:, :, :, j, l)
      ssaa_sop(:, :, :, j) = ssaa_sop(:, :, :, j) + taua_so_c(:, :, :&
&       , j, l)*ssaa_so_c(:, :, :, j, l)*saerop(:, :, :, l)
      ssaa_sot(:, :, :, j) = ssaa_sot(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_so_c(:, :, :, j, l)*ssaa_so_c(:, :, :, j, l)
      asya_sop(:, :, :, j) = asya_sop(:, :, :, j) + taua_so_c(:, :, :&
&       , j, l)*ssaa_so_c(:, :, :, j, l)*asya_ir_c(:, :, :, j, l)*&
&       saerop(:, :, :, l)
      asya_sot(:, :, :, j) = asya_sot(:, :, :, j) + saerot(:, :, :, l)*&
&       taua_so_c(:, :, :, j, l)*ssaa_so_c(:, :, :, j, l)*asya_ir_c(:, :&
&       , :, j, l)
    END DO
  END DO
END SUBROUTINE AEROOPT_D

