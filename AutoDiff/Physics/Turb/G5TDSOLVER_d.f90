!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53
!
!  Differentiation of g5tdsolver in forward (tangent) mode:
!   variations   of useful results: y
!   with respect to varying inputs: y
!   RW status of diff variables: y:in-out
SUBROUTINE G5TDSOLVER_D(im, jm, lm, a, b, c, y, yd)
  IMPLICIT NONE
!Arguments
  INTEGER, INTENT(IN) :: im, jm, lm
  REAL, DIMENSION(im, jm, lm), INTENT(IN) :: a, b, c
  REAL, DIMENSION(im, jm, lm), INTENT(INOUT) :: y
  REAL, DIMENSION(im, jm, lm), INTENT(INOUT) :: yd
!Locals
  INTEGER :: l
  REAL, DIMENSION(im, jm, lm) :: a1, b1, c1
  REAL, DIMENSION(im, jm, lm) :: a1d, b1d
!Make temporary copies and dont overwrite
  a1 = a
  b1 = b
  c1 = c
!VTRILU
!------
  b1d(:, :, 1) = 0.0
  b1(:, :, 1) = 1./b1(:, :, 1)
  DO l=2,lm
    a1d(:, :, l) = 0.0
    a1(:, :, l) = a1(:, :, l)*b1(:, :, l-1)
    b1d(:, :, l) = 0.0
    b1(:, :, l) = 1./(b1(:, :, l)-c1(:, :, l-1)*a1(:, :, l))
  END DO
!VTRISOLVE
!---------
!Sweep 1
  DO l=2,lm
    yd(:, :, l) = yd(:, :, l) - a1(:, :, l)*yd(:, :, l-1)
    y(:, :, l) = y(:, :, l) - y(:, :, l-1)*a1(:, :, l)
  END DO
!Sweep 2
  yd(:, :, lm) = b1(:, :, lm-1)*yd(:, :, lm)/(b1(:, :, lm-1)-a1(:, :, lm&
&   )*(1.0+c1(:, :, lm-1)*b1(:, :, lm-1)))
  y(:, :, lm) = y(:, :, lm)*b1(:, :, lm-1)/(b1(:, :, lm-1)-a1(:, :, lm)*&
&   (1.0+c1(:, :, lm-1)*b1(:, :, lm-1)))
  DO l=lm-1,1,-1
    yd(:, :, l) = b1(:, :, l)*(yd(:, :, l)-c1(:, :, l)*yd(:, :, l+1))
    y(:, :, l) = (y(:, :, l)-c1(:, :, l)*y(:, :, l+1))*b1(:, :, l)
  END DO
END SUBROUTINE G5TDSOLVER_D

