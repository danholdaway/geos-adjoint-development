<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code>
<a name="rase_tracer"></a><code class="comment">!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53</code>
<code class="comment">!</code>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">RASE_TRACER</code>(<code class="vardecl">idim</code>, <code class="vardecl">irun</code>, <code class="vardecl">k0</code>, <code class="vardecl">icmin</code>, <code class="vardecl">dt</code>, <code class="vardecl">cons_cp</code>, <code class="vardecl">cons_alhl</code>, <code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">& </code><code class="vardecl">cons_grav</code>, <code class="vardecl">cons_rgas</code>, <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>, <code class="vardecl">cons_vireps</code>, <code class="vardecl">seedras</code>, <code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">& </code><code class="vardecl">sige</code>, <code class="vardecl">kcbl</code>, <code class="vardecl">wgt0</code>, <code class="vardecl">wgt1</code>, <code class="vardecl">frland</code>, <code class="vardecl">ts</code>, <code class="vardecl">thoin</code>, <code class="vardecl">qhoin</code>, <code class="vardecl">uhoin</code>, <code class="vardecl">vhoin</code>, <code class="label">&</code></a>
<a name="rase_traceri0"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">& </code><code class="vardecl">co_auto</code>, <code class="vardecl">ple</code>, <code class="vardecl">rasparams</code>, <code class="vardecl">estblx</code>, <code class="vardecl">itrcr</code>, <code class="vardecl">xho</code>, <code class="vardecl">fscav</code>)</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="rase_traceri1"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!INPUTS</code></a>
<a name="rase_traceri2"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">idim</code>, <code class="vardecl">irun</code>, <code class="vardecl">k0</code>, <code class="vardecl">icmin</code></a>
<a name="rase_traceri3"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0 + <code class="constant">1</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple</code></a>
<a name="rase_traceri4"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0 + <code class="constant">1</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">sige</code></a>
<a name="rase_traceri5"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code>, <code class="vardecl">cons_cp</code>, <code class="vardecl">cons_alhl</code>, <code class="vardecl">cons_grav</code>, <code class="vardecl">cons_rgas</code></a>
<a name="rase_traceri6"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>, <code class="vardecl">cons_vireps</code></a>
<a name="rase_traceri7"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">seedras</code></a>
<a name="rase_traceri8"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kcbl</code></a>
<a name="rase_traceri9"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ts</code>, <code class="vardecl">frland</code></a>
<a name="rase_traceri10"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">co_auto</code></a>
<a name="rase_traceri11"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">wgt0</code>, <code class="vardecl">wgt1</code></a>
<a name="rase_traceri12"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rasparams</code></a>
<a name="rase_traceri13"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">estblx</code></a>
<a name="rase_traceri14"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">itrcr</code></a>
<a name="rase_traceri15"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>itrcr<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">fscav</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">thoin</code>, <code class="vardecl">qhoin</code>, <code class="vardecl">uhoin</code>, <code class="vardecl">vhoin</code></a>
<a name="rase_traceri16"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!PROGNOSTIC</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0, itrcr<code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">xho</code></a>
<a name="rase_traceri17"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!LOCALS</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">ic</code>, <code class="vardecl">l</code>, <code class="vardecl">kk</code>, <code class="vardecl">k</code></a>
<a name="rase_traceri18"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Parameters</code></a>
<a name="rase_traceri19"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">onepkap</code>=<code class="constant">1.</code>+<code class="constant">2.</code>/<code class="constant">7.</code>, <code class="vardecl">daylen</code>=<code class="constant">86400.0</code></a>
<a name="rase_traceri20"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">rhmax</code>=<code class="constant">0.9999</code></a>
<a name="rase_traceri21"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">cbl_qpert</code>=<code class="constant">0.0</code>, <code class="vardecl">cbl_tpert</code>=<code class="constant">1.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">cbl_tpert_mxocn</code>=<code class="constant">2.0</code>, <code class="vardecl">cbl_tpert_mxlnd</code>=<code class="constant">4.0</code></a>
<a name="rase_traceri22"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Constants</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">grav</code>, <code class="vardecl">cp</code>, <code class="vardecl">alhl</code>, <code class="vardecl">cpbg</code>, <code class="vardecl">alhi</code>, <code class="vardecl">cpi</code>, <code class="vardecl">gravi</code>, <code class="vardecl">ddt</code>, <code class="vardecl">lbcp</code></a>
<a name="rase_traceri23"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Rasparams</code></a>
<a name="rase_traceri24"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fricfac</code>, <code class="vardecl">cli_crit</code>, <code class="vardecl">rasal1</code>, <code class="vardecl">rasal2</code></a>
<a name="rase_traceri25"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">friclambda</code></a>
<a name="rase_traceri26"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">sdqv2</code>, <code class="vardecl">sdqv3</code>, <code class="vardecl">sdqvt1</code></a>
<a name="rase_traceri27"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">acritfac</code>, <code class="vardecl">pblfrac</code>, <code class="vardecl">autorampb</code></a>
<a name="rase_traceri28"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">maxdallowed</code>, <code class="vardecl">rhmn</code>, <code class="vardecl">rhmx</code></a>
<a name="rase_traceri29"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mxdiam</code></a>
<a name="rase_traceri30"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tx2</code>, <code class="vardecl">tx3</code>, <code class="vardecl">akm</code>, <code class="vardecl">acr</code>, <code class="vardecl">alm</code>, <code class="vardecl">tth</code>, <code class="vardecl">qqh</code>, <code class="vardecl">dqx</code></a>
<a name="rase_traceri31"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">wfn</code>, <code class="vardecl">tem</code>, <code class="vardecl">trg</code>, <code class="vardecl">trgexp</code>, <code class="vardecl">evp</code>, <code class="vardecl">wlq</code>, <code class="vardecl">qcc</code></a>
<a name="rase_traceri32"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cli</code>, <code class="vardecl">te_a</code>, <code class="vardecl">c00_x</code>, <code class="vardecl">cli_crit_x</code>, <code class="vardecl">toki</code></a>
<a name="rase_traceri33"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dt_lyr</code>, <code class="vardecl">rate</code>, <code class="vardecl">cvw_x</code>, <code class="vardecl">closs</code>, <code class="vardecl">f2</code>, <code class="vardecl">f3</code>, <code class="vardecl">f4</code></a>
<a name="rase_traceri34"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">wght0</code>, <code class="vardecl">prcbl</code>, <code class="vardecl">rndu</code></a>
<a name="rase_traceri35"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">lambda_min</code>, <code class="vardecl">lambda_max</code></a>
<a name="rase_traceri36"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tpert</code>, <code class="vardecl">qpert</code></a>
<a name="rase_traceri37"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">uht</code>, <code class="vardecl">vht</code></a>
<a name="rase_traceri38"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi_sv</code>, <code class="vardecl">qoi_sv</code>, <code class="vardecl">uoi_sv</code>, <code class="vardecl">voi_sv</code></a>
<a name="rase_traceri39"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi</code>, <code class="vardecl">qoi</code>, <code class="vardecl">uoi</code>, <code class="vardecl">voi</code>, <code class="vardecl">dqq</code>, <code class="vardecl">bet</code>, <code class="vardecl">gam</code>, <code class="vardecl">cll</code></a>
<a name="rase_traceri40"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi_c</code>, <code class="vardecl">qoi_c</code></a>
<a name="rase_traceri41"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">prh</code>, <code class="vardecl">pri</code>, <code class="vardecl">ght</code>, <code class="vardecl">dpt</code>, <code class="vardecl">dpb</code>, <code class="vardecl">pki</code></a>
<a name="rase_traceri42"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">ucu</code>, <code class="vardecl">vcu</code></a>
<a name="rase_traceri43"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">cln</code>, <code class="vardecl">rns</code>, <code class="vardecl">pol</code></a>
<a name="rase_traceri44"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">qst</code>, <code class="vardecl">ssl</code>, <code class="vardecl">rmf</code>, <code class="vardecl">rnn</code>, <code class="vardecl">rn1</code>, <code class="vardecl">rmfc</code>, <code class="vardecl">rmfp</code></a>
<a name="rase_traceri45"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">gms</code>, <code class="vardecl">eta</code>, <code class="vardecl">gmh</code>, <code class="vardecl">eht</code>, <code class="vardecl">gm1</code>, <code class="vardecl">hcc</code>, <code class="vardecl">rmfd</code></a>
<a name="rase_traceri46"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">hol</code>, <code class="vardecl">hst</code>, <code class="vardecl">qol</code>, <code class="vardecl">zol</code>, <code class="vardecl">hcld</code>, <code class="vardecl">cll0</code>, <code class="vardecl">cllx</code>, <code class="vardecl">clli</code></a>
<a name="rase_traceri47"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">bke</code>, <code class="vardecl">cvw</code>, <code class="vardecl">updfrc</code></a>
<a name="rase_traceri48"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">rasal</code>, <code class="vardecl">updfrp</code>, <code class="vardecl">bk2</code>, <code class="vardecl">dll0</code>, <code class="vardecl">dllx</code></a>
<a name="rase_traceri49"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">wght</code>, <code class="vardecl">massf</code></a>
<a name="rase_traceri50"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">qss</code>, <code class="vardecl">dqs</code>, <code class="vardecl">pf</code>, <code class="vardecl">pk</code>, <code class="vardecl">tempf</code>, <code class="vardecl">zlo</code></a>
<a name="rase_traceri51"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0 + <code class="constant">1</code><code class="typename">) </code>:: <code class="vardecl">prj</code>, <code class="vardecl">prs</code>, <code class="vardecl">qht</code>, <code class="vardecl">sht</code>, <code class="vardecl">zet</code>, <code class="vardecl">zle</code>, <code class="vardecl">pke</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">) </code>:: <code class="vardecl">tho</code>, <code class="vardecl">qho</code>, <code class="vardecl">uho</code>, <code class="vardecl">vho</code></a>
<a name="rase_traceri52"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Tracer scavenging</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">itr</code></a>
<a name="rase_traceri53"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Layer thickness in km</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">delzkm</code></a>
<a name="rase_traceri54"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Fraction of tracer *not* scavenged</code></a>
<a name="rase_traceri55"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fnoscav</code></a>
<a name="rase_traceri56"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0, itrcr<code class="typename">) </code>:: <code class="vardecl">xoi</code>, <code class="vardecl">xcu</code>, <code class="vardecl">xoi_sv</code></a>
<a name="rase_traceri57"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>itrcr<code class="typename">) </code>:: <code class="vardecl">xht</code></a>
<a name="rase_traceri58"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="rase_traceri59"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
<a name="rase_traceri60"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="rase_traceri61"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">EXP</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">arg1</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x5</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x4</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x3</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x2</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">max2</code></a>
<a name="rase_traceri62"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">max1</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a name="rase_traceri63"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Pass meteorology to internal arrays so it is not updated</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tho = thoin</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qho = qhoin</a>
<a name="rase_traceri64"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uho = uhoin</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vho = vhoin</a>
<a name="rase_traceri65"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Initialize Local Arrays</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi = <code class="constant">0.0</code></a>
<a name="rase_traceri66"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi = <code class="constant">0.0</code></a>
<a name="rase_traceri67"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi = <code class="constant">0.0</code></a>
<a name="rase_traceri68"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dqq = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bet = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gam = <code class="constant">0.0</code></a>
<a name="rase_traceri69"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi_c = <code class="constant">0.0</code></a>
<a name="rase_traceri70"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi_c = <code class="constant">0.0</code></a>
<a name="rase_traceri71"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prh = <code class="constant">0.0</code></a>
<a name="rase_traceri72"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pri = <code class="constant">0.0</code></a>
<a name="rase_traceri73"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ght = <code class="constant">0.0</code></a>
<a name="rase_traceri74"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dpt = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dpb = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pki = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ucu = <code class="constant">0.0</code></a>
<a name="rase_traceri75"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vcu = <code class="constant">0.0</code></a>
<a name="rase_traceri76"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cln = <code class="constant">0.0</code></a>
<a name="rase_traceri77"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pol = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qst = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ssl = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmf = <code class="constant">0.0</code></a>
<a name="rase_traceri78"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rnn = <code class="constant">0.0</code></a>
<a name="rase_traceri79"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rn1 = <code class="constant">0.0</code></a>
<a name="rase_traceri80"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gms = <code class="constant">0.0</code></a>
<a name="rase_traceri81"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">eta = <code class="constant">0.0</code></a>
<a name="rase_traceri82"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gmh = <code class="constant">0.0</code></a>
<a name="rase_traceri83"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">eht = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gm1 = <code class="constant">0.0</code></a>
<a name="rase_traceri84"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcc = <code class="constant">0.0</code></a>
<a name="rase_traceri85"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hol = <code class="constant">0.0</code></a>
<a name="rase_traceri86"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hst = <code class="constant">0.0</code></a>
<a name="rase_traceri87"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zol = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcld = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bke = <code class="constant">0.0</code></a>
<a name="rase_traceri88"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrc = <code class="constant">0.0</code></a>
<a name="rase_traceri89"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrp = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bk2 = <code class="constant">0.0</code></a>
<a name="rase_traceri90"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght = <code class="constant">0.0</code></a>
<a name="rase_traceri91"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">massf = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qss = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dqs = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pf = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pk = <code class="constant">0.0</code></a>
<a name="rase_traceri92"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tempf = <code class="constant">0.0</code></a>
<a name="rase_traceri93"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zlo = <code class="constant">0.0</code></a>
<a name="rase_traceri94"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prj = <code class="constant">0.0</code></a>
<a name="rase_traceri95"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prs = <code class="constant">0.0</code></a>
<a name="rase_traceri96"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qht = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sht = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zet = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zle = <code class="constant">0.0</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pke = <code class="constant">0.0</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  ---  1</code></a>
<a name="rase_traceri97"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  ---  4</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">fricfac = rasparams(<code class="constant">1</code>)</a>
<a name="rase_traceri98"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  ---  4</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cli_crit = rasparams(<code class="constant">4</code>)</a>
<a name="rase_traceri99"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  ---  5</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal1 = rasparams(<code class="constant">5</code>)</a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  ---  6</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal2 = rasparams(<code class="constant">6</code>)</a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 11</code></a>
<a name="rase_traceri100"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 14</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">friclambda = rasparams(<code class="constant">11</code>)</a>
<a name="rase_traceri101"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 14</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sdqv2 = rasparams(<code class="constant">14</code>)</a>
<a name="rase_traceri102"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 15</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sdqv3 = rasparams(<code class="constant">15</code>)</a>
<a name="rase_traceri103"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 16</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sdqvt1 = rasparams(<code class="constant">16</code>)</a>
<a name="rase_traceri104"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 17</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">acritfac = rasparams(<code class="constant">17</code>)</a>
<a name="rase_traceri105"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 20</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pblfrac = rasparams(<code class="constant">20</code>)</a>
<a name="rase_traceri106"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 21</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">autorampb = rasparams(<code class="constant">21</code>)</a>
<a name="rase_traceri107"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 24</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rhmn = rasparams(<code class="constant">24</code>)</a>
<a name="rase_traceri108"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 24</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">maxdallowed = rasparams(<code class="constant">23</code>)</a>
<a name="rase_traceri109"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!  --- 25</code></a>
<a name="rase_traceri110"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rhmx = rasparams(<code class="constant">25</code>)</a>
<a name="rase_traceri111"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">grav = cons_grav</a>
<a name="rase_traceri112"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">alhl = cons_alhl</a>
<a name="rase_traceri113"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cp = cons_cp</a>
<a name="rase_traceri114"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cpi = <code class="constant">1.0</code>/cp</a>
<a name="rase_traceri115"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">alhi = <code class="constant">1.0</code>/alhl</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gravi = <code class="constant">1.0</code>/grav</a>
<a name="rase_traceri116"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cpbg = cp*gravi</a>
<a name="rase_traceri117"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ddt = daylen/dt</a>
<a name="rase_traceri118"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">lbcp = alhl*cpi</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">i = <code class="constant">1</code></a>
<a name="rase_traceri119"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CALL FINDBASE</code></a>
<a name="rase_traceri120"></a>  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">k = kcbl(i)</a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (k .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri121"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Get saturation specific humidity and gradient wrt to T</code></a>
<a name="rase_traceri122"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pke = (ple(i, :)/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rase_traceri123"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pf = <code class="constant">0.5</code>*(ple(i, <code class="constant">1</code>:k0)+ple(i, <code class="constant">2</code>:k0+<code class="constant">1</code>))</a>
<a name="rase_traceri124"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pk = (pf/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rase_traceri125"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tempf = tho(i, :)*pk</a>
<a name="rase_traceri126"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zle = <code class="constant">0.0</code></a>
<a name="rase_traceri130"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zlo = <code class="constant">0.0</code></a>
<a name="rase_traceri127"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zle(k0+<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rase_traceri128"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k0,<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rase_traceri129"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zle(l) = tho(i, l)*(<code class="constant">1.</code>+cons_vireps*qho(i, l))</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zlo(l) = zle(l+<code class="constant">1</code>) + cons_cp/cons_grav*(pke(l+<code class="constant">1</code>)-pk(l))*zle(l)</a>
<a name="rase_traceri131"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zle(l) = zlo(l) + cons_cp/cons_grav*(pk(l)-pke(l))*zle(l)</a>
<a name="rase_traceri132"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = cbl_tpert*(ts(i)-(tempf(k0)+cons_grav*zlo(k0)/cons_cp))</a>
<a name="rase_traceri133"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!* ( QSSFC - Q(:,:,K0) ) [CBL_QPERT = 0.0]</code></a>
<a name="rase_traceri134"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qpert = cbl_qpert</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (tpert .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri135"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = <code class="constant">0.0</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri136"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = tpert</a>
<a name="rase_traceri137"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (qpert .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri138"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qpert = <code class="constant">0.0</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri139"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qpert = qpert</a>
<a name="rase_traceri140"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri141"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (frland(i) .LT. <code class="constant">0.1</code>) <code class="keyword">THEN</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (tpert .GT. cbl_tpert_mxocn) <code class="keyword">THEN</code></a>
<a name="rase_traceri142"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = cbl_tpert_mxocn</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri143"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = tpert</a>
<a name="rase_traceri144"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE IF</code> (tpert .GT. cbl_tpert_mxlnd) <code class="keyword">THEN</code></a>
<a name="rase_traceri145"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = cbl_tpert_mxlnd</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri146"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tpert = tpert</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri148"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">CALL </code><code class="funcname">DQSAT_RAS</code>(dqs, qss, tempf, pf, k0, estblx, cons_h2omw, <code class="label">&</code></a>
<a name="rase_traceri147"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&            </code>cons_airmw)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>kk=icmin,k+<code class="constant">1</code></a>
<a name="rase_traceri149"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prj(kk) = pke(kk)</a>
<a name="rase_traceri150"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri151"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prs(icmin:k0+<code class="constant">1</code>) = ple(i, icmin:k0+<code class="constant">1</code>)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi(icmin:k) = tho(i, icmin:k)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi(icmin:k) = qho(i, icmin:k)</a>
<a name="rase_traceri152"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi(icmin:k) = uho(i, icmin:k)</a>
<a name="rase_traceri153"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi(icmin:k) = vho(i, icmin:k)</a>
<a name="rase_traceri155"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qst(icmin:k) = qss(icmin:k)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dqq(icmin:k) = dqs(icmin:k)</a>
<a name="rase_traceri154"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
<a name="rase_traceri156"></a>      <a href="convection_tracer_b.html#rase_tracer_bi0" target="diffFile">xoi(icmin:k, itr) = xho(i, icmin:k, itr)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri157"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Mass fraction of each layer below cloud base</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">massf(:) = wgt0(i, :)</a>
<a name="rase_traceri159"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!RESET PRESSURE at bottom edge of CBL </code></a>
<a name="rase_traceri158"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prcbl = prs(k)</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rase_traceri160"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prcbl = prcbl + massf(l)*(prs(l+<code class="constant">1</code>)-prs(l))</a>
<a name="rase_traceri161"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri168"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prs(k+<code class="constant">1</code>) = prcbl</a>
<a name="rase_traceri162"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prj(k+<code class="constant">1</code>) = (prs(k+<code class="constant">1</code>)/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rase_traceri163"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pol(l) = <code class="constant">0.5</code>*(prs(l)+prs(l+<code class="constant">1</code>))</a>
<a name="rase_traceri164"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">prh(l) = (prs(l+<code class="constant">1</code>)*prj(l+<code class="constant">1</code>)-prs(l)*prj(l))/(onepkap*(prs(l+<code class="constant">1</code>)-prs(<code class="label">&</code></a>
<a name="rase_traceri165"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&       </code>l)))</a>
<a name="rase_traceri166"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pki(l) = <code class="constant">1.0</code>/prh(l)</a>
<a name="rase_traceri167"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dpt(l) = prh(l) - prj(l)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dpb(l) = prj(l+<code class="constant">1</code>) - prh(l)</a>
<a name="rase_traceri169"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">pri(l) = <code class="constant">.01</code>/(prs(l+<code class="constant">1</code>)-prs(l))</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri170"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!RECALCULATE PROFILE QUAN. IN LOWEST STRAPPED LAYER</code></a>
<a name="rase_traceri171"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (k .LE. k0) <code class="keyword">THEN</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi(k) = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi(k) = <code class="constant">0.</code></a>
<a name="rase_traceri172"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi(k) = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi(k) = <code class="constant">0.</code></a>
<a name="rase_traceri174"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!SPECIFY WEIGHTS GIVEN TO EACH LAYER WITHIN SUBCLOUD "SUPERLAYER"</code></a>
<a name="rase_traceri173"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rase_traceri177"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght(l) = massf(l)*(ple(i, l+<code class="constant">1</code>)-ple(i, l))/(prs(k+<code class="constant">1</code>)-prs(k))</a>
<a name="rase_traceri175"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri176"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi(k) = poi(k) + wght(l)*tho(i, l)</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi(k) = qoi(k) + wght(l)*qho(i, l)</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi(k) = uoi(k) + wght(l)*uho(i, l)</a>
<a name="rase_traceri178"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi(k) = voi(k) + wght(l)*vho(i, l)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri181"></a><a href="convection_tracer_b.html#rase_tracer_bi1" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
<a name="rase_traceri180"></a>      <a href="convection_tracer_b.html#rase_tracer_bi1" target="diffFile">xoi(k, :) = <code class="constant">0.</code></a>
<a name="rase_traceri179"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
          <a href="convection_tracer_b.html#rase_tracer_bi2" target="diffFile">xoi(k, itr) = xoi(k, itr) + wght(l)*xho(i, l, itr)</a>
<a name="rase_traceri182"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri183"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">arg1 = poi(k)*prh(k)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">CALL </code><code class="funcname">DQSATS_RAS</code>(dqq(k), qst(k), arg1, pol(k), estblx, cons_h2omw, <code class="label">&</code></a>
<a name="rase_traceri184"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&               </code>cons_airmw)</a>
<a name="rase_traceri185"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (seedras(i)/<code class="constant">1000000. </code>.LT. <code class="constant">1e-6</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri186"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rndu = <code class="constant">1e-6</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri187"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rndu = seedras(i)/<code class="constant">1000000.</code></a>
<a name="rase_traceri193"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri188"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">mxdiam = maxdallowed*rndu**(-(<code class="constant">1.</code>/<code class="constant">2.</code>))</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
<a name="rase_traceri189"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!*</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bet(l) = dqq(l)*pki(l)</a>
<a name="rase_traceri190"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!*</code></a>
<a name="rase_traceri191"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gam(l) = pki(l)/(<code class="constant">1.0</code>+lbcp*dqq(l))</a>
<a name="rase_traceri192"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (l .LT. k) <code class="keyword">THEN</code></a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ght(l+<code class="constant">1</code>) = gam(l)*dpb(l) + gam(l+<code class="constant">1</code>)*dpt(l+<code class="constant">1</code>)</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gm1(l+<code class="constant">1</code>) = <code class="constant">0.5</code>*lbcp*(dqq(l)/(alhl*(<code class="constant">1.0</code>+lbcp*dqq(l)))+dqq(l+<code class="constant">1</code>)/(<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&         </code>alhl*(<code class="constant">1.0</code>+lbcp*dqq(l+<code class="constant">1</code>))))</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri194"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rns = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmf = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfd = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfc = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfp = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0 = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dll0 = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cllx = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dllx = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">clli = <code class="constant">0.</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi_sv = poi</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi_sv = qoi</a>
<a name="rase_traceri199"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi_sv = uoi</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi_sv = voi</a>
<a name="rase_traceri195"></a><a href="convection_tracer_b.html#rase_tracer_bi3" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
    <a href="convection_tracer_b.html#rase_tracer_bi3" target="diffFile">xoi_sv = xoi</a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw = <code class="constant">0.0</code></a>
<a name="rase_traceri196"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrc = <code class="constant">0.0</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrp = <code class="constant">0.0</code></a>
<a name="rase_traceri197"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">! HOL initialized here in order not to confuse Valgrind debugger</code></a>
<a name="rase_traceri198"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hol = <code class="constant">0.</code></a>
<a name="rase_traceri212"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zet(k+<code class="constant">1</code>) = <code class="constant">0</code></a>
<a name="rase_traceri200"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sht(k+<code class="constant">1</code>) = cp*poi(k)*prj(k+<code class="constant">1</code>)</a>
<a name="rase_traceri201"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (qst(l)*rhmax .GT. qoi(l)) <code class="keyword">THEN</code></a>
<a name="rase_traceri202"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qoi(l)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri203"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qst(l)*rhmax</a>
<a name="rase_traceri204"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.000 </code>.LT. qol(l)) <code class="keyword">THEN</code></a>
<a name="rase_traceri205"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qol(l)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri206"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = <code class="constant">0.000</code></a>
<a name="rase_traceri207"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri208"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ssl(l) = cp*prj(l+<code class="constant">1</code>)*poi(l) + grav*zet(l+<code class="constant">1</code>)</a>
<a name="rase_traceri209"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hol(l) = ssl(l) + qol(l)*alhl</a>
<a name="rase_traceri210"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hst(l) = ssl(l) + qst(l)*alhl</a>
<a name="rase_traceri211"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = poi(l)*(prj(l+<code class="constant">1</code>)-prj(l))*cpbg</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zet(l) = zet(l+<code class="constant">1</code>) + tem</a>
<a name="rase_traceri388"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zol(l) = zet(l+<code class="constant">1</code>) + (prj(l+<code class="constant">1</code>)-prh(l))*poi(l)*cpbg</a>
<a name="rase_traceri214"></a>    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>ic=k,icmin+<code class="constant">1</code>,-<code class="constant">1</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi4" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
      <a href="convection_tracer_b.html#rase_tracer_bi4" target="diffFile">xcu(icmin:, :) = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ucu(icmin:) = <code class="constant">0.</code></a>
<a name="rase_traceri213"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vcu(icmin:) = <code class="constant">0.</code></a>
<a name="rase_traceri215"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">alm = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1. </code>.GT. (qoi(k)/qst(k)-rhmn)/(rhmx-rhmn)) <code class="keyword">THEN</code></a>
<a name="rase_traceri216"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">trg = (qoi(k)/qst(k)-rhmn)/(rhmx-rhmn)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri217"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">trg = <code class="constant">1.</code></a>
<a name="rase_traceri218"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.0 </code>.LT. (autorampb-sige(ic))/<code class="constant">0.2</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri219"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">y1 = (autorampb-sige(ic))/<code class="constant">0.2</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri220"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">y1 = <code class="constant">0.0</code></a>
<a name="rase_traceri221"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1.0 </code>.GT. y1) <code class="keyword">THEN</code></a>
<a name="rase_traceri222"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">f4 = y1</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri223"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">f4 = <code class="constant">1.0</code></a>
<a name="rase_traceri224"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (trg .GT. <code class="constant">1.0e-5</code>) <code class="keyword">THEN</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri225"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!RECOMPUTE SOUNDING UP TO DETRAINMENT LEVEL</code></a>
<a name="rase_traceri226"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi_c = poi</a>
<a name="rase_traceri227"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi_c = qoi</a>
<a name="rase_traceri228"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi_c(k) = poi_c(k) + tpert</a>
<a name="rase_traceri229"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi_c(k) = qoi_c(k) + qpert</a>
<a name="rase_traceri242"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zet(k+<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rase_traceri230"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sht(k+<code class="constant">1</code>) = cp*poi_c(k)*prj(k+<code class="constant">1</code>)</a>
<a name="rase_traceri231"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,ic,-<code class="constant">1</code></a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (qst(l)*rhmax .GT. qoi_c(l)) <code class="keyword">THEN</code></a>
<a name="rase_traceri232"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qoi_c(l)</a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri233"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qst(l)*rhmax</a>
<a name="rase_traceri234"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.000 </code>.LT. qol(l)) <code class="keyword">THEN</code></a>
<a name="rase_traceri235"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = qol(l)</a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri236"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qol(l) = <code class="constant">0.000</code></a>
<a name="rase_traceri237"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri238"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ssl(l) = cp*prj(l+<code class="constant">1</code>)*poi_c(l) + grav*zet(l+<code class="constant">1</code>)</a>
<a name="rase_traceri239"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hol(l) = ssl(l) + qol(l)*alhl</a>
<a name="rase_traceri240"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hst(l) = ssl(l) + qst(l)*alhl</a>
<a name="rase_traceri241"></a>          <a href="convection_tracer_b.html#rase_tracer_bi5" target="diffFile">tem = poi_c(l)*(prj(l+<code class="constant">1</code>)-prj(l))*cpbg</a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zet(l) = zet(l+<code class="constant">1</code>) + tem</a>
<a name="rase_traceri246"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">zol(l) = zet(l+<code class="constant">1</code>) + (prj(l+<code class="constant">1</code>)-prh(l))*poi_c(l)*cpbg</a>
<a name="rase_traceri243"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri244"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
<a name="rase_traceri245"></a>          <a href="convection_tracer_b.html#rase_tracer_bi6" target="diffFile">tem = (prj(l)-prh(l-<code class="constant">1</code>))/(prh(l)-prh(l-<code class="constant">1</code>))</a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">sht(l) = ssl(l-<code class="constant">1</code>) + tem*(ssl(l)-ssl(l-<code class="constant">1</code>))</a>
<a name="rase_traceri247"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qht(l) = <code class="constant">.5</code>*(qol(l)+qol(l-<code class="constant">1</code>))</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri248"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CALCULATE LAMBDA, ETA, AND WORKFUNCTION</code></a>
<a name="rase_traceri249"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">lambda_min = <code class="constant">.2</code>/mxdiam</a>
<a name="rase_traceri250"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">lambda_max = <code class="constant">.2</code>/<code class="constant">200.</code></a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (hol(k) .GT. hst(ic)) <code class="keyword">THEN</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi7" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri252"></a><a href="convection_tracer_b.html#rase_tracer_bi7" target="diffFile"><code class="comment">!LAMBDA CALCULATION: MS-A18</code></a>
<a name="rase_traceri251"></a>          <a href="convection_tracer_b.html#rase_tracer_bi7" target="diffFile">tem = (hst(ic)-hol(ic))*(zol(ic)-zet(ic+<code class="constant">1</code>))</a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k-<code class="constant">1</code></a>
<a name="rase_traceri253"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = tem + (hst(ic)-hol(l))*(zet(l)-zet(l+<code class="constant">1</code>))</a>
<a name="rase_traceri254"></a>          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (tem .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri255"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri256"></a>            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">alm = (hol(k)-hst(ic))/tem</a>
            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (alm .LE. lambda_max) <code class="keyword">THEN</code></a>
<a name="rase_traceri258"></a><a name="rase_traceri257"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri260"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">toki = <code class="constant">1.0</code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (alm .LT. lambda_min) toki = (alm/lambda_min)**<code class="constant">2</code></a>
<a name="rase_traceri259"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!ETA CALCULATION: MS-A2</code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
<a name="rase_traceri261"></a>                <a href="convection_tracer_b.html#rase_tracer_bi8" target="diffFile">eta(l) = <code class="constant">1.0 </code>+ alm*(zet(l)-zet(k))</a>
<a name="rase_traceri262"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
              <a href="convection_tracer_b.html#rase_tracer_bi9" target="diffFile">eta(ic) = <code class="constant">1.0 </code>+ alm*(zol(ic)-zet(k))</a>
<a name="rase_traceri263"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!WORKFUNCTION CALCULATION:  MS-A22</code></a>
<a name="rase_traceri268"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = <code class="constant">0.0</code></a>
<a name="rase_traceri264"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcc(k) = hol(k)</a>
<a name="rase_traceri265"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rase_traceri266"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcc(l) = hcc(l+<code class="constant">1</code>) + (eta(l)-eta(l+<code class="constant">1</code>))*hol(l)</a>
<a name="rase_traceri267"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = hcc(l+<code class="constant">1</code>)*dpb(l) + hcc(l)*dpt(l)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">eht(l) = eta(l+<code class="constant">1</code>)*dpb(l) + eta(l)*dpt(l)</a>
<a name="rase_traceri269"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = wfn + (tem-eht(l)*hst(l))*gam(l)</a>
<a name="rase_traceri270"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri271"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcc(ic) = hst(ic)*eta(ic)</a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = wfn + (hcc(ic+<code class="constant">1</code>)-hst(ic)*eta(ic+<code class="constant">1</code>))*gam(ic)*dpb(ic)</a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!VERTICAL VELOCITY/KE CALCULATION (ADDED 12/2001 JTB)</code></a>
<a name="rase_traceri272"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bk2(k) = <code class="constant">0.0</code></a>
<a name="rase_traceri283"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bke(k) = <code class="constant">0.0</code></a>
<a name="rase_traceri273"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcld(k) = hol(k)</a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic,-<code class="constant">1</code></a>
<a name="rase_traceri274"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">hcld(l) = (eta(l+<code class="constant">1</code>)*hcld(l+<code class="constant">1</code>)+(eta(l)-eta(l+<code class="constant">1</code>))*hol(l))/<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                 </code>eta(l)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = (hcld(l)-hst(l))*(zet(l)-zet(l+<code class="constant">1</code>))/(<code class="constant">1.0</code>+lbcp*dqq(l<code class="label">&</code></a>
<a name="rase_traceri275"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                 </code>))</a>
<a name="rase_traceri276"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bke(l) = bke(l+<code class="constant">1</code>) + grav*tem/(cp*prj(l+<code class="constant">1</code>)*poi(l))</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (tem .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri277"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">max1 = <code class="constant">0.0</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri278"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">max1 = tem</a>
<a name="rase_traceri279"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri280"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">bk2(l) = bk2(l+<code class="constant">1</code>) + grav*max1/(cp*prj(l+<code class="constant">1</code>)*poi(l))</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (bk2(l) .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri281"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">max2 = <code class="constant">0.0</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri282"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">max2 = bk2(l)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri284"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw(l) = <code class="funcname">SQRT</code>(<code class="constant">2.0</code>*max2)</a>
<a name="rase_traceri285"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri287"></a><a name="rase_traceri286"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!ALPHA CALCULATION </code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (zet(ic) .LT. <code class="constant">2000.</code>) rasal(ic) = rasal1</a>
<a name="rase_traceri288"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (zet(ic) .GE. <code class="constant">2000.</code>) rasal(ic) = rasal1 + (rasal2-<code class="label">&</code></a>
<a name="rase_traceri289"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                 </code>rasal1)*(zet(ic)-<code class="constant">2000.</code>)/<code class="constant">8000.</code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (rasal(ic) .GT. <code class="constant">1.0e5</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri290"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal(ic) = <code class="constant">1.0e5</code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri291"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal(ic) = rasal(ic)</a>
<a name="rase_traceri295"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri292"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rasal(ic) = dt/rasal(ic)</a>
<a name="rase_traceri293"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .LT. <code class="constant">1.00</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri294"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw(l) = <code class="constant">1.00</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw(l) = cvw(l)</a>
<a name="rase_traceri296"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri297"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri307"></a>              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">CALL </code><code class="funcname">ACRITN</code>(pol(ic), prs(k), acr, acritfac)</a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (wfn .GT. acr) <code class="keyword">THEN</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri298"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
<a name="rase_traceri299"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Scavenging of the below cloud tracer</code></a>
<a name="rase_traceri300"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">delzkm = (zet(ic)-zet(k))/<code class="constant">1000.</code></a>
<a name="rase_traceri301"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x4 = <code class="funcname">EXP</code>(-(fscav(itr)*delzkm))</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (x4 .GT. <code class="constant">1.</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri302"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x1 = <code class="constant">1.</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri303"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x1 = x4</a>
<a name="rase_traceri304"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (x1 .LT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri305"></a>                    <a href="convection_tracer_b.html#rase_tracer_bi10" target="diffFile">fnoscav = <code class="constant">0.</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri306"></a>                    <a href="convection_tracer_b.html#rase_tracer_bi11" target="diffFile">fnoscav = x1</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri308"></a>                  <a href="convection_tracer_b.html#rase_tracer_bi12" target="diffFile">xht(itr) = xoi(k, itr)*fnoscav</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wlq = qol(k)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uht = uoi(k)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vht = voi(k)</a>
<a name="rase_traceri346"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rnn(k) = <code class="constant">0.</code></a>
<a name="rase_traceri309"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(k) = <code class="constant">0.</code></a>
<a name="rase_traceri310"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic,-<code class="constant">1</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_bi13" target="diffFile">tem = eta(l) - eta(l+<code class="constant">1</code>)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wlq = wlq + tem*qol(l)</a>
<a name="rase_traceri320"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uht = uht + tem*uoi(l)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vht = vht + tem*voi(l)</a>
<a name="rase_traceri311"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
<a name="rase_traceri312"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Scavenging of the entrained tracer.  Updates transported tracer mass.</code></a>
<a name="rase_traceri313"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">delzkm = (zet(ic)-zet(l+<code class="constant">1</code>))/<code class="constant">1000.</code></a>
<a name="rase_traceri314"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x5 = <code class="funcname">EXP</code>(-(fscav(itr)*delzkm))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (x5 .GT. <code class="constant">1.</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri315"></a>                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x2 = <code class="constant">1.</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri316"></a>                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x2 = x5</a>
<a name="rase_traceri317"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (x2 .LT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri318"></a>                      <a href="convection_tracer_b.html#rase_tracer_bi14" target="diffFile">fnoscav = <code class="constant">0.</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri319"></a>                      <a href="convection_tracer_b.html#rase_tracer_bi15" target="diffFile">fnoscav = x2</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri321"></a>                    <a href="convection_tracer_b.html#rase_tracer_bi16" target="diffFile">xht(itr) = xht(itr) + tem*xoi(l, itr)*fnoscav</a>
<a name="rase_traceri322"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri323"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (l .GT. ic) <code class="keyword">THEN</code></a>
<a name="rase_traceri324"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tx2 = <code class="constant">0.5</code>*(qst(l)+qst(l-<code class="constant">1</code>))*eta(l)</a>
<a name="rase_traceri325"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tx3 = <code class="constant">0.5</code>*(hst(l)+hst(l-<code class="constant">1</code>))*eta(l)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qcc = tx2 + gm1(l)*(hcc(l)-tx3)</a>
<a name="rase_traceri326"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(l) = wlq - qcc</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri327"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(l) = wlq - qst(ic)*eta(ic)</a>
<a name="rase_traceri328"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (cll0(l) .LT. <code class="constant">0.00</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri329"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(l) = <code class="constant">0.00</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri330"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(l) = cll0(l)</a>
<a name="rase_traceri331"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri332"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cli = cll0(l)/eta(l)</a>
<a name="rase_traceri333"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">te_a = poi(l)*prh(l)</a>
<a name="rase_traceri334"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SUNDQ3_ICE</code>(te_a, sdqv2, sdqv3, sdqvt1, f2, f3)</a>
<a name="rase_traceri335"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">c00_x = co_auto(i)*f2*f3*f4</a>
<a name="rase_traceri336"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cli_crit_x = cli_crit/(f2*f3)</a>
<a name="rase_traceri337"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rate = c00_x*(<code class="constant">1.0</code>-<code class="funcname">EXP</code>(-(cli**<code class="constant">2</code>/cli_crit_x**<code class="constant">2</code>)))</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .LT. <code class="constant">1.00</code>) <code class="keyword">THEN</code></a>
<a name="rase_traceri338"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw_x = <code class="constant">1.00</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri339"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cvw_x = cvw(l)</a>
<a name="rase_traceri340"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri341"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dt_lyr = (zet(l)-zet(l+<code class="constant">1</code>))/cvw_x</a>
<a name="rase_traceri342"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">closs = cll0(l)*rate*dt_lyr</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (closs .GT. cll0(l)) <code class="keyword">THEN</code></a>
<a name="rase_traceri343"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">closs = cll0(l)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">closs = closs</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri344"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll0(l) = cll0(l) - closs</a>
<a name="rase_traceri345"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dll0(l) = closs</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (closs .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wlq = wlq - closs</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rnn(l) = closs</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rnn(l) = <code class="constant">0.</code></a>
<a name="rase_traceri347"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri348"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wlq = wlq - qst(ic)*eta(ic)</a>
<a name="rase_traceri349"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CALCULATE GAMMAS AND KERNEL</code></a>
<a name="rase_traceri350"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gms(k) = (sht(k)-ssl(k))*pri(k)</a>
<a name="rase_traceri351"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gmh(k) = gms(k) + (qht(k)-qol(k))*pri(k)*alhl</a>
<a name="rase_traceri356"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">akm = gmh(k)*gam(k-<code class="constant">1</code>)*dpb(k-<code class="constant">1</code>)</a>
<a name="rase_traceri352"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tx2 = gmh(k)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rase_traceri353"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gms(l) = (eta(l)*(sht(l)-ssl(l))+eta(l+<code class="constant">1</code>)*(ssl(l)-sht(<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                   </code>l+<code class="constant">1</code>)))*pri(l)</a>
<a name="rase_traceri354"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gmh(l) = gms(l) + (eta(l)*(qht(l)-qol(l))+eta(l+<code class="constant">1</code>)*(<code class="label">&</code></a>
<a name="rase_traceri355"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                   </code>qol(l)-qht(l+<code class="constant">1</code>)))*alhl*pri(l)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tx2 = tx2 + (eta(l)-eta(l+<code class="constant">1</code>))*gmh(l)</a>
<a name="rase_traceri357"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">akm = akm - gms(l)*eht(l)*pki(l) + tx2*ght(l)</a>
<a name="rase_traceri358"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri359"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gms(ic) = eta(ic+<code class="constant">1</code>)*(ssl(ic)-sht(ic+<code class="constant">1</code>))*pri(ic)</a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">akm = akm - gms(ic)*eta(ic+<code class="constant">1</code>)*dpb(ic)*pki(ic)</a>
<a name="rase_traceri360"></a>                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gmh(ic) = gms(ic) + (eta(ic+<code class="constant">1</code>)*(qol(ic)-qht(ic+<code class="constant">1</code>))*alhl+<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                 </code>eta(ic)*(hst(ic)-hol(ic)))*pri(ic)</a>
<a name="rase_traceri361"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CLOUD BASE MASS FLUX</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (.NOT.(akm .GE. <code class="constant">0.0 </code>.OR. wlq .LT. <code class="constant">0.0</code>)) <code class="keyword">THEN</code></a>
<a name="rase_traceri362"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rase_traceri363"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = -((wfn-acr)/akm)</a>
<a name="rase_traceri364"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">x3 = rasal(ic)*trg*toki*wfn</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (x3 .GT. (prs(k+<code class="constant">1</code>)-prs(k))*(<code class="constant">100.</code>*pblfrac)) <code class="keyword">THEN</code></a>
<a name="rase_traceri365"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = (prs(k+<code class="constant">1</code>)-prs(k))*(<code class="constant">100.</code>*pblfrac)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rase_traceri366"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = x3</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi17" target="diffFile"><code class="comment">!CUMULATIVE PRECIP AND CLOUD-BASE MASS FLUX FOR OUTPUT</code></a>
<a name="rase_traceri367"></a>                  <a href="convection_tracer_b.html#rase_tracer_bi17" target="diffFile">tem = wfn*gravi</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">cll(ic) = cll(ic) + wlq*tem</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmf(ic) = rmf(ic) + tem</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfd(ic) = rmfd(ic) + tem*eta(ic)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfp(l) = tem*eta(l)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rmfc(l) = rmfc(l) + rmfp(l)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">dllx(l) = dllx(l) + tem*dll0(l)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrp(l) = rmfp(l)*(ddt/daylen)*<code class="constant">1000.</code>/(cvw(l)*prs<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                       </code>(l))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">ELSE</code></a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrp(l) = <code class="constant">0.0</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">clli(l) = cll0(l)/eta(l)</a>
<a name="rase_traceri373"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">updfrc(l) = updfrc(l) + updfrp(l)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!THETA AND Q CHANGE DUE TO CLOUD TYPE IC</code></a>
<a name="rase_traceri368"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
<a name="rase_traceri369"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">rns(l) = rns(l) + rnn(l)*tem</a>
<a name="rase_traceri370"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gmh(l) = gmh(l)*wfn</a>
<a name="rase_traceri371"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">gms(l) = gms(l)*wfn</a>
<a name="rase_traceri372"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qoi(l) = qoi(l) + (gmh(l)-gms(l))*alhi</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">poi(l) = poi(l) + gms(l)*pki(l)*cpi</a>
<a name="rase_traceri374"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qst(l) = qst(l) + gms(l)*bet(l)*cpi</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri375"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!*FRICFAC*0.5</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = wfn*<code class="constant">0.5</code>*<code class="constant">1.0</code></a>
<a name="rase_traceri377"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
<a name="rase_traceri376"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = wfn*pri(k)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
                    <a href="convection_tracer_b.html#rase_tracer_bi18" target="diffFile">xcu(k, itr) = xcu(k, itr) + tem*(xoi(k-<code class="constant">1</code>, itr)-xoi(k<code class="label">&</code></a>
<a name="rase_traceri381"></a><a href="convection_tracer_b.html#rase_tracer_bi18" target="diffFile"><code class="label">&                     </code>, itr))</a>
<a name="rase_traceri380"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri378"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
<a name="rase_traceri379"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
                      <a href="convection_tracer_b.html#rase_tracer_bi20" target="diffFile">tem = wfn*pri(l)</a>
                      <a href="convection_tracer_b.html#rase_tracer_bi19" target="diffFile">xcu(l, itr) = xcu(l, itr) + tem*((xoi(l-<code class="constant">1</code>, itr)-<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi19" target="diffFile"><code class="label">&                       </code>xoi(l, itr))*eta(l)+(xoi(l, itr)-xoi(l+<code class="constant">1</code>, itr))*<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi19" target="diffFile"><code class="label">&                       </code>eta(l+<code class="constant">1</code>))</a>
<a name="rase_traceri382"></a>                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri384"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri383"></a>                  <a href="convection_tracer_b.html#rase_tracer_bi21" target="diffFile">tem = wfn*pri(ic)</a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
                    <a href="convection_tracer_b.html#rase_tracer_bi22" target="diffFile">xcu(ic, itr) = xcu(ic, itr) + (<code class="constant">2.</code>*(xht(itr)-xoi(ic, <code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi22" target="diffFile"><code class="label">&                     </code>itr)*(eta(ic)-eta(ic+<code class="constant">1</code>)))-(xoi(ic, itr)+xoi(ic+<code class="constant">1</code>, <code class="label">&</code></a>
<a name="rase_traceri387"></a><a href="convection_tracer_b.html#rase_tracer_bi22" target="diffFile"><code class="label">&                     </code>itr))*eta(ic+<code class="constant">1</code>))*tem</a>
<a name="rase_traceri386"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri385"></a>                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
                      <a href="convection_tracer_b.html#rase_tracer_bi23" target="diffFile">xoi(l, itr) = xoi(l, itr) + xcu(l, itr)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!End DO_TRACERS</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CUMULUS FRICTION</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (fricfac .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!================&gt;></code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wfn = wfn*fricfac*<code class="funcname">EXP</code>(-(alm/friclambda))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = wfn*pri(k)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ucu(k) = ucu(k) + tem*(uoi(k-<code class="constant">1</code>)-uoi(k))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vcu(k) = vcu(k) + tem*(voi(k-<code class="constant">1</code>)-voi(k))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = wfn*pri(l)</a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ucu(l) = ucu(l) + tem*((uoi(l-<code class="constant">1</code>)-uoi(l))*eta(l)+(<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                       </code>uoi(l)-uoi(l+<code class="constant">1</code>))*eta(l+<code class="constant">1</code>))</a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vcu(l) = vcu(l) + tem*((voi(l-<code class="constant">1</code>)-voi(l))*eta(l)+(<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                       </code>voi(l)-voi(l+<code class="constant">1</code>))*eta(l+<code class="constant">1</code>))</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tem = wfn*pri(ic)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">ucu(ic) = ucu(ic) + (<code class="constant">2.</code>*(uht-uoi(ic)*(eta(ic)-eta(ic<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                     </code>+<code class="constant">1</code>)))-(uoi(ic)+uoi(ic+<code class="constant">1</code>))*eta(ic+<code class="constant">1</code>))*tem</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vcu(ic) = vcu(ic) + (<code class="constant">2.</code>*(vht-voi(ic)*(eta(ic)-eta(ic<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="label">&                     </code>+<code class="constant">1</code>)))-(voi(ic)+voi(ic+<code class="constant">1</code>))*eta(ic+<code class="constant">1</code>))*tem</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uoi(l) = uoi(l) + ucu(l)</a>
                      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">voi(l) = voi(l) + vcu(l)</a>
                    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
                  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
                <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
              <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
            <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rase_traceri389"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!CLOUD LOOP</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">IF</code> (<code class="funcname">SUM</code>(rmf(icmin:k)) .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tho(i, icmin:k-<code class="constant">1</code>) = poi(icmin:k-<code class="constant">1</code>)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qho(i, icmin:k-<code class="constant">1</code>) = qoi(icmin:k-<code class="constant">1</code>)</a>
<a name="rase_traceri390"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uho(i, icmin:k-<code class="constant">1</code>) = uoi(icmin:k-<code class="constant">1</code>)</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vho(i, icmin:k-<code class="constant">1</code>) = voi(icmin:k-<code class="constant">1</code>)</a>
<a name="rase_traceri391"></a><a href="convection_tracer_b.html#rase_tracer_bi24" target="diffFile"><code class="comment">!De-strap tendencies from RAS</code></a>
      <a href="convection_tracer_b.html#rase_tracer_bi24" target="diffFile">wght = wgt1(i, :)</a>
<a name="rase_traceri393"></a><a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="comment">!Scale properly by layer masses</code></a>
<a name="rase_traceri392"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght0 = <code class="constant">0.</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rase_traceri394"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght0 = wght0 + wght(l)*(ple(i, l+<code class="constant">1</code>)-ple(i, l))</a>
<a name="rase_traceri395"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght0 = (prs(k+<code class="constant">1</code>)-prs(k))/wght0</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">wght = wght0*wght</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">tho(i, l) = tho(i, l) + wght(l)*(poi(k)-poi_sv(k))</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">qho(i, l) = qho(i, l) + wght(l)*(qoi(k)-qoi_sv(k))</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">uho(i, l) = uho(i, l) + wght(l)*(uoi(k)-uoi_sv(k))</a>
<a name="rase_traceri396"></a>        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile">vho(i, l) = vho(i, l) + wght(l)*(voi(k)-voi_sv(k))</a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rase_traceri399"></a><a href="convection_tracer_b.html#rase_tracer_bi25" target="diffFile"><code class="comment">!DO_TRACERS</code></a>
<a name="rase_traceri398"></a>      <a href="convection_tracer_b.html#rase_tracer_bi25" target="diffFile">xho(i, icmin:k-<code class="constant">1</code>, :) = xoi(icmin:k-<code class="constant">1</code>, :)</a>
<a name="rase_traceri397"></a>      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>itr=<code class="constant">1</code>,itrcr</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
          <a href="convection_tracer_b.html#rase_tracer_bi26" target="diffFile">xho(i, l, itr) = xho(i, l, itr) + wght(l)*(xoi(k, itr)-xoi_sv(<code class="label">&</code></a>
<a href="convection_tracer_b.html#rase_tracer_bi26" target="diffFile"><code class="label">&           </code>k, itr))</a>
        <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END IF</code></a>
<a href="convection_tracer_b.html#rase_tracer_b" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">RASE_TRACER</code></a>

<code class="keyword">SUBROUTINE </code><code class="funcname">ACRITN</code>(<code class="vardecl">pl</code>, <code class="vardecl">plb</code>, <code class="vardecl">acr</code>, <code class="vardecl">acritfac</code>)
  <code class="keyword">IMPLICIT NONE</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pl</code>, <code class="vardecl">plb</code>, <code class="vardecl">acritfac</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">acr</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">iwk</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">ph</code>(<code class="constant">15</code>)=(/<code class="constant">150.0</code>, <code class="constant">200.0</code>, <code class="constant">250.0</code>, <code class="constant">300.0</code>, <code class="constant">350.0</code>, <code class="constant">400.0</code><code class="label">&</code>
<code class="label">&   </code>, <code class="constant">450.0</code>, <code class="constant">500.0</code>, <code class="constant">550.0</code>, <code class="constant">600.0</code>, <code class="constant">650.0</code>, <code class="constant">700.0</code>, <code class="constant">750.0</code>, <code class="constant">800.0</code>, <code class="constant">850.0</code>/)
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">a</code>(<code class="constant">15</code>)=(/<code class="constant">1.6851</code>, <code class="constant">1.1686</code>, <code class="constant">0.7663</code>, <code class="constant">0.5255</code>, <code class="constant">0.4100</code>, <code class="label">&</code>
<code class="label">&   </code><code class="constant">0.3677</code>, <code class="constant">0.3151</code>, <code class="constant">0.2216</code>, <code class="constant">0.1521</code>, <code class="constant">0.1082</code>, <code class="constant">0.0750</code>, <code class="constant">0.0664</code>, <code class="constant">0.0553</code>, <code class="label">&</code>
<code class="label">&   </code><code class="constant">0.0445</code>, <code class="constant">0.0633</code>/)
  <code class="keyword">INTRINSIC </code><code class="funcname">INT</code>
  iwk = <code class="funcname">INT</code>(pl*<code class="constant">0.02 </code>- <code class="constant">0.999999999</code>)
  <code class="keyword">IF</code> (iwk .GT. <code class="constant">1 </code>.AND. iwk .LE. <code class="constant">15</code>) <code class="keyword">THEN</code>
    acr = a(iwk-<code class="constant">1</code>) + (pl-ph(iwk-<code class="constant">1</code>))*<code class="constant">.02</code>*(a(iwk)-a(iwk-<code class="constant">1</code>))
  <code class="keyword">ELSE IF</code> (iwk .GT. <code class="constant">15</code>) <code class="keyword">THEN</code>
    acr = a(<code class="constant">15</code>)
  <code class="keyword">ELSE</code>
    acr = a(<code class="constant">1</code>)
  <code class="keyword">END IF</code>
  acr = acritfac*acr*(plb-pl)
<code class="keyword">END SUBROUTINE </code><code class="funcname">ACRITN</code>

<code class="keyword">SUBROUTINE </code><code class="funcname">SUNDQ3_ICE</code>(<code class="vardecl">temp</code>, <code class="vardecl">rate2</code>, <code class="vardecl">rate3</code>, <code class="vardecl">te1</code>, <code class="vardecl">f2</code>, <code class="vardecl">f3</code>)
  <code class="keyword">IMPLICIT NONE</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">temp</code>, <code class="vardecl">rate2</code>, <code class="vardecl">rate3</code>, <code class="vardecl">te1</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">f2</code>, <code class="vardecl">f3</code>
<code class="comment">!,RATE2,RATE3,TE1</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">xx</code>, <code class="vardecl">yy</code>, <code class="vardecl">te0</code>, <code class="vardecl">te2</code>, <code class="vardecl">jump1</code>
  te0 = <code class="constant">273.</code>
  te2 = <code class="constant">200.</code>
  jump1 = (rate2-<code class="constant">1.0</code>)/(te0-te1)**<code class="constant">0.333</code>
<code class="comment">! Ice - phase treatment</code>
  <code class="keyword">IF</code> (temp .GE. te0) <code class="keyword">THEN</code>
    f2 = <code class="constant">1.0</code>
    f3 = <code class="constant">1.0</code>
  <code class="keyword">END IF</code>
  <code class="keyword">IF</code> (temp .GE. te1 .AND. temp .LT. te0) <code class="keyword">THEN</code>
    f2 = <code class="constant">1.0 </code>+ jump1*(te0-temp)**<code class="constant">0.3333</code>
    f3 = <code class="constant">1.0</code>
  <code class="keyword">END IF</code>
  <code class="keyword">IF</code> (temp .LT. te1) <code class="keyword">THEN</code>
    f2 = rate2 + (rate3-rate2)*(te1-temp)/(te1-te2)
    f3 = <code class="constant">1.0</code>
  <code class="keyword">END IF</code>
  <code class="keyword">IF</code> (f2 .GT. <code class="constant">27.0</code>) f2 = <code class="constant">27.0</code>
<code class="keyword">END SUBROUTINE </code><code class="funcname">SUNDQ3_ICE</code>

<code class="keyword">SUBROUTINE </code><code class="funcname">DQSAT_RAS</code>(<code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>, <code class="vardecl">temp</code>, <code class="vardecl">plo</code>, <code class="vardecl">lm</code>, <code class="vardecl">estblx</code>, <code class="vardecl">cons_h2omw</code>, <code class="label">&</code>
<code class="label">& </code><code class="vardecl">cons_airmw</code>)
  <code class="keyword">IMPLICIT NONE</code>
<code class="comment">!Inputs</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">lm</code>
  <code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>lm<code class="typename">) </code>:: <code class="vardecl">temp</code>, <code class="vardecl">plo</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">estblx</code>(:)
  <code class="typename">REAL*8 </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>
<code class="comment">!Outputs</code>
  <code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>lm<code class="typename">) </code>:: <code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>
<code class="comment">!Locals</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">max_mixing_ratio</code>=<code class="constant">1.0</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">esfac</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">k</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">tl</code>, <code class="vardecl">tt</code>, <code class="vardecl">ti</code>, <code class="vardecl">dqsat</code>, <code class="vardecl">qsat</code>, <code class="vardecl">dqq</code>, <code class="vardecl">qq</code>, <code class="vardecl">pl</code>, <code class="vardecl">pp</code>, <code class="vardecl">dd</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">it</code>
  <code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">degsubs</code>=<code class="constant">100</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tmintbl</code>=<code class="constant">150.0</code>, <code class="vardecl">tmaxtbl</code>=<code class="constant">333.0</code>
  <code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tablesize</code>=<code class="funcname">NINT</code>(<code class="vardecl">tmaxtbl</code>-<code class="vardecl">tmintbl</code>)*<code class="vardecl">degsubs</code>+<code class="constant">1</code>
  <code class="keyword">INTRINSIC </code><code class="funcname">NINT</code>
  <code class="keyword">INTRINSIC </code><code class="funcname">INT</code>
  esfac = cons_h2omw/cons_airmw
  <code class="keyword">DO </code>k=<code class="constant">1</code>,lm
    tl = temp(k)
    pl = plo(k)
    pp = pl*<code class="constant">100.0</code>
    <code class="keyword">IF</code> (tl .LE. tmintbl) <code class="keyword">THEN</code>
      ti = tmintbl
    <code class="keyword">ELSE IF</code> (tl .GE. tmaxtbl - <code class="constant">.001</code>) <code class="keyword">THEN</code>
      ti = tmaxtbl - <code class="constant">.001</code>
    <code class="keyword">ELSE</code>
      ti = tl
    <code class="keyword">END IF</code>
    tt = (ti-tmintbl)*degsubs + <code class="constant">1</code>
    it = <code class="funcname">INT</code>(tt)
    dqq = estblx(it+<code class="constant">1</code>) - estblx(it)
    qq = (tt-it)*dqq + estblx(it)
    <code class="keyword">IF</code> (pp .LE. qq) <code class="keyword">THEN</code>
      qsat = max_mixing_ratio
      dqsat = <code class="constant">0.0</code>
    <code class="keyword">ELSE</code>
      dd = <code class="constant">1.0</code>/(pp-(<code class="constant">1.0</code>-esfac)*qq)
      qsat = esfac*qq*dd
      dqsat = esfac*degsubs*dqq*pp*(dd*dd)
    <code class="keyword">END IF</code>
    dqsi(k) = dqsat
    qssi(k) = qsat
  <code class="keyword">END DO</code>
<code class="keyword">END SUBROUTINE </code><code class="funcname">DQSAT_RAS</code>

<code class="keyword">SUBROUTINE </code><code class="funcname">DQSATS_RAS</code>(<code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>, <code class="vardecl">temp</code>, <code class="vardecl">plo</code>, <code class="vardecl">estblx</code>, <code class="vardecl">cons_h2omw</code>, <code class="label">&</code>
<code class="label">& </code><code class="vardecl">cons_airmw</code>)
  <code class="keyword">IMPLICIT NONE</code>
<code class="comment">!Inputs</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">temp</code>, <code class="vardecl">plo</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">estblx</code>(:)
  <code class="typename">REAL*8 </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>
<code class="comment">!Outputs</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>
<code class="comment">!Locals</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">max_mixing_ratio</code>=<code class="constant">1.0</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">esfac</code>
  <code class="typename">REAL*8 </code>:: <code class="vardecl">tl</code>, <code class="vardecl">tt</code>, <code class="vardecl">ti</code>, <code class="vardecl">dqsat</code>, <code class="vardecl">qsat</code>, <code class="vardecl">dqq</code>, <code class="vardecl">qq</code>, <code class="vardecl">pl</code>, <code class="vardecl">pp</code>, <code class="vardecl">dd</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">it</code>
  <code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">degsubs</code>=<code class="constant">100</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tmintbl</code>=<code class="constant">150.0</code>, <code class="vardecl">tmaxtbl</code>=<code class="constant">333.0</code>
  <code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tablesize</code>=<code class="funcname">NINT</code>(<code class="vardecl">tmaxtbl</code>-<code class="vardecl">tmintbl</code>)*<code class="vardecl">degsubs</code>+<code class="constant">1</code>
  <code class="keyword">INTRINSIC </code><code class="funcname">NINT</code>
  <code class="keyword">INTRINSIC </code><code class="funcname">INT</code>
  esfac = cons_h2omw/cons_airmw
  tl = temp
  pl = plo
  pp = pl*<code class="constant">100.0</code>
  <code class="keyword">IF</code> (tl .LE. tmintbl) <code class="keyword">THEN</code>
    ti = tmintbl
  <code class="keyword">ELSE IF</code> (tl .GE. tmaxtbl - <code class="constant">.001</code>) <code class="keyword">THEN</code>
    ti = tmaxtbl - <code class="constant">.001</code>
  <code class="keyword">ELSE</code>
    ti = tl
  <code class="keyword">END IF</code>
  tt = (ti-tmintbl)*degsubs + <code class="constant">1</code>
  it = <code class="funcname">INT</code>(tt)
  dqq = estblx(it+<code class="constant">1</code>) - estblx(it)
  qq = (tt-it)*dqq + estblx(it)
  <code class="keyword">IF</code> (pp .LE. qq) <code class="keyword">THEN</code>
    qsat = max_mixing_ratio
    dqsat = <code class="constant">0.0</code>
  <code class="keyword">ELSE</code>
    dd = <code class="constant">1.0</code>/(pp-(<code class="constant">1.0</code>-esfac)*qq)
    qsat = esfac*qq*dd
    dqsat = esfac*degsubs*dqq*pp*(dd*dd)
  <code class="keyword">END IF</code>
  dqsi = dqsat
  qssi = qsat
<code class="keyword">END SUBROUTINE </code><code class="funcname">DQSATS_RAS</code>

</pre>
</body>
