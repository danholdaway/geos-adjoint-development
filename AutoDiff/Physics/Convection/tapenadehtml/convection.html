<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code>
<a name="rase"></a><code class="comment">!  Tapenade 3.9 (r5096) - 24 Feb 2014 16:53</code>
<code class="comment">!</code>
<a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">RASE</code>(<code class="vardecl">idim</code>, <code class="vardecl">irun</code>, <code class="vardecl">k0</code>, <code class="vardecl">icmin</code>, <code class="vardecl">dt</code>, <code class="vardecl">cons_cp</code>, <code class="vardecl">cons_alhl</code>, <code class="vardecl">cons_grav</code><code class="label">&</code></a>
<a href="convection_b.html#rase_b" target="diffFile"><code class="label">& </code>, <code class="vardecl">cons_rgas</code>, <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>, <code class="vardecl">cons_vireps</code>, <code class="vardecl">seedras</code>, <code class="vardecl">sige</code>, <code class="vardecl">kcbl</code><code class="label">&</code></a>
<a href="convection_b.html#rase_b" target="diffFile"><code class="label">& </code>, <code class="vardecl">wgt0</code>, <code class="vardecl">wgt1</code>, <code class="vardecl">frland</code>, <code class="vardecl">ts</code>, <code class="vardecl">tho</code>, <code class="vardecl">qho</code>, <code class="vardecl">uho</code>, <code class="vardecl">vho</code>, <code class="vardecl">co_auto</code>, <code class="vardecl">ple</code>, <code class="vardecl">clw</code>, <code class="vardecl">flxd</code><code class="label">&</code></a>
<a name="rasei80"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="label">& </code>, <code class="vardecl">cnv_prc3</code>, <code class="vardecl">cnv_updfrc</code>, <code class="vardecl">rasparams</code>, <code class="vardecl">estblx</code>)</a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="rasei81"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!INPUTS</code></a>
<a name="rasei82"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">idim</code>, <code class="vardecl">irun</code>, <code class="vardecl">k0</code>, <code class="vardecl">icmin</code></a>
<a name="rasei83"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0 + <code class="constant">1</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ple</code></a>
<a name="rasei84"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0 + <code class="constant">1</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">sige</code></a>
<a name="rasei85"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">dt</code>, <code class="vardecl">cons_cp</code>, <code class="vardecl">cons_alhl</code>, <code class="vardecl">cons_grav</code>, <code class="vardecl">cons_rgas</code></a>
<a name="rasei86"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code>, <code class="vardecl">cons_vireps</code></a>
<a name="rasei87"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">seedras</code></a>
<a name="rasei88"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kcbl</code></a>
<a name="rasei89"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">ts</code>, <code class="vardecl">frland</code></a>
<a name="rasei90"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">co_auto</code></a>
<a name="rasei91"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">wgt0</code>, <code class="vardecl">wgt1</code></a>
<a name="rasei92"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rasparams</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">estblx</code></a>
<a name="rasei93"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!OUTPUTS</code></a>
<a name="rasei94"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">clw</code>, <code class="vardecl">flxd</code></a>
<a name="rasei95"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">cnv_prc3</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">cnv_updfrc</code></a>
<a name="rasei96"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!PROGNOSTIC</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>idim, k0<code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">tho</code>, <code class="vardecl">qho</code>, <code class="vardecl">uho</code>, <code class="vardecl">vho</code></a>
<a name="rasei97"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!LOCALS</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">i</code>, <code class="vardecl">ic</code>, <code class="vardecl">l</code>, <code class="vardecl">kk</code>, <code class="vardecl">k</code></a>
<a name="rasei98"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Parameters</code></a>
<a name="rasei99"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">onepkap</code>=<code class="constant">1.</code>+<code class="constant">2.</code>/<code class="constant">7.</code>, <code class="vardecl">daylen</code>=<code class="constant">86400.0</code></a>
<a name="rasei100"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">rhmax</code>=<code class="constant">0.9999</code></a>
<a name="rasei101"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">cbl_qpert</code>=<code class="constant">0.0</code>, <code class="vardecl">cbl_tpert</code>=<code class="constant">1.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">cbl_tpert_mxocn</code>=<code class="constant">2.0</code>, <code class="vardecl">cbl_tpert_mxlnd</code>=<code class="constant">4.0</code></a>
<a name="rasei102"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Constants</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">grav</code>, <code class="vardecl">cp</code>, <code class="vardecl">alhl</code>, <code class="vardecl">cpbg</code>, <code class="vardecl">alhi</code>, <code class="vardecl">cpi</code>, <code class="vardecl">gravi</code>, <code class="vardecl">ddt</code>, <code class="vardecl">lbcp</code></a>
<a name="rasei103"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Rasparams</code></a>
<a name="rasei104"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">fricfac</code>, <code class="vardecl">cli_crit</code>, <code class="vardecl">rasal1</code>, <code class="vardecl">rasal2</code></a>
<a name="rasei105"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">friclambda</code></a>
<a name="rasei106"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">sdqv2</code>, <code class="vardecl">sdqv3</code>, <code class="vardecl">sdqvt1</code></a>
<a name="rasei107"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">acritfac</code>, <code class="vardecl">pblfrac</code>, <code class="vardecl">autorampb</code></a>
<a name="rasei108"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">maxdallowed</code>, <code class="vardecl">rhmn</code>, <code class="vardecl">rhmx</code></a>
<a name="rasei109"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">mxdiam</code></a>
<a name="rasei110"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tx2</code>, <code class="vardecl">tx3</code>, <code class="vardecl">akm</code>, <code class="vardecl">acr</code>, <code class="vardecl">alm</code>, <code class="vardecl">tth</code>, <code class="vardecl">qqh</code>, <code class="vardecl">dqx</code></a>
<a name="rasei111"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">wfn</code>, <code class="vardecl">tem</code>, <code class="vardecl">trg</code>, <code class="vardecl">trgexp</code>, <code class="vardecl">evp</code>, <code class="vardecl">wlq</code>, <code class="vardecl">qcc</code></a>
<a name="rasei112"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cli</code>, <code class="vardecl">te_a</code>, <code class="vardecl">c00_x</code>, <code class="vardecl">cli_crit_x</code>, <code class="vardecl">toki</code></a>
<a name="rasei113"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dt_lyr</code>, <code class="vardecl">rate</code>, <code class="vardecl">cvw_x</code>, <code class="vardecl">closs</code>, <code class="vardecl">f2</code>, <code class="vardecl">f3</code>, <code class="vardecl">f4</code></a>
<a name="rasei114"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">wght0</code>, <code class="vardecl">prcbl</code>, <code class="vardecl">rndu</code></a>
<a name="rasei115"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">lambda_min</code>, <code class="vardecl">lambda_max</code></a>
<a name="rasei116"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tpert</code>, <code class="vardecl">qpert</code></a>
<a name="rasei117"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">uht</code>, <code class="vardecl">vht</code></a>
<a name="rasei118"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi_sv</code>, <code class="vardecl">qoi_sv</code>, <code class="vardecl">uoi_sv</code>, <code class="vardecl">voi_sv</code></a>
<a name="rasei119"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi</code>, <code class="vardecl">qoi</code>, <code class="vardecl">uoi</code>, <code class="vardecl">voi</code>, <code class="vardecl">dqq</code>, <code class="vardecl">bet</code>, <code class="vardecl">gam</code>, <code class="vardecl">cll</code></a>
<a name="rasei120"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">poi_c</code>, <code class="vardecl">qoi_c</code></a>
<a name="rasei121"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">prh</code>, <code class="vardecl">pri</code>, <code class="vardecl">ght</code>, <code class="vardecl">dpt</code>, <code class="vardecl">dpb</code>, <code class="vardecl">pki</code></a>
<a name="rasei122"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">ucu</code>, <code class="vardecl">vcu</code></a>
<a name="rasei123"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">cln</code>, <code class="vardecl">rns</code>, <code class="vardecl">pol</code></a>
<a name="rasei124"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">qst</code>, <code class="vardecl">ssl</code>, <code class="vardecl">rmf</code>, <code class="vardecl">rnn</code>, <code class="vardecl">rn1</code>, <code class="vardecl">rmfc</code>, <code class="vardecl">rmfp</code></a>
<a name="rasei125"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">gms</code>, <code class="vardecl">eta</code>, <code class="vardecl">gmh</code>, <code class="vardecl">eht</code>, <code class="vardecl">gm1</code>, <code class="vardecl">hcc</code>, <code class="vardecl">rmfd</code></a>
<a name="rasei126"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">hol</code>, <code class="vardecl">hst</code>, <code class="vardecl">qol</code>, <code class="vardecl">zol</code>, <code class="vardecl">hcld</code>, <code class="vardecl">cll0</code>, <code class="vardecl">cllx</code>, <code class="vardecl">clli</code></a>
<a name="rasei127"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">bke</code>, <code class="vardecl">cvw</code>, <code class="vardecl">updfrc</code></a>
<a name="rasei128"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">rasal</code>, <code class="vardecl">updfrp</code>, <code class="vardecl">bk2</code>, <code class="vardecl">dll0</code>, <code class="vardecl">dllx</code></a>
<a name="rasei129"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">wght</code>, <code class="vardecl">massf</code></a>
<a name="rasei130"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0<code class="typename">) </code>:: <code class="vardecl">qss</code>, <code class="vardecl">dqs</code>, <code class="vardecl">pf</code>, <code class="vardecl">pk</code>, <code class="vardecl">tempf</code>, <code class="vardecl">zlo</code></a>
<a name="rasei131"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>k0 + <code class="constant">1</code><code class="typename">) </code>:: <code class="vardecl">prj</code>, <code class="vardecl">prs</code>, <code class="vardecl">qht</code>, <code class="vardecl">sht</code>, <code class="vardecl">zet</code>, <code class="vardecl">zle</code>, <code class="vardecl">pke</code></a>
<a name="rasei132"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="rasei133"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
<a name="rasei134"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="rasei135"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">EXP</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">arg1</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">x1</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">max2</code></a>
<a name="rasei136"></a>  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">max1</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">y1</code></a>
<a name="rasei137"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Initialize Local Arrays</code></a>
<a name="rasei138"></a>  <a href="convection_b.html#rase_b" target="diffFile">poi = <code class="constant">0.0</code></a>
<a name="rasei139"></a>  <a href="convection_b.html#rase_b" target="diffFile">qoi = <code class="constant">0.0</code></a>
<a name="rasei140"></a>  <a href="convection_b.html#rase_b" target="diffFile">uoi = <code class="constant">0.0</code></a>
<a name="rasei141"></a>  <a href="convection_b.html#rase_b" target="diffFile">voi = <code class="constant">0.0</code></a>
<a name="rasei142"></a>  <a href="convection_b.html#rase_b" target="diffFile">dqq = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">bet = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">gam = <code class="constant">0.0</code></a>
<a name="rasei143"></a>  <a href="convection_b.html#rase_b" target="diffFile">poi_c = <code class="constant">0.0</code></a>
<a name="rasei144"></a>  <a href="convection_b.html#rase_b" target="diffFile">qoi_c = <code class="constant">0.0</code></a>
<a name="rasei145"></a>  <a href="convection_b.html#rase_b" target="diffFile">prh = <code class="constant">0.0</code></a>
<a name="rasei146"></a>  <a href="convection_b.html#rase_b" target="diffFile">pri = <code class="constant">0.0</code></a>
<a name="rasei147"></a>  <a href="convection_b.html#rase_b" target="diffFile">ght = <code class="constant">0.0</code></a>
<a name="rasei148"></a>  <a href="convection_b.html#rase_b" target="diffFile">dpt = <code class="constant">0.0</code></a>
<a name="rasei149"></a>  <a href="convection_b.html#rase_b" target="diffFile">dpb = <code class="constant">0.0</code></a>
<a name="rasei150"></a>  <a href="convection_b.html#rase_b" target="diffFile">pki = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">ucu = <code class="constant">0.0</code></a>
<a name="rasei151"></a>  <a href="convection_b.html#rase_b" target="diffFile">vcu = <code class="constant">0.0</code></a>
<a name="rasei152"></a>  <a href="convection_b.html#rase_b" target="diffFile">cln = <code class="constant">0.0</code></a>
<a name="rasei153"></a>  <a href="convection_b.html#rase_b" target="diffFile">pol = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">qst = <code class="constant">0.0</code></a>
<a name="rasei154"></a>  <a href="convection_b.html#rase_b" target="diffFile">ssl = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">rmf = <code class="constant">0.0</code></a>
<a name="rasei155"></a>  <a href="convection_b.html#rase_b" target="diffFile">rnn = <code class="constant">0.0</code></a>
<a name="rasei156"></a>  <a href="convection_b.html#rase_b" target="diffFile">rn1 = <code class="constant">0.0</code></a>
<a name="rasei157"></a>  <a href="convection_b.html#rase_b" target="diffFile">gms = <code class="constant">0.0</code></a>
<a name="rasei158"></a>  <a href="convection_b.html#rase_b" target="diffFile">eta = <code class="constant">0.0</code></a>
<a name="rasei159"></a>  <a href="convection_b.html#rase_b" target="diffFile">gmh = <code class="constant">0.0</code></a>
<a name="rasei160"></a>  <a href="convection_b.html#rase_b" target="diffFile">eht = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">gm1 = <code class="constant">0.0</code></a>
<a name="rasei161"></a>  <a href="convection_b.html#rase_b" target="diffFile">hcc = <code class="constant">0.0</code></a>
<a name="rasei162"></a>  <a href="convection_b.html#rase_b" target="diffFile">hol = <code class="constant">0.0</code></a>
<a name="rasei163"></a>  <a href="convection_b.html#rase_b" target="diffFile">hst = <code class="constant">0.0</code></a>
<a name="rasei164"></a>  <a href="convection_b.html#rase_b" target="diffFile">qol = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">zol = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">hcld = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">bke = <code class="constant">0.0</code></a>
<a name="rasei165"></a>  <a href="convection_b.html#rase_b" target="diffFile">cvw = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">updfrc = <code class="constant">0.0</code></a>
<a name="rasei166"></a>  <a href="convection_b.html#rase_b" target="diffFile">rasal = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">updfrp = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">bk2 = <code class="constant">0.0</code></a>
<a name="rasei167"></a>  <a href="convection_b.html#rase_b" target="diffFile">wght = <code class="constant">0.0</code></a>
<a name="rasei168"></a>  <a href="convection_b.html#rase_b" target="diffFile">massf = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">qss = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">dqs = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">pf = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">pk = <code class="constant">0.0</code></a>
<a name="rasei169"></a>  <a href="convection_b.html#rase_b" target="diffFile">tempf = <code class="constant">0.0</code></a>
<a name="rasei170"></a>  <a href="convection_b.html#rase_b" target="diffFile">zlo = <code class="constant">0.0</code></a>
<a name="rasei171"></a>  <a href="convection_b.html#rase_b" target="diffFile">prj = <code class="constant">0.0</code></a>
<a name="rasei172"></a>  <a href="convection_b.html#rase_b" target="diffFile">prs = <code class="constant">0.0</code></a>
<a name="rasei173"></a>  <a href="convection_b.html#rase_b" target="diffFile">qht = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">sht = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">zet = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">zle = <code class="constant">0.0</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">pke = <code class="constant">0.0</code></a>
<a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Initialize Outputs</code></a>
<a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  ---  1</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">cnv_prc3 = <code class="constant">0.</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">cnv_updfrc = <code class="constant">0.</code></a>
<a name="rasei174"></a>  <a href="convection_b.html#rase_b" target="diffFile">flxd = <code class="constant">0.</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">clw = <code class="constant">0.</code></a>
<a name="rasei175"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  ---  1</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">fricfac = rasparams(<code class="constant">1</code>)</a>
<a name="rasei176"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  ---  4</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">cli_crit = rasparams(<code class="constant">4</code>)</a>
<a name="rasei177"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  ---  5</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">rasal1 = rasparams(<code class="constant">5</code>)</a>
<a name="rasei178"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  ---  6</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">rasal2 = rasparams(<code class="constant">6</code>)</a>
<a name="rasei179"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 11</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">friclambda = rasparams(<code class="constant">11</code>)</a>
<a name="rasei180"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 14</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">sdqv2 = rasparams(<code class="constant">14</code>)</a>
<a name="rasei181"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 15</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">sdqv3 = rasparams(<code class="constant">15</code>)</a>
<a name="rasei182"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 16</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">sdqvt1 = rasparams(<code class="constant">16</code>)</a>
<a name="rasei183"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 17</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">acritfac = rasparams(<code class="constant">17</code>)</a>
<a name="rasei184"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 20</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">pblfrac = rasparams(<code class="constant">20</code>)</a>
<a name="rasei185"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 21</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">autorampb = rasparams(<code class="constant">21</code>)</a>
<a name="rasei186"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 24</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">rhmn = rasparams(<code class="constant">24</code>)</a>
<a name="rasei187"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 24</code></a>
  <a href="convection_b.html#rase_b" target="diffFile">maxdallowed = rasparams(<code class="constant">23</code>)</a>
<a name="rasei188"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!  --- 25</code></a>
<a name="rasei189"></a>  <a href="convection_b.html#rase_b" target="diffFile">rhmx = rasparams(<code class="constant">25</code>)</a>
<a name="rasei190"></a>  <a href="convection_b.html#rase_b" target="diffFile">grav = cons_grav</a>
<a name="rasei191"></a>  <a href="convection_b.html#rase_b" target="diffFile">alhl = cons_alhl</a>
<a name="rasei192"></a>  <a href="convection_b.html#rase_b" target="diffFile">cp = cons_cp</a>
<a name="rasei193"></a>  <a href="convection_b.html#rase_b" target="diffFile">cpi = <code class="constant">1.0</code>/cp</a>
<a name="rasei194"></a>  <a href="convection_b.html#rase_b" target="diffFile">alhi = <code class="constant">1.0</code>/alhl</a>
<a name="rasei195"></a>  <a href="convection_b.html#rase_b" target="diffFile">gravi = <code class="constant">1.0</code>/grav</a>
<a name="rasei196"></a>  <a href="convection_b.html#rase_b" target="diffFile">cpbg = cp*gravi</a>
<a name="rasei197"></a>  <a href="convection_b.html#rase_b" target="diffFile">ddt = daylen/dt</a>
<a name="rasei198"></a>  <a href="convection_b.html#rase_b" target="diffFile">lbcp = alhl*cpi</a>
  <a href="convection_b.html#rase_b" target="diffFile">i = <code class="constant">1</code></a>
<a name="rasei199"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!CALL FINDBASE</code></a>
<a name="rasei200"></a>  <a href="convection_b.html#rase_b" target="diffFile">k = kcbl(i)</a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (k .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="rasei201"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Get saturation specific humidity and gradient wrt to T</code></a>
<a name="rasei202"></a>    <a href="convection_b.html#rase_b" target="diffFile">pke = (ple(i, :)/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rasei203"></a>    <a href="convection_b.html#rase_b" target="diffFile">pf = <code class="constant">0.5</code>*(ple(i, <code class="constant">1</code>:k0)+ple(i, <code class="constant">2</code>:k0+<code class="constant">1</code>))</a>
<a name="rasei204"></a>    <a href="convection_b.html#rase_b" target="diffFile">pk = (pf/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rasei205"></a>    <a href="convection_b.html#rase_bi22" target="diffFile">tempf = tho(i, :)*pk</a>
<a name="rasei206"></a>    <a href="convection_b.html#rase_b" target="diffFile">zle = <code class="constant">0.0</code></a>
<a name="rasei210"></a>    <a href="convection_b.html#rase_b" target="diffFile">zlo = <code class="constant">0.0</code></a>
<a name="rasei207"></a>    <a href="convection_b.html#rase_b" target="diffFile">zle(k0+<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rasei208"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k0,<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rasei209"></a>      <a href="convection_b.html#rase_bi25" target="diffFile">zle(l) = tho(i, l)*(<code class="constant">1.</code>+cons_vireps*qho(i, l))</a>
      <a href="convection_b.html#rase_bi24" target="diffFile">zlo(l) = zle(l+<code class="constant">1</code>) + cons_cp/cons_grav*(pke(l+<code class="constant">1</code>)-pk(l))*zle(l)</a>
<a name="rasei211"></a>      <a href="convection_b.html#rase_bi23" target="diffFile">zle(l) = zlo(l) + cons_cp/cons_grav*(pk(l)-pke(l))*zle(l)</a>
<a name="rasei212"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="convection_b.html#rase_bi26" target="diffFile">tpert = cbl_tpert*(ts(i)-(tempf(k0)+cons_grav*zlo(k0)/cons_cp))</a>
<a name="rasei213"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!* ( QSSFC - Q(:,:,K0) ) [CBL_QPERT = 0.0]</code></a>
<a name="rasei214"></a>    <a href="convection_b.html#rase_b" target="diffFile">qpert = cbl_qpert</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (tpert .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei215"></a>      <a href="convection_b.html#rase_b" target="diffFile">tpert = <code class="constant">0.0</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei216"></a>      <a href="convection_b.html#rase_b" target="diffFile">tpert = tpert</a>
<a name="rasei217"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (qpert .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei218"></a>      <a href="convection_b.html#rase_b" target="diffFile">qpert = <code class="constant">0.0</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei219"></a>      <a href="convection_b.html#rase_b" target="diffFile">qpert = qpert</a>
<a name="rasei220"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei221"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (frland(i) .LT. <code class="constant">0.1</code>) <code class="keyword">THEN</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (tpert .GT. cbl_tpert_mxocn) <code class="keyword">THEN</code></a>
<a name="rasei222"></a>        <a href="convection_b.html#rase_b" target="diffFile">tpert = cbl_tpert_mxocn</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei223"></a>        <a href="convection_b.html#rase_b" target="diffFile">tpert = tpert</a>
<a name="rasei224"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE IF</code> (tpert .GT. cbl_tpert_mxlnd) <code class="keyword">THEN</code></a>
<a name="rasei225"></a>      <a href="convection_b.html#rase_b" target="diffFile">tpert = cbl_tpert_mxlnd</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei226"></a>      <a href="convection_b.html#rase_b" target="diffFile">tpert = tpert</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei228"></a>    <a href="convection_b.html#rase_bi27" target="diffFile"><code class="keyword">CALL </code><code class="funcname">DQSAT_RAS</code>(dqs, qss, tempf, pf, k0, estblx, cons_h2omw, <code class="label">&</code></a>
<a name="rasei227"></a><a href="convection_b.html#rase_bi27" target="diffFile"><code class="label">&            </code>cons_airmw)</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>kk=icmin,k+<code class="constant">1</code></a>
<a name="rasei229"></a>      <a href="convection_b.html#rase_b" target="diffFile">prj(kk) = pke(kk)</a>
<a name="rasei230"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei231"></a>    <a href="convection_b.html#rase_b" target="diffFile">prs(icmin:k0+<code class="constant">1</code>) = ple(i, icmin:k0+<code class="constant">1</code>)</a>
<a name="rasei232"></a>    <a href="convection_b.html#rase_bi33" target="diffFile">poi(icmin:k) = tho(i, icmin:k)</a>
<a name="rasei233"></a>    <a href="convection_b.html#rase_bi32" target="diffFile">qoi(icmin:k) = qho(i, icmin:k)</a>
<a name="rasei234"></a>    <a href="convection_b.html#rase_bi31" target="diffFile">uoi(icmin:k) = uho(i, icmin:k)</a>
<a name="rasei235"></a>    <a href="convection_b.html#rase_bi30" target="diffFile">voi(icmin:k) = vho(i, icmin:k)</a>
<a name="rasei236"></a>    <a href="convection_b.html#rase_bi29" target="diffFile">qst(icmin:k) = qss(icmin:k)</a>
    <a href="convection_b.html#rase_bi28" target="diffFile">dqq(icmin:k) = dqs(icmin:k)</a>
<a name="rasei237"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Mass fraction of each layer below cloud base</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">massf(:) = wgt0(i, :)</a>
<a name="rasei239"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!RESET PRESSURE at bottom edge of CBL </code></a>
<a name="rasei238"></a>    <a href="convection_b.html#rase_b" target="diffFile">prcbl = prs(k)</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rasei240"></a>      <a href="convection_b.html#rase_b" target="diffFile">prcbl = prcbl + massf(l)*(prs(l+<code class="constant">1</code>)-prs(l))</a>
<a name="rasei241"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei248"></a>    <a href="convection_b.html#rase_b" target="diffFile">prs(k+<code class="constant">1</code>) = prcbl</a>
<a name="rasei242"></a>    <a href="convection_b.html#rase_b" target="diffFile">prj(k+<code class="constant">1</code>) = (prs(k+<code class="constant">1</code>)/<code class="constant">1000.</code>)**(cons_rgas/cons_cp)</a>
<a name="rasei243"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
      <a href="convection_b.html#rase_b" target="diffFile">pol(l) = <code class="constant">0.5</code>*(prs(l)+prs(l+<code class="constant">1</code>))</a>
<a name="rasei244"></a>      <a href="convection_b.html#rase_b" target="diffFile">prh(l) = (prs(l+<code class="constant">1</code>)*prj(l+<code class="constant">1</code>)-prs(l)*prj(l))/(onepkap*(prs(l+<code class="constant">1</code>)-prs(<code class="label">&</code></a>
<a name="rasei245"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="label">&       </code>l)))</a>
<a name="rasei246"></a>      <a href="convection_b.html#rase_b" target="diffFile">pki(l) = <code class="constant">1.0</code>/prh(l)</a>
<a name="rasei247"></a>      <a href="convection_b.html#rase_b" target="diffFile">dpt(l) = prh(l) - prj(l)</a>
      <a href="convection_b.html#rase_b" target="diffFile">dpb(l) = prj(l+<code class="constant">1</code>) - prh(l)</a>
<a name="rasei249"></a>      <a href="convection_b.html#rase_b" target="diffFile">pri(l) = <code class="constant">.01</code>/(prs(l+<code class="constant">1</code>)-prs(l))</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei250"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!RECALCULATE PROFILE QUAN. IN LOWEST STRAPPED LAYER</code></a>
<a name="rasei251"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (k .LE. k0) <code class="keyword">THEN</code></a>
<a name="rasei252"></a>      <a href="convection_b.html#rase_bi37" target="diffFile">poi(k) = <code class="constant">0.</code></a>
<a name="rasei253"></a>      <a href="convection_b.html#rase_bi36" target="diffFile">qoi(k) = <code class="constant">0.</code></a>
<a name="rasei254"></a>      <a href="convection_b.html#rase_bi35" target="diffFile">uoi(k) = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_bi34" target="diffFile">voi(k) = <code class="constant">0.</code></a>
<a name="rasei256"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!SPECIFY WEIGHTS GIVEN TO EACH LAYER WITHIN SUBCLOUD "SUPERLAYER"</code></a>
<a name="rasei255"></a>      <a href="convection_b.html#rase_b" target="diffFile">wght = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rasei261"></a>        <a href="convection_b.html#rase_b" target="diffFile">wght(l) = massf(l)*(ple(i, l+<code class="constant">1</code>)-ple(i, l))/(prs(k+<code class="constant">1</code>)-prs(k))</a>
<a name="rasei257"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei258"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rasei259"></a>        <a href="convection_b.html#rase_bi41" target="diffFile">poi(k) = poi(k) + wght(l)*tho(i, l)</a>
<a name="rasei260"></a>        <a href="convection_b.html#rase_bi40" target="diffFile">qoi(k) = qoi(k) + wght(l)*qho(i, l)</a>
        <a href="convection_b.html#rase_bi39" target="diffFile">uoi(k) = uoi(k) + wght(l)*uho(i, l)</a>
<a name="rasei262"></a>        <a href="convection_b.html#rase_bi38" target="diffFile">voi(k) = voi(k) + wght(l)*vho(i, l)</a>
<a name="rasei264"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="convection_b.html#rase_bi43" target="diffFile">arg1 = poi(k)*prh(k)</a>
      <a href="convection_b.html#rase_bi42" target="diffFile"><code class="keyword">CALL </code><code class="funcname">DQSATS_RAS</code>(dqq(k), qst(k), arg1, pol(k), estblx, cons_h2omw, <code class="label">&</code></a>
<a name="rasei265"></a><a href="convection_b.html#rase_bi42" target="diffFile"><code class="label">&               </code>cons_airmw)</a>
<a name="rasei266"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (seedras(i)/<code class="constant">1000000. </code>.LT. <code class="constant">1e-6</code>) <code class="keyword">THEN</code></a>
<a name="rasei267"></a>      <a href="convection_b.html#rase_b" target="diffFile">rndu = <code class="constant">1e-6</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei268"></a>      <a href="convection_b.html#rase_b" target="diffFile">rndu = seedras(i)/<code class="constant">1000000.</code></a>
<a name="rasei274"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei269"></a>    <a href="convection_b.html#rase_b" target="diffFile">mxdiam = maxdallowed*rndu**(-(<code class="constant">1.</code>/<code class="constant">2.</code>))</a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
<a name="rasei270"></a><a href="convection_b.html#rase_bi45" target="diffFile"><code class="comment">!*</code></a>
      <a href="convection_b.html#rase_bi45" target="diffFile">bet(l) = dqq(l)*pki(l)</a>
<a name="rasei271"></a><a href="convection_b.html#rase_bi44" target="diffFile"><code class="comment">!*</code></a>
<a name="rasei272"></a>      <a href="convection_b.html#rase_bi44" target="diffFile">gam(l) = pki(l)/(<code class="constant">1.0</code>+lbcp*dqq(l))</a>
<a name="rasei273"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (l .LT. k) <code class="keyword">THEN</code></a>
        <a href="convection_b.html#rase_bi47" target="diffFile">ght(l+<code class="constant">1</code>) = gam(l)*dpb(l) + gam(l+<code class="constant">1</code>)*dpt(l+<code class="constant">1</code>)</a>
        <a href="convection_b.html#rase_bi46" target="diffFile">gm1(l+<code class="constant">1</code>) = <code class="constant">0.5</code>*lbcp*(dqq(l)/(alhl*(<code class="constant">1.0</code>+lbcp*dqq(l)))+dqq(l+<code class="constant">1</code>)/(<code class="label">&</code></a>
<a href="convection_b.html#rase_bi46" target="diffFile"><code class="label">&         </code>alhl*(<code class="constant">1.0</code>+lbcp*dqq(l+<code class="constant">1</code>))))</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei275"></a>    <a href="convection_b.html#rase_b" target="diffFile">rns = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">cll = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">rmf = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">rmfd = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">rmfc = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">rmfp = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">cll0 = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">dll0 = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">cllx = <code class="constant">0.</code></a>
<a name="rasei283"></a>    <a href="convection_b.html#rase_b" target="diffFile">dllx = <code class="constant">0.</code></a>
<a name="rasei282"></a>    <a href="convection_b.html#rase_b" target="diffFile">clli = <code class="constant">0.</code></a>
<a name="rasei281"></a>    <a href="convection_b.html#rase_bi52" target="diffFile">poi_sv = poi</a>
<a name="rasei280"></a>    <a href="convection_b.html#rase_bi51" target="diffFile">qoi_sv = qoi</a>
<a name="rasei276"></a>    <a href="convection_b.html#rase_bi50" target="diffFile">uoi_sv = uoi</a>
    <a href="convection_b.html#rase_bi49" target="diffFile">voi_sv = voi</a>
    <a href="convection_b.html#rase_b" target="diffFile">cvw = <code class="constant">0.0</code></a>
<a name="rasei277"></a>    <a href="convection_b.html#rase_b" target="diffFile">updfrc = <code class="constant">0.0</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">updfrp = <code class="constant">0.0</code></a>
<a name="rasei278"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">! HOL initialized here in order not to confuse Valgrind debugger</code></a>
<a name="rasei279"></a>    <a href="convection_b.html#rase_b" target="diffFile">hol = <code class="constant">0.</code></a>
<a name="rasei296"></a>    <a href="convection_b.html#rase_b" target="diffFile">zet(k+<code class="constant">1</code>) = <code class="constant">0</code></a>
<a name="rasei284"></a>    <a href="convection_b.html#rase_bi48" target="diffFile">sht(k+<code class="constant">1</code>) = cp*poi(k)*prj(k+<code class="constant">1</code>)</a>
<a name="rasei285"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,icmin,-<code class="constant">1</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (qst(l)*rhmax .GT. qoi(l)) <code class="keyword">THEN</code></a>
<a name="rasei286"></a>        <a href="convection_b.html#rase_bi53" target="diffFile">qol(l) = qoi(l)</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei287"></a>        <a href="convection_b.html#rase_bi54" target="diffFile">qol(l) = qst(l)*rhmax</a>
<a name="rasei288"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.000 </code>.LT. qol(l)) <code class="keyword">THEN</code></a>
<a name="rasei289"></a>        <a href="convection_b.html#rase_b" target="diffFile">qol(l) = qol(l)</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei290"></a>        <a href="convection_b.html#rase_bi55" target="diffFile">qol(l) = <code class="constant">0.000</code></a>
<a name="rasei291"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei292"></a>      <a href="convection_b.html#rase_bi60" target="diffFile">ssl(l) = cp*prj(l+<code class="constant">1</code>)*poi(l) + grav*zet(l+<code class="constant">1</code>)</a>
<a name="rasei293"></a>      <a href="convection_b.html#rase_bi59" target="diffFile">hol(l) = ssl(l) + qol(l)*alhl</a>
<a name="rasei294"></a>      <a href="convection_b.html#rase_bi58" target="diffFile">hst(l) = ssl(l) + qst(l)*alhl</a>
<a name="rasei295"></a>      <a href="convection_b.html#rase_b" target="diffFile">tem = poi(l)*(prj(l+<code class="constant">1</code>)-prj(l))*cpbg</a>
      <a href="convection_b.html#rase_bi57" target="diffFile">zet(l) = zet(l+<code class="constant">1</code>) + tem</a>
<a name="rasei473"></a>      <a href="convection_b.html#rase_bi56" target="diffFile">zol(l) = zet(l+<code class="constant">1</code>) + (prj(l+<code class="constant">1</code>)-prh(l))*poi(l)*cpbg</a>
<a name="rasei297"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei298"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>ic=k,icmin+<code class="constant">1</code>,-<code class="constant">1</code></a>
      <a href="convection_b.html#rase_bi62" target="diffFile">ucu(icmin:) = <code class="constant">0.</code></a>
<a name="rasei299"></a>      <a href="convection_b.html#rase_bi61" target="diffFile">vcu(icmin:) = <code class="constant">0.</code></a>
<a name="rasei300"></a>      <a href="convection_b.html#rase_b" target="diffFile">alm = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1. </code>.GT. (qoi(k)/qst(k)-rhmn)/(rhmx-rhmn)) <code class="keyword">THEN</code></a>
<a name="rasei301"></a>        <a href="convection_b.html#rase_bi63" target="diffFile">trg = (qoi(k)/qst(k)-rhmn)/(rhmx-rhmn)</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei302"></a>        <a href="convection_b.html#rase_bi64" target="diffFile">trg = <code class="constant">1.</code></a>
<a name="rasei303"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.0 </code>.LT. (autorampb-sige(ic))/<code class="constant">0.2</code>) <code class="keyword">THEN</code></a>
<a name="rasei304"></a>        <a href="convection_b.html#rase_b" target="diffFile">y1 = (autorampb-sige(ic))/<code class="constant">0.2</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei305"></a>        <a href="convection_b.html#rase_b" target="diffFile">y1 = <code class="constant">0.0</code></a>
<a name="rasei306"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1.0 </code>.GT. y1) <code class="keyword">THEN</code></a>
<a name="rasei307"></a>        <a href="convection_b.html#rase_bi65" target="diffFile">f4 = y1</a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei308"></a>        <a href="convection_b.html#rase_bi66" target="diffFile">f4 = <code class="constant">1.0</code></a>
<a name="rasei309"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (trg .GT. <code class="constant">1.0e-5</code>) <code class="keyword">THEN</code></a>
<a href="convection_b.html#rase_bi71" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei310"></a><a href="convection_b.html#rase_bi71" target="diffFile"><code class="comment">!RECOMPUTE SOUNDING UP TO DETRAINMENT LEVEL</code></a>
<a name="rasei311"></a>        <a href="convection_b.html#rase_bi71" target="diffFile">poi_c = poi</a>
<a name="rasei312"></a>        <a href="convection_b.html#rase_bi70" target="diffFile">qoi_c = qoi</a>
<a name="rasei313"></a>        <a href="convection_b.html#rase_bi69" target="diffFile">poi_c(k) = poi_c(k) + tpert</a>
<a name="rasei314"></a>        <a href="convection_b.html#rase_b" target="diffFile">qoi_c(k) = qoi_c(k) + qpert</a>
<a name="rasei327"></a>        <a href="convection_b.html#rase_bi68" target="diffFile">zet(k+<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rasei315"></a>        <a href="convection_b.html#rase_bi67" target="diffFile">sht(k+<code class="constant">1</code>) = cp*poi_c(k)*prj(k+<code class="constant">1</code>)</a>
<a name="rasei316"></a>        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,ic,-<code class="constant">1</code></a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (qst(l)*rhmax .GT. qoi_c(l)) <code class="keyword">THEN</code></a>
<a name="rasei317"></a>            <a href="convection_b.html#rase_bi72" target="diffFile">qol(l) = qoi_c(l)</a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei318"></a>            <a href="convection_b.html#rase_bi73" target="diffFile">qol(l) = qst(l)*rhmax</a>
<a name="rasei319"></a>          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="constant">0.000 </code>.LT. qol(l)) <code class="keyword">THEN</code></a>
<a name="rasei320"></a>            <a href="convection_b.html#rase_b" target="diffFile">qol(l) = qol(l)</a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei321"></a>            <a href="convection_b.html#rase_bi74" target="diffFile">qol(l) = <code class="constant">0.000</code></a>
<a name="rasei322"></a>          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei323"></a>          <a href="convection_b.html#rase_bi80" target="diffFile">ssl(l) = cp*prj(l+<code class="constant">1</code>)*poi_c(l) + grav*zet(l+<code class="constant">1</code>)</a>
<a name="rasei324"></a>          <a href="convection_b.html#rase_bi79" target="diffFile">hol(l) = ssl(l) + qol(l)*alhl</a>
<a name="rasei325"></a>          <a href="convection_b.html#rase_bi78" target="diffFile">hst(l) = ssl(l) + qst(l)*alhl</a>
<a name="rasei326"></a>          <a href="convection_b.html#rase_bi77" target="diffFile">tem = poi_c(l)*(prj(l+<code class="constant">1</code>)-prj(l))*cpbg</a>
          <a href="convection_b.html#rase_bi76" target="diffFile">zet(l) = zet(l+<code class="constant">1</code>) + tem</a>
<a name="rasei331"></a>          <a href="convection_b.html#rase_bi75" target="diffFile">zol(l) = zet(l+<code class="constant">1</code>) + (prj(l+<code class="constant">1</code>)-prh(l))*poi_c(l)*cpbg</a>
<a name="rasei328"></a>        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei329"></a>        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
<a name="rasei330"></a>          <a href="convection_b.html#rase_bi328" target="diffFile">tem = (prj(l)-prh(l-<code class="constant">1</code>))/(prh(l)-prh(l-<code class="constant">1</code>))</a>
          <a href="convection_b.html#rase_bi82" target="diffFile">sht(l) = ssl(l-<code class="constant">1</code>) + tem*(ssl(l)-ssl(l-<code class="constant">1</code>))</a>
<a name="rasei332"></a>          <a href="convection_b.html#rase_bi81" target="diffFile">qht(l) = <code class="constant">.5</code>*(qol(l)+qol(l-<code class="constant">1</code>))</a>
        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei333"></a><a href="convection_b.html#rase_bi83" target="diffFile"><code class="comment">!CALCULATE LAMBDA, ETA, AND WORKFUNCTION</code></a>
<a name="rasei334"></a>        <a href="convection_b.html#rase_bi83" target="diffFile">lambda_min = <code class="constant">.2</code>/mxdiam</a>
<a name="rasei335"></a>        <a href="convection_b.html#rase_b" target="diffFile">lambda_max = <code class="constant">.2</code>/<code class="constant">200.</code></a>
        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (hol(k) .GT. hst(ic)) <code class="keyword">THEN</code></a>
<a href="convection_b.html#rase_bi84" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei337"></a><a href="convection_b.html#rase_bi84" target="diffFile"><code class="comment">!LAMBDA CALCULATION: MS-A18</code></a>
<a name="rasei336"></a>          <a href="convection_b.html#rase_bi84" target="diffFile">tem = (hst(ic)-hol(ic))*(zol(ic)-zet(ic+<code class="constant">1</code>))</a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k-<code class="constant">1</code></a>
<a name="rasei338"></a>            <a href="convection_b.html#rase_bi85" target="diffFile">tem = tem + (hst(ic)-hol(l))*(zet(l)-zet(l+<code class="constant">1</code>))</a>
<a name="rasei339"></a>          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (tem .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei340"></a><a href="convection_b.html#rase_bi86" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei341"></a>            <a href="convection_b.html#rase_bi86" target="diffFile">alm = (hol(k)-hst(ic))/tem</a>
            <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (alm .LE. lambda_max) <code class="keyword">THEN</code></a>
<a name="rasei343"></a><a name="rasei342"></a><a href="convection_b.html#rase_bi87" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei345"></a>              <a href="convection_b.html#rase_bi87" target="diffFile">toki = <code class="constant">1.0</code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (alm .LT. lambda_min) </a><a href="convection_b.html#rase_bi88" target="diffFile">toki = (alm/lambda_min)**<code class="constant">2</code></a>
<a name="rasei344"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!ETA CALCULATION: MS-A2</code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
<a name="rasei346"></a>                <a href="convection_b.html#rase_bi89" target="diffFile">eta(l) = <code class="constant">1.0 </code>+ alm*(zet(l)-zet(k))</a>
<a name="rasei347"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
              <a href="convection_b.html#rase_bi91" target="diffFile">eta(ic) = <code class="constant">1.0 </code>+ alm*(zol(ic)-zet(k))</a>
<a name="rasei348"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!WORKFUNCTION CALCULATION:  MS-A22</code></a>
<a name="rasei353"></a>              <a href="convection_b.html#rase_b" target="diffFile">wfn = <code class="constant">0.0</code></a>
<a name="rasei349"></a>              <a href="convection_b.html#rase_bi90" target="diffFile">hcc(k) = hol(k)</a>
<a name="rasei350"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rasei351"></a>                <a href="convection_b.html#rase_bi94" target="diffFile">hcc(l) = hcc(l+<code class="constant">1</code>) + (eta(l)-eta(l+<code class="constant">1</code>))*hol(l)</a>
<a name="rasei352"></a>                <a href="convection_b.html#rase_bi350" target="diffFile">tem = hcc(l+<code class="constant">1</code>)*dpb(l) + hcc(l)*dpt(l)</a>
                <a href="convection_b.html#rase_bi93" target="diffFile">eht(l) = eta(l+<code class="constant">1</code>)*dpb(l) + eta(l)*dpt(l)</a>
<a name="rasei354"></a>                <a href="convection_b.html#rase_bi92" target="diffFile">wfn = wfn + (tem-eht(l)*hst(l))*gam(l)</a>
<a name="rasei355"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei356"></a>              <a href="convection_b.html#rase_bi98" target="diffFile">hcc(ic) = hst(ic)*eta(ic)</a>
              <a href="convection_b.html#rase_bi97" target="diffFile">wfn = wfn + (hcc(ic+<code class="constant">1</code>)-hst(ic)*eta(ic+<code class="constant">1</code>))*gam(ic)*dpb(ic)</a>
<a href="convection_b.html#rase_bi96" target="diffFile"><code class="comment">!VERTICAL VELOCITY/KE CALCULATION (ADDED 12/2001 JTB)</code></a>
<a name="rasei357"></a>              <a href="convection_b.html#rase_bi96" target="diffFile">bk2(k) = <code class="constant">0.0</code></a>
<a name="rasei368"></a>              <a href="convection_b.html#rase_b" target="diffFile">bke(k) = <code class="constant">0.0</code></a>
<a name="rasei358"></a>              <a href="convection_b.html#rase_bi95" target="diffFile">hcld(k) = hol(k)</a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic,-<code class="constant">1</code></a>
<a name="rasei359"></a>                <a href="convection_b.html#rase_bi100" target="diffFile">hcld(l) = (eta(l+<code class="constant">1</code>)*hcld(l+<code class="constant">1</code>)+(eta(l)-eta(l+<code class="constant">1</code>))*hol(l))/<code class="label">&</code></a>
<a href="convection_b.html#rase_bi100" target="diffFile"><code class="label">&                 </code>eta(l)</a>
                <a href="convection_b.html#rase_bi99" target="diffFile">tem = (hcld(l)-hst(l))*(zet(l)-zet(l+<code class="constant">1</code>))/(<code class="constant">1.0</code>+lbcp*dqq(l<code class="label">&</code></a>
<a name="rasei360"></a><a href="convection_b.html#rase_bi99" target="diffFile"><code class="label">&                 </code>))</a>
<a name="rasei361"></a>                <a href="convection_b.html#rase_b" target="diffFile">bke(l) = bke(l+<code class="constant">1</code>) + grav*tem/(cp*prj(l+<code class="constant">1</code>)*poi(l))</a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (tem .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei362"></a>                  <a href="convection_b.html#rase_bi101" target="diffFile">max1 = <code class="constant">0.0</code></a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei363"></a>                  <a href="convection_b.html#rase_bi102" target="diffFile">max1 = tem</a>
<a name="rasei364"></a>                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei365"></a>                <a href="convection_b.html#rase_bi103" target="diffFile">bk2(l) = bk2(l+<code class="constant">1</code>) + grav*max1/(cp*prj(l+<code class="constant">1</code>)*poi(l))</a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (bk2(l) .LT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei366"></a>                  <a href="convection_b.html#rase_bi104" target="diffFile">max2 = <code class="constant">0.0</code></a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei367"></a>                  <a href="convection_b.html#rase_bi105" target="diffFile">max2 = bk2(l)</a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei369"></a>                <a href="convection_b.html#rase_bi106" target="diffFile">cvw(l) = <code class="funcname">SQRT</code>(<code class="constant">2.0</code>*max2)</a>
<a name="rasei370"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei372"></a><a name="rasei371"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!ALPHA CALCULATION </code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (zet(ic) .LT. <code class="constant">2000.</code>) </a><a href="convection_b.html#rase_bi107" target="diffFile">rasal(ic) = rasal1</a>
<a name="rasei373"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (zet(ic) .GE. <code class="constant">2000.</code>) </a><a href="convection_b.html#rase_bi108" target="diffFile">rasal(ic) = rasal1 + (rasal2-<code class="label">&</code></a>
<a name="rasei374"></a><a href="convection_b.html#rase_bi108" target="diffFile"><code class="label">&                 </code>rasal1)*(zet(ic)-<code class="constant">2000.</code>)/<code class="constant">8000.</code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (rasal(ic) .GT. <code class="constant">1.0e5</code>) <code class="keyword">THEN</code></a>
<a name="rasei375"></a>                <a href="convection_b.html#rase_bi109" target="diffFile">rasal(ic) = <code class="constant">1.0e5</code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei376"></a>                <a href="convection_b.html#rase_b" target="diffFile">rasal(ic) = rasal(ic)</a>
<a name="rasei380"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei377"></a>              <a href="convection_b.html#rase_bi110" target="diffFile">rasal(ic) = dt/rasal(ic)</a>
<a name="rasei378"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .LT. <code class="constant">1.00</code>) <code class="keyword">THEN</code></a>
<a name="rasei379"></a>                  <a href="convection_b.html#rase_bi111" target="diffFile">cvw(l) = <code class="constant">1.00</code></a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
                  <a href="convection_b.html#rase_bi112" target="diffFile">cvw(l) = cvw(l)</a>
<a name="rasei381"></a>                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei382"></a>              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei383"></a>              <a href="convection_b.html#rase_bi113" target="diffFile"><code class="keyword">CALL </code><code class="funcname">ACRITN</code>(pol(ic), prs(k), acr, acritfac)</a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (wfn .GT. acr) <code class="keyword">THEN</code></a>
<a name="rasei384"></a><a href="convection_b.html#rase_bi118" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei385"></a>                <a href="convection_b.html#rase_bi118" target="diffFile">wlq = qol(k)</a>
<a name="rasei386"></a>                <a href="convection_b.html#rase_bi117" target="diffFile">uht = uoi(k)</a>
<a name="rasei387"></a>                <a href="convection_b.html#rase_bi116" target="diffFile">vht = voi(k)</a>
<a name="rasei420"></a>                <a href="convection_b.html#rase_bi115" target="diffFile">rnn(k) = <code class="constant">0.</code></a>
<a name="rasei388"></a>                <a href="convection_b.html#rase_bi114" target="diffFile">cll0(k) = <code class="constant">0.</code></a>
<a name="rasei389"></a>                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic,-<code class="constant">1</code></a>
<a name="rasei390"></a>                  <a href="convection_b.html#rase_bi388" target="diffFile">tem = eta(l) - eta(l+<code class="constant">1</code>)</a>
<a name="rasei391"></a>                  <a href="convection_b.html#rase_bi121" target="diffFile">wlq = wlq + tem*qol(l)</a>
<a name="rasei392"></a>                  <a href="convection_b.html#rase_bi120" target="diffFile">uht = uht + tem*uoi(l)</a>
<a name="rasei393"></a>                  <a href="convection_b.html#rase_bi119" target="diffFile">vht = vht + tem*voi(l)</a>
<a name="rasei394"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (l .GT. ic) <code class="keyword">THEN</code></a>
<a name="rasei395"></a>                    <a href="convection_b.html#rase_bi125" target="diffFile">tx2 = <code class="constant">0.5</code>*(qst(l)+qst(l-<code class="constant">1</code>))*eta(l)</a>
<a name="rasei396"></a>                    <a href="convection_b.html#rase_bi124" target="diffFile">tx3 = <code class="constant">0.5</code>*(hst(l)+hst(l-<code class="constant">1</code>))*eta(l)</a>
                    <a href="convection_b.html#rase_bi123" target="diffFile">qcc = tx2 + gm1(l)*(hcc(l)-tx3)</a>
<a name="rasei397"></a>                    <a href="convection_b.html#rase_bi122" target="diffFile">cll0(l) = wlq - qcc</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei398"></a>                    <a href="convection_b.html#rase_bi126" target="diffFile">cll0(l) = wlq - qst(ic)*eta(ic)</a>
<a name="rasei399"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (cll0(l) .LT. <code class="constant">0.00</code>) <code class="keyword">THEN</code></a>
<a name="rasei400"></a>                    <a href="convection_b.html#rase_bi127" target="diffFile">cll0(l) = <code class="constant">0.00</code></a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei401"></a>                    <a href="convection_b.html#rase_b" target="diffFile">cll0(l) = cll0(l)</a>
<a name="rasei402"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei403"></a>                  <a href="convection_b.html#rase_bi401" target="diffFile">cli = cll0(l)/eta(l)</a>
<a name="rasei404"></a>                  <a href="convection_b.html#rase_bi402" target="diffFile">te_a = poi(l)*prh(l)</a>
<a name="rasei405"></a>                  <a href="convection_b.html#rase_bi130" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SUNDQ3_ICE</code>(te_a, sdqv2, sdqv3, sdqvt1, f2, f3)</a>
<a name="rasei406"></a>                  <a href="convection_b.html#rase_bi129" target="diffFile">c00_x = co_auto(i)*f2*f3*f4</a>
<a name="rasei407"></a>                  <a href="convection_b.html#rase_bi405" target="diffFile">cli_crit_x = cli_crit/(f2*f3)</a>
<a name="rasei408"></a>                  <a href="convection_b.html#rase_bi128" target="diffFile">rate = c00_x*(<code class="constant">1.0</code>-<code class="funcname">EXP</code>(-(cli**<code class="constant">2</code>/cli_crit_x**<code class="constant">2</code>)))</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .LT. <code class="constant">1.00</code>) <code class="keyword">THEN</code></a>
<a name="rasei409"></a>                    <a href="convection_b.html#rase_bi131" target="diffFile">cvw_x = <code class="constant">1.00</code></a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei410"></a>                    <a href="convection_b.html#rase_bi132" target="diffFile">cvw_x = cvw(l)</a>
<a name="rasei411"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei412"></a>                  <a href="convection_b.html#rase_bi134" target="diffFile">dt_lyr = (zet(l)-zet(l+<code class="constant">1</code>))/cvw_x</a>
<a name="rasei413"></a>                  <a href="convection_b.html#rase_bi133" target="diffFile">closs = cll0(l)*rate*dt_lyr</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (closs .GT. cll0(l)) <code class="keyword">THEN</code></a>
<a name="rasei414"></a>                    <a href="convection_b.html#rase_bi135" target="diffFile">closs = cll0(l)</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei416"></a>                    <a href="convection_b.html#rase_b" target="diffFile">closs = closs</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei415"></a>                  <a href="convection_b.html#rase_bi136" target="diffFile">cll0(l) = cll0(l) - closs</a>
<a name="rasei417"></a>                  <a href="convection_b.html#rase_b" target="diffFile">dll0(l) = closs</a>
<a name="rasei418"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (closs .GT. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
                    <a href="convection_b.html#rase_b" target="diffFile">wlq = wlq - closs</a>
<a name="rasei419"></a>                    <a href="convection_b.html#rase_bi137" target="diffFile">rnn(l) = closs</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
                    <a href="convection_b.html#rase_bi138" target="diffFile">rnn(l) = <code class="constant">0.</code></a>
<a name="rasei421"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei422"></a>                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
                <a href="convection_b.html#rase_bi143" target="diffFile">wlq = wlq - qst(ic)*eta(ic)</a>
<a name="rasei423"></a><a href="convection_b.html#rase_bi142" target="diffFile"><code class="comment">!CALCULATE GAMMAS AND KERNEL</code></a>
<a name="rasei424"></a>                <a href="convection_b.html#rase_bi142" target="diffFile">gms(k) = (sht(k)-ssl(k))*pri(k)</a>
<a name="rasei425"></a>                <a href="convection_b.html#rase_bi141" target="diffFile">gmh(k) = gms(k) + (qht(k)-qol(k))*pri(k)*alhl</a>
<a name="rasei430"></a>                <a href="convection_b.html#rase_bi140" target="diffFile">akm = gmh(k)*gam(k-<code class="constant">1</code>)*dpb(k-<code class="constant">1</code>)</a>
<a name="rasei426"></a>                <a href="convection_b.html#rase_bi139" target="diffFile">tx2 = gmh(k)</a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
<a name="rasei427"></a>                  <a href="convection_b.html#rase_bi147" target="diffFile">gms(l) = (eta(l)*(sht(l)-ssl(l))+eta(l+<code class="constant">1</code>)*(ssl(l)-sht(<code class="label">&</code></a>
<a href="convection_b.html#rase_bi147" target="diffFile"><code class="label">&                   </code>l+<code class="constant">1</code>)))*pri(l)</a>
<a name="rasei428"></a>                  <a href="convection_b.html#rase_bi146" target="diffFile">gmh(l) = gms(l) + (eta(l)*(qht(l)-qol(l))+eta(l+<code class="constant">1</code>)*(<code class="label">&</code></a>
<a name="rasei429"></a><a href="convection_b.html#rase_bi146" target="diffFile"><code class="label">&                   </code>qol(l)-qht(l+<code class="constant">1</code>)))*alhl*pri(l)</a>
                  <a href="convection_b.html#rase_bi145" target="diffFile">tx2 = tx2 + (eta(l)-eta(l+<code class="constant">1</code>))*gmh(l)</a>
<a name="rasei431"></a>                  <a href="convection_b.html#rase_bi144" target="diffFile">akm = akm - gms(l)*eht(l)*pki(l) + tx2*ght(l)</a>
<a name="rasei432"></a>                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei433"></a>                <a href="convection_b.html#rase_bi150" target="diffFile">gms(ic) = eta(ic+<code class="constant">1</code>)*(ssl(ic)-sht(ic+<code class="constant">1</code>))*pri(ic)</a>
                <a href="convection_b.html#rase_bi149" target="diffFile">akm = akm - gms(ic)*eta(ic+<code class="constant">1</code>)*dpb(ic)*pki(ic)</a>
<a name="rasei434"></a>                <a href="convection_b.html#rase_bi148" target="diffFile">gmh(ic) = gms(ic) + (eta(ic+<code class="constant">1</code>)*(qol(ic)-qht(ic+<code class="constant">1</code>))*alhl+<code class="label">&</code></a>
<a href="convection_b.html#rase_bi148" target="diffFile"><code class="label">&                 </code>eta(ic)*(hst(ic)-hol(ic)))*pri(ic)</a>
<a name="rasei435"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!CLOUD BASE MASS FLUX</code></a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (.NOT.(akm .GE. <code class="constant">0.0 </code>.OR. wlq .LT. <code class="constant">0.0</code>)) <code class="keyword">THEN</code></a>
<a name="rasei436"></a><a href="convection_b.html#rase_bi152" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei437"></a>                  <a href="convection_b.html#rase_bi152" target="diffFile">wfn = -((wfn-acr)/akm)</a>
<a name="rasei438"></a>                  <a href="convection_b.html#rase_bi151" target="diffFile">x1 = rasal(ic)*trg*toki*wfn</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (x1 .GT. (prs(k+<code class="constant">1</code>)-prs(k))*(<code class="constant">100.</code>*pblfrac)) <code class="keyword">THEN</code></a>
<a name="rasei439"></a>                    <a href="convection_b.html#rase_bi153" target="diffFile">wfn = (prs(k+<code class="constant">1</code>)-prs(k))*(<code class="constant">100.</code>*pblfrac)</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="rasei440"></a>                    <a href="convection_b.html#rase_bi154" target="diffFile">wfn = x1</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei443"></a><a href="convection_b.html#rase_bi157" target="diffFile"><code class="comment">!CUMULATIVE PRECIP AND CLOUD-BASE MASS FLUX FOR OUTPUT</code></a>
<a name="rasei441"></a>                  <a href="convection_b.html#rase_bi157" target="diffFile">tem = wfn*gravi</a>
<a name="rasei442"></a>                  <a href="convection_b.html#rase_bi156" target="diffFile">cll(ic) = cll(ic) + wlq*tem</a>
<a name="rasei449"></a>                  <a href="convection_b.html#rase_b" target="diffFile">rmf(ic) = rmf(ic) + tem</a>
<a name="rasei444"></a>                  <a href="convection_b.html#rase_bi155" target="diffFile">rmfd(ic) = rmfd(ic) + tem*eta(ic)</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic+<code class="constant">1</code>,k</a>
                    <a href="convection_b.html#rase_bi158" target="diffFile">rmfp(l) = tem*eta(l)</a>
<a name="rasei445"></a>                    <a href="convection_b.html#rase_b" target="diffFile">rmfc(l) = rmfc(l) + rmfp(l)</a>
<a name="rasei446"></a>                    <a href="convection_b.html#rase_b" target="diffFile">dllx(l) = dllx(l) + tem*dll0(l)</a>
                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (cvw(l) .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
                      <a href="convection_b.html#rase_bi159" target="diffFile">updfrp(l) = rmfp(l)*(ddt/daylen)*<code class="constant">1000.</code>/(cvw(l)*prs<code class="label">&</code></a>
<a name="rasei447"></a><a href="convection_b.html#rase_bi159" target="diffFile"><code class="label">&                       </code>(l))</a>
                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
                      <a href="convection_b.html#rase_bi160" target="diffFile">updfrp(l) = <code class="constant">0.0</code></a>
<a name="rasei448"></a>                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
                    <a href="convection_b.html#rase_b" target="diffFile">clli(l) = cll0(l)/eta(l)</a>
<a name="rasei456"></a>                    <a href="convection_b.html#rase_bi161" target="diffFile">updfrc(l) = updfrc(l) + updfrp(l)</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei455"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!THETA AND Q CHANGE DUE TO CLOUD TYPE IC</code></a>
<a name="rasei450"></a>                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
<a name="rasei451"></a>                    <a href="convection_b.html#rase_bi167" target="diffFile">rns(l) = rns(l) + rnn(l)*tem</a>
<a name="rasei452"></a>                    <a href="convection_b.html#rase_bi166" target="diffFile">gmh(l) = gmh(l)*wfn</a>
<a name="rasei453"></a>                    <a href="convection_b.html#rase_bi165" target="diffFile">gms(l) = gms(l)*wfn</a>
<a name="rasei454"></a>                    <a href="convection_b.html#rase_bi164" target="diffFile">qoi(l) = qoi(l) + (gmh(l)-gms(l))*alhi</a>
                    <a href="convection_b.html#rase_bi163" target="diffFile">poi(l) = poi(l) + gms(l)*pki(l)*cpi</a>
<a name="rasei457"></a>                    <a href="convection_b.html#rase_bi162" target="diffFile">qst(l) = qst(l) + gms(l)*bet(l)*cpi</a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei458"></a><a href="convection_b.html#rase_bi168" target="diffFile"><code class="comment">!*FRICFAC*0.5</code></a>
                  <a href="convection_b.html#rase_bi168" target="diffFile">wfn = wfn*<code class="constant">0.5</code>*<code class="constant">1.0</code></a>
<a name="rasei459"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!CUMULUS FRICTION</code></a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (fricfac .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei460"></a><a href="convection_b.html#rase_bi172" target="diffFile"><code class="comment">!================&gt;></code></a>
<a name="rasei461"></a>                    <a href="convection_b.html#rase_bi172" target="diffFile">wfn = wfn*fricfac*<code class="funcname">EXP</code>(-(alm/friclambda))</a>
<a name="rasei462"></a>                    <a href="convection_b.html#rase_bi171" target="diffFile">tem = wfn*pri(k)</a>
<a name="rasei466"></a>                    <a href="convection_b.html#rase_bi170" target="diffFile">ucu(k) = ucu(k) + tem*(uoi(k-<code class="constant">1</code>)-uoi(k))</a>
<a name="rasei463"></a>                    <a href="convection_b.html#rase_bi169" target="diffFile">vcu(k) = vcu(k) + tem*(voi(k-<code class="constant">1</code>)-voi(k))</a>
<a name="rasei464"></a>                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k-<code class="constant">1</code>,ic+<code class="constant">1</code>,-<code class="constant">1</code></a>
                      <a href="convection_b.html#rase_bi175" target="diffFile">tem = wfn*pri(l)</a>
<a name="rasei465"></a>                      <a href="convection_b.html#rase_bi174" target="diffFile">ucu(l) = ucu(l) + tem*((uoi(l-<code class="constant">1</code>)-uoi(l))*eta(l)+(<code class="label">&</code></a>
<a href="convection_b.html#rase_bi174" target="diffFile"><code class="label">&                       </code>uoi(l)-uoi(l+<code class="constant">1</code>))*eta(l+<code class="constant">1</code>))</a>
                      <a href="convection_b.html#rase_bi173" target="diffFile">vcu(l) = vcu(l) + tem*((voi(l-<code class="constant">1</code>)-voi(l))*eta(l)+(<code class="label">&</code></a>
<a name="rasei467"></a><a href="convection_b.html#rase_bi173" target="diffFile"><code class="label">&                       </code>voi(l)-voi(l+<code class="constant">1</code>))*eta(l+<code class="constant">1</code>))</a>
<a name="rasei468"></a>                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
                    <a href="convection_b.html#rase_bi178" target="diffFile">tem = wfn*pri(ic)</a>
<a name="rasei469"></a>                    <a href="convection_b.html#rase_bi177" target="diffFile">ucu(ic) = ucu(ic) + (<code class="constant">2.</code>*(uht-uoi(ic)*(eta(ic)-eta(ic<code class="label">&</code></a>
<a href="convection_b.html#rase_bi177" target="diffFile"><code class="label">&                     </code>+<code class="constant">1</code>)))-(uoi(ic)+uoi(ic+<code class="constant">1</code>))*eta(ic+<code class="constant">1</code>))*tem</a>
<a name="rasei472"></a>                    <a href="convection_b.html#rase_bi176" target="diffFile">vcu(ic) = vcu(ic) + (<code class="constant">2.</code>*(vht-voi(ic)*(eta(ic)-eta(ic<code class="label">&</code></a>
<a name="rasei470"></a><a href="convection_b.html#rase_bi176" target="diffFile"><code class="label">&                     </code>+<code class="constant">1</code>)))-(voi(ic)+voi(ic+<code class="constant">1</code>))*eta(ic+<code class="constant">1</code>))*tem</a>
<a name="rasei471"></a>                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=ic,k</a>
                      <a href="convection_b.html#rase_bi180" target="diffFile">uoi(l) = uoi(l) + ucu(l)</a>
                      <a href="convection_b.html#rase_bi179" target="diffFile">voi(l) = voi(l) + vcu(l)</a>
                    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
                  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
                <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
              <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
            <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="rasei474"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei477"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!CLOUD LOOP</code></a>
<a name="rasei475"></a>    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (<code class="funcname">SUM</code>(rmf(icmin:k)) .GT. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
<a name="rasei476"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=icmin,k</a>
        <a href="convection_b.html#rase_bi475" target="diffFile">tem = pri(l)*grav</a>
<a name="rasei484"></a>        <a href="convection_b.html#rase_bi181" target="diffFile">cnv_prc3(i, l) = rns(l)*tem</a>
<a name="rasei483"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei482"></a>      <a href="convection_b.html#rase_bi187" target="diffFile">tho(i, icmin:k-<code class="constant">1</code>) = poi(icmin:k-<code class="constant">1</code>)</a>
<a name="rasei481"></a>      <a href="convection_b.html#rase_bi186" target="diffFile">qho(i, icmin:k-<code class="constant">1</code>) = qoi(icmin:k-<code class="constant">1</code>)</a>
<a name="rasei478"></a>      <a href="convection_b.html#rase_bi185" target="diffFile">uho(i, icmin:k-<code class="constant">1</code>) = uoi(icmin:k-<code class="constant">1</code>)</a>
<a name="rasei479"></a>      <a href="convection_b.html#rase_bi184" target="diffFile">vho(i, icmin:k-<code class="constant">1</code>) = voi(icmin:k-<code class="constant">1</code>)</a>
      <a href="convection_b.html#rase_bi183" target="diffFile">cnv_updfrc(i, icmin:k-<code class="constant">1</code>) = updfrc(icmin:k-<code class="constant">1</code>)</a>
<a name="rasei480"></a><a href="convection_b.html#rase_bi182" target="diffFile"><code class="comment">!De-strap tendencies from RAS</code></a>
      <a href="convection_b.html#rase_bi182" target="diffFile">wght = wgt1(i, :)</a>
<a name="rasei486"></a><a href="convection_b.html#rase_b" target="diffFile"><code class="comment">!Scale properly by layer masses</code></a>
<a name="rasei485"></a>      <a href="convection_b.html#rase_b" target="diffFile">wght0 = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rasei487"></a>        <a href="convection_b.html#rase_b" target="diffFile">wght0 = wght0 + wght(l)*(ple(i, l+<code class="constant">1</code>)-ple(i, l))</a>
<a name="rasei488"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei493"></a>      <a href="convection_b.html#rase_b" target="diffFile">wght0 = (prs(k+<code class="constant">1</code>)-prs(k))/wght0</a>
<a name="rasei492"></a>      <a href="convection_b.html#rase_b" target="diffFile">wght = wght0*wght</a>
<a name="rasei491"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">DO </code>l=k,k0</a>
<a name="rasei490"></a>        <a href="convection_b.html#rase_bi191" target="diffFile">tho(i, l) = tho(i, l) + wght(l)*(poi(k)-poi_sv(k))</a>
<a name="rasei489"></a>        <a href="convection_b.html#rase_bi190" target="diffFile">qho(i, l) = qho(i, l) + wght(l)*(qoi(k)-qoi_sv(k))</a>
        <a href="convection_b.html#rase_bi189" target="diffFile">uho(i, l) = uho(i, l) + wght(l)*(uoi(k)-uoi_sv(k))</a>
<a name="rasei494"></a>        <a href="convection_b.html#rase_bi188" target="diffFile">vho(i, l) = vho(i, l) + wght(l)*(voi(k)-voi_sv(k))</a>
<a name="rasei495"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="rasei498"></a>      <a href="convection_b.html#rase_bi195" target="diffFile">flxd(i, icmin:k) = rmfd(icmin:k)*ddt/daylen</a>
<a name="rasei497"></a>      <a href="convection_b.html#rase_bi194" target="diffFile">clw(i, icmin:k) = cll(icmin:k)*ddt/daylen</a>
<a name="rasei496"></a>      <a href="convection_b.html#rase_bi193" target="diffFile">flxd(i, <code class="constant">1</code>:icmin-<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rasei500"></a>      <a href="convection_b.html#rase_bi192" target="diffFile">clw(i, <code class="constant">1</code>:icmin-<code class="constant">1</code>) = <code class="constant">0.</code></a>
<a name="rasei499"></a>      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">IF</code> (k .LT. k0) <code class="keyword">THEN</code></a>
        <a href="convection_b.html#rase_bi197" target="diffFile">flxd(i, k:k0) = <code class="constant">0.</code></a>
        <a href="convection_b.html#rase_bi196" target="diffFile">clw(i, k:k0) = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
      <a href="convection_b.html#rase_b" target="diffFile">flxd(i, :) = <code class="constant">0.</code></a>
      <a href="convection_b.html#rase_b" target="diffFile">clw(i, :) = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">ELSE</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">flxd(i, :) = <code class="constant">0.</code></a>
    <a href="convection_b.html#rase_b" target="diffFile">clw(i, :) = <code class="constant">0.</code></a>
  <a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END IF</code></a>
<a href="convection_b.html#rase_b" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">RASE</code></a>

<code class="keyword">SUBROUTINE </code><code class="funcname">ACRITN</code>(<code class="vardecl">pl</code>, <code class="vardecl">plb</code>, <code class="vardecl">acr</code>, <code class="vardecl">acritfac</code>)
  <code class="keyword">IMPLICIT NONE</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">pl</code>, <code class="vardecl">plb</code>, <code class="vardecl">acritfac</code>
  <code class="typename">REAL*8</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">acr</code>
  <code class="typename">INTEGER </code>:: <code class="vardecl">iwk</code>
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">ph</code>(<code class="constant">15</code>)=(/<code class="constant">150.0</code>, <code class="constant">200.0</code>, <code class="constant">250.0</code>, <code class="constant">300.0</code>, <code class="constant">350.0</code>, <code class="constant">400.0</code><code class="label">&</code>
<code class="label">&   </code>, <code class="constant">450.0</code>, <code class="constant">500.0</code>, <code class="constant">550.0</code>, <code class="constant">600.0</code>, <code class="constant">650.0</code>, <code class="constant">700.0</code>, <code class="constant">750.0</code>, <code class="constant">800.0</code>, <code class="constant">850.0</code>/)
  <code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">a</code>(<code class="constant">15</code>)=(/<code class="constant">1.6851</code>, <code class="constant">1.1686</code>, <code class="constant">0.7663</code>, <code class="constant">0.5255</code>, <code class="constant">0.4100</code>, <code class="label">&</code>
<code class="label">&   </code><code class="constant">0.3677</code>, <code class="constant">0.3151</code>, <code class="constant">0.2216</code>, <code class="constant">0.1521</code>, <code class="constant">0.1082</code>, <code class="constant">0.0750</code>, <code class="constant">0.0664</code>, <code class="constant">0.0553</code>, <code class="label">&</code>
<code class="label">&   </code><code class="constant">0.0445</code>, <code class="constant">0.0633</code>/)
  <code class="keyword">INTRINSIC </code><code class="funcname">INT</code>
  iwk = <code class="funcname">INT</code>(pl*<code class="constant">0.02 </code>- <code class="constant">0.999999999</code>)
  <code class="keyword">IF</code> (iwk .GT. <code class="constant">1 </code>.AND. iwk .LE. <code class="constant">15</code>) <code class="keyword">THEN</code>
    acr = a(iwk-<code class="constant">1</code>) + (pl-ph(iwk-<code class="constant">1</code>))*<code class="constant">.02</code>*(a(iwk)-a(iwk-<code class="constant">1</code>))
  <code class="keyword">ELSE IF</code> (iwk .GT. <code class="constant">15</code>) <code class="keyword">THEN</code>
    acr = a(<code class="constant">15</code>)
  <code class="keyword">ELSE</code>
    acr = a(<code class="constant">1</code>)
  <code class="keyword">END IF</code>
  acr = acritfac*acr*(plb-pl)
<a name="sundq3_ice"></a><code class="keyword">END SUBROUTINE </code><code class="funcname">ACRITN</code>

<a name="sundq3_icei67"></a><a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">SUNDQ3_ICE</code>(<code class="vardecl">temp</code>, <code class="vardecl">rate2</code>, <code class="vardecl">rate3</code>, <code class="vardecl">te1</code>, <code class="vardecl">f2</code>, <code class="vardecl">f3</code>)</a>
<a name="sundq3_icei68"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="sundq3_icei69"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">temp</code>, <code class="vardecl">rate2</code>, <code class="vardecl">rate3</code>, <code class="vardecl">te1</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">f2</code>, <code class="vardecl">f3</code></a>
<a name="sundq3_icei70"></a><a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="comment">!,RATE2,RATE3,TE1</code></a>
<a name="sundq3_icei71"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">xx</code>, <code class="vardecl">yy</code>, <code class="vardecl">te0</code>, <code class="vardecl">te2</code>, <code class="vardecl">jump1</code></a>
<a name="sundq3_icei72"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile">te0 = <code class="constant">273.</code></a>
<a name="sundq3_icei73"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile">te2 = <code class="constant">200.</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile">jump1 = (rate2-<code class="constant">1.0</code>)/(te0-te1)**<code class="constant">0.333</code></a>
<a name="sundq3_icei74"></a><a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="comment">! Ice - phase treatment</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">IF</code> (temp .GE. te0) <code class="keyword">THEN</code></a>
    <a href="convection_b.html#sundq3_ice_bi19" target="diffFile">f2 = <code class="constant">1.0</code></a>
<a name="sundq3_icei75"></a>    <a href="convection_b.html#sundq3_ice_b" target="diffFile">f3 = <code class="constant">1.0</code></a>
<a name="sundq3_icei76"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">IF</code> (temp .GE. te1 .AND. temp .LT. te0) <code class="keyword">THEN</code></a>
    <a href="convection_b.html#sundq3_ice_bi20" target="diffFile">f2 = <code class="constant">1.0 </code>+ jump1*(te0-temp)**<code class="constant">0.3333</code></a>
<a name="sundq3_icei77"></a>    <a href="convection_b.html#sundq3_ice_b" target="diffFile">f3 = <code class="constant">1.0</code></a>
<a name="sundq3_icei78"></a>  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">IF</code> (temp .LT. te1) <code class="keyword">THEN</code></a>
    <a href="convection_b.html#sundq3_ice_bi21" target="diffFile">f2 = rate2 + (rate3-rate2)*(te1-temp)/(te1-te2)</a>
<a name="sundq3_icei79"></a>    <a href="convection_b.html#sundq3_ice_b" target="diffFile">f3 = <code class="constant">1.0</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">IF</code> (f2 .GT. <code class="constant">27.0</code>) f2 = <code class="constant">27.0</code></a>
<a name="dqsat_ras"></a><a href="convection_b.html#sundq3_ice_b" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">SUNDQ3_ICE</code></a>

<a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">DQSAT_RAS</code>(<code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>, <code class="vardecl">temp</code>, <code class="vardecl">plo</code>, <code class="vardecl">lm</code>, <code class="vardecl">estblx</code>, <code class="vardecl">cons_h2omw</code>, <code class="label">&</code></a>
<a name="dqsat_rasi32"></a><a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="label">& </code><code class="vardecl">cons_airmw</code>)</a>
  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="dqsat_rasi33"></a><a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="comment">!Inputs</code></a>
<a name="dqsat_rasi34"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">lm</code></a>
<a name="dqsat_rasi35"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>lm<code class="typename">) </code>:: <code class="vardecl">temp</code>, <code class="vardecl">plo</code></a>
<a name="dqsat_rasi36"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">estblx</code>(:)</a>
  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code></a>
<a name="dqsat_rasi37"></a><a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="comment">!Outputs</code></a>
  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">DIMENSION(</code>lm<code class="typename">) </code>:: <code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code></a>
<a name="dqsat_rasi38"></a><a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="comment">!Locals</code></a>
<a name="dqsat_rasi39"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">max_mixing_ratio</code>=<code class="constant">1.0</code></a>
<a name="dqsat_rasi40"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">esfac</code></a>
<a name="dqsat_rasi41"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">k</code></a>
<a name="dqsat_rasi42"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tl</code>, <code class="vardecl">tt</code>, <code class="vardecl">ti</code>, <code class="vardecl">dqsat</code>, <code class="vardecl">qsat</code>, <code class="vardecl">dqq</code>, <code class="vardecl">qq</code>, <code class="vardecl">pl</code>, <code class="vardecl">pp</code>, <code class="vardecl">dd</code></a>
<a name="dqsat_rasi43"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">it</code></a>
<a name="dqsat_rasi44"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">degsubs</code>=<code class="constant">100</code></a>
<a name="dqsat_rasi45"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tmintbl</code>=<code class="constant">150.0</code>, <code class="vardecl">tmaxtbl</code>=<code class="constant">333.0</code></a>
<a name="dqsat_rasi46"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tablesize</code>=<code class="funcname">NINT</code>(<code class="vardecl">tmaxtbl</code>-<code class="vardecl">tmintbl</code>)*<code class="vardecl">degsubs</code>+<code class="constant">1</code></a>
<a name="dqsat_rasi47"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">NINT</code></a>
<a name="dqsat_rasi66"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
<a name="dqsat_rasi48"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile">esfac = cons_h2omw/cons_airmw</a>
<a name="dqsat_rasi49"></a>  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,lm</a>
<a name="dqsat_rasi50"></a>    <a href="convection_b.html#dqsat_ras_bi9" target="diffFile">tl = temp(k)</a>
<a name="dqsat_rasi51"></a>    <a href="convection_b.html#dqsat_ras_bi49" target="diffFile">pl = plo(k)</a>
<a name="dqsat_rasi52"></a>    <a href="convection_b.html#dqsat_ras_bi50" target="diffFile">pp = pl*<code class="constant">100.0</code></a>
<a name="dqsat_rasi53"></a>    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">IF</code> (tl .LE. tmintbl) <code class="keyword">THEN</code></a>
<a name="dqsat_rasi54"></a>      <a href="convection_b.html#dqsat_ras_b" target="diffFile">ti = tmintbl</a>
    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">ELSE IF</code> (tl .GE. tmaxtbl - <code class="constant">.001</code>) <code class="keyword">THEN</code></a>
<a name="dqsat_rasi55"></a>      <a href="convection_b.html#dqsat_ras_b" target="diffFile">ti = tmaxtbl - <code class="constant">.001</code></a>
    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="dqsat_rasi56"></a>      <a href="convection_b.html#dqsat_ras_bi10" target="diffFile">ti = tl</a>
<a name="dqsat_rasi57"></a>    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="dqsat_rasi58"></a>    <a href="convection_b.html#dqsat_ras_bi13" target="diffFile">tt = (ti-tmintbl)*degsubs + <code class="constant">1</code></a>
<a name="dqsat_rasi59"></a>    <a href="convection_b.html#dqsat_ras_b" target="diffFile">it = <code class="funcname">INT</code>(tt)</a>
<a name="dqsat_rasi60"></a>    <a href="convection_b.html#dqsat_ras_bi12" target="diffFile">dqq = estblx(it+<code class="constant">1</code>) - estblx(it)</a>
    <a href="convection_b.html#dqsat_ras_bi11" target="diffFile">qq = (tt-it)*dqq + estblx(it)</a>
    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">IF</code> (pp .LE. qq) <code class="keyword">THEN</code></a>
      <a href="convection_b.html#dqsat_ras_b" target="diffFile">qsat = max_mixing_ratio</a>
<a name="dqsat_rasi61"></a>      <a href="convection_b.html#dqsat_ras_b" target="diffFile">dqsat = <code class="constant">0.0</code></a>
<a name="dqsat_rasi63"></a>    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="dqsat_rasi62"></a>      <a href="convection_b.html#dqsat_ras_bi14" target="diffFile">dd = <code class="constant">1.0</code>/(pp-(<code class="constant">1.0</code>-esfac)*qq)</a>
      <a href="convection_b.html#dqsat_ras_bi16" target="diffFile">qsat = esfac*qq*dd</a>
<a name="dqsat_rasi65"></a>      <a href="convection_b.html#dqsat_ras_bi15" target="diffFile">dqsat = esfac*degsubs*dqq*pp*(dd*dd)</a>
<a name="dqsat_rasi64"></a>    <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="convection_b.html#dqsat_ras_bi18" target="diffFile">dqsi(k) = dqsat</a>
    <a href="convection_b.html#dqsat_ras_bi17" target="diffFile">qssi(k) = qsat</a>
  <a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">END DO</code></a>
<a name="dqsats_ras"></a><a href="convection_b.html#dqsat_ras_b" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">DQSAT_RAS</code></a>

<a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">DQSATS_RAS</code>(<code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code>, <code class="vardecl">temp</code>, <code class="vardecl">plo</code>, <code class="vardecl">estblx</code>, <code class="vardecl">cons_h2omw</code>, <code class="label">&</code></a>
<a name="dqsats_rasi0"></a><a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="label">& </code><code class="vardecl">cons_airmw</code>)</a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="dqsats_rasi1"></a><a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="comment">!Inputs</code></a>
<a name="dqsats_rasi2"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">temp</code>, <code class="vardecl">plo</code></a>
<a name="dqsats_rasi3"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">estblx</code>(:)</a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">cons_h2omw</code>, <code class="vardecl">cons_airmw</code></a>
<a name="dqsats_rasi4"></a><a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="comment">!Outputs</code></a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">dqsi</code>, <code class="vardecl">qssi</code></a>
<a name="dqsats_rasi5"></a><a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="comment">!Locals</code></a>
<a name="dqsats_rasi6"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">max_mixing_ratio</code>=<code class="constant">1.0</code></a>
<a name="dqsats_rasi7"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">esfac</code></a>
<a name="dqsats_rasi8"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8 </code>:: <code class="vardecl">tl</code>, <code class="vardecl">tt</code>, <code class="vardecl">ti</code>, <code class="vardecl">dqsat</code>, <code class="vardecl">qsat</code>, <code class="vardecl">dqq</code>, <code class="vardecl">qq</code>, <code class="vardecl">pl</code>, <code class="vardecl">pp</code>, <code class="vardecl">dd</code></a>
<a name="dqsats_rasi9"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">it</code></a>
<a name="dqsats_rasi10"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">degsubs</code>=<code class="constant">100</code></a>
<a name="dqsats_rasi11"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">REAL*8</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tmintbl</code>=<code class="constant">150.0</code>, <code class="vardecl">tmaxtbl</code>=<code class="constant">333.0</code></a>
<a name="dqsats_rasi12"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">tablesize</code>=<code class="funcname">NINT</code>(<code class="vardecl">tmaxtbl</code>-<code class="vardecl">tmintbl</code>)*<code class="vardecl">degsubs</code>+<code class="constant">1</code></a>
<a name="dqsats_rasi13"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">NINT</code></a>
<a name="dqsats_rasi14"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">INT</code></a>
<a name="dqsats_rasi15"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile">esfac = cons_h2omw/cons_airmw</a>
<a name="dqsats_rasi16"></a>  <a href="convection_b.html#dqsats_ras_bi0" target="diffFile">tl = temp</a>
<a name="dqsats_rasi17"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile">pl = plo</a>
<a name="dqsats_rasi18"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile">pp = pl*<code class="constant">100.0</code></a>
<a name="dqsats_rasi19"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">IF</code> (tl .LE. tmintbl) <code class="keyword">THEN</code></a>
<a name="dqsats_rasi20"></a>    <a href="convection_b.html#dqsats_ras_b" target="diffFile">ti = tmintbl</a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">ELSE IF</code> (tl .GE. tmaxtbl - <code class="constant">.001</code>) <code class="keyword">THEN</code></a>
<a name="dqsats_rasi21"></a>    <a href="convection_b.html#dqsats_ras_b" target="diffFile">ti = tmaxtbl - <code class="constant">.001</code></a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="dqsats_rasi22"></a>    <a href="convection_b.html#dqsats_ras_bi1" target="diffFile">ti = tl</a>
<a name="dqsats_rasi23"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">END IF</code></a>
<a name="dqsats_rasi24"></a>  <a href="convection_b.html#dqsats_ras_bi3" target="diffFile">tt = (ti-tmintbl)*degsubs + <code class="constant">1</code></a>
<a name="dqsats_rasi25"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile">it = <code class="funcname">INT</code>(tt)</a>
<a name="dqsats_rasi26"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile">dqq = estblx(it+<code class="constant">1</code>) - estblx(it)</a>
  <a href="convection_b.html#dqsats_ras_bi2" target="diffFile">qq = (tt-it)*dqq + estblx(it)</a>
  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">IF</code> (pp .LE. qq) <code class="keyword">THEN</code></a>
    <a href="convection_b.html#dqsats_ras_b" target="diffFile">qsat = max_mixing_ratio</a>
<a name="dqsats_rasi27"></a>    <a href="convection_b.html#dqsats_ras_b" target="diffFile">dqsat = <code class="constant">0.0</code></a>
<a name="dqsats_rasi29"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="dqsats_rasi28"></a>    <a href="convection_b.html#dqsats_ras_bi6" target="diffFile">dd = <code class="constant">1.0</code>/(pp-(<code class="constant">1.0</code>-esfac)*qq)</a>
    <a href="convection_b.html#dqsats_ras_bi5" target="diffFile">qsat = esfac*qq*dd</a>
<a name="dqsats_rasi31"></a>    <a href="convection_b.html#dqsats_ras_bi4" target="diffFile">dqsat = esfac*degsubs*dqq*pp*(dd*dd)</a>
<a name="dqsats_rasi30"></a>  <a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="convection_b.html#dqsats_ras_bi8" target="diffFile">dqsi = dqsat</a>
  <a href="convection_b.html#dqsats_ras_bi7" target="diffFile">qssi = qsat</a>
<a href="convection_b.html#dqsats_ras_b" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">DQSATS_RAS</code></a>

</pre>
</body>
