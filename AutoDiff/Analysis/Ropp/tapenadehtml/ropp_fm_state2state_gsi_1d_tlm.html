<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="ropp_fm_state2state_gsi_1d_tlm"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Ecuador team)</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Tapenade 3.11 (r5903) - 14 Dec 2015 10:32</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Differentiation of ropp_fm_state2state_gsi_1d in forward (tangent) mode:</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!   variations   of useful results: temp shum geop pres</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!   with respect to varying inputs: state</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!   RW status of diff variables: temp:out shum:out state:in geop:out</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!                pres:out</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">ROPP_FM_STATE2STATE_GSI_1D_TLM</code>(<code class="vardecl">n_lev</code>, <code class="vardecl">state</code>, <code class="vardecl">state_tl</code>, <code class="vardecl">temp</code>, <code class="label">&</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi42"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="label">& </code><code class="vardecl">temp_tl</code>, <code class="vardecl">shum</code>, <code class="vardecl">shum_tl</code>, <code class="vardecl">pres</code>, <code class="vardecl">pres_tl</code>, <code class="vardecl">geop</code>, <code class="vardecl">geop_tl</code>, <code class="vardecl">geop_sfc</code>, <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="label">& </code><code class="vardecl">use_logq</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi43"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di62" target="origFile"><code class="keyword">USE </code><code class="funcname">ROPP_FM_CONSTANTS</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi44"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di63" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">wp</code>=<code class="constant">4</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi45"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di64" target="origFile"><code class="comment">!  REAL(wp), PARAMETER ::  </code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di64" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">n_lev</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi46"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di65" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">state</code>(<code class="constant">3</code>*<code class="vardecl">n_lev</code>+<code class="constant">1</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi47"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">state_tl</code>(<code class="constant">3</code>*<code class="vardecl">n_lev</code>+<code class="constant">1</code>)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di66" target="origFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">use_logq</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi48"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di67" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">temp</code>(<code class="vardecl">n_lev</code>)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">temp_tl</code>(<code class="vardecl">n_lev</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi49"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di68" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">shum</code>(<code class="vardecl">n_lev</code>)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">shum_tl</code>(<code class="vardecl">n_lev</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi50"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di69" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">pres</code>(<code class="vardecl">n_lev</code>)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">pres_tl</code>(<code class="vardecl">n_lev</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi51"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di70" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">geop</code>(<code class="vardecl">n_lev</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi52"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">geop_tl</code>(<code class="vardecl">n_lev</code>)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di71" target="origFile"><code class="typename">REAL</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">geop_sfc</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi53"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di72" target="origFile"><code class="comment">! Temporary holder</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di72" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">xstatetmp</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di73" target="origFile"><code class="comment">! Pressure at level edges</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi54"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di73" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">pedg</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">pedg_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di74" target="origFile"><code class="comment">! Virtual temperauture (K)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi55"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di74" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">tv</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">tv_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di75" target="origFile"><code class="comment">! Geopot height half level</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi56"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di75" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">geope</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">geope_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di76" target="origFile"><code class="comment">! log ratio of pressures</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi57"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di76" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">lnpm</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">lnpm_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di77" target="origFile"><code class="comment">! Pressure difference (Pa)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi58"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di77" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">delp</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">delp_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di78" target="origFile"><code class="comment">! Thickness (m)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi59"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di78" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">delz</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">delz_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di79" target="origFile"><code class="comment">! Interpolation coefficient</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi60"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di79" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">alpha</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">alpha_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di80" target="origFile"><code class="comment">! Log pressure at edges</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi61"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di80" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">logp</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">logp_tl</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di81" target="origFile"><code class="comment">! p to the kappa at edges</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi62"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di81" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">pkap</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">pkap_tl</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi63"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di82" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">) </code>:: <code class="vardecl">xkappa</code>, <code class="vardecl">xkappai</code>, <code class="vardecl">dlog</code>, <code class="vardecl">dpkap</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi64"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">) </code>:: <code class="vardecl">dlog_tl</code>, <code class="vardecl">dpkap_tl</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi65"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di83" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">nlev</code>, <code class="vardecl">elev</code>, <code class="vardecl">k</code>, <code class="vardecl">k1</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi66"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di84" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIZE</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi67"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">EXP</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi68"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di86" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">LOG</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di87" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SUM</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi89"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di88" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">) </code>:: <code class="vardecl">pwx1</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">) </code>:: <code class="vardecl">pwx1_tl</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi90"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di69" target="origFile"><code class="comment">!Number of levels</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di69" target="origFile">nlev = n_lev</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di70" target="origFile"><code class="comment">!Number of level edges</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di70" target="origFile">elev = n_lev + <code class="constant">1</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi92"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di91" target="origFile"><code class="keyword">ALLOCATE(</code>xstatetmp<code class="keyword">(</code><code class="funcname">SIZE</code>(state)<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di92" target="origFile"><code class="keyword">ALLOCATE(</code>tv_tl<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi94"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di93" target="origFile"><code class="keyword">ALLOCATE(</code>tv<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di94" target="origFile"><code class="keyword">ALLOCATE(</code>pedg_tl<code class="keyword">(</code>elev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi96"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di95" target="origFile"><code class="keyword">ALLOCATE(</code>pedg<code class="keyword">(</code>elev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di96" target="origFile"><code class="keyword">ALLOCATE(</code>geope_tl<code class="keyword">(</code>elev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi98"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di97" target="origFile"><code class="keyword">ALLOCATE(</code>geope<code class="keyword">(</code>elev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di98" target="origFile"><code class="keyword">ALLOCATE(</code>lnpm_tl<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi100"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di99" target="origFile"><code class="keyword">ALLOCATE(</code>lnpm<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di100" target="origFile"><code class="keyword">ALLOCATE(</code>delp_tl<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi102"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di101" target="origFile"><code class="keyword">ALLOCATE(</code>delp<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di102" target="origFile"><code class="keyword">ALLOCATE(</code>delz_tl<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi104"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di103" target="origFile"><code class="keyword">ALLOCATE(</code>delz<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di104" target="origFile"><code class="keyword">ALLOCATE(</code>alpha_tl<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi106"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di105" target="origFile"><code class="keyword">ALLOCATE(</code>alpha<code class="keyword">(</code>nlev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di106" target="origFile"><code class="keyword">ALLOCATE(</code>logp_tl<code class="keyword">(</code>elev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi108"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di107" target="origFile"><code class="keyword">ALLOCATE(</code>logp<code class="keyword">(</code>elev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi71"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di108" target="origFile"><code class="keyword">ALLOCATE(</code>pkap_tl<code class="keyword">(</code>elev<code class="keyword">))</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di109" target="origFile"><code class="keyword">ALLOCATE(</code>pkap<code class="keyword">(</code>elev<code class="keyword">))</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi110"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di110" target="origFile"><code class="comment">!Virtual temperature</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi72"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di110" target="origFile">tv_tl = state_tl(<code class="constant">1</code>:nlev)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di71" target="origFile">tv = state(<code class="constant">1</code>:nlev)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi111"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di111" target="origFile"><code class="comment">!Specific humidity</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi73"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di111" target="origFile">shum_tl = state_tl(nlev+<code class="constant">1</code>:<code class="constant">2</code>*nlev)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di72" target="origFile">shum = state(nlev+<code class="constant">1</code>:<code class="constant">2</code>*nlev)</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di112" target="origFile"><code class="comment">!Convert virtual temperature to temperature</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi112"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di112" target="origFile">temp_tl = (tv_tl*(<code class="constant">1.0_wp</code>+<code class="constant">0.61_wp</code>*shum)-tv*<code class="constant">0.61_wp</code>*shum_tl)/(<code class="constant">1.0_wp</code>+<code class="label">&</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi74"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di112" target="origFile"><code class="label">&   </code><code class="constant">0.61_wp</code>*shum)**<code class="constant">2</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di73" target="origFile">temp = tv/(<code class="constant">1.0_wp</code>+<code class="constant">0.61_wp</code>*shum)</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di113" target="origFile"><code class="comment">!Pressure at the edge of levels from log(p) x10x100 is to hPa to Pa</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi113"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di113" target="origFile">pedg_tl = <code class="constant">10.0_wp</code>*<code class="constant">100.0_wp</code>*state_tl(<code class="constant">2</code>*nlev+<code class="constant">1</code>:<code class="constant">3</code>*nlev+<code class="constant">1</code>)*<code class="funcname">EXP</code>(state(<code class="constant">2</code>*<code class="label">&</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi114"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di113" target="origFile"><code class="label">&   </code>nlev+<code class="constant">1</code>:<code class="constant">3</code>*nlev+<code class="constant">1</code>))</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di74" target="origFile">pedg = <code class="constant">10.0_wp</code>*<code class="constant">100.0_wp</code>*<code class="funcname">EXP</code>(state(<code class="constant">2</code>*nlev+<code class="constant">1</code>:<code class="constant">3</code>*nlev+<code class="constant">1</code>))</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi115"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di75" target="origFile"><code class="comment">!Pressue at the mid point using the GEOS-5 calculation</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi118"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di75" target="origFile">xkappa = r_dry/c_p</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi77"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di76" target="origFile">xkappai = <code class="constant">1.</code>/xkappa</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi116"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di79" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,elev</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi78"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di116" target="origFile">logp_tl(k) = pedg_tl(k)/pedg(k)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di77" target="origFile">logp(k) = <code class="funcname">LOG</code>(pedg(k))</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile"><code class="keyword">IF</code> (pedg(k) .GT. <code class="constant">0.0 </code>.OR. (pedg(k) .LT. <code class="constant">0.0 </code>.AND. xkappa .EQ. <code class="funcname">INT</code>(<code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile"><code class="label">&       </code>xkappa))) <code class="keyword">THEN</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile">pkap_tl(k) = xkappa*pedg(k)**(xkappa-<code class="constant">1</code>)*pedg_tl(k)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile"><code class="keyword">ELSE IF</code> (pedg(k) .EQ. <code class="constant">0.0 </code>.AND. xkappa .EQ. <code class="constant">1.0</code>) <code class="keyword">THEN</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile">pkap_tl(k) = pedg_tl(k)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile"><code class="keyword">ELSE</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi117"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile">pkap_tl(k) = <code class="constant">0.0</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di117" target="origFile"><code class="keyword">END IF</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di78" target="origFile">pkap(k) = pedg(k)**xkappa</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi123"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di79" target="origFile"><code class="keyword">END DO</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi80"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pres_tl = <code class="constant">0.0</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi119"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di84" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,nlev</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi81"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di119" target="origFile">dlog_tl = logp_tl(k) - logp_tl(k+<code class="constant">1</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi120"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di80" target="origFile">dlog = logp(k) - logp(k+<code class="constant">1</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi82"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di120" target="origFile">dpkap_tl = pkap_tl(k) - pkap_tl(k+<code class="constant">1</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi121"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di81" target="origFile">dpkap = pkap(k) - pkap(k+<code class="constant">1</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi83"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di121" target="origFile">pwx1_tl = (xkappai*dpkap_tl*dlog-xkappai*dpkap*dlog_tl)/dlog**<code class="constant">2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di82" target="origFile">pwx1 = xkappai*dpkap/dlog</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile"><code class="keyword">IF</code> (pwx1 .GT. <code class="constant">0.0 </code>.OR. (pwx1 .LT. <code class="constant">0.0 </code>.AND. xkappai .EQ. <code class="funcname">INT</code>(xkappai<code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile"><code class="label">&       </code>))) <code class="keyword">THEN</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile">pres_tl(k) = xkappai*pwx1**(xkappai-<code class="constant">1</code>)*pwx1_tl</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile"><code class="keyword">ELSE IF</code> (pwx1 .EQ. <code class="constant">0.0 </code>.AND. xkappai .EQ. <code class="constant">1.0</code>) <code class="keyword">THEN</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile">pres_tl(k) = pwx1_tl</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile"><code class="keyword">ELSE</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi122"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile">pres_tl(k) = <code class="constant">0.0</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di122" target="origFile"><code class="keyword">END IF</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi124"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di83" target="origFile">pres(k) = pwx1**xkappai</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di84" target="origFile"><code class="keyword">END DO</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi86"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="comment">!Update specific humidity - circular on tv because of calc on check_qsat?</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi125"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">IF</code> (use_logq) <code class="keyword">THEN</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi87"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di125" target="origFile">shum_tl = shum_tl*<code class="funcname">EXP</code>(shum)/<code class="constant">1000.0_wp</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di86" target="origFile">shum = <code class="funcname">EXP</code>(shum)/<code class="constant">1000.0_wp</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di126" target="origFile"><code class="keyword">CALL </code><code class="funcname">CHECK_QSAT_TLM</code>(shum, shum_tl, temp, temp_tl, pres, pres_tl, <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di126" target="origFile"><code class="label">&                 </code>nlev)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi89"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">ELSE</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi128"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">WHERE </code>(shum .LE. <code class="constant">0.0_wp</code>) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di128" target="origFile">shum_tl = <code class="constant">0.0</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di89" target="origFile">shum = <code class="constant">1.0e-9_wp</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi90"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">END WHERE</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di85" target="origFile"><code class="keyword">END IF</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di129" target="origFile"><code class="comment">!Geopotential height - follows ECMWF version</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi129"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di129" target="origFile"><code class="comment">!Pressure differences at mid</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi91"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di129" target="origFile">delp_tl = pedg_tl(<code class="constant">1</code>:elev-<code class="constant">1</code>) - pedg_tl(<code class="constant">2</code>:elev)</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di90" target="origFile">delp = pedg(<code class="constant">1</code>:elev-<code class="constant">1</code>) - pedg(<code class="constant">2</code>:elev)</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di130" target="origFile"><code class="comment">!Log of pressure ratio at mid</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi130"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di130" target="origFile">lnpm_tl = (pedg_tl(<code class="constant">1</code>:elev-<code class="constant">1</code>)*pedg(<code class="constant">2</code>:elev)-pedg(<code class="constant">1</code>:elev-<code class="constant">1</code>)*pedg_tl(<code class="constant">2</code>:<code class="label">&</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi92"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di130" target="origFile"><code class="label">&   </code>elev))/(pedg(<code class="constant">2</code>:elev)*pedg(<code class="constant">1</code>:elev-<code class="constant">1</code>))</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di91" target="origFile">lnpm = <code class="funcname">LOG</code>(pedg(<code class="constant">1</code>:elev-<code class="constant">1</code>)/pedg(<code class="constant">2</code>:elev))</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di131" target="origFile"><code class="comment">!Interpolation coefficients</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi131"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di131" target="origFile">alpha_tl = -((pedg_tl(<code class="constant">2</code>:elev)*delp-pedg(<code class="constant">2</code>:elev)*delp_tl)*lnpm/delp**<code class="constant">2</code>)<code class="label">&</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi93"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di131" target="origFile"><code class="label">&   </code>- pedg(<code class="constant">2</code>:elev)*lnpm_tl/delp</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi132"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di92" target="origFile">alpha = <code class="constant">1.0_wp </code>- pedg(<code class="constant">2</code>:elev)/delp*lnpm</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi94"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di132" target="origFile">alpha_tl(elev-<code class="constant">1</code>) = <code class="constant">0.0_4</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di93" target="origFile">alpha(elev-<code class="constant">1</code>) = <code class="funcname">LOG</code>(<code class="constant">2.0_wp</code>)</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi133"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di133" target="origFile"><code class="comment">!Function to be integrated</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi135"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di133" target="origFile">delz_tl = r_dry*(tv_tl*lnpm+tv*lnpm_tl)/g_wmo</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di94" target="origFile">delz = r_dry*tv*lnpm/g_wmo</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi95"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di96" target="origFile"><code class="comment">!Calculate geopotential height integral</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi134"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di96" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,elev</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di134" target="origFile">geope_tl(k) = <code class="funcname">SUM</code>(delz_tl(<code class="constant">1</code>:k-<code class="constant">1</code>))</a>
<a name="ropp_fm_state2state_gsi_1d_tlmi97"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di95" target="origFile">geope(k) = geop_sfc + <code class="funcname">SUM</code>(delz(<code class="constant">1</code>:k-<code class="constant">1</code>))</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di96" target="origFile"><code class="keyword">END DO</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi136"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di136" target="origFile"><code class="comment">!Interpolate onto full levels </code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di136" target="origFile">geop_tl = geope_tl(<code class="constant">1</code>:elev-<code class="constant">1</code>) + r_dry*(alpha_tl*tv+alpha*tv_tl)/g_wmo</a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di97" target="origFile">geop = geope(<code class="constant">1</code>:elev-<code class="constant">1</code>) + alpha*r_dry*tv/g_wmo</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di137" target="origFile"><code class="comment">!Clean up</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi138"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di137" target="origFile"><code class="keyword">DEALLOCATE(</code>xstatetmp<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di138" target="origFile"><code class="keyword">DEALLOCATE(</code>tv_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi140"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di139" target="origFile"><code class="keyword">DEALLOCATE(</code>tv<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di140" target="origFile"><code class="keyword">DEALLOCATE(</code>pedg_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi142"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di141" target="origFile"><code class="keyword">DEALLOCATE(</code>pedg<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di142" target="origFile"><code class="keyword">DEALLOCATE(</code>geope_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi144"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di143" target="origFile"><code class="keyword">DEALLOCATE(</code>geope<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di144" target="origFile"><code class="keyword">DEALLOCATE(</code>lnpm_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi146"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di145" target="origFile"><code class="keyword">DEALLOCATE(</code>lnpm<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di146" target="origFile"><code class="keyword">DEALLOCATE(</code>delp_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi148"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di147" target="origFile"><code class="keyword">DEALLOCATE(</code>delp<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di148" target="origFile"><code class="keyword">DEALLOCATE(</code>delz_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi150"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di149" target="origFile"><code class="keyword">DEALLOCATE(</code>delz<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di150" target="origFile"><code class="keyword">DEALLOCATE(</code>alpha_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi152"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di151" target="origFile"><code class="keyword">DEALLOCATE(</code>alpha<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di152" target="origFile"><code class="keyword">DEALLOCATE(</code>logp_tl<code class="keyword">)</code></a>
<a name="ropp_fm_state2state_gsi_1d_tlmi154"></a>  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di153" target="origFile"><code class="keyword">DEALLOCATE(</code>logp<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di154" target="origFile"><code class="keyword">DEALLOCATE(</code>pkap_tl<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di155" target="origFile"><code class="keyword">DEALLOCATE(</code>pkap<code class="keyword">)</code></a>
<a name="check_qsat_tlm"></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">CONTAINS</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Differentiation of check_qsat in forward (tangent) mode:</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!   variations   of useful results: shum</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!   with respect to varying inputs: temp shum press</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!-------------------------------------------------------------------------------</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">! 9. Compute Saturation Vapour Pressure - limit log(humidity) within saturation </code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!-------------------------------------------------------------------------------</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CHECK_QSAT_TLM</code>(<code class="vardecl">shum</code>, <code class="vardecl">shum_tl</code>, <code class="vardecl">temp</code>, <code class="vardecl">temp_tl</code>, <code class="vardecl">press</code>, <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="label">&   </code><code class="vardecl">press_tl</code>, <code class="vardecl">nlev</code>)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">USE </code><code class="funcname">DIFFSIZES</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Hint: ISIZE1OFpwy1 should be the size of dimension 1 of array pwy1</code></a>
<a name="check_qsat_tlmi0"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Hint: ISIZE1OFpwy2 should be the size of dimension 1 of array pwy2</code></a>
<a name="check_qsat_tlmi1"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a name="check_qsat_tlmi2"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di0" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">wp</code>=<code class="constant">4</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di1" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nlev</code></a>
<a name="check_qsat_tlmi3"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di2" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">shum</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(nlev), <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">shum_tl</code></a>
<a name="check_qsat_tlmi4"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di3" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">temp</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(nlev), <code class="typename">INTENT(IN) </code>:: <code class="vardecl">temp_tl</code></a>
<a name="check_qsat_tlmi5"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di4" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(nlev), <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press_tl</code></a>
<a name="check_qsat_tlmi6"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di5" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">z</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">z_tl</code></a>
<a name="check_qsat_tlmi7"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di6" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">x</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">x_tl</code></a>
<a name="check_qsat_tlmi8"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di7" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">tfrac</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">tfrac_tl</code></a>
<a name="check_qsat_tlmi9"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di8" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">es</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">es_tl</code></a>
<a name="check_qsat_tlmi10"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di9" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">qs</code></a>
<a name="check_qsat_tlmi11"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(:), <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">qs_tl</code></a>
<a name="check_qsat_tlmi12"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di10" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIZE</code></a>
<a name="check_qsat_tlmi13"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di11" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">LOG10</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di12" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="check_qsat_tlmi14"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di13" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy1</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy1_tl</code></a>
<a name="check_qsat_tlmi15"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di14" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwr1</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwr1_tl</code></a>
<a name="check_qsat_tlmi16"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di15" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwy2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwy2_tl</code></a>
<a name="check_qsat_tlmi17"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di16" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwr2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwr2_tl</code></a>
<a name="check_qsat_tlmi18"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di17" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy10</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy10_tl</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di18" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy11</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy11_tl</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL*4 </code>:: <code class="vardecl">max1_tl</code>(<code class="vardecl">nlev</code>)</a>
<a name="check_qsat_tlmi19"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL*4 </code>:: <code class="vardecl">max1</code>(<code class="vardecl">nlev</code>)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di19" target="origFile"><code class="keyword">ALLOCATE(</code>es_tl<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi21"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di20" target="origFile"><code class="keyword">ALLOCATE(</code>es<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di21" target="origFile"><code class="keyword">ALLOCATE(</code>qs_tl<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi23"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di22" target="origFile"><code class="keyword">ALLOCATE(</code>qs<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di23" target="origFile"><code class="keyword">ALLOCATE(</code>z_tl<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi25"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di24" target="origFile"><code class="keyword">ALLOCATE(</code>z<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di25" target="origFile"><code class="keyword">ALLOCATE(</code>x_tl<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi27"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di26" target="origFile"><code class="keyword">ALLOCATE(</code>x<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi19"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di27" target="origFile"><code class="keyword">ALLOCATE(</code>tfrac_tl<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di28" target="origFile"><code class="keyword">ALLOCATE(</code>tfrac<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a name="check_qsat_tlmi29"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di29" target="origFile"><code class="comment">! 9.1 Goff-Gratch equation (saturation vapour pressure over water)</code></a>
<a name="check_qsat_tlmi20"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di29" target="origFile">tfrac_tl = -(<code class="constant">373.16_wp</code>*temp_tl/temp**<code class="constant">2</code>)</a>
<a name="check_qsat_tlmi30"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di19" target="origFile">tfrac = <code class="constant">373.16_wp</code>/temp</a>
<a name="check_qsat_tlmi21"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di30" target="origFile">pwy1_tl = <code class="constant">11.344</code>*tfrac_tl/tfrac**<code class="constant">2</code></a>
<a name="check_qsat_tlmi31"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di20" target="origFile">pwy1 = <code class="constant">11.344</code>*(<code class="constant">1.0_wp</code>-<code class="constant">1.0_wp</code>/tfrac)</a>
<a name="check_qsat_tlmi22"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di31" target="origFile">pwr1_tl = <code class="constant">10</code>**pwy1*<code class="funcname">LOG</code>(<code class="constant">10</code>)*pwy1_tl</a>
<a name="check_qsat_tlmi32"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di21" target="origFile">pwr1 = <code class="constant">10</code>**pwy1</a>
<a name="check_qsat_tlmi23"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di32" target="origFile">pwy2_tl = -(<code class="constant">3.49149</code>*tfrac_tl)</a>
<a name="check_qsat_tlmi33"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di22" target="origFile">pwy2 = -(<code class="constant">3.49149</code>*(tfrac-<code class="constant">1.0_wp</code>))</a>
<a name="check_qsat_tlmi24"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di33" target="origFile">pwr2_tl = <code class="constant">10</code>**pwy2*<code class="funcname">LOG</code>(<code class="constant">10</code>)*pwy2_tl</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di23" target="origFile">pwr2 = <code class="constant">10</code>**pwy2</a>
<a name="check_qsat_tlmi34"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di34" target="origFile">z_tl = <code class="constant">5.02808_wp</code>*tfrac_tl/(tfrac*<code class="funcname">LOG</code>(<code class="constant">10.0</code>)) - <code class="constant">7.90298_wp</code>*tfrac_tl -<code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di34" target="origFile"><code class="label">&     </code><code class="constant">1.3816e-7_wp</code>*pwr1_tl + <code class="constant">8.1328e-3_wp</code>*pwr2_tl</a>
<a name="check_qsat_tlmi25"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di24" target="origFile">z = -(<code class="constant">7.90298_wp</code>*(tfrac-<code class="constant">1.0_wp</code>)) + <code class="constant">5.02808_wp</code>*<code class="funcname">LOG10</code>(tfrac) - <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di24" target="origFile"><code class="label">&     </code><code class="constant">1.3816e-7_wp</code>*(pwr1-<code class="constant">1.0_wp</code>) + <code class="constant">8.1328e-3_wp</code>*(pwr2-<code class="constant">1.0_wp</code>)</a>
<a name="check_qsat_tlmi35"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di35" target="origFile"><code class="comment">! 9.2 Goff-Gratch equation (saturation vapour pressure over ice)</code></a>
<a name="check_qsat_tlmi26"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di35" target="origFile">tfrac_tl(:) = -(<code class="constant">273.16_wp</code>*temp_tl(:)/temp(:)**<code class="constant">2</code>)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di25" target="origFile">tfrac(:) = <code class="constant">273.16_wp</code>/temp(:)</a>
<a name="check_qsat_tlmi36"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di36" target="origFile">x_tl = <code class="constant">0.876793_wp</code>*tfrac_tl/tfrac**<code class="constant">2 </code>- <code class="constant">3.56654_wp</code>*tfrac_tl/(tfrac*<code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di36" target="origFile"><code class="label">&     </code><code class="funcname">LOG</code>(<code class="constant">10.0</code>)) - <code class="constant">9.09718_wp</code>*tfrac_tl</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di26" target="origFile">x = -(<code class="constant">9.09718_wp</code>*(tfrac-<code class="constant">1.0_wp</code>)) + (-(<code class="constant">3.56654_wp</code>*<code class="funcname">LOG10</code>(tfrac))) + <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di26" target="origFile"><code class="label">&     </code><code class="constant">0.876793_wp</code>*(<code class="constant">1.0_wp</code>-<code class="constant">1.0_wp</code>/tfrac)</a>
<a name="check_qsat_tlmi28"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di38" target="origFile">pwy10_tl = <code class="constant">0.0_4</code></a>
<a name="check_qsat_tlmi38"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(temp .GE. <code class="constant">273.16</code>) </a>
<a name="check_qsat_tlmi29"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di38" target="origFile">pwy10_tl = z_tl</a>
<a name="check_qsat_tlmi39"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di28" target="origFile">pwy10 = z</a>
<a name="check_qsat_tlmi30"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di39" target="origFile">pwr1_tl = <code class="constant">10</code>**pwy10*<code class="funcname">LOG</code>(<code class="constant">10</code>)*pwy10_tl</a>
<a name="check_qsat_tlmi40"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di29" target="origFile">pwr1 = <code class="constant">10</code>**pwy10</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di40" target="origFile">es_tl = <code class="constant">1013246.0_wp</code>*pwr1_tl</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di30" target="origFile">es = <code class="constant">1013246.0_wp</code>*pwr1</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
<a name="check_qsat_tlmi31"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di41" target="origFile">pwy11_tl = <code class="constant">0.0_4</code></a>
<a name="check_qsat_tlmi41"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(.NOT.temp .GE. <code class="constant">273.16</code>) </a>
<a name="check_qsat_tlmi32"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di41" target="origFile">pwy11_tl = x_tl</a>
<a name="check_qsat_tlmi42"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di31" target="origFile">pwy11 = x</a>
<a name="check_qsat_tlmi33"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di42" target="origFile">pwr1_tl = <code class="constant">10</code>**pwy11*<code class="funcname">LOG</code>(<code class="constant">10</code>)*pwy11_tl</a>
<a name="check_qsat_tlmi43"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di32" target="origFile">pwr1 = <code class="constant">10</code>**pwy11</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di43" target="origFile">es_tl = <code class="constant">610.71_wp</code>*pwr1_tl</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di33" target="origFile">es = <code class="constant">610.71_wp</code>*pwr1</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
<a name="check_qsat_tlmi35"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di45" target="origFile">max1_tl = <code class="constant">0.0_4</code></a>
<a name="check_qsat_tlmi45"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(press .LT. es) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di45" target="origFile">max1_tl = es_tl</a>
<a name="check_qsat_tlmi36"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di35" target="origFile">max1 = es</a>
<a name="check_qsat_tlmi46"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ELSEWHERE</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di46" target="origFile">max1_tl = press_tl</a>
<a name="check_qsat_tlmi37"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di36" target="origFile">max1 = press</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di47" target="origFile"><code class="comment">! 9.3 Compute saturation humidity</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di47" target="origFile">qs_tl = (epsilon_water*es_tl*(max1-(<code class="constant">1.0_wp</code>-epsilon_water)*es)-es*<code class="label">&</code></a>
<a name="check_qsat_tlmi47"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di47" target="origFile"><code class="label">&     </code>epsilon_water*(max1_tl-(<code class="constant">1.0_wp</code>-epsilon_water)*es_tl))/(max1-(<code class="label">&</code></a>
<a name="p0"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di47" target="origFile"><code class="label">&     </code><code class="constant">1.0_wp</code>-epsilon_water)*es)**<code class="constant">2</code></a>
<a name="check_qsat_tlmi39"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di37" target="origFile">qs = es*epsilon_water/(max1-(<code class="constant">1.0_wp</code>-epsilon_water)*es)</a>
<a name="check_qsat_tlmi49"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(</a><a href="msg.html#p0" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">qs .EQ. <code class="constant">1.0_wp</code>) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di49" target="origFile">qs_tl = <code class="constant">2.0_wp</code>*shum_tl(<code class="funcname">SIZE</code>(shum))</a>
<a name="p1"></a>      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di39" target="origFile">qs = <code class="constant">2.0_wp</code>*shum(<code class="funcname">SIZE</code>(shum))</a>
<a name="check_qsat_tlmi41"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
<a name="check_qsat_tlmi51"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(shum .GT. </a><a href="msg.html#p1" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">qs) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di51" target="origFile">shum_tl = qs_tl</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di41" target="origFile">shum = qs</a>
<a name="check_qsat_tlmi52"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di52" target="origFile"><code class="keyword">DEALLOCATE(</code>es_tl<code class="keyword">)</code></a>
<a name="check_qsat_tlmi54"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di53" target="origFile"><code class="keyword">DEALLOCATE(</code>es<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di54" target="origFile"><code class="keyword">DEALLOCATE(</code>qs_tl<code class="keyword">)</code></a>
<a name="check_qsat_tlmi56"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di55" target="origFile"><code class="keyword">DEALLOCATE(</code>qs<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di56" target="origFile"><code class="keyword">DEALLOCATE(</code>z_tl<code class="keyword">)</code></a>
<a name="check_qsat_tlmi58"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di57" target="origFile"><code class="keyword">DEALLOCATE(</code>z<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di58" target="origFile"><code class="keyword">DEALLOCATE(</code>x_tl<code class="keyword">)</code></a>
<a name="check_qsat_tlmi60"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di59" target="origFile"><code class="keyword">DEALLOCATE(</code>x<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di60" target="origFile"><code class="keyword">DEALLOCATE(</code>tfrac_tl<code class="keyword">)</code></a>
<a name="check_qsat"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1di61" target="origFile"><code class="keyword">DEALLOCATE(</code>tfrac<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CHECK_QSAT_TLM</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!-------------------------------------------------------------------------------</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">! 9. Compute Saturation Vapour Pressure - limit log(humidity) within saturation </code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!-------------------------------------------------------------------------------</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">CHECK_QSAT</code>(<code class="vardecl">shum</code>, <code class="vardecl">temp</code>, <code class="vardecl">press</code>, <code class="vardecl">nlev</code>)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">USE </code><code class="funcname">DIFFSIZES</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Hint: ISIZE1OFpwy1 should be the size of dimension 1 of array pwy1</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">!  Hint: ISIZE1OFpwy2 should be the size of dimension 1 of array pwy2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">wp</code>=<code class="constant">4</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">INTEGER</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nlev</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">shum</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">temp</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>nlev<code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">press</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">z</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">x</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">tfrac</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">es</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:<code class="typename">)</code>, <code class="typename">ALLOCATABLE </code>:: <code class="vardecl">qs</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SIZE</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">LOG10</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy1</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwr1</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwy2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy2) :: <code class="vardecl">pwr2</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy10</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL(</code><code class="modifier">wp</code><code class="typename">)</code>, DIMENSION(ISIZE1OFpwy1) :: <code class="vardecl">pwy11</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="typename">REAL*4 </code>:: <code class="vardecl">max1</code>(<code class="vardecl">nlev</code>)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ALLOCATE(</code>es<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ALLOCATE(</code>qs<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ALLOCATE(</code>z<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ALLOCATE(</code>x<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ALLOCATE(</code>tfrac<code class="keyword">(</code><code class="funcname">SIZE</code>(shum)<code class="keyword">))</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">! 9.1 Goff-Gratch equation (saturation vapour pressure over water)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">tfrac = <code class="constant">373.16_wp</code>/temp</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwy1 = <code class="constant">11.344</code>*(<code class="constant">1.0_wp</code>-<code class="constant">1.0_wp</code>/tfrac)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwr1 = <code class="constant">10</code>**pwy1</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwy2 = -(<code class="constant">3.49149</code>*(tfrac-<code class="constant">1.0_wp</code>))</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwr2 = <code class="constant">10</code>**pwy2</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">z = -(<code class="constant">7.90298_wp</code>*(tfrac-<code class="constant">1.0_wp</code>)) + <code class="constant">5.02808_wp</code>*<code class="funcname">LOG10</code>(tfrac) - <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="label">&     </code><code class="constant">1.3816e-7_wp</code>*(pwr1-<code class="constant">1.0_wp</code>) + <code class="constant">8.1328e-3_wp</code>*(pwr2-<code class="constant">1.0_wp</code>)</a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">! 9.2 Goff-Gratch equation (saturation vapour pressure over ice)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">tfrac(:) = <code class="constant">273.16_wp</code>/temp(:)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">x = -(<code class="constant">9.09718_wp</code>*(tfrac-<code class="constant">1.0_wp</code>)) + (-(<code class="constant">3.56654_wp</code>*<code class="funcname">LOG10</code>(tfrac))) + <code class="label">&</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="label">&     </code><code class="constant">0.876793_wp</code>*(<code class="constant">1.0_wp</code>-<code class="constant">1.0_wp</code>/tfrac)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(temp .GE. <code class="constant">273.16</code>) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwy10 = z</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwr1 = <code class="constant">10</code>**pwy10</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">es = <code class="constant">1013246.0_wp</code>*pwr1</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ELSEWHERE</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwy11 = x</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">pwr1 = <code class="constant">10</code>**pwy11</a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">es = <code class="constant">610.71_wp</code>*pwr1</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(press .LT. es) </a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">max1 = es</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">ELSEWHERE</code></a>
      <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">max1 = press</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END WHERE</code></a>
<a name="p0"></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="comment">! 9.3 Compute saturation humidity</code></a>
<a name="p1"></a>    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">qs = es*epsilon_water/(max1-(<code class="constant">1.0_wp</code>-epsilon_water)*es)</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(</a><a href="msg.html#p0" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">qs .EQ. <code class="constant">1.0_wp</code>) qs = <code class="constant">2.0_wp</code>*shum(<code class="funcname">SIZE</code>(shum))</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">WHERE </code>(shum .GT. </a><a href="msg.html#p1" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile">qs) shum = qs</a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">DEALLOCATE(</code>es<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">DEALLOCATE(</code>qs<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">DEALLOCATE(</code>z<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">DEALLOCATE(</code>x<code class="keyword">)</code></a>
    <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">DEALLOCATE(</code>tfrac<code class="keyword">)</code></a>
  <a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">CHECK_QSAT</code></a>
<a href="ropp_fm_state2state_gsi_1d_p.html#ropp_fm_state2state_gsi_1d" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">ROPP_FM_STATE2STATE_GSI_1D_TLM</code></a>
</pre>
</body>
